<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8" />
  <title>台語字詞排序遊戲</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0;
      height: 100%;
      background-color: #ffecb3; /* 活潑有活力的淡黃色背景 */
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px 10px;
    }
    h1 {
      margin-bottom: 0.5em;
      color: #2e7d32; /* 綠色標題 */
    }
    #instruction {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: #555;
    }
    #words {
      display: flex;
      flex-wrap: nowrap; /* 一行排列 */
      justify-content: center;
      gap: 12px;
      min-height: 60px;
      background: #fff;
      border: 3px dashed #81c784;
      border-radius: 12px;
      padding: 10px 15px;
      margin-bottom: 20px;
      user-select: none;
      overflow-x: auto;
    }
    .word {
      background-color: #aed581;
      padding: 10px 16px;
      border-radius: 10px;
      cursor: grab;
      font-weight: 600;
      white-space: nowrap;
      color: #1b5e20;
      user-select: none;
    }
    button {
      font-size: 1em;
      padding: 10px 20px;
      margin: 5px 10px 5px 0;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      background-color: #4caf50;
      color: white;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #388e3c;
    }
    #result {
      font-weight: bold;
      font-size: 1.3em;
      margin-top: 15px;
      min-height: 1.5em;
    }
    #progress {
      margin-top: 15px;
      font-size: 1em;
      color: #2e7d32;
    }
    a.dict-link {
      margin-left: 10px;
      font-size: 0.9em;
      color: #388e3c;
      text-decoration: underline;
    }
    a.dict-link:hover {
      color: #2e7d32;
    }
  </style>
</head>
<body>
  <h1>台語字詞排序遊戲</h1>
  <div id="instruction">請 kā tsia-ê 字詞排 hōo 好勢</div>
  <div id="words"></div>
  <div>
    <button id="btn-confirm">確認</button>
    <button id="btn-restart">重新開始</button>
    <button id="btn-next">後一條</button>
    <button id="btn-show-answer">提示正確答案</button>
    <button id="btn-play-audio">播放語音</button>
    <a id="dict-link" href="#" class="dict-link" target="_blank" rel="noopener noreferrer">看教典</a>
  </div>
  <div id="result"></div>
  <div id="progress"></div>

  <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
  <script>
    const questions = [
      {
        words: ["囡仔人", "有", "耳", "無", "喙", "。"],
        answer: "囡仔人有耳無喙。",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/47/47743.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/2144/"
      },
      {
        words: ["鳥仔", "生成", "會", "飛", "，", "人", "生成", "會", "行路", "。"],
        answer: "鳥仔生成會飛，人生成會行路。",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/47/47451.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/1890/"
      },
      {
        words: ["伊", "是", "一个", "笑面虎", "，", "你", "著愛", "注意", "！"],
        answer: "伊是一个笑面虎，你著愛注意！",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/52/52341.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/6444/"
      },
      {
        words: ["干焦", "賰", "遮的", "菜", "爾爾", "，", "你", "欲", "無", "？"],
        answer: "干焦賰遮的菜爾爾，你欲無？",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/46/46044.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/448/"
      },
      {
        words: ["食", "杏仁茶", "配", "油炸粿", "。"],
        answer: "食杏仁茶配油炸粿。",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/50/50167.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/4283/"
      },
      {
        words: ["一陣", "囡仔", "佇遐", "咧", "掩咯雞", "。"],
        answer: "一陣囡仔佇遐咧掩咯雞。",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/53/53291.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/7356/"
      },
      {
        words: ["伊", "才", "毋是", "彼款", "會", "食錢", "的", "人", "。"],
        answer: "伊才毋是彼款會食錢的人。",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/51/51542.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/5674/"
      },
      {
        words: ["今仔日", "的", "日頭", "真", "猛", "。"],
        answer: "今仔日的日頭真猛。",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/46/46720.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/tshiau/?lui=tai_ku&tsha=%E4%BB%8A%E4%BB%94%E6%97%A5%E7%9A%84%E6%97%A5%E9%A0%AD%E7%9C%9F%E7%8C%9B"
      },
      {
        words: ["這陣", "當咧", "出", "大日虎", "，", "咱", "上好", "莫", "出門", "，", "較袂", "著痧", "。"],
        answer: "這陣當咧出大日虎，咱上好莫出門，較袂著痧。",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/wS/Jb/29207-1-1.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/29207/"
      },
      {
        words: ["落", "遐大", "的", "雨", "閣", "拄著", "滇流", "，", "莫怪", "會", "做大水", "。"],
        answer: "落遐大的雨閣拄著滇流，莫怪會做大水。",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/leku/61/61975.mp3",
        dict: "https://sutian.moe.edu.tw/und-hani/su/18989/"
      }
    ];

    const wordsContainer = document.getElementById('words');
    const btnConfirm = document.getElementById('btn-confirm');
    const btnRestart = document.getElementById('btn-restart');
    const btnNext = document.getElementById('btn-next');
    const btnShowAnswer = document.getElementById('btn-show-answer');
    const btnPlayAudio = document.getElementById('btn-play-audio');
    const resultDiv = document.getElementById('result');
    const progressDiv = document.getElementById('progress');
    const dictLink = document.getElementById('dict-link');

    let currentIndex = 0;
    let sortable;

    function shuffleArray(arr) {
      const array = arr.slice();
      for(let i = array.length -1; i>0; i--){
        const j = Math.floor(Math.random() * (i+1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function loadQuestion(index){
      if(index < 0 || index >= questions.length) return;
      const q = questions[index];
      resultDiv.textContent = '';
      dictLink.href = q.dict;
      dictLink.textContent = '看教典';

      // 清空字詞
      wordsContainer.innerHTML = '';

      // 洗牌字詞放入
      const shuffled = shuffleArray(q.words);
      for(let w of shuffled){
        const div = document.createElement('div');
        div.className = 'word';
        div.textContent = w;
        wordsContainer.appendChild(div);
      }

      // 初始化 Sortable
      if(sortable) sortable.destroy();
      sortable = new Sortable(wordsContainer, {
        animation: 150,
        ghostClass: 'sortable-ghost',
      });

      // 更新進度
      progressDiv.textContent = `第 ${index + 1} 題，共 ${questions.length} 題`;
    }

    function checkAnswer(){
      const q = questions[currentIndex];
      const arranged = Array.from(wordsContainer.children).map(div => div.textContent).join('');
      if(arranged === q.answer){
        resultDiv.style.color = 'green';
        resultDiv.textContent = '✅ 著！有夠𠢕！';
      } else {
        resultDiv.style.color = 'red';
        resultDiv.textContent = '毋著喔，閣試一擺。';
      }
    }

    function restartQuestion(){
      loadQuestion(currentIndex);
      resultDiv.textContent = '';
    }

    function nextQuestion(){
      if(currentIndex < questions.length -1){
        currentIndex++;
        loadQuestion(currentIndex);
      } else {
        alert('已經是最後一題了');
      }
    }

    function showAnswer(){
      const q = questions[currentIndex];
      wordsContainer.innerHTML = '';
      for(let ch of q.answer){
        const div = document.createElement('div');
        div.className = 'word';
        div.textContent = ch;
        wordsContainer.appendChild(div);
      }
      resultDiv.style.color = 'blue';
      resultDiv.textContent = '提示：正確答案';
    }

    function playAudio(){
      const q = questions[currentIndex];
      const audio = new Audio(q.audio);
      audio.play();
    }

    btnConfirm.addEventListener('click', checkAnswer);
    btnRestart.addEventListener('click', restartQuestion);
    btnNext.addEventListener('click', nextQuestion);
    btnShowAnswer.addEventListener('click', showAnswer);
    btnPlayAudio.addEventListener('click', playAudio);

    loadQuestion(currentIndex);
  </script>
</body>
</html>

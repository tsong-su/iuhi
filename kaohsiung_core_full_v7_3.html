<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"/>
<title>é«˜é›„å¸‚æ–°èˆŠåœ°åæ‹–æ›³é…å°ï½œå¸‚ä¸­å¿ƒå€ v7.3ï¼ˆæ»¿ç‰ˆå›ºå®šæ¨™ç±¤ï¼‰</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700;800&display=swap">
<style>
:root{ --ink:#0f172a; --bg:#f7f8fb; --card:#fff; --border:#e5e7eb; --good:#22c55e; --bad:#ef4444; }
*{box-sizing:border-box; -webkit-tap-highlight-color:transparent}
html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,-apple-system,Arial}
h1{margin:.6rem 0 .2rem;text-align:center;font-weight:800;font-size:clamp(20px,3.4vw,28px)}
.p{text-align:center;margin:.1rem 0;color:#5b6470;font-size:14px}
.wrapper{max-width:1100px;margin:0 auto;padding:0 10px 14px}
.board{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.08);overflow:hidden}
.mapbox{position:relative;width:100%;height:74vh;min-height:540px;background:#fff}
.mapbox svg{width:100%;height:100%;display:block}
.mapbox svg path,.mapbox svg polygon,.mapbox svg polyline{vector-effect:non-scaling-stroke;stroke-linejoin:round;stroke-linecap:round}
.non-core{display:none !important}
.core-district{fill:url(#coreGrad);stroke:#1f2937;stroke-width:.9}
svg text.label{font-weight:900;fill:#5a3000;paint-order:stroke;stroke:#fff;stroke-width:2px;stroke-linejoin:round;letter-spacing:.5px; font-size:12px}
svg text.label tspan{fill:#8a4b00;font-weight:800;font-size:10px}

.tray{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;padding:12px;background:#fff;border-top:1px dashed var(--border)}
.chip{user-select:none;touch-action:none;padding:10px 12px;border-radius:14px;border:2px solid #f6a270;background:#fff;
      box-shadow:0 3px 8px rgba(0,0,0,.18);font-weight:900;color:#5a3000;display:inline-flex;flex-direction:column;align-items:center;gap:2px}
.chip .poj{font-size:12px;color:#8a4b00}
.chip.dragging{opacity:.85;box-shadow:0 10px 24px rgba(0,0,0,.28)}
.chip.correct{border-color:var(--good)}
.chip.wrong{border-color:var(--bad);animation:shake .28s linear 1}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)}}

.footer{text-align:center;padding:12px}
.btn{display:inline-block;margin:0 6px;background:linear-gradient(145deg,#ffa96e,#ffcf9b);color:#fff;padding:9px 14px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.18);border:0;font-weight:900}
.btn.green{background:linear-gradient(145deg,#34d399,#059669)}
.toast{position:fixed;left:50%;top:12px;transform:translateX(-50%);background:#111827;color:#fff;padding:8px 12px;border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.25);font-weight:700;z-index:999;display:none}
</style>
</head>
<body>
  <h1>é«˜é›„å¸‚æ–°èˆŠåœ°åæ‹–æ›³é…å°ï½œå¸‚ä¸­å¿ƒå€</h1>
  <p class="p">ğŸ“± å»ºè­°ç›´å¼è§€çœ‹æ•ˆæœæœ€ä½³</p>
  <p class="p">ğŸ‘‡ æŠŠã€ŒèˆŠåœ°åï¼‹æ‹¼éŸ³ã€æ‹–åˆ°åœ–ä¸Šçš„æ­£ç¢ºä½ç½®ï¼ˆåœ–ä¸Šæ–‡å­—ç‚ºæ–°åœ°åï¼‹æ‹¼éŸ³ï¼‰</p>

  <div class="wrapper">
    <div class="board">
      <div class="mapbox" id="mapbox">

        <!-- â¬‡ æŠŠ v6.2 çš„ <svg>â€¦</svg> åŸæ¨£è²¼åœ¨é€™è£¡ â¬‡ -->
        <!-- é‡è¦ï¼šè«‹å‹™å¿…ä¿ç•™å„è¡Œæ”¿å€ <title>ï¼Œè…³æœ¬æœƒç”¨å®ƒä¾†åˆ¤æ–·å€å -->
        <!-- ä¾‹å¦‚ <title>æ¥ æ¢“å€</title>ã€<title>å·¦ç‡Ÿå€</title>... -->
        <!-- PASTE-SVG-HERE -->
        <!-- â¬† æŠŠ v6.2 çš„ <svg>â€¦</svg> åŸæ¨£è²¼åœ¨é€™è£¡ â¬† -->

      </div>

      <div class="tray" id="tray"></div>
    </div>

    <div class="footer">
      <button class="btn" id="btn-restart">ğŸ” é–£è€ä¸€æ“º</button>
      <a class="btn green" href="https://tsong-su.github.io/iuhi/index.html">ğŸ  è½‰å»éŠæˆ²é¦–é </a>
    </div>
  </div>

  <div class="toast" id="toast">âœ”ï¸ é…å°æˆåŠŸï¼</div>

<script>
/* å¸‚ä¸­å¿ƒ 11 å€ï¼‹è³‡æ–™ï¼ˆæ–‡å­—å›ºå®šåº§æ¨™å¯å†å¾®èª¿ï¼‰ */
const CORE = ["æ¥ æ¢“","å·¦ç‡Ÿ","é¼“å±±","ä¸‰æ°‘","é¹½åŸ•","å‰é‡‘","æ–°èˆˆ","è‹“é›…","æ——æ´¥","å‰é®","å°æ¸¯"];
const DATA = {
  "æ¥ æ¢“":{old:"æ¥ ä»”å‘", newPoj:"LÃ¢m-tsÃº",      oldPoj:"LÃ¢m-Ã¡-khenn",  label:[220,380]},
  "å·¦ç‡Ÿ":{old:"åŸ¤ä»”é ­", newPoj:"TsÃ³-iÃ¢nn",    oldPoj:"Pi-Ã¡-thÃ¢u",    label:[260,340]},
  "é¼“å±±":{old:"æ‰“é¼“å±±", newPoj:"KÃ³o-san",     oldPoj:"TÃ¡nn-kÃ³o-san", label:[240,420]},
  "ä¸‰æ°‘":{old:"ä¸‰å¡Šå", newPoj:"Sam-bÃ®n",     oldPoj:"Sann-tÃ¨-tshÃ¹", label:[300,460]},
  "é¹½åŸ•":{old:"é¹½åŸ•åŸ”", newPoj:"IÃ¢m-tiÃ¢nn",   oldPoj:"IÃ¢m-tiÃ¢nn-poo",label:[200,520]},
  "å‰é‡‘":{old:"å‰è¡¿",   newPoj:"TsiÃ¢n-kim",   oldPoj:"TsiÃ¢n-khim",   label:[260,520]},
  "æ–°èˆˆ":{old:"é€®æ¸¯åŸ”", newPoj:"Sin-hing",    oldPoj:"TÄi-kÃ¡ng-poo", label:[300,520]},
  "è‹“é›…":{old:"ç¬­ä»”å¯®", newPoj:"LÃ®ng-ngÃ¡",    oldPoj:"LÃ®ng-Ã¡-liÃ¢u",  label:[320,560]},
  "æ——æ´¥":{old:"æ——å¾Œ",   newPoj:"KÃ®-tin",      oldPoj:"KÃ®-Äu",        label:[150,640]},
  "å‰é®":{old:"å‰é®",   newPoj:"TsiÃ¢n-tÃ¬n",   oldPoj:"TsiÃ¢n-tÃ¬n",    label:[280,610]},
  "å°æ¸¯":{old:"æ¸¯ä»”å¢˜", newPoj:"SiÃ³-kÃ¡ng",    oldPoj:"KÃ¡ng-Ã¡ kÃ®nn",  label:[310,680]}
};

/* éŸ³æª”å‘½åè¦å‰‡ï¼ˆèˆ‡ä½ ç¾æœ‰ä¸€è‡´ï¼‰ */
function idxOf(name){ return CORE.indexOf(name)+1; }
function newSrc(name){ return "map_assets/"+String(idxOf(name)).padStart(2,'0')+name+"_new.mp3"; }
function oldSrc(name){ return "map_assets/"+String(idxOf(name)).padStart(2,'0')+DATA[name].old+"_old.mp3"; }

const mapbox = document.getElementById('mapbox');
const tray   = document.getElementById('tray');
const toast  = document.getElementById('toast');
const audioNew = new Audio();
const audioOld = new Audio();
const victory  = new Audio("map_assets/victory.mp3");
let solved = 0;

/* å·¥å…· */
function onlyHan(t){const m=(t||'').match(/[\u4E00-\u9FFF]+/g);return m?m.join(''):'';}
function getNameFromShape(el){
  const t = el.querySelector && el.querySelector('title');
  if(t && t.textContent) return onlyHan(t.textContent).replace(/å¸‚|é«˜é›„/,'').replace(/\s/g,'').replace(/å€$/,'');
  return onlyHan(el.getAttribute('data-name')||el.getAttribute('id')||'').replace(/å€$/,'');
}
function showToast(msg){ toast.textContent=msg; toast.style.display='block'; setTimeout(()=>toast.style.display='none', 900); }

/* åˆå§‹åŒ–ï¼šåªé¡¯ç¤ºå¸‚ä¸­å¿ƒã€å¥—æŸ”å’Œæ¼¸å±¤ã€æ”¾å›ºå®šæ¨™ç±¤ */
function initMap(){
  const svg = mapbox.querySelector('svg'); if(!svg) return;

  /* æŸ”å’Œæ¼¸å±¤ */
  const defs = document.createElementNS('http://www.w3.org/2000/svg','defs');
  const lg = document.createElementNS('http://www.w3.org/2000/svg','linearGradient'); lg.id='coreGrad'; lg.setAttribute('x1','0'); lg.setAttribute('x2','0'); lg.setAttribute('y1','0'); lg.setAttribute('y2','1');
  const s1=document.createElementNS('http://www.w3.org/2000/svg','stop'); s1.setAttribute('offset','0%'); s1.setAttribute('stop-color','#ffcf9b');
  const s2=document.createElementNS('http://www.w3.org/2000/svg','stop'); s2.setAttribute('offset','100%'); s2.setAttribute('stop-color','#f6a270');
  lg.appendChild(s1); lg.appendChild(s2); defs.appendChild(lg); svg.prepend(defs);

  /* å…ˆå…¨éƒ¨éš±è—æˆ non-core */
  svg.querySelectorAll('path,polygon,polyline').forEach(el=>el.classList.add('non-core'));

  /* é€ç¾¤çµ„æƒ <title>ï¼Œå‡¡æ˜¯å¸‚ä¸­å¿ƒ 11 å€å°±æ¨™æˆ core-districtï¼Œå…¶ä»–ä¿æŒéš±è— */
  svg.querySelectorAll('g, path, polygon, polyline').forEach(el=>{
    const t = el.querySelector && el.querySelector('title');
    if(!t) return;
    const name = onlyHan(t.textContent).replace(/å¸‚|é«˜é›„/,'').replace(/\s/g,'').replace(/å€$/,'');
    if(CORE.includes(name)){
      (el.querySelectorAll('path,polygon,polyline')||[]).forEach(p=>{
        p.classList.remove('non-core');
        p.classList.add('core-district');
        p.setAttribute('data-core-name', name);
      });
    }
  });

  /* å‚™æ´ï¼šå€‹åˆ¥ path æ—é‚Šç·Šé„°çš„ titleï¼ˆè¬ä¸€ç¾¤çµ„æ²’æœ‰ï¼‰ */
  if(!svg.querySelector('.core-district')){
    svg.querySelectorAll('path,polygon,polyline').forEach(el=>{
      const prev = el.previousElementSibling;
      const t = (prev && prev.tagName==='title') ? prev : (el.querySelector && el.querySelector('title'));
      const nm = t ? onlyHan(t.textContent).replace(/å¸‚|é«˜é›„/,'').replace(/\s/g,'').replace(/å€$/,'') : '';
      if(CORE.includes(nm)){ el.classList.remove('non-core'); el.classList.add('core-district'); el.setAttribute('data-core-name', nm); }
    });
  }

  /* å›ºå®šæ¨™ç±¤ï¼ˆæ–°åœ°åï¼‹æ‹¼éŸ³ï¼‰ï¼Œåº§æ¨™å¯å†å¾®èª¿ */
  svg.querySelectorAll('text.label').forEach(n=>n.remove());
  for(const name of CORE){
    const pos = (DATA[name]&&DATA[name].label)||[0,0];
    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('class','label'); t.setAttribute('x', pos[0]); t.setAttribute('y', pos[1]); t.setAttribute('text-anchor','middle');
    t.textContent = name;
    const ts = document.createElementNS('http://www.w3.org/2000/svg','tspan'); ts.setAttribute('x', pos[0]); ts.setAttribute('dy','1.2em'); ts.textContent = (DATA[name]?.newPoj)||'';
    t.appendChild(ts); svg.appendChild(t);
  }
}

/* ç”¢ç”Ÿ 11 å€‹æ‹–æ›³ç±¤ï¼ˆèˆŠåœ°åï¼‹æ‹¼éŸ³ï¼‰ */
function buildChips(){
  tray.innerHTML=''; solved=0;
  const items = CORE.map(n=>({name:n, old:DATA[n].old, oldPoj:DATA[n].oldPoj})).sort(()=>Math.random()-0.5);
  for(const it of items){
    const chip = document.createElement('div'); chip.className='chip'; chip.setAttribute('data-name', it.name);
    chip.innerHTML = '<div>'+it.old+'</div><div class="poj">'+(it.oldPoj||'')+'</div>';
    tray.appendChild(chip);
  }
  enableDrag();
}

/* æ‹–æ›³é…å° */
function enableDrag(){
  let dragEl=null, offsetX=0, offsetY=0, origParent=null;

  function onDown(e){
    const t = e.target.closest('.chip'); if(!t) return; e.preventDefault();
    dragEl=t; dragEl.classList.add('dragging');
    const r=dragEl.getBoundingClientRect(); offsetX=e.clientX-r.left; offsetY=e.clientY-r.top;
    origParent=dragEl.parentElement; mapbox.appendChild(dragEl);
    dragEl.style.position='absolute'; dragEl.style.zIndex=99; move(e);
    window.addEventListener('pointermove', move); window.addEventListener('pointerup', up, {once:true});
  }

  function move(e){
    if(!dragEl) return;
    const host = mapbox.getBoundingClientRect();
    let x = e.clientX - host.left - offsetX; let y = e.clientY - host.top - offsetY;
    x = Math.max(0, Math.min(host.width - dragEl.offsetWidth, x));
    y = Math.max(0, Math.min(host.height - dragEl.offsetHeight, y));
    dragEl.style.left=x+'px'; dragEl.style.top=y+'px';
  }

  function up(e){
    if(!dragEl) return; window.removeEventListener('pointermove', move);
    const name = dragEl.getAttribute('data-name');
    const r = dragEl.getBoundingClientRect(); const center = {x:r.left+r.width/2, y:r.top+r.height/2};
    const svg = mapbox.querySelector('svg'); let best=null, bestDist=1e9;

    svg.querySelectorAll('.core-district').forEach(el=>{
      const b=el.getBBox(); const pt=svg.createSVGPoint(); pt.x=b.x+b.width/2; pt.y=b.y+b.height/2;
      const s=pt.matrixTransform(el.getScreenCTM()); const d=Math.hypot(center.x-s.x, center.y-s.y);
      const n=el.getAttribute('data-core-name')||getNameFromShape(el);
      if(d<bestDist){ best={el, name:n, s}; bestDist=d; }
    });

    if(best && best.name===name && bestDist<80){
      dragEl.classList.remove('wrong'); dragEl.classList.add('correct');
      dragEl.style.left=(best.s.x - mapbox.getBoundingClientRect().left)+'px';
      dragEl.style.top=(best.s.y  - mapbox.getBoundingClientRect().top )+'px';
      dragEl.style.transform='translate(-50%,-50%)'; dragEl.onpointerdown=null;

      // é‚Šæ¡†é–ƒäº®
      const prev=best.el.style.strokeWidth; best.el.style.stroke='#fff'; best.el.style.strokeWidth='4px';
      setTimeout(()=>{ best.el.style.stroke='#1f2937'; best.el.style.strokeWidth=prev||'.9'; }, 800);

      // è‡ªå‹•æ’­æ”¾ æ–°â†’èˆŠ
      playAudio(name);

      solved++; showToast('âœ”ï¸ é…å°æˆåŠŸï¼');
      if(solved>=CORE.length) setTimeout(()=>victory.play().catch(()=>{}),700);
    }else{
      dragEl.classList.remove('correct'); dragEl.classList.add('wrong');
      origParent.appendChild(dragEl); dragEl.style.position=''; dragEl.style.left=''; dragEl.style.top=''; dragEl.style.transform='';
    }
    dragEl.classList.remove('dragging'); dragEl=null;
  }

  tray.addEventListener('pointerdown', onDown); mapbox.addEventListener('pointerdown', onDown);
}

/* éŸ³æª”ï¼šæ–° â†’ èˆŠ */
function playAudio(name){
  audioNew.src = encodeURI(newSrc(name)); audioOld.src = encodeURI(oldSrc(name));
  audioNew.onended = ()=> setTimeout(()=>audioOld.play().catch(()=>{}), 600);
  audioNew.play().catch(()=>{});
}

/* é‡æ–°é–‹å§‹ */
document.getElementById('btn-restart').addEventListener('click', ()=>window.location.reload());

/* å•Ÿå‹• */
window.addEventListener('load', ()=>{
  // ç­‰ SVG é€² DOM å¾Œå†è™•ç†
  setTimeout(()=>{ initMap(); buildChips(); }, 60);
});
</script>
</body>
</html>

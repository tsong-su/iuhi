<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
<title>é«˜é›„å¸‚38å€æ–°èˆŠåœ°åäº’å‹•åœ°åœ–</title>
<style>
  :root{
    --ink:#111827; --muted:#6b7280; --bg:#fafafa;
    --red:#f87171; --purple:#c4b5fd; --ylg:#bbf7d0; --cyan:#99f6e4;
    --card:rgba(255,255,255,.94);
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,-apple-system,Arial}
  header{padding:14px 16px 6px}
  h1{margin:0 0 6px;font-size:20px}
  .hint{margin:0;color:var(--muted);font-size:14px}
  .legend{display:flex;flex-wrap:wrap;gap:8px;padding:8px 12px 2px}
  .chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #e5e7eb;border-radius:999px;padding:4px 10px 4px 6px;background:#fff}
  .dot{width:14px;height:14px;border-radius:50%}
  .wrap{padding:8px 12px 16px}
  .mapbox{position:relative;border:1px solid #e5e7eb;border-radius:14px;background:#fff;box-shadow:0 8px 22px rgba(0,0,0,.08);overflow:hidden}
  /* SVG å°ºå¯¸ï¼šæ‰‹æ©Ÿç›´å¼ä¹Ÿèƒ½ä¸€å±çœ‹åˆ°å…¨åœ– */
  svg{display:block;width:100%;height:calc(100vh - 210px);max-height:1000px}
  @media (max-width:768px){ svg{height:calc(100vh - 230px)} }

  /* æµ®çª— */
  .tip{
    position:absolute;min-width:230px;max-width:86vw;pointer-events:auto;
    background:var(--card);backdrop-filter:saturate(140%) blur(6px);
    border:1px solid rgba(0,0,0,.06);border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.16);
    padding:12px;opacity:0;transform:translate(-50%,-10px) scale(.98);
    transition:opacity .22s ease, transform .22s ease;
  }
  .tip.show{opacity:1;transform:translate(-50%,-14px) scale(1)}
  .tip h3{margin:0 0 2px;color:#b91c1c;font-size:16px;font-weight:700}
  .tip h4{margin:0 0 6px;color:#111827;font-size:15px;font-weight:600}
  .py{margin:0;color:#4b5563;font-size:14px;line-height:1.2}
  .btns{margin-top:8px;display:flex;gap:8px}
  .btn{
    padding:6px 10px;font-size:13px;border-radius:10px;border:1px solid #d1d5db;background:#ffffff;cursor:pointer;
    display:inline-flex;align-items:center;gap:6px
  }
  .btn svg{width:14px;height:14px}
  .btn:disabled{opacity:.5;cursor:not-allowed}

  /* é»æ“Šå›é¥‹ï¼šäº®åº¦æ¼¸å¼·å†æ·¡å‡ºï¼ˆ1 ç§’ï¼‰ */
  @keyframes pulseBright {
    0% { filter:brightness(1);   }
    50%{ filter:brightness(1.45);}
    100%{filter:brightness(1);   }
  }
  .pulse-1s{ animation:pulseBright 1s ease; }

  /* hover æäº® */
  .hoverable{ transition:filter .25s ease }
  .hoverable:hover{ filter:brightness(1.15) }
</style>
</head>
<body>
<header>
  <h1>é«˜é›„å¸‚38å€æ–°èˆŠåœ°åäº’å‹•åœ°åœ–</h1>
  <p class="hint">ğŸ“± å»ºè­°ç›´å¼è§€çœ‹æ•ˆæœæœ€ä½³</p>
</header>

<div class="legend">
  <span class="chip"><span class="dot" style="background:var(--red)"></span>å¸‚ä¸­å¿ƒ</span>
  <span class="chip"><span class="dot" style="background:var(--purple)"></span>å¸‚éƒŠâ€“æ±</span>
  <span class="chip"><span class="dot" style="background:var(--ylg)"></span>å¸‚éƒŠâ€“åŒ—</span>
  <span class="chip"><span class="dot" style="background:var(--cyan)"></span>å±±å€</span>
</div>

<div class="wrap">
  <div class="mapbox">
    <div id="tip" class="tip" role="dialog" aria-live="polite">
      <h3 id="tipNew"></h3>
      <h4 id="tipOld"></h4>
      <p id="tipPyNew" class="py"></p>
      <p id="tipPyOld" class="py"></p>
      <div class="btns">
        <button id="btnPlayNew" class="btn">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg> æ–°åœ°å
        </button>
        <button id="btnPlayOld" class="btn">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg> èˆŠåœ°å
        </button>
      </div>
      <audio id="aud" preload="none"></audio>
    </div>

    <!-- ä½ çš„ SVG å°‡è¢«æ’å…¥åˆ° #svgRoot ä¸­ï¼ˆå¾ map_assets/Blank_Kaohsiung_map.svg è¼‰å…¥ï¼‰ -->
    <svg id="stage" viewBox="0 0 1143.062 1440.995" preserveAspectRatio="xMidYMid meet" aria-label="é«˜é›„å¸‚è¡Œæ”¿å€äº’å‹•åœ°åœ–">
      <g id="svgRoot"></g>
    </svg>
  </div>
</div>

<script>
/* 1) è¨­å®šï¼šä½ çš„ SVG ä¾†æºï¼ˆèˆ‡æœ¬æª”åŒå±¤çš„ map_assets å…§ï¼‰ */
const SVG_URL = 'map_assets/Blank_Kaohsiung_map.svg';

/* 2) å››ç¾¤å®šç¾©èˆ‡è‰²ç³» */
const GROUPS = {
  center: ["æ¥ æ¢“","å·¦ç‡Ÿ","é¼“å±±","ä¸‰æ°‘","é¹½åŸ•","å‰é‡‘","æ–°èˆˆ","è‹“é›…","æ——æ´¥","å‰é®","å°æ¸¯"],
  east:   ["å¤§æ¨¹","å¤§å¯®","æ—åœ’","å¤§ç¤¾","ä»æ­¦","é³¥æ¾","é³³å±±"],
  north:  ["èŒ„è£","æ°¸å®‰","å½Œé™€","æ¢“å®˜","æ¹–å…§","è·¯ç«¹","å²¡å±±","æ©‹é ­","é˜¿è“®","ç”°å¯®","ç‡•å·¢"],
  mount:  ["å…§é–€","æ——å±±","æ‰æ—","ç¾æ¿ƒ","ç”²ä»™","å…­é¾œ","é‚£ç‘ªå¤","æ¡ƒæº","èŒ‚æ—"]
};
const COLOR = { center:'var(--red)', east:'var(--purple)', north:'var(--ylg)', mount:'var(--cyan)' };

/* 3) 38 å€è³‡æ–™ï¼ˆæ–°ï¼èˆŠåœ°åï¼‹å…©è¡Œå°èªæ‹¼éŸ³ï¼‰ */
const DATA = {
  "æ¥ æ¢“":{old:"æ¥ ä»”å‘",      pyNew:"LÃ¢m-tsÃº",        pyOld:"LÃ¢m-Ã¡-khenn"},
  "å·¦ç‡Ÿ":{old:"åŸ¤ä»”é ­",      pyNew:"TsÃ³-iÃ¢nn",       pyOld:"Pi-Ã¡-thÃ¢u"},
  "é¼“å±±":{old:"æ‰“ç‹—å±±",      pyNew:"KÃ³o-san",        pyOld:"TÃ¡nn-kÃ³o-san"},
  "ä¸‰æ°‘":{old:"ä¸‰å¡Šå",      pyNew:"Sam-bÃ®n",        pyOld:"Sann-tÃ¨-tshÃ¹"},
  "é¹½åŸ•":{old:"é¹½åŸ•åŸ”",      pyNew:"IÃ¢m-tiÃ¢nn",      pyOld:"IÃ¢m-tiÃ¢nn-poo"},
  "å‰é‡‘":{old:"å‰è¡¿",        pyNew:"TsiÃ¢n-kim",      pyOld:"TsiÃ¢n-khim"},
  "æ–°èˆˆ":{old:"é€®æ¸¯åŸ”",      pyNew:"Sin-hing",       pyOld:"TÄi-kÃ¡ng-poo"},
  "è‹“é›…":{old:"ç¬­ä»”å¯®",      pyNew:"LÃ®ng-ngÃ¡",       pyOld:"LÃ®ng-Ã¡-liÃ¢u"},
  "æ——æ´¥":{old:"æ——å¾Œ",        pyNew:"KÃ®-tin",         pyOld:"KÃ®-Äu"},
  "å‰é®":{old:"å‰é®",        pyNew:"TsiÃ¢n-tÃ¬n",      pyOld:"TsiÃ¢n-tÃ¬n"},
  "å°æ¸¯":{old:"æ¸¯ä»”å¢˜",      pyNew:"SiÃ³-kÃ¡ng",       pyOld:"KÃ¡ng-Ã¡ kÃ®nn"},
  "å¤§æ¨¹":{old:"å¤§æ¨¹è·¤",      pyNew:"TuÄ-tshiÅ«",      pyOld:"TuÄ-tshiÅ«-kha"},
  "å¤§å¯®":{old:"å¤§è—”",        pyNew:"TuÄ-liÃ¢u",       pyOld:"TuÄ-liÃ¢u"},
  "æ—åœ’":{old:"é ‚æ—ä»”é‚Š",    pyNew:"LÃ®m-hnÌ‚g",        pyOld:"TÃ­ng-nÃ¢-Ã¡-pinn"},
  "å¤§ç¤¾":{old:"ä¸‰å¥¶å£‡",      pyNew:"TuÄ-siÄ",        pyOld:"Sam-nÃ¡i-tuÃ¢nn"},
  "ä»æ­¦":{old:"ä»æ­¦åº„",      pyNew:"JÃ®n-bÃº",         pyOld:"JÃ®n-bÃº-tsng"},
  "é³¥æ¾":{old:"é³¥æ¾è·¤",      pyNew:"TsiÃ¡u-tshÃ®ng",   pyOld:"TsiÃ¡u-tshÃ®ng-kha"},
  "é³³å±±":{old:"ä¸‹åŸ¤é ­",      pyNew:"HÅng-suann",     pyOld:"Ä’-pi-thÃ¢u"},
  "èŒ„è£":{old:"èŒ„è‹³è£ä»”",    pyNew:"Ka-tiÄnn",       pyOld:"Ka-tang-tiÄnn-Ã¡"},
  "æ°¸å®‰":{old:"çƒæ¨¹æ—",      pyNew:"Ãng-an",         pyOld:"Oo-tshiÅ«-nÃ¢"},
  "å½Œé™€":{old:"å½Œé™€æ¸¯",      pyNew:"MÃ®-tÃ´",          pyOld:"BÃ®-lÃ´-kÃ¡ng"},
  "æ¢“å®˜":{old:"æ¢“å®˜",        pyNew:"TsÃº-kuann",      pyOld:"TsÃº-kuann"},
  "æ¹–å…§":{old:"å¤§æ¹–",        pyNew:"Ã”o-lÄi",         pyOld:"TuÄ-Ã´o"},
  "è·¯ç«¹":{old:"åŠè·¯ç«¹",      pyNew:"LÅo-tik",        pyOld:"PuÃ nn-lÅo-tik"},
  "å²¡å±±":{old:"é˜¿å…¬åº—",      pyNew:"Kong-san",       pyOld:"A-kong-tiÃ m"},
  "æ©‹é ­":{old:"æ©‹ä»”é ­",      pyNew:"KiÃ´-thÃ¢u",       pyOld:"KiÃ´-Ã¡-thÃ¢u"},
  "é˜¿è“®":{old:"é˜¿å—¹ç¤¾",      pyNew:"A-lian",         pyOld:"A-lian-siÄ"},
  "ç”°å¯®":{old:"ç”°è—”",        pyNew:"TshÃ¢n-liÃ¢u",     pyOld:"TshÃ¢n-liÃ¢u"},
  "ç‡•å·¢":{old:"æ´å‰¿å³",      pyNew:"IÃ n-tsÃ¢u",       pyOld:"UÄn-tsÃ¢u-iÅ«"},
  "å…§é–€":{old:"ç¾…æ¼¢å…§é–€",    pyNew:"LÄi-bÃ»n",        pyOld:"LÃ´-hÃ n-lÄi-bÃ»n"},
  "æ——å±±":{old:"è•ƒè–¯è—”",      pyNew:"KÃ®-san",         pyOld:"Han-tsÃ®-liÃ¢u"},
  "æ‰æ—":{old:"æ¥ æ¢“ä»™",      pyNew:"Sam-nÃ¢",         pyOld:"LÃ¢m-tsÃº-sian"},
  "ç¾æ¿ƒ":{old:"ç€°æ¿ƒ",        pyNew:"Bi-long",        pyOld:"BÃ®-long"},
  "ç”²ä»™":{old:"é˜¿é‡Œé—œ",      pyNew:"Kah-sian",       pyOld:"A-lÃ­-kuan"},
  "å…­é¾œ":{old:"å…­é¾œé‡Œç¤¾",    pyNew:"LaÌk-ku",         pyOld:"LaÌk-ku-lÃ­-siÄ"},
  "é‚£ç‘ªå¤":{old:"èšŠå­åª",     pyNew:"Na-mÃ¡-siah",     pyOld:"Mangacun/BÃ¡ng-Ã¡-tsÃ­"},
  "æ¡ƒæº":{old:"é›…çˆ¾",        pyNew:"ThÃ´-guÃ¢n",       pyOld:"Ngani/NgÃ¡-nÃ­"},
  "èŒ‚æ—":{old:"å¤šç´",        pyNew:"BÅo-lÃ®m",        pyOld:"TÅ-na"}
};

/* 4) éŸ³æª”å°æ‡‰ï¼šå€åŸŸç·¨è™Ÿï¼ˆ01ï½38ï¼‰ï¼Œç”¨æ–¼çµ„æª”å */
const ORDER = [
  // å¸‚ä¸­å¿ƒ 01â€“11
  "æ¥ æ¢“","å·¦ç‡Ÿ","é¼“å±±","ä¸‰æ°‘","é¹½åŸ•","å‰é‡‘","æ–°èˆˆ","è‹“é›…","æ——æ´¥","å‰é®","å°æ¸¯",
  // æ±å€ 12â€“18
  "å¤§æ¨¹","å¤§å¯®","æ—åœ’","å¤§ç¤¾","ä»æ­¦","é³¥æ¾","é³³å±±",
  // åŒ—å€ 19â€“29
  "èŒ„è£","æ°¸å®‰","å½Œé™€","æ¢“å®˜","æ¹–å…§","è·¯ç«¹","å²¡å±±","æ©‹é ­","é˜¿è“®","ç”°å¯®","ç‡•å·¢",
  // å±±å€ 30â€“38
  "å…§é–€","æ——å±±","æ‰æ—","ç¾æ¿ƒ","ç”²ä»™","å…­é¾œ","é‚£ç‘ªå¤","æ¡ƒæº","èŒ‚æ—"
];
const indexOfName = Object.fromEntries(ORDER.map((n,i)=>[n, String(i+1).padStart(2,'0')]));

/* 5) DOM åƒç…§ */
const svgRoot = document.getElementById('svgRoot');
const stage   = document.getElementById('stage');
const tip     = document.getElementById('tip');
const elNew   = document.getElementById('tipNew');
const elOld   = document.getElementById('tipOld');
const elPyN   = document.getElementById('tipPyNew');
const elPyO   = document.getElementById('tipPyOld');
const btnNew  = document.getElementById('btnPlayNew');
const btnOld  = document.getElementById('btnPlayOld');
const aud     = document.getElementById('aud');

/* 6) è¼‰å…¥ SVG â†’ å»é»‘æ¡† â†’ ä¸Šè‰² â†’ ç¶å®š */
loadSVG().catch(err=>{
  svgRoot.innerHTML = `<text x="20" y="40" fill="#b91c1c" font-size="16">è¼‰å…¥ SVG å¤±æ•—ï¼Œè«‹æª¢æŸ¥è·¯å¾‘ï¼š${SVG_URL}</text>`;
});

async function loadSVG(){
  const res = await fetch(SVG_URL, {mode:'cors'});
  const txt = await res.text();
  svgRoot.innerHTML = txt;

  // è‹¥åŸæª”æ²’ viewBoxï¼Œè£œä¸Šï¼ˆé¿å…æ‰‹æ©Ÿåªè¦‹ä¸€è§’ï¼‰
  const rootSvg = svgRoot.querySelector('svg');
  if(rootSvg && !rootSvg.getAttribute('viewBox')){
    const w = parseFloat(rootSvg.getAttribute('width'))  || 1143.062;
    const h = parseFloat(rootSvg.getAttribute('height')) || 1440.995;
    rootSvg.setAttribute('viewBox', `0 0 ${w} ${h}`);
  }

  // ç§»é™¤å¤§é¢ç©/é»‘ç²—æ¡†ï¼ˆç„¡ <title> çš„å¤§ path/rect/polygonï¼Œæˆ–é»‘è‰²ç²—æé‚Šï¼‰
  const vb = (rootSvg||stage).viewBox.baseVal;
  const totalArea = (vb && vb.width*vb.height) || (1143.062*1440.995) || 1;

  svgRoot.querySelectorAll('rect,path,polygon').forEach(el=>{
    try{
      const bb = el.getBBox();
      const area = bb.width*bb.height;
      const strokeW = parseFloat(el.getAttribute('stroke-width') || '0');
      const stroke  = (el.getAttribute('stroke')||'').toLowerCase();
      const titled = !!(el.querySelector && el.querySelector('title'));
      const looksFrame = (stroke==='black' || stroke==='#000' || stroke==='#000000' || stroke.includes('rgb(0, 0, 0)')) && strokeW>=5;
      if ((area/totalArea>0.25 && !titled) || looksFrame) el.remove();
    }catch(_){}
  });

  // éš±è—åŸ SVG å…§çš„æ–‡å­—ï¼ˆé¿å…èˆ‡æµ®çª—é‡ç–Šï¼‰
  svgRoot.querySelectorAll('text').forEach(t=>t.setAttribute('display','none'));

  // è‘—è‰²ï¼‹äº’å‹•
  const zones = svgRoot.querySelectorAll('path,polygon');
  zones.forEach(z=>{
    const t = z.querySelector('title');
    let name = t && t.textContent ? t.textContent.trim() : '';
    // åªå–ä¸­æ–‡å€åï¼ˆå»æ‰å°¾è¨»/è‹±æ–‡ï¼‰
    name = name.replace(/å€.*$/,'').replace(/\s*\(.+?\)\s*$/,'').replace(/\s*[A-Za-z].*$/,'');
    if(!name) return;

    const group = whichGroup(name);
    if(!group) return;

    // è‘—è‰²èˆ‡åŸºæœ¬äº’å‹•
    z.classList.add('hoverable');
    z.setAttribute('fill', getComputedStyle(document.documentElement).getPropertyValue(
      {center:'--red', east:'--purple', north:'--ylg', mount:'--cyan'}[group]
    ).trim());
    z.setAttribute('stroke','#ffffff');
    z.setAttribute('stroke-width','1');

    // é»æ“Šï¼šæµ®çª—é¡¯ç¤ºï¼‹äº®åº¦æ¼¸å¼·å†æ·¡å‡º 1 ç§’
    z.addEventListener('click', (ev)=>{
      ev.stopPropagation();
      // å‹•ç•«å›é¥‹
      z.classList.remove('pulse-1s'); // å…ˆç§»é™¤ä»¥ä¾¿é‡æ’­
      void z.offsetWidth;             // è§¸ç™¼ reflow
      z.classList.add('pulse-1s');

      showTooltip(name, z);
    }, {passive:true});
  });

  // é»ç©ºç™½è™•é—œé–‰
  document.addEventListener('click', hideTooltip, {capture:true});
  window.addEventListener('resize', hideTooltip);
}

/* åˆ¤æ–·åˆ†ç¾¤ */
function whichGroup(n){
  if(GROUPS.center.includes(n)) return 'center';
  if(GROUPS.east.includes(n))   return 'east';
  if(GROUPS.north.includes(n))  return 'north';
  if(GROUPS.mount.includes(n))  return 'mount';
  return null;
}

/* æµ®çª—ç”Ÿæˆèˆ‡å®šä½ï¼ˆè²¼è‘—è©²è¡Œæ”¿å€æ—é‚Šï¼‰ */
function showTooltip(name, elem){
  const d = DATA[name] || {};
  elNew.textContent = name;           // æ–°åœ°åï¼ˆç´…ï¼‰
  elOld.textContent = d.old || "";    // èˆŠåœ°åï¼ˆé»‘ï¼‰
  elPyN.textContent = d.pyNew || "";  // æ‹¼éŸ³ï¼ˆæ–°ï¼‰
  elPyO.textContent = d.pyOld || "";  // æ‹¼éŸ³ï¼ˆèˆŠï¼‰

  // audio æº–å‚™ï¼ˆä¾ 01â€“38 ç·¨è™Ÿ + åç¨±ï¼‰
  const idx = indexOfName[name];
  const newPath = `map_assets/sounds/${idx}${name}_new.mp3`;
  const oldName = d.old || '';
  const oldPath = `map_assets/sounds/${idx}${oldName}_old.mp3`;

  btnNew.disabled = false;
  btnOld.disabled = false;

  btnNew.onclick = ()=> playAudio(newPath);
  btnOld.onclick = ()=> playAudio(oldPath);

  // å®šä½ï¼šç”¨å…ƒç´ çš„ getBoundingClientRect + scroll æ ¡æ­£
  const hostRect = stage.getBoundingClientRect();
  const r = elem.getBoundingClientRect();
  const cx = r.left + r.width/2;
  const cy = r.top  + r.height/2;
  const left = cx - hostRect.left + window.scrollX;
  let   top  = cy - hostRect.top  + window.scrollY - 14;

  // é¿å…è²¼åˆ°è¦–çª—é‚Šç·£ï¼ˆç°¡æ˜“é˜²è­·ï¼‰
  const pad = 12;
  const vw = window.innerWidth, vh = window.innerHeight;
  const tRect = tip.getBoundingClientRect();
  const tipW = tRect.width || 240, tipH = tRect.height || 120;

  const L = Math.max(pad, Math.min(left, hostRect.width - pad));
  const T = Math.max(pad, Math.min(top,  hostRect.height - pad));

  tip.style.left = `${L}px`;
  tip.style.top  = `${T}px`;
  tip.classList.add('show');
}

function hideTooltip(){
  tip.classList.remove('show');
}

/* éŸ³æª”æ’­æ”¾ï¼ˆè‹¥æª”æ¡ˆå°šæœªæ”¾å…¥ï¼Œæœƒå®‰éœ failï¼Œä¸å½±éŸ¿äº’å‹•ï¼‰ */
function playAudio(src){
  aud.pause();
  aud.src = src;
  aud.play().catch(()=>{/* æ²’æª”æ¡ˆå°±ä¸æ’­ï¼Œä¸è·³éŒ¯ */});
}
</script>
</body>
</html>

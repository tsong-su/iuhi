<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>é«˜é›„å¸‚ï¼å¸‚ä¸­å¿ƒå€æ–°èˆŠåœ°åé…å°éŠæˆ²</title>
<style>
  :root{
    --bg:#fdf6ef;      /* æŸ”ç±³è‰² */
    --ink:#3b2f2a;
    --accent:#e7d2b4;  /* èªªæ˜/æŒ‰éˆ•åº•è‰² */
    --pill:#f4c7c7;    /* èˆŠåœ°åæ¡† */
    --pill-b:#c76565;
    --ok:#cfe8c8;      /* é…å°æˆåŠŸå€å¡Šè‰² */
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: "Noto Sans TC", system-ui, -apple-system, "Segoe UI", sans-serif;
    background:var(--bg);
    color:var(--ink);
    -webkit-tap-highlight-color: transparent;
  }
  header{
    font-weight:800;
    font-size:clamp(18px, 4.6vw, 28px);
    text-align:center;
    padding:10px 14px 6px;
  }
  .bar{
    display:flex; align-items:center; justify-content:center; gap:8px;
    padding:4px 10px 6px;
    font-size:clamp(13px, 3.7vw, 16px);
    color:#5b524d;
  }
  .bar .home{
    padding:6px 10px; border-radius:12px; border:0; cursor:pointer;
    background:#e9e0cf;
    box-shadow:0 1px 0 rgba(0,0,0,.06) inset;
  }
  .wrap{
    display:flex; flex-direction:column; gap:8px;
    height:calc(100dvh - 110px); /* è®“æ‰‹æ©Ÿç›´å¼ç›¡é‡æ»¿ç‰ˆ */
    padding:0 10px 10px;
  }
  #mapBox{
    position:relative;
    flex:1 1 auto;
    background:#fff;
    border-radius:14px;
    box-shadow:0 2px 10px rgba(0,0,0,.04) inset;
    overflow:hidden;
  }
  #mapBox svg{ width:100%; height:100%; display:block; }
  /* å°æç¤ºæ³¡æ³¡ï¼ˆhoverï¼‰ */
  #tip{
    position:fixed; z-index:50; pointer-events:none; display:none;
    background:#fff; border:1px solid #ddd; border-radius:8px;
    padding:6px 8px; font-size:13px; box-shadow:0 6px 20px rgba(0,0,0,.12);
  }
  /* æ‹–æ›³æ‰˜ç›¤ */
  #tray{
    display:flex; flex-wrap:wrap; gap:10px; justify-content:center;
  }
  .pill{
    background:var(--pill); border:2px solid var(--pill-b);
    padding:8px 12px; border-radius:12px; font-weight:700; cursor:grab;
    user-select:none; font-size:clamp(14px, 3.9vw, 17px);
    box-shadow:0 1px 0 rgba(0,0,0,.05) inset;
  }
  .dragging{ opacity:.6 }
  /* å®Œæˆå½ˆçª— */
  #done{
    position:fixed; left:50%; top:50%; transform:translate(-50%,-50%) scale(.7);
    background:#ffffffea; border:1px solid #ddd; border-radius:16px;
    padding:16px 22px; font-size:20px; font-weight:800; color:#2e7d32;
    backdrop-filter:saturate(140%) blur(2px);
    display:none; z-index:100;
    animation:pop .4s ease forwards;
  }
  @keyframes pop{
    to{ transform:translate(-50%,-50%) scale(1) }
  }
  /* æ‰‹æ©Ÿç›´å¼å„ªå…ˆ */
  @media (min-width:768px){
    .wrap{ height:calc(100dvh - 120px) }
  }
</style>
</head>
<body>
  <header>é«˜é›„å¸‚ï¼å¸‚ä¸­å¿ƒå€æ–°èˆŠåœ°åé…å°éŠæˆ²</header>
  <div class="bar">
    ğŸ“œè«‹å°‡èˆŠåœ°åæ‹–æ›³è‡³ç›¸å°æ‡‰æ–°åœ°åå€åŸŸ
    <button class="home" id="homeBtn">ğŸ  è½‰å»éŠæˆ²é ­é </button>
  </div>

  <div class="wrap">
    <div id="mapBox"></div>
    <div id="tray" aria-label="èˆŠåœ°åæ‹–æ›³æ‰˜ç›¤"></div>
  </div>

  <div id="tip"></div>
  <div id="done">æœ‰å¤  gÃ¢u çš„ï¼è®šå•¦ï¼</div>

  <!-- éŸ³æ•ˆ -->
  <audio id="seVictory" src="map_assets/victory.mp3"></audio>
  <audio id="seFinish"  src="map_assets/finish1.mp3"></audio>

<script>
const tip = document.getElementById('tip');
document.getElementById('homeBtn').addEventListener('click', ()=>alert('æš«æœªé–‹æ”¾'));

const MAP_PATH = 'map_assets/svg1.txt'; // å¯ç”¨ .txt æˆ– .svg
const NEW_OLD = [
  // ä¾åºï¼šæ–°åœ°å, èˆŠåœ°å, ç¾…é¦¬
  ["æ¥ æ¢“","æ¥ ä»”å‘","LÃ¢m-Ã¡-khenn"],
  ["å·¦ç‡Ÿ","åŸ¤ä»”é ­","Pi-Ã¡-thÃ¢u"],
  ["é¼“å±±","æ‰“é¼“å±±","TÃ¡nn-kÃ³o-san"],
  ["ä¸‰æ°‘","ä¸‰å¡Šå","Sann-tÃ¨-tshÃ¹"],
  ["é¹½åŸ•","é¹½åŸ•åŸ”","IÃ¢m-tiÃ¢nn-poo"],
  ["å‰é‡‘","å‰è¡¿","TsiÃ¢n-khim"],
  ["æ–°èˆˆ","é€®æ¸¯åŸ”","TÄi-kÃ¡ng-poo"],
  ["è‹“é›…","ç¬­ä»”å¯®","LÃ®ng-Ã¡-liÃ¢u"],
  ["æ——æ´¥","æ——å¾Œ","KÃ®-Äu"],
  ["å‰é®","å‰é®","TsiÃ¢n-tÃ¬n"],
  ["å°æ¸¯","æ¸¯ä»”å¢˜","KÃ¡ng-Ã¡-kÃ®nn"],
];

let doneCount = 0;

(async function boot(){
  const svgText = await fetch(MAP_PATH).then(r=>r.text());
  // å»æ‰ xml/doctype æ‰èƒ½å®‰å…¨ innerHTML
  const cleaned = svgText
    .replace(/<\?xml[\s\S]*?\?>/i,'')
    .replace(/<!DOCTYPE[\s\S]*?>/i,'');
  const box = document.getElementById('mapBox');
  box.innerHTML = cleaned;

  /** èª¿æ•´ SVG å°ºå¯¸å±¬æ€§ï¼Œç¢ºä¿æ»¿ç‰ˆé¡¯ç¤º **/
  const svg = box.querySelector('svg');
  if(!svg){
    console.error('æœªæ‰¾åˆ° <svg>ï¼Œè«‹ç¢ºèª map_assets/svg1.txt å…§å®¹ã€‚');
    box.innerHTML = '<div style="padding:20px;color:#a33">è®€å–å¤±æ•—ï¼šsvg1.txt å…§å®¹å¯èƒ½ç¼ºå°‘ &lt;svg&gt; ...</div>';
    return;
  }
  svg.removeAttribute('width');
  svg.removeAttribute('height');
  svg.setAttribute('preserveAspectRatio','xMidYMid meet');
  svg.style.width = '100%';
  svg.style.height = '100%';

  /** è’é›†æ‰€æœ‰ pathï¼Œè®€å– <title>æ–°ï½œèˆŠ>ï¼›æ›ä¸Š hover æç¤ºèˆ‡ drop å€ **/
  const districts = [];
  svg.querySelectorAll('path').forEach((p)=>{
    const t = p.querySelector('title');
    if(!t) return;
    const raw = t.textContent.trim();
    // å…è¨±ã€Œæ–°ï½œèˆŠã€æˆ–ã€Œæ–°åœ°åï½œèˆŠåœ°åã€ä»»ä¸€å½¢å¼
    const [newName, oldName] = raw.split('ï½œ').map(s=>s?.trim());
    if(!newName) return;
    p.dataset.newName = newName;
    p.dataset.oldName = oldName || '';
    // hover æç¤º
    p.addEventListener('pointerenter', (e)=>{
      tip.style.display = 'block';
      tip.textContent = oldName ? `${newName}ï½œ${oldName}` : newName;
    });
    p.addEventListener('pointermove', (e)=>{
      tip.style.left = (e.clientX+10)+'px';
      tip.style.top  = (e.clientY+10)+'px';
    });
    p.addEventListener('pointerleave', ()=> tip.style.display='none');
    // drop support
    p.addEventListener('dragover', e=>e.preventDefault());
    p.addEventListener('drop', onDropToPath);
    districts.push(p);
  });

  /** ç”¢ç”ŸèˆŠåœ°åæ‹–æ›³æ–¹å¡Šï¼ˆéš¨æ©Ÿé †åºï¼‰ **/
  const tray = document.getElementById('tray');
  const shuffled = NEW_OLD.slice().sort(()=>Math.random()-0.5);
  shuffled.forEach(([newName, oldName, roman], i)=>{
    const el = document.createElement('div');
    el.className = 'pill';
    el.textContent = `${oldName} ${roman}`;
    el.setAttribute('draggable','true');
    el.dataset.newName = newName;
    // DnD
    el.addEventListener('dragstart', ()=> el.classList.add('dragging'));
    el.addEventListener('dragend',   ()=> el.classList.remove('dragging'));
    tray.appendChild(el);
  });
})();

function onDropToPath(ev){
  const drag = document.querySelector('.pill.dragging');
  if(!drag) return;
  const targetNew = this.dataset.newName;  // ç”± <title> è§£æå‡ºä¾†
  if(!targetNew) return;
  // æ¯”å°ï¼šæ‹–æ›³æ–¹å¡Šæƒ³è¦é…å°çš„ã€Œæ–°åœ°åã€
  const want = drag.dataset.newName;
  if(want === targetNew){
    // æˆåŠŸï¼šå€å¡Šè®Šè‰²ã€æ’­æ”¾éŸ³æª”ã€åˆä½µé¡¯ç¤ºæ–°èˆŠå
    this.style.fill = 'var(--ok)';
    const oldName = this.dataset.oldName || '';
    // å°‡ <title> æ”¹æˆã€Œæ–°ï¼ˆèˆŠï¼‰ã€è®“ hover ä¸€è‡´
    const t = this.querySelector('title');
    if(t) t.textContent = `${targetNew}ï¼ˆ${oldName}ï¼‰`;

    // æ’­æ”¾éŸ³æª”ï¼ˆä¾ NEW_OLD çš„é †åº 01..11 å‘½åï¼‰
    const idx = indexFromNew(want); // 1..11
    if(idx){
      playSeq(`map_assets/${pad2(idx)}${want}_new.mp3`,
              `map_assets/${pad2(idx)}${oldName}_old.mp3`);
    }

    drag.remove();
    doneCount++;
    if(doneCount===11) finishAll();
  }
}

function indexFromNew(newName){
  const i = NEW_OLD.findIndex(row=>row[0]===newName);
  return i>=0 ? i+1 : 0;
}
function pad2(n){ return (n<10?'0':'')+n; }

function playSeq(a,b){
  const A = new Audio(a); A.play().catch(()=>{});
  A.addEventListener('ended', ()=>{
    setTimeout(()=>{ const B = new Audio(b); B.play().catch(()=>{}); }, 100);
  });
}

function finishAll(){
  const v = document.getElementById('seVictory');
  const f = document.getElementById('seFinish');
  const d = document.getElementById('done');
  v.currentTime=0; v.play().catch(()=>{});
  setTimeout(()=>{
    f.currentTime=0; f.play().catch(()=>{});
    d.style.display='block';
    setTimeout(()=>d.style.display='none', 2600);
  }, 600);
}
</script>
</body>
</html>

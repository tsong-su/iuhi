<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æœå­éª°ä»”éŠæˆ²-ç¬¬3å›</title>
  <style>
    :root{
      --bg:#fff8f0;
      --card:#fff;
      --accent:#ff7b56;
      --text:#333;
      --btn-bg:#ff8f6b;
      --btn-color:#fff;
      --dice-size:140px; /* è‹¥éœ€å¾®èª¿ï¼Œé€™è£¡æ”¹ */
      --max-width:820px;
      --shadow: 0 6px 18px rgba(0,0,0,0.08);
      font-family: "Noto Sans TC", "Helvetica Neue", Arial, sans-serif;
    }

    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);}
    .wrap{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:28px 16px;
    }
    .card{
      width:100%;
      max-width:var(--max-width);
      background:var(--card);
      border-radius:14px;
      padding:22px;
      box-shadow:var(--shadow);
      box-sizing:border-box;
    }

    .title{
      text-align:center;
      margin-bottom:8px;
    }
    .title h1{
      margin:0;
      font-size:1.6rem;
      letter-spacing:0.6px;
    }
    .subtitle{
      margin-top:6px;
      color:#666;
      font-size:0.95rem;
    }

    /* ä¸»é«”ä½ˆå±€ï¼šå·¦ç‚ºéª°å­/åœ–ç¤ºï¼Œå³ç‚ºæ§åˆ¶/æ–‡å­—ï¼ˆå¯¬è¢å¹•ï¼‰ */
    .main{
      display:flex;
      gap:18px;
      align-items:center;
      justify-content:center;
      flex-wrap:wrap;
    }

    .panel-left, .panel-right{
      flex:1 1 320px;
      min-width:260px;
    }

    .dice-box{
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:12px;
      padding:12px;
    }

    /* éª°å­å¤–è§€ï¼ˆç”¨åœ–ï¼‰ */
    .dice{
      width:var(--dice-size);
      height:var(--dice-size);
      border-radius:12px;
      background:#fff;
      display:flex;
      align-items:center;
      justify-content:center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.12);
      transform-style:preserve-3d;
      transition: transform 0.6s cubic-bezier(.2,.9,.3,1);
      overflow:hidden;
      position:relative;
    }
    .dice img{
      max-width:100%;
      max-height:100%;
      display:block;
      user-select:none;
      pointer-events:none;
    }

    /* è®“æ“²éª°å­æ™‚æœ‰æ—‹è½‰å‹•ç•« */
    .rolling {
      animation: diceSpin 0.8s linear infinite;
    }
    @keyframes diceSpin {
      from { transform: rotateX(0deg) rotateY(0deg) scale(1.02); }
      to   { transform: rotateX(360deg) rotateY(360deg) scale(0.98); }
    }

    .controls{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:center;
      margin-top:6px;
      flex-wrap:wrap;
    }

    .btn{
      background:var(--btn-bg);
      color:var(--btn-color);
      border:none;
      padding:10px 18px;
      border-radius:10px;
      font-size:1rem;
      cursor:pointer;
      box-shadow: 0 6px 14px rgba(0,0,0,0.08);
    }
    .btn:disabled{opacity:0.5;cursor:default;}

    .info{
      padding:12px;
      border-radius:10px;
      background:linear-gradient(180deg,#fff,#fffaf2);
      box-shadow:inset 0 1px 0 rgba(255,255,255,0.6);
      font-size:0.98rem;
      line-height:1.45;
    }

    .fruit-name{
      text-align:center;
      margin-top:8px;
      font-size:1.15rem;
      font-weight:600;
    }
    .phonetic{
      text-align:center;
      margin-top:4px;
      color:#666;
      font-size:0.98rem;
    }

    .reset-area{ text-align:center; margin-top:12px; }

    /* æ‰‹æ©Ÿå„ªåŒ–ï¼šå°‡ä¸»é«”ç½®ä¸­ã€æ–‡å­—æ›´å° */
    @media (max-width:640px){
      .card{ padding:16px; border-radius:12px; }
      .title h1{ font-size:1.25rem; }
      .subtitle{ font-size:0.9rem; }
      :root { --dice-size:120px; }
      .controls{ gap:8px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-label="æœå­éª°ä»”éŠæˆ² - ç¬¬3å›éŠæˆ²ä»‹é¢">
      <div class="title" aria-hidden="false">
        <h1>æœå­éª°ä»”éŠæˆ²-ç¬¬3å›</h1>
        <div class="subtitle">ğŸ“± å»ºè­°ç›´å¼è§€çœ‹æ•ˆæœæœ€ä½³</div>
      </div>

      <div class="main">
        <div class="panel-left">
          <div class="dice-box">
            <div id="dice" class="dice" aria-live="polite" aria-atomic="true">
              <img id="diceImage" src="game9_assets/fruit13.png" alt="éª°å­é¡¯ç¤ºçš„æ°´æœ">
            </div>

            <div class="controls">
              <button id="rollBtn" class="btn" type="button">æ“²éª°å­</button>
              <button id="resetBtn" class="btn" type="button" style="background:#8fb6ff;color:#fff;">é‡ç½®éŠæˆ²</button>
            </div>

            <div class="fruit-name" id="fruitName">æº–å‚™æ“²éª°å­</div>
            <div class="phonetic" id="fruitPhonetic">è«‹æŒ‰ã€Œæ“²éª°å­ã€</div>
          </div>
        </div>

        <div class="panel-right">
          <div class="info" id="infoBox">
            <strong>ä½¿ç”¨èªªæ˜</strong>
            <ul>
              <li>æŒ‰ã€Œæ“²éª°å­ã€é–‹å§‹æ»¾å‹•ï¼ŒæŒ‰éˆ•æœƒåœ¨æ»¾å‹•æœŸé–“åœç”¨ã€‚</li>
              <li>åœæ­¢æ™‚æœƒæ’­æ”¾åœæ­¢éŸ³æ•ˆï¼Œä¸¦åœ¨ 0.5 ç§’å¾Œæ’­æ”¾è©²æ°´æœçš„å°èªç™¼éŸ³ã€‚</li>
              <li>æ¯é¡†æ°´æœåªæœƒé¡¯ç¤ºä¸€æ¬¡ï¼ˆå…± 6 ç¨®ï¼‰ã€‚å…¨éƒ¨å‡ºéå¾Œè«‹æŒ‰ã€Œé‡ç½®éŠæˆ²ã€ã€‚</li>
            </ul>
            <hr>
            <div>
              <strong>æœ¬å›åˆæ°´æœæ¸…å–®ï¼ˆå°èª + æ‹¼éŸ³ï¼‰</strong>
              <ol>
                <li>fruit13 â†’ æ£—ä»” tsÃ³-Ã¡</li>
                <li>fruit14 â†’ æŸšä»” iÅ«-Ã¡</li>
                <li>fruit15 â†’ æä»” lÃ­-Ã¡</li>
                <li>fruit16 â†’ æŸ¿ä»” khÄ«-Ã¡</li>
                <li>fruit17 â†’ è”æ nÄi-tsi</li>
                <li>fruit18 â†’ é¾çœ¼ lÃ®ng-gÃ­ng</li>
              </ol>
            </div>
          </div>
        </div>
      </div> <!-- main -->

    </div> <!-- card -->
  </div> <!-- wrap -->

  <script>
    // ---- è³‡æºå®šç¾© ----
    const assetsBase = 'game9_assets/';
    const fruits = [
      { img: 'fruit13.png', name: 'æ£—ä»”', phonetic: 'tsÃ³-Ã¡', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/8/8491.mp3' },
      { img: 'fruit14.png', name: 'æŸšä»”', phonetic: 'iÅ«-Ã¡', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/5/5085.mp3' },
      { img: 'fruit15.png', name: 'æä»”', phonetic: 'lÃ­-Ã¡', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/3/3227.mp3' },
      { img: 'fruit16.png', name: 'æŸ¿ä»”', phonetic: 'khÄ«-Ã¡', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/5/5087.mp3' },
      { img: 'fruit17.png', name: 'è”æ', phonetic: 'nÄi-tsi', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/6/6646.mp3' },
      { img: 'fruit18.png', name: 'é¾çœ¼', phonetic: 'lÃ®ng-gÃ­ng', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/12/12106.mp3' },
    ];

    const rollSound = new Audio(assetsBase + 'Roll the dice.mp3');
    rollSound.loop = true;
    const stopSound = new Audio(assetsBase + 'ding.mp3');

    // ---- UI å…ƒä»¶ ----
    const rollBtn = document.getElementById('rollBtn');
    const resetBtn = document.getElementById('resetBtn');
    const dice = document.getElementById('dice');
    const diceImage = document.getElementById('diceImage');
    const fruitName = document.getElementById('fruitName');
    const fruitPhonetic = document.getElementById('fruitPhonetic');

    // ---- ä¸é‡è¤‡é‚è¼¯ï¼šå…ˆéš¨æ©Ÿæ‰“äº‚ç´¢å¼•é™£åˆ—ï¼Œå†æ¯æ¬¡ pop ä¸€å€‹ ----
    let order = [];
    function shuffleOrder(){
      order = Array.from({length:fruits.length}, (_,i)=>i);
      for(let i=order.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [order[i], order[j]] = [order[j], order[i]];
      }
    }
    shuffleOrder();

    // ---- æ“²éª°å­/æ»¾å‹•å¯¦ä½œ ----
    let rolling = false;
    let intervalId = null;

    function startRolling(){
      if(rolling) return;
      if(order.length === 0){
        fruitName.textContent = 'å·²ç¶“å…¨éƒ¨å‡ºéå›‰';
        fruitPhonetic.textContent = 'è«‹æŒ‰ã€Œé‡ç½®éŠæˆ²ã€ä»¥é‡æ–°é–‹å§‹';
        return;
      }
      rolling = true;
      rollBtn.disabled = true;
      resetBtn.disabled = true;

      // é–‹å§‹æ»¾å‹•å‹•ç•«ï¼ˆCSS 3D æ—‹è½‰ï¼‰ï¼Œä¸¦ä»¥ setInterval å¿«é€Ÿåˆ‡æ›åœ–ç‰‡ä»¥æ¨¡æ“¬æ»¾å‹•
      dice.classList.add('rolling');
      rollSound.currentTime = 0;
      rollSound.play().catch(()=>{/* autoplay å¯èƒ½è¢«ç€è¦½å™¨æ“‹ï¼Œå¾Œé¢äº¤äº’æ“ä½œå…è¨±æ’­æ”¾ */});

      intervalId = setInterval(()=>{
        // åœ¨æ»¾å‹•æ™‚éš¨æ©Ÿé¡¯ç¤ºä¸€å¼µåœ–ï¼ˆå¯é‡è¤‡ï¼Œç›´åˆ°çœŸæ­£åœæ­¢é¸å–ï¼‰
        const idx = Math.floor(Math.random()*fruits.length);
        diceImage.src = assetsBase + fruits[idx].img;
        diceImage.alt = fruits[idx].name;
      }, 80); // åˆ‡æ›é€Ÿåº¦
    }

    function stopRollingAndShow(){
      if(!rolling) return;
      rolling = false;

      // åœæ­¢æ»¾å‹•å‹•ç•«åŠæ»¾å‹•éŸ³
      dice.classList.remove('rolling');
      if(intervalId) clearInterval(intervalId);
      intervalId = null;

      // pick next index from shuffled order (ensures non-repetition)
      const nextIndex = order.pop();
      const chosen = fruits[nextIndex];

      // é¡¯ç¤ºåœ–ç‰‡ï¼ˆç«‹åˆ»é¡¯ç¤ºï¼‰ï¼Œä¸¦æ’­æ”¾åœæ­¢éŸ³æ•ˆ
      diceImage.src = assetsBase + chosen.img;
      diceImage.alt = chosen.name;
      stopSound.currentTime = 0;
      stopSound.play().catch(()=>{});

      // åœ¨åœæ­¢éŸ³æ•ˆå¾Œ 0.5 ç§’æ’­æ”¾å°èªç™¼éŸ³ï¼ˆé¡Œç›®è¦æ±‚ï¼‰
      setTimeout(()=>{
        // æ’­æ”¾å°æ‡‰éŸ³æª”ï¼ˆé ç«¯ sutian é€£çµï¼‰
        const pron = new Audio(chosen.audio);
        pron.play().catch(()=>{/* è‹¥è¢«é˜»æ“‹ï¼Œä½¿ç”¨è€…å†é»æ“Šå³å¯ */});
      }, 500);

      // æ›´æ–°æ–‡å­—
      fruitName.textContent = chosen.name;
      fruitPhonetic.textContent = chosen.phonetic;

      // re-enable buttonsï¼ˆä½†è‹¥å·²ç„¡æ›´å¤šæ°´æœï¼Œæç¤ºé‡ç½®ï¼‰
      setTimeout(()=>{
        rollBtn.disabled = false;
        resetBtn.disabled = false;
        if(order.length === 0){
          rollBtn.disabled = true;
          fruitPhonetic.textContent = chosen.phonetic + 'ï¼ˆå·²å‡ºå®Œæ‰€æœ‰æ°´æœï¼‰';
        }
      }, 700);
    }

    // å°‡ä¸€å€‹å®Œæ•´çš„ã€Œæ“²â€”åœã€æµç¨‹ç¶åˆ°æŒ‰éˆ•ï¼šæŒ‰ä¸€ä¸‹å•Ÿå‹• 700ms çš„æ»¾å‹•ï¼ˆæˆ–ä»»æ„æ‚¨æƒ³çš„æ™‚é–“ï¼‰
    // æˆ‘å€‘æ¨¡æ“¬çœŸå¯¦æ‰‹å‹•åœéª°ï¼šå•Ÿå‹•å¾Œè‡ªå‹•åœ¨ 900~1300ms é–“éš¨æ©Ÿåœæ­¢ï¼ˆé¿å…æ¯æ¬¡éƒ½åŒä¸€æ™‚é•·ï¼‰
    rollBtn.addEventListener('click', ()=> {
      startRolling();
      // è‡ªå‹•åœæ­¢ï¼šåœ¨ 800 ~ 1300 ms éš¨æ©Ÿæ™‚é–“åœæ­¢ï¼Œæ¨¡æ“¬æŠ•æ“²è¡Œç‚º
      const stopDelay = 900 + Math.floor(Math.random()*500);
      setTimeout(()=> stopRollingAndShow(), stopDelay);
    });

    resetBtn.addEventListener('click', ()=>{
      // é‡æ–°æ´—ç‰Œã€é‡ç½®é¡¯ç¤º
      shuffleOrder();
      diceImage.src = assetsBase + fruits[0].img;
      diceImage.alt = fruits[0].name;
      fruitName.textContent = 'éŠæˆ²å·²é‡ç½®';
      fruitPhonetic.textContent = 'è«‹æŒ‰ã€Œæ“²éª°å­ã€é–‹å§‹';
      rollBtn.disabled = false;
    });

    // é è¼‰æ‰€æœ‰è³‡æºï¼ˆåœ–ç‰‡ + éŸ³æ•ˆï¼‰ä»¥æ¸›å°‘å»¶é²
    (function preload(){
      fruits.forEach(f=>{
        const im = new Image();
        im.src = assetsBase + f.img;
      });
      // é è¼‰åœæ­¢éŸ³ï¼ˆä½†ä¸è¦è‡ªå‹•æ’­æ”¾ï¼‰
      stopSound.load();
      rollSound.load();
    })();

    // Accessibility: æ”¯æ´éµç›¤ç©ºç™½éµå•Ÿå‹•æ“²éª°ï¼ˆç•¶æŒ‰éˆ•æœ‰ç„¦é»æˆ–æ•´å€‹æ–‡ä»¶ï¼‰
    document.addEventListener('keydown', (e)=>{
      if(e.code === 'Space' && !e.repeat){
        e.preventDefault();
        if(!rollBtn.disabled) rollBtn.click();
      }
    });

    // åˆå§‹é¡¯ç¤ºç¬¬ä¸€å¼µåœ–ï¼ˆé è¦½ï¼‰
    diceImage.src = assetsBase + fruits[0].img;
    diceImage.alt = fruits[0].name;

  </script>
</body>
</html>

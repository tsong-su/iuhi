<style>
  .target {
    position: absolute;
    width: 4.5%;   /* 紅框再縮小 */
    aspect-ratio: 1 / 1;
    border: 3px dashed red;
    box-sizing: border-box;
    pointer-events: none;
  }

  .stamp {
    position: absolute;
    width: 10%;   /* 郵票固定 10% */
    aspect-ratio: 1 / 1;
    cursor: grab;
    z-index: 10;
  }
</style>

<script>
  function createStamps() {
    stamps.forEach(s => s.remove());
    stamps = [];

    basePositions.forEach((pos, i) => {
      const img = document.createElement("img");
      img.src = `game4_assets/stamp${i+1}.png`;   // ← 確認檔案是否存在
      img.className = "stamp";
      img.dataset.index = i;
      img.draggable = true;
      mapContainer.appendChild(img);
      stamps.push(img);

      // 不等 onload，直接隨機散落
      shuffleStamp(img);
    });

    initDragDrop();
  }

  function shuffleStamp(stamp) {
    const mapW = map.clientWidth;
    const mapH = map.clientHeight;
    const offsetX = (mapContainer.clientWidth - mapW) / 2;
    const offsetY = (mapContainer.clientHeight - mapH) / 2;

    let left, top;
    let tries = 0;

    do {
      left = offsetX + Math.random() * (mapW - mapW * 0.1);
      top  = offsetY + Math.random() * (mapH - mapH * 0.1);
      tries++;
    } while (
      left > offsetX + mapW*0.25 &&
      left < offsetX + mapW*0.75 &&
      top  > offsetY + mapH*0.25 &&
      top  < offsetY + mapH*0.75 &&
      tries < 50
    );

    stamp.style.left = left + "px";
    stamp.style.top = top + "px";
  }
</script>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區&注音符號郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      text-align: center;
      background: #fff;
      overflow: hidden; /* 去掉捲軸 */
    }
    h1 {
      margin: 10px 0 5px 0;
      font-size: 22px;
    }
    h2 {
      margin: 0 0 15px 0;
      font-size: 16px;
      font-weight: normal;
      color: #444;
    }
    #game-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: calc(100vh - 100px);
      padding: 0 40px; /* 往外推，避免太擠 */
      box-sizing: border-box;
    }
    #stamps-left, #stamps-right {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(2, 100px);
      gap: 10px;
    }
    .stamp {
      width: 100px;
      height: 100px;
      cursor: grab;
      border: 1px solid #ccc;
      object-fit: cover;
    }
    #map-container {
      position: relative;
      flex: 0 0 auto;
    }
    #map {
      width: 500px; /* 固定地圖大小 */
      height: auto;
      display: block;
    }
    .drop-zone {
      position: absolute;
      width: 100px;
      height: 100px;
      border: 2px dashed red;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      color: red;
      pointer-events: none;
      box-sizing: border-box;
    }
    #controls {
      margin-top: 15px;
    }
    button {
      margin: 5px;
      padding: 8px 16px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>臺灣北部地區&注音符號郵票配對遊戲</h1>
  <h2>共郵票 suá 到對應的縣市格仔內</h2>

  <div id="game-container">
    <!-- 左側郵票 -->
    <div id="stamps-left"></div>

    <!-- 地圖與紅框 -->
    <div id="map-container">
      <img id="map" src="game4_assets/north_map.png" alt="地圖">
      <!-- 紅框 (12個) -->
    </div>

    <!-- 右側郵票 -->
    <div id="stamps-right"></div>
  </div>

  <!-- 控制區 -->
  <div id="controls">
    <button onclick="toggleCalibration()">切換對位校正模式</button>
    <button onclick="exportCoordinates()">匯出座標</button>
  </div>

  <script>
    const stampContainerLeft = document.getElementById("stamps-left");
    const stampContainerRight = document.getElementById("stamps-right");
    const mapContainer = document.getElementById("map-container");
    let calibrationMode = false;
    let dropZones = [];
    const stamps = 12;

    // 初始化郵票 (左右各一組)
    for (let i = 1; i <= stamps; i++) {
      const imgLeft = document.createElement("img");
      imgLeft.src = `game4_assets/stamp${i}.jpg`;
      imgLeft.className = "stamp";
      imgLeft.draggable = true;
      stampContainerLeft.appendChild(imgLeft);

      const imgRight = document.createElement("img");
      imgRight.src = `game4_assets/stamp${i}.jpg`;
      imgRight.className = "stamp";
      imgRight.draggable = true;
      stampContainerRight.appendChild(imgRight);
    }

    // 初始化紅框 (12 個)
    const coords = [
      { x: 28, y: 16 }, { x: 54, y: 9 }, { x: 70, y: 10 }, { x: 84, y: 25 },
      { x: 23, y: 38 }, { x: 42, y: 19 }, { x: 80, y: 46 }, { x: 16, y: 59 },
      { x: 20, y: 90 }, { x: 54, y: 80 }, { x: 66, y: 58 }, { x: 40, y: 92 }
    ];

    coords.forEach((c, idx) => {
      const zone = document.createElement("div");
      zone.className = "drop-zone";
      zone.style.left = c.x + "%";
      zone.style.top = c.y + "%";
      zone.innerText = idx + 1;
      mapContainer.appendChild(zone);
      dropZones.push(zone);
    });

    // 切換對位校正模式
    function toggleCalibration() {
      calibrationMode = !calibrationMode;
      alert(calibrationMode ? "進入對位校正模式，可拖曳紅框調整位置" : "退出對位校正模式");

      dropZones.forEach(zone => {
        zone.style.pointerEvents = calibrationMode ? "auto" : "none";
        zone.style.cursor = calibrationMode ? "move" : "default";

        if (calibrationMode) {
          zone.onmousedown = function(e) {
            const shiftX = e.clientX - zone.getBoundingClientRect().left;
            const shiftY = e.clientY - zone.getBoundingClientRect().top;

            function moveAt(pageX, pageY) {
              const rect = mapContainer.getBoundingClientRect();
              zone.style.left = ((pageX - rect.left - shiftX) / rect.width * 100) + "%";
              zone.style.top = ((pageY - rect.top - shiftY) / rect.height * 100) + "%";
            }

            function onMouseMove(e) {
              moveAt(e.pageX, e.pageY);
            }

            document.addEventListener("mousemove", onMouseMove);

            zone.onmouseup = function() {
              document.removeEventListener("mousemove", onMouseMove);
              zone.onmouseup = null;
            };
          };

          zone.ondragstart = () => false;
        } else {
          zone.onmousedown = null;
        }
      });
    }

    // 匯出座標
    function exportCoordinates() {
      let output = "";
      dropZones.forEach((z, idx) => {
        output += `${idx + 1} → left:${z.style.left}, top:${z.style.top}\n`;
      });
      // 可直接複製貼回
      prompt("紅框座標 (可複製)：", output);
    }
  </script>
</body>
</html>

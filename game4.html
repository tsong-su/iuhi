<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>è‡ºç£åŒ—éƒ¨åœ°åœ–&æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      text-align: center;
      background: #f5f5f5;
      font-family: Arial, sans-serif;
    }
    h1 {
      font-size: 28px;
      margin: 10px;
    }
    #gameContainer {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    #map {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }
    .frame {
      position: absolute;
      border: 3px dashed red;
      pointer-events: none;
      box-sizing: border-box;
    }
    .stamp {
      position: absolute;
      cursor: grab;
      user-select: none;
      z-index: 10;
    }
    #controls {
      margin: 10px;
    }
    button {
      font-size: 18px;
      padding: 8px 16px;
      margin: 5px;
      cursor: pointer;
    }
    #message {
      font-size: 26px;
      color: green;
      font-weight: bold;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>è‡ºç£åŒ—éƒ¨åœ°åœ–&æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</h1>
  <div id="controls">
    <a href="index.html">ğŸ  å›åˆ°éŠæˆ²é¦–é </a>
    <button onclick="shuffleStamps()">ğŸ”„ é‡æ’éƒµç¥¨</button>
  </div>
  <div id="gameContainer">
    <img id="map" src="game4_assets/north2_map.png" alt="åŒ—éƒ¨åœ°åœ–">
  </div>
  <div id="message"></div>

  <script>
    const basePositions = [
      { "x": 0.9953, "y": 0.1551 },
      { "x": 0.7589, "y": 0.0012 },
      { "x": 0.5749, "y": 0.0249 },
      { "x": 0.3782, "y": 0.1872 },
      { "x": 0.1291, "y": 0.1264 },
      { "x": 0.115, "y": 0.3242 },
      { "x": 0.0077, "y": 0.5255 },
      { "x": 0.0435, "y": 0.9668 },
      { "x": 0.2479, "y": 0.9922 },
      { "x": 0.4791, "y": 0.9043 },
      { "x": 0.7372, "y": 0.4916 },
      { "x": 0.9173, "y": 0.4409 }
    ];

    const container = document.getElementById("gameContainer");
    const map = document.getElementById("map");
    const message = document.getElementById("message");

    let frames = [];
    let stamps = [];
    let placedCount = 0;
    const total = basePositions.length;

    const correctAudio = new Audio("game4_assets/correct.mp3");
    const wrongAudio = new Audio("game4_assets/wrong.mp3");
    const victoryAudio = new Audio("game4_assets/victory.mp3");

    // å»ºç«‹ç´…æ¡† & éƒµç¥¨
    function initGame() {
      frames.forEach(f => f.remove());
      stamps.forEach(s => s.remove());
      frames = [];
      stamps = [];
      placedCount = 0;
      message.textContent = "";

      const rect = container.getBoundingClientRect();
      const mapW = rect.width;
      const mapH = rect.height;
      const frameSize = mapW * 0.06;

      basePositions.forEach((pos, i) => {
        // ç´…æ¡†
        const frame = document.createElement("div");
        frame.className = "frame";
        frame.style.width = frameSize + "px";
        frame.style.height = frameSize + "px";
        frame.style.left = (pos.x * mapW - frameSize / 2) + "px";
        frame.style.top = (pos.y * mapH - frameSize / 2) + "px";
        container.appendChild(frame);
        frames.push(frame);

        // éƒµç¥¨
        const stamp = document.createElement("img");
        stamp.src = `game4_assets/stamp${i+1}.jpg`;
        stamp.className = "stamp";
        stamp.style.width = frameSize + "px";
        stamp.dataset.index = i;
        container.appendChild(stamp);
        stamps.push(stamp);
      });

      shuffleStamps();
    }

    // éš¨æ©Ÿæ•£è½éƒµç¥¨ï¼ˆå››å‘¨ç©ºç™½å€åŸŸï¼‰
    function shuffleStamps() {
      const rect = container.getBoundingClientRect();
      const mapW = rect.width;
      const mapH = rect.height;
      const frameSize = mapW * 0.06;

      stamps.forEach(stamp => {
        let x, y;
        const margin = 50;

        // é¿é–‹åœ°åœ–ä¸­å¿ƒå€åŸŸï¼Œæ•£è½å››å‘¨
        if (Math.random() > 0.5) {
          // ä¸Šä¸‹
          x = Math.random() * (mapW - frameSize - margin);
          y = Math.random() > 0.5 ? margin : mapH - frameSize - margin;
        } else {
          // å·¦å³
          x = Math.random() > 0.5 ? margin : mapW - frameSize - margin;
          y = Math.random() * (mapH - frameSize - margin);
        }

        stamp.style.left = x + "px";
        stamp.style.top = y + "px";
      });
    }

    // æ‹–æ›³åŠŸèƒ½
    let dragTarget = null, offsetX = 0, offsetY = 0;
    document.addEventListener("mousedown", e => {
      if (e.target.classList.contains("stamp")) {
        dragTarget = e.target;
        const rect = dragTarget.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
      }
    });
    document.addEventListener("mousemove", e => {
      if (dragTarget) {
        dragTarget.style.left = (e.clientX - offsetX) + "px";
        dragTarget.style.top = (e.clientY - offsetY) + "px";
      }
    });
    document.addEventListener("mouseup", e => {
      if (dragTarget) {
        checkDrop(dragTarget);
        dragTarget = null;
      }
    });

    function checkDrop(stamp) {
      const idx = parseInt(stamp.dataset.index);
      const rect = container.getBoundingClientRect();
      const mapW = rect.width;
      const mapH = rect.height;
      const frameSize = mapW * 0.06;

      const frame = frames[idx];
      const fRect = frame.getBoundingClientRect();
      const sRect = stamp.getBoundingClientRect();

      if (Math.abs(fRect.left - sRect.left) < frameSize/3 &&
          Math.abs(fRect.top - sRect.top) < frameSize/3) {
        stamp.style.left = frame.style.left;
        stamp.style.top = frame.style.top;
        stamp.style.pointerEvents = "none";
        correctAudio.play();
        placedCount++;
        if (placedCount === total) {
          message.textContent = "ğŸ‰ æœ‰å¤ gÃ¢uï¼";
          victoryAudio.play();
        }
      } else {
        wrongAudio.play();
      }
    }

    window.addEventListener("resize", initGame);
    window.addEventListener("load", initGame);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: "Microsoft JhengHei", sans-serif;
      background: url("game4_assets/north_map.png") no-repeat center center;
      background-size: contain;
      height: 100vh;
      overflow: hidden;
    }
    #gameContainer {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .stamp {
      position: absolute;
      width: 100px;
      height: 100px;
      cursor: grab;
    }
    .slot {
      position: absolute;
      width: 100px;
      height: 100px;
      border: 2px dashed transparent; /* 不顯示邊框 */
    }
    #message {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      color: red;
      display: none;
      font-weight: bold;
      animation: grow 2s forwards;
    }
    @keyframes grow {
      from { font-size: 20px; opacity: 0.5; }
      to { font-size: 120px; opacity: 1; }
    }
    #homeButton {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      font-size: 22px;
      font-weight: bold;
      background-color: #f0ad4e;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="gameContainer"></div>
  <div id="message">有夠 gâu！</div>
  <button id="homeButton" onclick="location.href='https://tsong-su.github.io/iuhi/index.html'">回到遊戲首頁</button>

  <script>
    const container = document.getElementById("gameContainer");

    // 大約估算的 12 個格子座標 (1760x1415 尺寸為基準)
    const answerPositions = [
      {x:200, y:200}, {x:400, y:250}, {x:600, y:220},
      {x:800, y:300}, {x:1000, y:350}, {x:1200, y:320},
      {x:1400, y:400}, {x:300, y:600}, {x:500, y:650},
      {x:700, y:700}, {x:900, y:750}, {x:1100, y:800}
    ];

    const stamps = [];
    const slots = [];

    // 建立格子
    answerPositions.forEach((pos, index) => {
      const slot = document.createElement("div");
      slot.className = "slot";
      slot.style.left = pos.x + "px";
      slot.style.top = pos.y + "px";
      container.appendChild(slot);
      slots.push(slot);
    });

    // 隨機散佈郵票
    answerPositions.forEach((pos, index) => {
      const stamp = document.createElement("img");
      stamp.src = `game4_assets/stamp${index+1}.jpg`;
      stamp.className = "stamp";
      stamp.style.left = (50 + (index%6)*120) + "px";
      stamp.style.top = (900 + Math.floor(index/6)*120) + "px";
      stamp.dataset.index = index;
      container.appendChild(stamp);
      stamps.push(stamp);

      makeDraggable(stamp, pos, index);
    });

    let correctCount = 0;

    function makeDraggable(stamp, targetPos, index) {
      let offsetX, offsetY, originalX, originalY;

      stamp.onmousedown = function(e) {
        offsetX = e.clientX - stamp.offsetLeft;
        offsetY = e.clientY - stamp.offsetTop;
        originalX = stamp.offsetLeft;
        originalY = stamp.offsetTop;

        document.onmousemove = function(e) {
          stamp.style.left = (e.clientX - offsetX) + "px";
          stamp.style.top = (e.clientY - offsetY) + "px";
        };

        document.onmouseup = function(e) {
          document.onmousemove = null;
          document.onmouseup = null;

          const dx = stamp.offsetLeft - targetPos.x;
          const dy = stamp.offsetTop - targetPos.y;
          const distance = Math.sqrt(dx*dx + dy*dy);

          if (distance <= 30) {
            // 吸附到正確位置
            stamp.style.left = targetPos.x + "px";
            stamp.style.top = targetPos.y + "px";
            stamp.onmousedown = null;
            new Audio(`game4_assets/stamp${index+1}.mp3`).play();
            correctCount++;

            if (correctCount === 12) {
              document.getElementById("message").style.display = "block";
            }
          } else {
            // 錯誤 -> 彈回原位
            stamp.style.left = originalX + "px";
            stamp.style.top = originalY + "px";
            new Audio("game4_assets/wrong.mp3").play();
          }
        };
      };
    }
  </script>
</body>
</html>

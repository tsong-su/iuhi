<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>台灣北部郵票配對遊戲</title>
<style>
  body {
    margin: 0;
    background: #f4f4f4;
    text-align: center;
    font-family: Arial, sans-serif;
  }

  h2 {
    margin: 10px;
  }

  #game-container {
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    height: calc(100vh - 60px);
    overflow: hidden;
  }

  #map-container {
    position: relative;
    flex: 1;
    text-align: center;
  }

  #map {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
  }

  #red-frames {
    position: absolute;
    top: 0;
    left: 0;
  }

  .red-frame {
    position: absolute;
    border: 2px solid red;
    box-sizing: border-box;
  }

  .stamps {
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 10px;
    padding: 10px;
  }

  .stamp {
    cursor: grab;
    border: 2px solid #ccc;
    background: white;
    border-radius: 6px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }

  #toolbar {
    height: 60px;
    background: #ddd;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  #toolbar button {
    padding: 8px 16px;
    margin: 0 5px;
    font-size: 14px;
  }
</style>
</head>
<body>

<h2>台灣北部地圖＆注音符號郵票配對遊戲</h2>

<div id="game-container">
  <!-- 左側郵票 -->
  <div class="stamps" id="left-stamps"></div>

  <!-- 地圖區 -->
  <div id="map-container">
    <img id="map" src="game4_assets/north2_map.png" alt="北部地圖">
    <div id="red-frames"></div>
  </div>

  <!-- 右側郵票 -->
  <div class="stamps" id="right-stamps"></div>
</div>

<!-- 工具列 -->
<div id="toolbar">
  <button onclick="location.href='index.html'">回到遊戲首頁</button>
</div>

<script>
const redFramePositions = [
  {x:1036, y:145}, {x:905, y:80}, {x:806, y:83}, {x:704, y:144},
  {x:593, y:116}, {x:593, y:180}, {x:544, y:243}, {x:567, y:396},
  {x:661, y:406}, {x:761, y:376}, {x:873, y:236}, {x:955, y:220}
];

// 答案表（示範，需根據 north_answer.png 調整）
const correctAnswers = {
  1: "stamp3.jpg",
  2: "stamp7.jpg",
  3: "stamp1.jpg",
  4: "stamp5.jpg",
  5: "stamp2.jpg",
  6: "stamp6.jpg",
  7: "stamp4.jpg",
  8: "stamp9.jpg",
  9: "stamp10.jpg",
  10: "stamp8.jpg",
  11: "stamp11.jpg",
  12: "stamp12.jpg"
};

const allStamps = [
  "stamp1.jpg","stamp2.jpg","stamp3.jpg","stamp4.jpg",
  "stamp5.jpg","stamp6.jpg","stamp7.jpg","stamp8.jpg",
  "stamp9.jpg","stamp10.jpg","stamp11.jpg","stamp12.jpg"
];

// 分兩邊顯示郵票
function renderStamps() {
  const left = document.getElementById("left-stamps");
  const right = document.getElementById("right-stamps");
  allStamps.slice(0,6).forEach(name => {
    const img = createStamp(name);
    left.appendChild(img);
  });
  allStamps.slice(6).forEach(name => {
    const img = createStamp(name);
    right.appendChild(img);
  });
}

// 建立可拖曳的郵票
function createStamp(name) {
  const img = document.createElement("img");
  img.src = "game4_assets/" + name;
  img.className = "stamp";
  img.draggable = true;
  img.addEventListener("dragstart", e => {
    e.dataTransfer.setData("text/plain", name);
  });
  return img;
}

// 繪製紅框
function renderRedFrames() {
  const map = document.getElementById('map');
  const redFrames = document.getElementById('red-frames');
  redFrames.innerHTML = "";

  const scale = map.width / map.naturalWidth;

  redFramePositions.forEach((pos, i) => {
    const frame = document.createElement("div");
    frame.className = "red-frame";
    frame.dataset.index = i + 1;

    const frameSize = 60 * scale; // 紅框比郵票小
    frame.style.width = frameSize + "px";
    frame.style.height = frameSize + "px";

    // 中心對齊
    frame.style.left = (pos.x * scale - frameSize/2) + "px";
    frame.style.top = (pos.y * scale - frameSize/2) + "px";

    frame.addEventListener("dragover", e => e.preventDefault());
    frame.addEventListener("drop", e => {
      e.preventDefault();
      const stampName = e.dataTransfer.getData("text/plain");
      checkMatch(i+1, stampName, frame);
    });

    redFrames.appendChild(frame);
  });

  scaleStamps(scale);
}

// 調整郵票大小
function scaleStamps(scale) {
  const stampSize = 80 * scale; // 郵票比紅框大
  document.querySelectorAll('.stamp').forEach(stamp => {
    stamp.style.width = stampSize + "px";
    stamp.style.height = "auto";
  });
}

// 檢查配對
function checkMatch(frameIndex, stampName, frame) {
  if (correctAnswers[frameIndex] === stampName) {
    frame.style.border = "2px solid green";
    new Audio("game4_assets/correct.mp3").play();
  } else {
    frame.style.border = "2px solid red";
    new Audio("game4_assets/wrong.mp3").play();
  }
}

// 初始化
window.addEventListener('resize', renderRedFrames);
window.addEventListener('load', () => {
  renderStamps();
  const map = document.getElementById('map');
  map.onload = renderRedFrames;
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區&注音符號郵票配對遊戲</title>
  <style>
    body {
      text-align: center;
      font-family: Arial, sans-serif;
      margin: 0;
      overflow: hidden;
    }

    h2 {
      margin: 20px 0;
    }

    #game-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: calc(100vh - 100px);
      padding: 0 20px;
      box-sizing: border-box;
    }

    #stamps-left, #stamps-right {
      display: grid;
      grid-template-columns: repeat(2, 100px);
      grid-template-rows: repeat(3, 100px);
      gap: 10px;
    }

    .stamp {
      width: 100px;
      height: 100px;
      cursor: grab;
    }

    #map-container {
      position: relative;
      flex-grow: 1;
      max-width: 800px;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #map {
      max-width: 100%;
      max-height: 100%;
      display: block;
    }

    .dropzone {
      position: absolute;
      width: 100px;
      height: 100px;
      border: 2px dashed red;
      pointer-events: none;
    }

    #controls {
      margin: 10px;
    }
  </style>
</head>
<body>
  <h2>臺灣北部地區&注音符號郵票配對遊戲</h2>
  <div id="game-container">
    <!-- 左側郵票 -->
    <div id="stamps-left">
      <img src="game4_assets/stamp1.jpg" class="stamp" draggable="true" id="stamp1">
      <img src="game4_assets/stamp2.jpg" class="stamp" draggable="true" id="stamp2">
      <img src="game4_assets/stamp3.jpg" class="stamp" draggable="true" id="stamp3">
      <img src="game4_assets/stamp4.jpg" class="stamp" draggable="true" id="stamp4">
      <img src="game4_assets/stamp5.jpg" class="stamp" draggable="true" id="stamp5">
      <img src="game4_assets/stamp6.jpg" class="stamp" draggable="true" id="stamp6">
    </div>

    <!-- 地圖 -->
    <div id="map-container">
      <img src="game4_assets/north_map.png" id="map" alt="臺灣北部地圖">
      <!-- 紅框投放區 (會根據座標生成) -->
    </div>

    <!-- 右側郵票 -->
    <div id="stamps-right">
      <img src="game4_assets/stamp7.jpg" class="stamp" draggable="true" id="stamp7">
      <img src="game4_assets/stamp8.jpg" class="stamp" draggable="true" id="stamp8">
      <img src="game4_assets/stamp9.jpg" class="stamp" draggable="true" id="stamp9">
      <img src="game4_assets/stamp10.jpg" class="stamp" draggable="true" id="stamp10">
      <img src="game4_assets/stamp11.jpg" class="stamp" draggable="true" id="stamp11">
      <img src="game4_assets/stamp12.jpg" class="stamp" draggable="true" id="stamp12">
    </div>
  </div>

  <!-- 控制按鈕 -->
  <div id="controls">
    <button onclick="setMode('game')">一般模式</button>
    <button onclick="setMode('calibration')">對位校正模式</button>
    <button onclick="exportPositions()">匯出座標</button>
    <button onclick="clearCustomPositions()">清除自訂座標</button>
    <button onclick="location.reload()">重新開始</button>
    <button onclick="window.location.href='index.html'">返回遊戲首頁</button>
  </div>

  <script>
    const mapContainer = document.getElementById("map-container");
    const map = document.getElementById("map");
    const stamps = document.querySelectorAll(".stamp");

    // ✅ 預設正確座標 (百分比)
    const correctPositions = [
      { x: 100, y: 18.0033 },
      { x: 81.1616, y: 2.681 },
      { x: 57.101, y: 0 },
      { x: 9.189, y: 34.9741 },
      { x: 37.2605, y: 15.0418 },
      { x: 1.9834, y: 57.8766 },
      { x: 12.8999, y: 9.3935 },
      { x: 1.702, y: 99.0745 },
      { x: 48.1213, y: 93.6605 },
      { x: 23.1445, y: 100 },
      { x: 96.768, y: 44.4399 },
      { x: 73.6003, y: 55.3403 }
    ];

    let mode = "game"; // game 或 calibration
    let dropzones = [];

    // 初始化紅框
    function createDropzones() {
      map.addEventListener("load", () => {
        const rect = map.getBoundingClientRect();
        dropzones.forEach(z => z.remove());
        dropzones = [];

        correctPositions.forEach((pos, i) => {
          const dz = document.createElement("div");
          dz.classList.add("dropzone");
          dz.style.left = (rect.width * pos.x / 100 - 50) + "px";
          dz.style.top = (rect.height * pos.y / 100 - 50) + "px";
          dz.dataset.index = i + 1;
          mapContainer.appendChild(dz);
          dropzones.push(dz);
        });
      });
    }

    createDropzones();

    // 模式切換
    function setMode(newMode) {
      mode = newMode;
      alert("切換到 " + (mode === "calibration" ? "對位校正模式" : "一般模式"));
    }

    // 匯出座標
    function exportPositions() {
      const rect = map.getBoundingClientRect();
      const exported = dropzones.map(dz => {
        const left = parseFloat(dz.style.left) + 50;
        const top = parseFloat(dz.style.top) + 50;
        return {
          x: ((left / rect.width) * 100).toFixed(4),
          y: ((top / rect.height) * 100).toFixed(4)
        };
      });
      console.log(JSON.stringify(exported, null, 2));
      alert("座標已匯出（請打開瀏覽器 Console 查看）");
    }

    // 清除自訂座標
    function clearCustomPositions() {
      createDropzones();
      alert("已清除自訂座標");
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地圖&注音符號郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      overflow: hidden;
      font-family: "Microsoft JhengHei", sans-serif;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
    }
    #controls button {
      margin-right: 8px;
      padding: 6px 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: #ff6666;
      color: white;
      cursor: pointer;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    #map {
      max-width: 70%;
      max-height: 70%;
      object-fit: contain;
      display: block;
    }
    .frame {
      position: absolute;
      border: 3px dashed red;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
    .stamp {
      position: absolute;
      width: 6vw; /* 郵票與紅框一致 */
      height: auto;
      cursor: grab;
      z-index: 5;
    }
  </style>
</head>
<body>
  <div id="controls">
    <button onclick="shuffleStamps()">🔄 重排郵票</button>
    <button onclick="location.href='index.html'">🏠 回到遊戲首頁</button>
  </div>

  <div id="game-container">
    <img id="map" src="game4_assets/north2_map.png" alt="map">
  </div>

  <!-- 音效 -->
  <audio id="correct-sound" src="game4_assets/correct.mp3"></audio>
  <audio id="wrong-sound" src="game4_assets/wrong.mp3"></audio>

  <script>
    const basePositions = [
      {x:0.9953, y:0.1551},
      {x:0.7589, y:0.0012},
      {x:0.5749, y:0.0249},
      {x:0.3782, y:0.1872},
      {x:0.1291, y:0.1264},
      {x:0.115 , y:0.3242},
      {x:0.0077, y:0.5255},
      {x:0.0435, y:0.9668},
      {x:0.2479, y:0.9922},
      {x:0.4791, y:0.9043},
      {x:0.7372, y:0.4916},
      {x:0.9173, y:0.4409}
    ];

    const map = document.getElementById("map");
    const container = document.getElementById("game-container");
    const correctSound = document.getElementById("correct-sound");
    const wrongSound = document.getElementById("wrong-sound");
    const stampSize = 6; // vw，與 .stamp 相同

    function createFrames() {
      basePositions.forEach((pos, i) => {
        const frame = document.createElement("div");
        frame.className = "frame";
        frame.style.width = stampSize + "vw";
        frame.style.height = stampSize + "vw";
        frame.style.left = (pos.x * map.clientWidth + map.offsetLeft) + "px";
        frame.style.top  = (pos.y * map.clientHeight + map.offsetTop) + "px";
        frame.dataset.index = i;
        container.appendChild(frame);
      });
    }

    function createStamps() {
      for (let i=0; i<12; i++) {
        const stamp = document.createElement("img");
        stamp.src = `game4_assets/stamp${i+1}.jpg`;
        stamp.className = "stamp";
        stamp.draggable = true;
        stamp.dataset.index = i;
        container.appendChild(stamp);
      }
      shuffleStamps();
    }

    function shuffleStamps() {
      const stamps = document.querySelectorAll(".stamp");
      const containerWidth = container.clientWidth;
      const containerHeight = container.clientHeight;

      stamps.forEach(stamp => {
        // 讓郵票分佈在右側或下方空白區
        let x, y;
        if (Math.random() > 0.5) { // 右側
          x = map.offsetLeft + map.clientWidth + Math.random() * (containerWidth - map.clientWidth - 100);
          y = 50 + Math.random() * (containerHeight - 150);
        } else { // 下方
          x = 50 + Math.random() * (containerWidth - 150);
          y = map.offsetTop + map.clientHeight + Math.random() * (containerHeight - map.clientHeight - 100);
        }
        stamp.style.left = x + "px";
        stamp.style.top  = y + "px";
      });
    }

    function enableDragAndDrop() {
      let dragged = null;

      document.querySelectorAll(".stamp").forEach(stamp => {
        stamp.addEventListener("dragstart", e => {
          dragged = e.target;
        });
      });

      document.querySelectorAll(".frame").forEach(frame => {
        frame.addEventListener("dragover", e => e.preventDefault());
        frame.addEventListener("drop", e => {
          e.preventDefault();
          if (dragged && dragged.dataset.index === frame.dataset.index) {
            frame.style.border = "3px solid green";
            dragged.style.left = frame.style.left;
            dragged.style.top  = frame.style.top;
            correctSound.currentTime = 0;
            correctSound.play();
          } else {
            wrongSound.currentTime = 0;
            wrongSound.play();
          }
        });
      });
    }

    map.onload = () => {
      createFrames();
      createStamps();
      enableDragAndDrop();
    };
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區郵票配對遊戲</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #map-container {
      position: relative;
      display: inline-block;
      margin-top: 20px;
    }
    #map {
      width: 700px;
      display: block;
    }
    .stamp {
      width: 80px;
      cursor: grab;
      position: relative;
      z-index: 10;
    }
    .target {
      position: absolute;
      width: 80px;
      height: 100px;
    }
    #stamps-left, #stamps-right {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(3, auto);
      gap: 10px;
    }
    #stamps-left { left: -120px; }
    #stamps-right { right: -120px; }
    #victory {
      display: none;
      font-size: 40px;
      font-weight: bold;
      color: green;
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.1);
      animation: grow 2s forwards;
      z-index: 100;
    }
    @keyframes grow {
      to { transform: translate(-50%, -50%) scale(1.5); }
    }
    .controls {
      margin-top: 20px;
    }
    .controls button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>臺灣北部地區郵票配對遊戲</h2>
  <p>耍法：kā 郵票 suá 到對應縣市的格仔內</p>
  <div id="map-container">
    <img id="map" src="game4_assets/map.png" alt="地圖">
    <div id="victory">有夠gâu！</div>
  </div>
  <div class="controls">
    <button onclick="location.reload()">閣耍一擺</button>
    <button onclick="window.location.href='https://tsong-su.github.io/iuhi/index.html'">回到遊戲首頁</button>
  </div>

  <script>
    const stampsData = [
      { id: 1, img: "game4_assets/1.png", target: {x:21.9069, y:15.2772} },
      { id: 2, img: "game4_assets/2.png", target: {x:55.5533, y:8.5731} },
      { id: 3, img: "game4_assets/3.png", target: {x:75.6431, y:10.4015} },
      { id: 4, img: "game4_assets/4.png", target: {x:93.1196, y:25.8412} },
      { id: 5, img: "game4_assets/5.png", target: {x:15.3736, y:37.421} },
      { id: 6, img: "game4_assets/6.png", target: {x:39.8734, y:19.1371} },
      { id: 7, img: "game4_assets/7.png", target: {x:87.7297, y:46.3597} },
      { id: 8, img: "game4_assets/8.png", target: {x:6.88036, y:59.1584} },
      { id: 9, img: "game4_assets/9.png", target: {x:11.2903, y:89.8347} },
      { id: 10, img: "game4_assets/10.png", target: {x:55.2266, y:79.677} },
      { id: 11, img: "game4_assets/11.png", target: {x:71.0698, y:57.33} },
      { id: 12, img: "game4_assets/12.png", target: {x:37.5868, y:91.8662} }
    ];

    const mapContainer = document.getElementById("map-container");
    const map = document.getElementById("map");

    let draggedStamp = null;
    let originalParent = null;

    function createStamps() {
      const leftContainer = document.createElement("div");
      leftContainer.id = "stamps-left";
      const rightContainer = document.createElement("div");
      rightContainer.id = "stamps-right";
      mapContainer.appendChild(leftContainer);
      mapContainer.appendChild(rightContainer);

      stampsData.forEach((stamp, index) => {
        const img = document.createElement("img");
        img.src = stamp.img;
        img.classList.add("stamp");
        img.draggable = true;
        img.dataset.id = stamp.id;

        if (index < stampsData.length / 2) {
          leftContainer.appendChild(img);
        } else {
          rightContainer.appendChild(img);
        }

        img.addEventListener("dragstart", dragStart);
      });
    }

    function createTargets() {
      stampsData.forEach(stamp => {
        const div = document.createElement("div");
        div.classList.add("target");
        div.dataset.id = stamp.id;

        div.style.left = (map.width * stamp.target.x / 100) + "px";
        div.style.top = (map.height * stamp.target.y / 100) + "px";
        mapContainer.appendChild(div);
      });
    }

    function dragStart(e) {
      draggedStamp = e.target;
      originalParent = draggedStamp.parentNode;
    }

    mapContainer.addEventListener("dragover", e => {
      e.preventDefault();
    });

    mapContainer.addEventListener("drop", e => {
      e.preventDefault();
      const targets = document.querySelectorAll(".target");
      let placed = false;

      targets.forEach(target => {
        const rect = target.getBoundingClientRect();
        if (
          e.clientX >= rect.left &&
          e.clientX <= rect.right &&
          e.clientY >= rect.top &&
          e.clientY <= rect.bottom
        ) {
          if (draggedStamp.dataset.id === target.dataset.id) {
            draggedStamp.style.left = target.style.left;
            draggedStamp.style.top = target.style.top;
            draggedStamp.style.position = "absolute";
            target.appendChild(draggedStamp);
            playSound("game4_assets/correct.mp3");
            checkVictory();
          } else {
            playSound("game4_assets/wrong.mp3");
            originalParent.appendChild(draggedStamp);
          }
          placed = true;
        }
      });

      if (!placed) {
        playSound("game4_assets/wrong.mp3");
        originalParent.appendChild(draggedStamp);
      }
    });

    function playSound(src) {
      const audio = new Audio(src);
      audio.play();
    }

    function checkVictory() {
      const targets = document.querySelectorAll(".target");
      let allFilled = true;
      targets.forEach(t => {
        if (!t.querySelector("img")) allFilled = false;
      });

      if (allFilled) {
        playSound("game4_assets/victory.mp3");
        document.getElementById("victory").style.display = "block";
      }
    }

    createStamps();
    createTargets();
  </script>
</body>
</html>

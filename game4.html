<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>檢查版：臺灣北部地區郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #fdfaf0; /* 淺米白 */
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #game-container {
      position: relative;
      width: 90vw;
      height: 80vh;
      margin: 1em auto;
      border: 2px solid #333;
      background: #eee url('game4_assets/north_map.jpg') no-repeat center center;
      background-size: contain;
    }
    .stamp {
      width: 60px;
      height: 60px;
      position: absolute;
      cursor: grab;
      border: 1px solid #999;
      border-radius: 5px;
    }
    .dropzone {
      position: absolute;
      width: 60px;
      height: 60px;
      border: 2px dashed transparent;
    }
    .dropzone.correct { border-color: green; }
    #message {
      margin-top: 1em;
      font-size: 2em;
      color: green;
      display: none;
    }
    #errors {
      color: red;
      font-size: 0.9em;
      margin-top: 0.5em;
    }
    #back-home {
      margin-top: 1em;
      padding: 0.5em 1em;
      font-size: 1.2em;
    }
  </style>
</head>
<body>

<h2>檢查版：臺灣北部地區郵票配對遊戲</h2>
<div id="game-container"></div>
<div id="message">有夠gâu 🎉</div>
<button id="back-home" onclick="location.href='index.html'">回到遊戲首頁</button>
<div id="errors"></div>

<script>
  const container = document.getElementById('game-container');
  const errorsDiv = document.getElementById('errors');
  const messageDiv = document.getElementById('message');

  const stampsData = [
    {id:'stamp1', file:'stamp1.jpg', audio:'stamp1.mp3', left:5, top:5},
    {id:'stamp2', file:'stamp2.jpg', audio:'stamp2.mp3', left:20, top:10},
    {id:'stamp3', file:'stamp3.jpg', audio:'stamp3.mp3', left:35, top:5},
    {id:'stamp4', file:'stamp4.jpg', audio:'stamp4.mp3', left:50, top:10},
    {id:'stamp5', file:'stamp5.jpg', audio:'stamp5.mp3', left:65, top:5},
    {id:'stamp6', file:'stamp6.jpg', audio:'stamp6.mp3', left:80, top:10},
    {id:'stamp7', file:'stamp7.jpg', audio:'stamp7.mp3', left:10, top:50},
    {id:'stamp8', file:'stamp8.jpg', audio:'stamp8.mp3', left:25, top:60},
    {id:'stamp9', file:'stamp9.jpg', audio:'stamp9.mp3', left:40, top:50},
    {id:'stamp10', file:'stamp10.jpg', audio:'stamp10.mp3', left:55, top:60},
    {id:'stamp11', file:'stamp11.jpg', audio:'stamp11.mp3', left:70, top:50},
    {id:'stamp12', file:'stamp12.jpg', audio:'stamp12.mp3', left:85, top:60},
  ];

  const dropzones = [];

  let correctCount = 0;

  // 預先檢查圖片是否能載入
  stampsData.forEach(stamp => {
    const img = new Image();
    img.src = 'game4_assets/' + stamp.file;
    img.onload = () => {
      // 建立郵票元素
      const stampEl = document.createElement('img');
      stampEl.src = img.src;
      stampEl.id = stamp.id;
      stampEl.className = 'stamp';
      stampEl.style.left = stamp.left + '%';
      stampEl.style.top = stamp.top + '%';
      stampEl.draggable = true;
      container.appendChild(stampEl);

      // 拖曳事件
      stampEl.addEventListener('dragstart', e => {
        e.dataTransfer.setData('text/plain', stamp.id);
      });

      // 建立對應 dropzone
      const dz = document.createElement('div');
      dz.className = 'dropzone';
      dz.style.left = stamp.left + '%';
      dz.style.top = stamp.top + '%';
      dz.dataset.stamp = stamp.id;
      container.appendChild(dz);
      dropzones.push(dz);

    };
    img.onerror = () => {
      errorsDiv.innerHTML += `圖片載入失敗：${stamp.file}<br>`;
    };
  });

  // 檢查錯誤音效
  const wrongAudio = new Audio('game4_assets/wrong.mp3');
  wrongAudio.onerror = () => {
    errorsDiv.innerHTML += '錯誤音效載入失敗：wrong.mp3<br>';
  };

  // dropzone 事件
  const observer = new MutationObserver(() => {
    dropzones.forEach(dz => {
      dz.addEventListener('dragover', e => e.preventDefault());
      dz.addEventListener('drop', e => {
        e.preventDefault();
        const stampId = e.dataTransfer.getData('text/plain');
        if (stampId === dz.dataset.stamp) {
          const stampEl = document.getElementById(stampId);
          dz.appendChild(stampEl);
          stampEl.style.left = '0';
          stampEl.style.top = '0';
          stampEl.draggable = false;
          dz.classList.add('correct');
          correctCount++;
          // 播放對應音效
          const audio = new Audio('game4_assets/' + stampsData.find(s => s.id===stampId).audio);
          audio.play();
          if (correctCount === stampsData.length) {
            messageDiv.style.display = 'block';
          }
        } else {
          wrongAudio.play();
        }
      });
    });
  });

  observer.observe(container, { childList: true });
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地圖郵票配對遊戲</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
      overflow-x: hidden; /* 避免水平捲軸 */
    }
    h1 {
      margin: 15px 0;
    }
    #map-container {
      position: relative;
      width: 35vw;
      max-width: 600px;
      margin: 0 auto;
      overflow: hidden;
    }
    #map {
      width: 100%;
      display: block;
    }
    .dropzone {
      position: absolute;
      width: 6%;
      height: 6%;
      border: 2px dashed red;
      pointer-events: none; /* 紅框不擋拖曳 */
    }
    #stamps-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      max-width: 90vw;
      margin: 15px auto;
    }
    .stamp {
      width: 80px;
      height: auto;
      cursor: grab;
    }
    #controls {
      margin: 15px auto;
      padding: 10px;
      background: #ddd;
      border-top: 2px solid #aaa;
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    button {
      padding: 6px 12px;
      font-size: 14px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background: #4285f4;
      color: white;
    }
    button:hover {
      background: #3367d6;
    }
  </style>
</head>
<body>
  <h1>臺灣北部地圖郵票配對遊戲</h1>

  <div id="map-container">
    <img id="map" src="game4_assets/north_map.png" alt="北部地圖">
  </div>

  <div id="stamps-container"></div>

  <div id="controls">
    <button onclick="goHome()">回到遊戲首頁</button>
    <button onclick="resetGame()">重新開始</button>
    <button onclick="toggleCalibration()">對位校正</button>
    <button onclick="clearCustom()">清除座標</button>
    <button onclick="exportCoords()">匯出座標</button>
  </div>

  <script>
    const stamps = Array.from({length: 12}, (_, i) => `game4_assets/stamp${i+1}.jpg`);
    const container = document.getElementById("stamps-container");
    const mapContainer = document.getElementById("map-container");

    // 初始紅框（相對百分比座標）
    let dropzones = [
      {x: 86, y: 18}, {x: 69, y: 0}, {x: 47, y: 0}, {x: 5, y: 27},
      {x: 28, y: 6}, {x: 0, y: 51}, {x: 9, y: 2}, {x: 3, y: 82},
      {x: 47, y: 77}, {x: 24, y: 83}, {x: 81, y: 41}, {x: 63, y: 48}
    ];

    let calibrationMode = false;

    // 建立郵票
    stamps.forEach((src, idx) => {
      const img = document.createElement("img");
      img.src = src;
      img.className = "stamp";
      img.draggable = true;
      img.dataset.index = idx;
      img.addEventListener("dragstart", dragStart);
      container.appendChild(img);
    });

    // 建立紅框
    function renderDropzones() {
      mapContainer.querySelectorAll(".dropzone").forEach(z => z.remove());
      dropzones.forEach((pos, i) => {
        const dz = document.createElement("div");
        dz.className = "dropzone";
        dz.style.left = pos.x + "%";
        dz.style.top = pos.y + "%";
        if (calibrationMode) {
          dz.style.pointerEvents = "auto";
          dz.style.cursor = "move";
          dz.draggable = true;
          dz.addEventListener("dragstart", e => {
            e.dataTransfer.setData("dz", i);
          });
        }
        mapContainer.appendChild(dz);
      });
    }
    renderDropzones();

    // 拖曳處理
    function dragStart(e) {
      e.dataTransfer.setData("stamp", e.target.dataset.index);
    }

    mapContainer.addEventListener("dragover", e => e.preventDefault());
    mapContainer.addEventListener("drop", e => {
      e.preventDefault();
      const stampIdx = e.dataTransfer.getData("stamp");
      if (stampIdx !== "") {
        alert("暫時判定：放置錯誤！");
      }
    });

    // 工具列功能
    function goHome() {
      alert("返回首頁（可連結回首頁頁面）");
    }
    function resetGame() {
      alert("遊戲已重置！");
    }
    function toggleCalibration() {
      calibrationMode = !calibrationMode;
      renderDropzones();
      alert(calibrationMode ? "進入對位校正模式" : "回到正式遊戲");
    }
    function clearCustom() {
      dropzones = [];
      renderDropzones();
      alert("已清除自訂座標");
    }
    function exportCoords() {
      const json = JSON.stringify(dropzones, null, 2);
      navigator.clipboard.writeText(json);
      alert("已複製座標到剪貼簿：\n" + json);
    }
  </script>
</body>
</html>

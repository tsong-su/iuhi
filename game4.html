<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區&注音符號郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f8f8f8;
      overflow: hidden; /* 防止多餘捲軸 */
    }
    .container {
      display: flex;
      height: calc(100vh - 80px); /* 預留工具列空間 */
      box-sizing: border-box;
    }
    .map-area {
      flex: 1;
      position: relative;
      background-color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }
    .map-area img {
      max-width: 100%;
      max-height: 100%;
    }
    .stamps {
      width: 240px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
      padding: 10px;
    }
    .stamp {
      width: 100px;
      height: 100px;
      border: 1px solid #ccc;
      cursor: grab;
      background-size: cover;
      background-position: center;
    }
    .red-box {
      position: absolute;
      border: 2px dashed red;
      width: 100px;
      height: 100px;
      cursor: move;
    }
    .toolbar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 80px;
      background: #ddd;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      box-shadow: 0 -2px 5px rgba(0,0,0,0.2);
    }
    button {
      padding: 10px 20px;
      border: none;
      background: #007bff;
      color: white;
      cursor: pointer;
      border-radius: 5px;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h2 style="text-align:center; margin:10px 0;">
    臺灣北部地區&注音符號郵票配對遊戲
  </h2>

  <div class="container">
    <!-- 左側郵票 -->
    <div class="stamps" id="left-stamps">
      <div class="stamp" style="background-image:url('game4_assets/stamp1.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp2.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp3.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp4.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp5.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp6.jpg')" draggable="true"></div>
    </div>

    <!-- 地圖 -->
    <div class="map-area" id="map-area">
      <img src="game4_assets/north_map.png" alt="map" id="map-image">
      <!-- 紅框 (先放 12 個) -->
    </div>

    <!-- 右側郵票 -->
    <div class="stamps" id="right-stamps">
      <div class="stamp" style="background-image:url('game4_assets/stamp7.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp8.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp9.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp10.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp11.jpg')" draggable="true"></div>
      <div class="stamp" style="background-image:url('game4_assets/stamp12.jpg')" draggable="true"></div>
    </div>
  </div>

  <!-- 工具列 -->
  <div class="toolbar">
    <button onclick="toggleCalibration()">對位校正模式</button>
    <button onclick="exportCoordinates()">匯出座標</button>
    <button onclick="alert('返回首頁（可連結回首頁頁面）')">返回遊戲首頁</button>
  </div>

  <script>
    const mapArea = document.getElementById("map-area");
    const calibrationBoxes = [];
    let calibrationMode = false;
    let draggedBox = null;
    let offsetX, offsetY;

    // 建立 12 個紅框
    const coords = [
      {x: 100, y: 18.0033}, {x: 81.1616, y: 2.681}, {x: 57.101, y: 0},
      {x: 9.189, y: 34.9741}, {x: 37.2605, y: 15.0418}, {x: 1.9834, y: 57.8766},
      {x: 12.8999, y: 9.3935}, {x: 1.702, y: 99.0745}, {x: 48.1213, y: 93.6605},
      {x: 23.1445, y: 100}, {x: 96.768, y: 44.4399}, {x: 73.6003, y: 55.3403}
    ];
    coords.forEach(c => {
      const box = document.createElement("div");
      box.className = "red-box";
      box.style.left = c.x + "%";
      box.style.top = c.y + "%";
      mapArea.appendChild(box);
      calibrationBoxes.push(box);
    });

    // 切換對位校正模式
    function toggleCalibration() {
      calibrationMode = !calibrationMode;
      alert("對位校正模式：" + (calibrationMode ? "開啟" : "關閉"));
    }

    // 匯出座標
    function exportCoordinates() {
      const results = calibrationBoxes.map(box => {
        const rect = mapArea.getBoundingClientRect();
        const x = (parseFloat(box.style.left) / rect.width) * 100;
        const y = (parseFloat(box.style.top) / rect.height) * 100;
        return {x: x.toFixed(4), y: y.toFixed(4)};
      });
      const json = JSON.stringify(results, null, 2);
      navigator.clipboard.writeText(json).then(() => {
        alert("座標已複製到剪貼簿:\n" + json);
      });
    }

    // 紅框拖曳 (只在校正模式開啟時啟動)
    mapArea.addEventListener("mousedown", e => {
      if (!calibrationMode) return;
      if (e.target.classList.contains("red-box")) {
        draggedBox = e.target;
        const rect = draggedBox.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
      }
    });
    mapArea.addEventListener("mousemove", e => {
      if (!calibrationMode || !draggedBox) return;
      const rect = mapArea.getBoundingClientRect();
      let left = ((e.clientX - rect.left - offsetX) / rect.width) * 100;
      let top = ((e.clientY - rect.top - offsetY) / rect.height) * 100;
      draggedBox.style.left = left + "%";
      draggedBox.style.top = top + "%";
    });
    mapArea.addEventListener("mouseup", () => {
      draggedBox = null;
    });
  </script>
</body>
</html>

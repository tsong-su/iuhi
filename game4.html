<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區郵票配對遊戲</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    #map-container {
      position: relative;
      display: inline-block;
      margin-top: 20px;
    }
    #map {
      width: 700px;
      display: block;
    }
    .stamp {
      width: 80px;
      cursor: grab;
      position: relative;
      z-index: 10;
    }
    .target {
      position: absolute;
      width: 80px;
      height: 100px;
    }
    #stamps-left, #stamps-right {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(3, auto);
      gap: 10px;
    }
    #stamps-left { left: -120px; }
    #stamps-right { right: -120px; }
    #victory {
      display: none;
      font-size: 40px;
      font-weight: bold;
      color: green;
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.1);
      animation: grow 2s forwards;
      z-index: 100;
    }
    @keyframes grow {
      to { transform: translate(-50%, -50%) scale(1.5); }
    }
    .controls {
      margin-top: 20px;
    }
    .controls button {
      margin: 0 10px;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>臺灣北部地區郵票配對遊戲</h2>
  <p>耍法：kā 郵票 suá 到對應縣市的格仔內</p>
  <div id="map-container">
    <img id="map" src="game4_assets/map.png" alt="地圖">
    <div id="victory">有夠gâu！</div>
  </div>
  <div class="controls">
    <button onclick="location.reload()">閣耍一擺</button>
    <button onclick="window.location.href='index.html'">回到遊戲首頁</button>
  </div>

  <script>
    const stampsData = [
      { id: 1, img: "game4_assets/stamp1.jpg", sound: "game4_assets/stamp1.mp3", target: {x:21.9, y:15.3} },
      { id: 2, img: "game4_assets/stamp2.jpg", sound: "game4_assets/stamp2.mp3", target: {x:55.6, y:8.6} },
      { id: 3, img: "game4_assets/stamp3.jpg", sound: "game4_assets/stamp3.mp3", target: {x:75.6, y:10.4} },
      { id: 4, img: "game4_assets/stamp4.jpg", sound: "game4_assets/stamp4.mp3", target: {x:93.1, y:25.8} },
      { id: 5, img: "game4_assets/stamp5.jpg", sound: "game4_assets/stamp5.mp3", target: {x:15.4, y:37.4} },
      { id: 6, img: "game4_assets/stamp6.jpg", sound: "game4_assets/stamp6.mp3", target: {x:39.9, y:19.1} },
      { id: 7, img: "game4_assets/stamp7.jpg", sound: "game4_assets/stamp7.mp3", target: {x:87.7, y:46.4} },
      { id: 8, img: "game4_assets/stamp8.jpg", sound: "game4_assets/stamp8.mp3", target: {x:6.9, y:59.2} },
      { id: 9, img: "game4_assets/stamp9.jpg", sound: "game4_assets/stamp9.mp3", target: {x:11.3, y:89.8} },
      { id: 10, img: "game4_assets/stamp10.jpg", sound: "game4_assets/stamp10.mp3", target: {x:55.2, y:79.7} },
      { id: 11, img: "game4_assets/stamp11.jpg", sound: "game4_assets/stamp11.mp3", target: {x:71.1, y:57.3} },
      { id: 12, img: "game4_assets/stamp12.jpg", sound: "game4_assets/stamp12.mp3", target: {x:37.6, y:91.9} }
    ];

    const mapContainer = document.getElementById("map-container");
    const map = document.getElementById("map");

    let draggedStamp = null;
    let originalParent = null;
    let originalIndex = null;

    function createStamps() {
      const leftContainer = document.createElement("div");
      leftContainer.id = "stamps-left";
      const rightContainer = document.createElement("div");
      rightContainer.id = "stamps-right";
      mapContainer.appendChild(leftContainer);
      mapContainer.appendChild(rightContainer);

      stampsData.forEach((stamp, index) => {
        const img = document.createElement("img");
        img.src = stamp.img;
        img.classList.add("stamp");
        img.draggable = true;
        img.dataset.id = stamp.id;

        if (index < stampsData.length / 2) {
          leftContainer.appendChild(img);
        } else {
          rightContainer.appendChild(img);
        }

        img.addEventListener("dragstart", dragStart);
      });
    }

    function createTargets() {
      stampsData.forEach(stamp => {
        const div = document.createElement("div");
        div.classList.add("target");
        div.dataset.id = stamp.id;
        div.style.left = (map.width * stamp.target.x / 100) + "px";
        div.style.top = (map.height * stamp.target.y / 100) + "px";
        mapContainer.appendChild(div);
      });
    }

    function dragStart(e) {
      draggedStamp = e.target;
      originalParent = draggedStamp.parentNode;
      originalIndex = Array.from(originalParent.children).indexOf(draggedStamp);
    }

    mapContainer.addEventListener("dragover", e => e.preventDefault());

    mapContainer.addEventListener("drop", e => {
      e.preventDefault();
      const targets = document.querySelectorAll(".target");
      let placed = false;

      targets.forEach(target => {
        const rect = target.getBoundingClientRect();
        if (
          e.clientX >= rect.left &&
          e.clientX <= rect.right &&
          e.clientY >= rect.top &&
          e.clientY <= rect.bottom
        ) {
          const stampData = stampsData.find(s => s.id == draggedStamp.dataset.id);
          if (draggedStamp.dataset.id === target.dataset.id) {
            draggedStamp.style.position = "absolute";
            draggedStamp.style.left = target.style.left;
            draggedStamp.style.top = target.style.top;
            mapContainer.appendChild(draggedStamp);
            playSound(stampData.sound);
            checkVictory();
          } else {
            playSound("game4_assets/wrong.mp3");
            resetStamp();
          }
          placed = true;
        }
      });

      if (!placed) {
        playSound("game4_assets/wrong.mp3");
        resetStamp();
      }
    });

    function resetStamp() {
      if (originalIndex >= originalParent.children.length) {
        originalParent.appendChild(draggedStamp);
      } else {
        originalParent.insertBefore(draggedStamp, originalParent.children[originalIndex]);
      }
      draggedStamp.style.position = "relative";
      draggedStamp.style.left = "";
      draggedStamp.style.top = "";
    }

    function playSound(src) {
      const audio = new Audio(src);
      audio.play();
    }

    function checkVictory() {
      const targets = document.querySelectorAll(".target");
      let allFilled = true;
      targets.forEach(t => {
        const match = Array.from(mapContainer.querySelectorAll(".stamp")).find(
          s => s.dataset.id === t.dataset.id &&
               s.style.left === t.style.left &&
               s.style.top === t.style.top
        );
        if (!match) allFilled = false;
      });

      if (allFilled) {
        playSound("game4_assets/victory.mp3");
        document.getElementById("victory").style.display = "block";
      }
    }

    createStamps();
    createTargets();
  </script>
</body>
</html>

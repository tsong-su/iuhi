<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區郵票配對遊戲</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      margin: 0;
      background-color: #f0f0f0;
      overflow: hidden;
      text-align: center;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #map {
      max-width: 100vw;
      max-height: 100vh;
      width: auto;
      height: auto;
      display: block;
    }
    .slot {
      position: absolute;
      width: 80px;
      height: 80px;
      border: 3px dashed red; /* 粗紅框 */
      pointer-events: none;
      z-index: 5;
    }
    .stamp {
      position: absolute;
      width: 80px;
      height: 80px;
      cursor: grab;
      z-index: 10;
    }
    #success {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 24px;
      font-weight: bold;
      color: red;
      display: none;
      z-index: 20;
    }
    #home-btn {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      font-size: 22px;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      text-decoration: none;
      z-index: 30;
    }
    #home-btn:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>臺灣北部地區郵票配對遊戲</h1>
  <div id="game-container">
    <img id="map" src="game4_assets/north2_map.png">
    <div id="success">有夠 gâu！</div>
  </div>
  <a id="home-btn" href="https://tsong-su.github.io/iuhi/index.html">回到遊戲首頁</a>

  <script>
    const container = document.getElementById("game-container");
    const map = document.getElementById("map");
    const success = document.getElementById("success");

    // ✅ 你的比例座標 (x, y 都是 0~1)
    const basePositions = [
      {"x":0.9953,"y":0.1551},
      {"x":0.7589,"y":0.0012},
      {"x":0.5749,"y":0.0249},
      {"x":0.3782,"y":0.1872},
      {"x":0.1291,"y":0.1264},
      {"x":0.115,"y":0.3242},
      {"x":0.0077,"y":0.5255},
      {"x":0.0435,"y":0.9668},
      {"x":0.2479,"y":0.9922},
      {"x":0.4791,"y":0.9043},
      {"x":0.7372,"y":0.4916},
      {"x":0.9173,"y":0.4409}
    ];

    let stampsPlaced = 0;
    let slots = [];

    function setupGame() {
      // 清除舊的 slot 與 stamp
      document.querySelectorAll(".slot, .stamp").forEach(el => el.remove());
      stampsPlaced = 0;
      slots = [];

      const rect = map.getBoundingClientRect();
      const mapW = rect.width;
      const mapH = rect.height;
      const offsetX = rect.left + window.scrollX;
      const offsetY = rect.top + window.scrollY;

      basePositions.forEach((p, i) => {
        const posX = offsetX + p.x * mapW;
        const posY = offsetY + p.y * mapH;

        // 建立 slot
        const slot = document.createElement("div");
        slot.className = "slot";
        slot.style.left = (posX - 40) + "px";
        slot.style.top = (posY - 40) + "px";
        container.appendChild(slot);
        slots.push({x: posX, y: posY});

        // 建立 stamp
        const stamp = document.createElement("img");
        stamp.src = `game4_assets/stamp${i+1}.jpg`;
        stamp.className = "stamp";
        stamp.dataset.index = i;

        // 隨機分散四周
        const side = Math.floor(Math.random() * 4);
        let randX, randY;
        if (side === 0) { randX = Math.random() * mapW; randY = -100; }
        if (side === 1) { randX = mapW + 50; randY = Math.random() * mapH; }
        if (side === 2) { randX = Math.random() * mapW; randY = mapH + 50; }
        if (side === 3) { randX = -100; randY = Math.random() * mapH; }

        stamp.style.left = randX + "px";
        stamp.style.top = randY + "px";
        container.appendChild(stamp);

        dragElement(stamp, {x: posX, y: posY}, i);
      });
    }

    function dragElement(elmnt, correctPos, index) {
      let offsetX=0, offsetY=0, mouseX=0, mouseY=0, originalX=0, originalY=0;
      elmnt.onmousedown = dragMouseDown;

      function dragMouseDown(e) {
        e.preventDefault();
        mouseX = e.clientX;
        mouseY = e.clientY;
        originalX = elmnt.offsetLeft;
        originalY = elmnt.offsetTop;
        document.onmouseup = closeDragElement;
        document.onmousemove = elementDrag;
      }

      function elementDrag(e) {
        offsetX = e.clientX - mouseX;
        offsetY = e.clientY - mouseY;
        elmnt.style.left = (elmnt.offsetLeft + offsetX) + "px";
        elmnt.style.top = (elmnt.offsetTop + offsetY) + "px";
        mouseX = e.clientX;
        mouseY = e.clientY;
      }

      function closeDragElement() {
        document.onmouseup = null;
        document.onmousemove = null;
        const stampX = elmnt.offsetLeft + 40;
        const stampY = elmnt.offsetTop + 40;

        const dx = stampX - correctPos.x;
        const dy = stampY - correctPos.y;
        const dist = Math.sqrt(dx*dx + dy*dy);

        if (dist < 30) {
          elmnt.style.left = (correctPos.x - 40) + "px";
          elmnt.style.top = (correctPos.y - 40) + "px";
          elmnt.onmousedown = null;
          playSound(`game4_assets/stamp${index+1}.mp3`);
          stampsPlaced++;
          if (stampsPlaced === basePositions.length) showSuccess();
        } else {
          elmnt.style.left = originalX + "px";
          elmnt.style.top = originalY + "px";
          playSound("game4_assets/wrong.mp3");
        }
      }
    }

    function playSound(src){
      const audio = new Audio(src);
      audio.play();
    }

    function showSuccess(){
      success.style.display = "block";
      success.style.fontSize = "24px";
      let size = 24;
      const interval = setInterval(()=>{
        size += 5;
        success.style.fontSize = size+"px";
        if(size>=100){ clearInterval(interval); }
      }, 200);
    }

    window.addEventListener("load", setupGame);
    window.addEventListener("resize", setupGame);
  </script>
</body>
</html>

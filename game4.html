<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地圖注音符號郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      background: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      background: #005BAC;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      margin: 0;
    }
    #game-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 10px;
      position: relative;
      width: 100%;
      height: 80vh;
    }
    #map-container {
      position: relative;
      width: 35%;
      height: 100%;
      background: transparent;
    }
    #map-container img {
      width: 100%;
      height: auto;
      display: block;
    }
    .stamp {
      width: 80px;
      height: auto;
      cursor: grab;
      margin: 5px;
    }
    .stamps-left, .stamps-right {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }
    .stamp-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .target {
      position: absolute;
      width: 80px;
      height: 80px;
      border: 2px dashed red;
      pointer-events: none;
    }
    .calibration {
      border-style: solid !important;
      pointer-events: auto !important;
      cursor: move;
    }
    #toolbar {
      margin-top: 10px;
      padding: 10px;
      background: #ddd;
      border-radius: 10px;
      display: flex;
      gap: 10px;
    }
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      background: #005BAC;
      color: white;
    }
    button:hover {
      background: #004080;
    }
  </style>
</head>
<body>
  <h1>臺灣北部地圖注音符號郵票配對遊戲</h1>
  <div id="game-container">
    <div class="stamps-left">
      <div class="stamp-grid" id="left-stamps"></div>
    </div>
    <div id="map-container">
      <img src="game4_assets/north_map.png" id="map">
    </div>
    <div class="stamps-right">
      <div class="stamp-grid" id="right-stamps"></div>
    </div>
  </div>

  <div id="toolbar">
    <button onclick="toggleCalibration()">對位校正</button>
    <button onclick="clearCustom()">清除自訂座標</button>
    <button onclick="exportCoords()">匯出座標</button>
    <button onclick="resetGame()">重新開始</button>
  </div>

  <script>
    const coords = [
      { x: 86.4476, y: 17.6471 },
      { x: 68.9938, y: -4.6036 },
      { x: 47.2279, y: -4.8593 },
      { x: 5.3388, y: 26.8542 },
      { x: 28.3368, y: 6.3939 },
      { x: -3.6961, y: 50.6394 },
      { x: 8.6242, y: 2.3018 },
      { x: 2.8747, y: 81.8414 },
      { x: 46.6119, y: 76.9821 },
      { x: 23.8193, y: 83.376 },
      { x: 80.6982, y: 40.665 },
      { x: 63.039, y: 48.3376 }
    ];

    let calibrationMode = false;
    const mapContainer = document.getElementById("map-container");

    // 建立紅框
    coords.forEach((c, i) => {
      const div = document.createElement("div");
      div.className = "target";
      div.style.left = c.x + "%";
      div.style.top = c.y + "%";
      mapContainer.appendChild(div);
    });

    // 建立郵票
    const left = document.getElementById("left-stamps");
    const right = document.getElementById("right-stamps");
    for (let i = 1; i <= 12; i++) {
      const img = document.createElement("img");
      img.src = `game4_assets/stamp${i}.jpg`;
      img.className = "stamp";
      img.draggable = true;
      img.dataset.index = i - 1;
      if (i <= 6) left.appendChild(img); else right.appendChild(img);
    }

    // 拖曳邏輯
    const stamps = document.querySelectorAll(".stamp");
    let dragged = null;
    stamps.forEach(stamp => {
      stamp.addEventListener("dragstart", e => {
        dragged = e.target;
        setTimeout(() => (stamp.style.display = "none"), 0);
      });
      stamp.addEventListener("dragend", e => {
        dragged.style.display = "block";
        dragged = null;
      });
    });

    mapContainer.addEventListener("dragover", e => e.preventDefault());
    mapContainer.addEventListener("drop", e => {
      e.preventDefault();
      if (!dragged) return;
      const rect = mapContainer.getBoundingClientRect();
      const x = ((e.clientX - rect.left) / rect.width) * 100;
      const y = ((e.clientY - rect.top) / rect.height) * 100;

      let placed = false;
      document.querySelectorAll(".target").forEach((t, idx) => {
        const tx = parseFloat(t.style.left);
        const ty = parseFloat(t.style.top);
        if (Math.abs(x - tx) < 5 && Math.abs(y - ty) < 5) {
          dragged.style.position = "absolute";
          dragged.style.left = t.style.left;
          dragged.style.top = t.style.top;
          mapContainer.appendChild(dragged);
          placed = true;
        }
      });
      if (!placed) {
        alert("放錯位置！");
      }
    });

    function toggleCalibration() {
      calibrationMode = !calibrationMode;
      document.querySelectorAll(".target").forEach(t => {
        if (calibrationMode) {
          t.classList.add("calibration");
        } else {
          t.classList.remove("calibration");
        }
      });
    }

    function clearCustom() {
      alert("已清除自訂座標（可補上邏輯）");
    }

    function exportCoords() {
      const arr = [];
      document.querySelectorAll(".target").forEach(t => {
        arr.push({ x: parseFloat(t.style.left), y: parseFloat(t.style.top) });
      });
      const json = JSON.stringify(arr, null, 2);
      navigator.clipboard.writeText(json).then(() => {
        alert("座標已複製：\n" + json);
      });
    }

    function resetGame() {
      location.reload();
    }
  </script>
</body>
</html>

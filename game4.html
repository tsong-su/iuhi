import React, { useState } from "react";

// 紅框初始座標 (可以隨便先填，之後用校正模式調整)
const initialRedBoxes = [
  { id: 1, x: 420, y: 120 },
  { id: 2, x: 480, y: 160 },
  { id: 3, x: 450, y: 210 },
  { id: 4, x: 500, y: 260 },
  { id: 5, x: 460, y: 320 },
  { id: 6, x: 530, y: 360 },
];

const GameWithCalibration = () => {
  const [mode, setMode] = useState("game"); // game | calibration
  const [redBoxes, setRedBoxes] = useState(initialRedBoxes);
  const [opacity, setOpacity] = useState(0.5);

  // 校正模式用：移動紅框
  const handleDrag = (id, e) => {
    const newRedBoxes = redBoxes.map((box) =>
      box.id === id ? { ...box, x: e.clientX - 25, y: e.clientY - 25 } : box
    );
    setRedBoxes(newRedBoxes);
  };

  return (
    <div className="flex flex-col items-center p-4">
      <div className="w-full flex justify-between items-center mb-4">
        <h2 className="text-xl font-bold">臺灣北部地圖&注音符號郵票對對遊戲</h2>
        <button
          className="px-4 py-2 bg-blue-500 text-white rounded-lg"
          onClick={() => setMode(mode === "game" ? "calibration" : "game")}
        >
          {mode === "game" ? "切換到校正模式" : "回到正式遊戲"}
        </button>
      </div>

      {/* --- 正式遊戲模式 --- */}
      {mode === "game" && (
        <div className="relative w-[700px] h-[550px] border bg-white flex items-center justify-center">
          {/* 地圖 */}
          <img
            src="game4_assets/north_map.png"
            alt="north_map"
            className="w-full h-full object-contain"
          />
          {/* 紅框 (固定位置, 不可拖曳) */}
          {redBoxes.map((box) => (
            <div
              key={box.id}
              className="absolute w-[50px] h-[50px] border-2 border-red-500 border-dashed"
              style={{ left: box.x, top: box.y }}
            />
          ))}
        </div>
      )}

      {/* --- 校正模式 --- */}
      {mode === "calibration" && (
        <div className="flex flex-col items-center">
          <div className="relative w-[700px] h-[550px] border">
            {/* 底圖 */}
            <img
              src="game4_assets/north_map.png"
              alt="north_map"
              className="absolute top-0 left-0 w-full h-full object-contain"
            />
            {/* 疊圖 */}
            <img
              src="game4_assets/north2_map.png"
              alt="north2_map"
              style={{ opacity }}
              className="absolute top-0 left-0 w-full h-full object-contain"
            />
            {/* 可拖曳紅框 */}
            {redBoxes.map((box) => (
              <div
                key={box.id}
                draggable
                onDragEnd={(e) => handleDrag(box.id, e)}
                className="absolute w-[50px] h-[50px] border-2 border-red-500 border-dashed cursor-move"
                style={{ left: box.x, top: box.y }}
                title={`Box ${box.id}`}
              />
            ))}
          </div>

          {/* 透明度控制 */}
          <div className="mt-4 flex items-center gap-2">
            <span>透明度: </span>
            <input
              type="range"
              min="0"
              max="1"
              step="0.05"
              value={opacity}
              onChange={(e) => setOpacity(Number(e.target.value))}
            />
            <span>{Math.round(opacity * 100)}%</span>
          </div>

          {/* 即時座標輸出 */}
          <pre className="mt-4 bg-gray-100 p-2 rounded text-sm">
            {JSON.stringify(redBoxes, null, 2)}
          </pre>
        </div>
      )}
    </div>
  );
};

export default GameWithCalibration;

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>北部郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      background: black;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      color: white;
      font-family: sans-serif;
    }
    header {
      text-align: center;
      font-size: 24px;
      padding: 10px;
      background: #333;
    }
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      overflow: hidden;
    }
    #map-container {
      position: relative;
      display: inline-block;
      max-width: 90%;
      max-height: 80%;
    }
    #map {
      display: block;
      width: 100%;
      height: auto;
    }
    .red-frame {
      position: absolute;
      border: 3px solid red;
      box-sizing: border-box;
      pointer-events: none;
    }
    #red-frames {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }
    #stamps {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      padding: 10px;
      background: #444;
    }
    .stamp {
      margin: 5px;
      cursor: grab;
      user-select: none;
      width: 80px;
      height: auto;
    }
  </style>
</head>
<body>
  <header>北部郵票配對遊戲</header>
  <main>
    <div id="map-container">
      <img id="map" src="game4_assets/north2_map.png" alt="map">
      <div id="red-frames"></div>
    </div>
  </main>
  <div id="stamps"></div>

  <!-- 音效 -->
  <audio id="success-sound" src="game4_assets/success.mp3"></audio>
  <audio id="error-sound" src="game4_assets/error.mp3"></audio>

  <script>
    // 12 個紅框座標（依您之前給的）
    const redFramePositions = [
      { x:1036, y:145 }, { x:905, y:80 }, { x:806, y:83 },
      { x:704, y:144 }, { x:593, y:116 }, { x:593, y:180 },
      { x:544, y:243 }, { x:567, y:396 }, { x:661, y:406 },
      { x:761, y:376 }, { x:873, y:236 }, { x:955, y:220 }
    ];

    // ✅ 正確配對表（依 north_answer.png 配對）
    const correctAnswers = {
      1: "stamp3.jpg",
      2: "stamp7.jpg",
      3: "stamp1.jpg",
      4: "stamp9.jpg",
      5: "stamp6.jpg",
      6: "stamp12.jpg",
      7: "stamp4.jpg",
      8: "stamp2.jpg",
      9: "stamp10.jpg",
      10: "stamp8.jpg",
      11: "stamp5.jpg",
      12: "stamp11.jpg"
    };

    const map = document.getElementById("map");
    const redFrames = document.getElementById("red-frames");
    const stampsContainer = document.getElementById("stamps");

    // 渲染紅框
    function renderRedFrames() {
      redFrames.innerHTML = "";
      const scale = map.width / map.naturalWidth;
      redFramePositions.forEach((pos, index) => {
        const frame = document.createElement("div");
        frame.className = "red-frame";
        frame.dataset.index = index + 1;
        const frameSize = 50 * scale;
        frame.style.left = (pos.x * scale - frameSize/2) + "px";
        frame.style.top = (pos.y * scale - frameSize/2) + "px";
        frame.style.width = frameSize + "px";
        frame.style.height = frameSize + "px";
        redFrames.appendChild(frame);
      });
    }

    // 渲染郵票
    function renderStamps() {
      for (let i = 1; i <= 12; i++) {
        const img = document.createElement("img");
        img.src = `game4_assets/stamp${i}.jpg`;
        img.className = "stamp";
        img.draggable = true;
        img.dataset.stamp = `stamp${i}.jpg`;
        img.addEventListener("dragstart", dragStart);
        stampsContainer.appendChild(img);
      }
    }

    // 拖曳邏輯
    function dragStart(e) {
      e.dataTransfer.setData("stamp", e.target.dataset.stamp);
    }
    map.addEventListener("dragover", e => e.preventDefault());
    redFrames.addEventListener("dragover", e => e.preventDefault());

    redFrames.addEventListener("drop", e => {
      e.preventDefault();
      const stampFile = e.dataTransfer.getData("stamp");
      const targetFrame = e.target.closest(".red-frame");
      if (!targetFrame) return;
      const frameIndex = targetFrame.dataset.index;
      if (correctAnswers[frameIndex] === stampFile) {
        document.getElementById("success-sound").play();
        targetFrame.style.border = "3px solid lime";
      } else {
        document.getElementById("error-sound").play();
        targetFrame.style.border = "3px solid red";
      }
    });

    // 縮放時自動調整
    window.addEventListener("resize", renderRedFrames);
    window.addEventListener("load", () => {
      map.onload = renderRedFrames;
      renderStamps();
    });
  </script>
</body>
</html>

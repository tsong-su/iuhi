<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區&注音符號郵票配對遊戲</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin: 10px 0;
    }
    #gameArea {
      position: relative;
      width: 600px; /* 固定地圖大小，避免縮放跑掉 */
      height: auto;
      margin: 10px 0;
      overflow: hidden; /* 不要讓框框溢出產生捲軸 */
    }
    #map {
      width: 600px;
      height: auto;
      display: block;
    }
    .red-box {
      position: absolute;
      width: 100px; /* 與郵票大小一致 */
      height: 100px;
      border: 2px dashed red;
      cursor: move;
    }
    #stampsArea {
      display: grid;
      grid-template-columns: repeat(2, 100px);
      grid-template-rows: repeat(6, 100px);
      gap: 10px;
      margin-top: 20px;
    }
    .stamp {
      width: 100px;
      height: 100px;
      border: 1px solid #ccc;
      background-size: cover;
      background-position: center;
    }
    #controls {
      margin-top: 15px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    button {
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>臺灣北部地區&注音符號郵票配對遊戲</h1>

  <div id="gameArea">
    <img id="map" src="game4_assets/north_map.png" alt="臺灣北部地圖">
  </div>

  <!-- 郵票展示區（暫時固定不動） -->
  <div id="stampsArea">
    <div class="stamp" style="background-image:url('game4_assets/stamp1.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp2.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp3.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp4.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp5.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp6.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp7.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp8.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp9.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp10.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp11.png')"></div>
    <div class="stamp" style="background-image:url('game4_assets/stamp12.png')"></div>
  </div>

  <div id="controls">
    <button id="calibrateBtn">對位校正</button>
    <button id="clearBtn">清除自訂座標</button>
    <button id="exportBtn">匯出座標</button>
    <button id="homeBtn">返回遊戲首頁</button>
  </div>

  <script>
    const boxesData = [
      { x: 86.375, y: 21.4619 },
      { x: 69.5,   y: 9.4868 },
      { x: 51.875, y: 6.9984 },
      { x: 14.25,  y: 32.5039 },
      { x: 36.875, y: 17.8849 },
      { x: 5.625,  y: 47.7449 },
      { x: 19.125, y: 13.8414 },
      { x: 13.25,  y: 81.3375 },
      { x: 48.5,   y: 72.6283 },
      { x: 29.375, y: 83.3593 },
      { x: 81,     y: 40.7465 },
      { x: 64.25,  y: 48.5226 }
    ];

    const gameArea = document.getElementById("gameArea");
    let boxes = [];
    let isCalibration = false;

    function createBoxes() {
      boxesData.forEach((pos, idx) => {
        const box = document.createElement("div");
        box.classList.add("red-box");
        box.dataset.index = idx;
        setBoxPosition(box, pos);
        gameArea.appendChild(box);
        boxes.push(box);
      });
    }

    function setBoxPosition(box, pos) {
      const map = document.getElementById("map");
      const offsetX = (pos.x / 100) * map.width;
      const offsetY = (pos.y / 100) * map.height;
      box.style.left = offsetX + "px";
      box.style.top = offsetY + "px";
    }

    // 對位校正模式
    document.getElementById("calibrateBtn").addEventListener("click", () => {
      isCalibration = !isCalibration;
      document.getElementById("calibrateBtn").textContent =
        isCalibration ? "結束校正" : "對位校正";

      boxes.forEach(box => {
        if (isCalibration) {
          box.addEventListener("mousedown", dragStart);
        } else {
          box.removeEventListener("mousedown", dragStart);
        }
      });
    });

    // 拖曳事件
    let currentBox = null;
    let offsetX, offsetY;

    function dragStart(e) {
      currentBox = e.target;
      offsetX = e.clientX - currentBox.offsetLeft;
      offsetY = e.clientY - currentBox.offsetTop;
      document.addEventListener("mousemove", dragMove);
      document.addEventListener("mouseup", dragEnd);
    }

    function dragMove(e) {
      if (!currentBox) return;
      currentBox.style.left = e.clientX - offsetX - gameArea.getBoundingClientRect().left + "px";
      currentBox.style.top  = e.clientY - offsetY - gameArea.getBoundingClientRect().top + "px";
    }

    function dragEnd() {
      document.removeEventListener("mousemove", dragMove);
      document.removeEventListener("mouseup", dragEnd);
      currentBox = null;
    }

    // 匯出座標
    document.getElementById("exportBtn").addEventListener("click", () => {
      const map = document.getElementById("map");
      const coords = boxes.map(box => {
        const x = (parseFloat(box.style.left) / map.width) * 100;
        const y = (parseFloat(box.style.top) / map.height) * 100;
        return { x: parseFloat(x.toFixed(3)), y: parseFloat(y.toFixed(3)) };
      });

      const json = JSON.stringify(coords, null, 2);
      navigator.clipboard.writeText(json).then(() => {
        alert("座標已匯出並複製到剪貼簿：\n" + json);
      });
    });

    // 清除自訂座標
    document.getElementById("clearBtn").addEventListener("click", () => {
      boxes.forEach((box, idx) => {
        setBoxPosition(box, boxesData[idx]);
      });
    });

    // 返回首頁
    document.getElementById("homeBtn").addEventListener("click", () => {
      window.location.href = "index.html"; 
    });

    window.onload = createBoxes;
  </script>
</body>
</html>

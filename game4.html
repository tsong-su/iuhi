<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è‡ºç£åŒ—éƒ¨åœ°åœ–&æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f0f0f0;
      overflow: hidden;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #map {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
    }
    .frame {
      position: absolute;
      border: 3px dashed red;
      pointer-events: none;
      box-sizing: border-box;
    }
    .stamp {
      position: absolute;
      cursor: grab;
      z-index: 10;
      transition: transform 0.2s;
    }
    .stamp:active {
      cursor: grabbing;
      transform: scale(1.1);
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      display: flex;
      gap: 10px;
      z-index: 20;
    }
    #ui button {
      padding: 5px 10px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background: #1976d2;
      color: white;
      cursor: pointer;
    }
    #ui button:hover {
      background: #0d47a1;
    }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-weight: bold;
      color: red;
      display: none;
      z-index: 30;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <img id="map" src="game4_assets/north2_map.png" alt="åŒ—éƒ¨åœ°åœ–">
    <div id="frames"></div>
    <div id="stamps"></div>
    <div id="ui">
      <button onclick="reshuffleStamps()">ğŸ”„ é‡æ’éƒµç¥¨</button>
      <button onclick="goHome()">ğŸ  å›åˆ°éŠæˆ²é¦–é </button>
    </div>
    <div id="message">æœ‰å¤ gÃ¢uï¼</div>
  </div>

  <script>
    const frameData = [
      {id:1, x:20, y:15}, {id:2, x:35, y:18}, {id:3, x:50, y:22},
      {id:4, x:65, y:25}, {id:5, x:75, y:40}, {id:6, x:60, y:50},
      {id:7, x:45, y:55}, {id:8, x:30, y:60}, {id:9, x:20, y:70},
      {id:10, x:40, y:75}, {id:11, x:55, y:80}, {id:12, x:70, y:85}
    ];
    const framesContainer = document.getElementById("frames");
    const stampsContainer = document.getElementById("stamps");
    const map = document.getElementById("map");
    const message = document.getElementById("message");
    const frameSizePercent = 8; // æ¡†èˆ‡éƒµç¥¨å¤§å° (ç›¸å°æ–¼åœ°åœ–)

    let stamps = [];
    let correctCount = 0;

    // å»ºç«‹ç´…æ¡†
    function createFrames() {
      frameData.forEach(fd => {
        const f = document.createElement("div");
        f.className = "frame";
        f.dataset.id = fd.id;
        framesContainer.appendChild(f);
      });
      updateFrames();
    }

    // æ ¹æ“šåœ°åœ–å¤§å°æ›´æ–°ç´…æ¡†
    function updateFrames() {
      const mapRect = map.getBoundingClientRect();
      frameData.forEach((fd, i) => {
        const f = framesContainer.children[i];
        const size = mapRect.width * (frameSizePercent/100);
        f.style.width = size + "px";
        f.style.height = size + "px";
        f.style.left = (mapRect.left + (fd.x/100)*mapRect.width - size/2) + "px";
        f.style.top = (mapRect.top + (fd.y/100)*mapRect.height - size/2) + "px";
      });
    }

    // å»ºç«‹éƒµç¥¨
    function createStamps() {
      for(let i=1;i<=12;i++){
        const s = document.createElement("img");
        s.src = `game4_assets/stamp${i}.jpg`;
        s.className = "stamp";
        s.dataset.id = i;
        s.draggable = true;
        s.style.width = (map.width * (frameSizePercent/100)) + "px";
        stampsContainer.appendChild(s);
        stamps.push(s);

        s.addEventListener("dragstart", dragStart);
        s.addEventListener("dragend", dragEnd);
      }
      reshuffleStamps();
    }

    // éš¨æ©Ÿæ•£ä½ˆéƒµç¥¨
    function reshuffleStamps() {
      const mapRect = map.getBoundingClientRect();
      stamps.forEach(s=>{
        const size = mapRect.width * (frameSizePercent/100);
        s.style.width = size+"px";
        s.style.height = "auto";
        const x = Math.random()*(window.innerWidth-size);
        const y = Math.random()*(window.innerHeight-size-100)+100;
        s.style.left = x+"px";
        s.style.top = y+"px";
      });
    }

    // æ‹–æ›³
    let draggedStamp=null, startX=0, startY=0;
    function dragStart(e){
      draggedStamp=e.target;
      startX=parseInt(draggedStamp.style.left);
      startY=parseInt(draggedStamp.style.top);
    }
    function dragEnd(e){
      if(!draggedStamp)return;
      let dropped=false;
      const frames=document.querySelectorAll(".frame");
      frames.forEach(f=>{
        const r=f.getBoundingClientRect();
        const s=draggedStamp.getBoundingClientRect();
        if(!(s.right<r.left||s.left>r.right||s.bottom<r.top||s.top>r.bottom)){
          if(f.dataset.id===draggedStamp.dataset.id){
            // æ­£ç¢º
            draggedStamp.style.left=r.left+"px";
            draggedStamp.style.top=r.top+"px";
            playSound(`game4_assets/stamp${draggedStamp.dataset.id}.mp3`);
            draggedStamp.draggable=false;
            draggedStamp.style.zIndex=5;
            correctCount++;
            if(correctCount===12) gameWin();
          }else{
            // éŒ¯èª¤
            playSound("game4_assets/wrong.mp3");
            draggedStamp.style.left=startX+"px";
            draggedStamp.style.top=startY+"px";
          }
          dropped=true;
        }
      });
      if(!dropped){
        draggedStamp.style.left=startX+"px";
        draggedStamp.style.top=startY+"px";
      }
      draggedStamp=null;
    }

    function playSound(file){
      const a=new Audio(file);
      a.play();
    }

    function gameWin(){
      message.style.display="block";
      playSound("game4_assets/victory.mp3");
    }

    function goHome(){
      window.location.href="index.html";
    }

    window.addEventListener("resize", ()=>{
      updateFrames();
      reshuffleStamps();
    });

    window.onload=()=>{
      createFrames();
      createStamps();
    };
  </script>
</body>
</html>

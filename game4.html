<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區郵票配對遊戲</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      text-align: center;
      background-color: #f0f0f0;
    }
    #game-container {
      position: relative;
      display: inline-block;
      width: 90%; /* 地圖大小限制在畫面寬度 */
      max-width: 1000px;
    }
    #map {
      width: 100%;
      height: auto;
      display: block;
    }
    .stamp {
      position: absolute;
      width: 80px;
      height: 80px;
      cursor: grab;
      z-index: 10;
    }
    .slot {
      position: absolute;
      width: 80px;
      height: 80px;
      border: 3px dashed red;
      background-color: rgba(255,255,255,0.3);
      pointer-events: none;
      z-index: 5;
    }
    #success {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 20px;
      font-weight: bold;
      color: red;
      display: none;
      z-index: 20;
    }
    #home-btn {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 22px;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      text-decoration: none;
    }
    #home-btn:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>臺灣北部地區郵票配對遊戲</h1>
  <div id="game-container">
    <img id="map" src="game4_assets/north1_map.png">
    <div id="success">有夠gâu！</div>
  </div>
  <br>
  <a id="home-btn" href="https://tsong-su.github.io/iuhi/index.html">回到遊戲首頁</a>

  <script>
    const container = document.getElementById("game-container");
    const map = document.getElementById("map");
    const success = document.getElementById("success");

    // === 新基準大小 ===
    const baseWidth = 1284;
    const baseHeight = 970;

    // 答案位置 (需依新圖調整座標！這裡先放大致範例)
    const basePositions = [
      {x:200,y:250},{x:350,y:280},{x:500,y:220},
      {x:650,y:400},{x:800,y:500},{x:950,y:320},
      {x:1100,y:600},{x:1200,y:300},{x:1150,y:480},
      {x:400,y:650},{x:700,y:750},{x:1000,y:820}
    ];

    let stampsPlaced = 0;

    map.onload = () => {
      const answerPositions = basePositions.map(p => ({
        x: p.x, y: p.y
      }));

      answerPositions.forEach((pos, i) => {
        // 建立格子
        const slot = document.createElement("div");
        slot.className = "slot";
        slot.dataset.index = i;
        container.appendChild(slot);

        // 建立郵票
        const stamp = document.createElement("img");
        stamp.src = `game4_assets/stamp${i+1}.jpg`;
        stamp.className = "stamp";
        stamp.dataset.index = i;
        container.appendChild(stamp);
      });

      // 調整位置（依照圖片實際大小縮放）
      function positionElements() {
        const rect = map.getBoundingClientRect();
        const scaleX = rect.width / baseWidth;
        const scaleY = rect.height / baseHeight;

        document.querySelectorAll(".slot").forEach((slot, i) => {
          const pos = basePositions[i];
          slot.style.left = (pos.x * scaleX - 40) + "px";
          slot.style.top = (pos.y * scaleY - 40) + "px";
        });

        // 隨機散落郵票，避免重疊
        const stamps = document.querySelectorAll(".stamp");
        const placed = [];
        stamps.forEach((stamp, i) => {
          let randX, randY, overlap;
          const rect = map.getBoundingClientRect();
          do {
            randX = Math.random() * (rect.width - 100);
            randY = Math.random() * (rect.height - 100);
            overlap = placed.some(p => 
              Math.abs(p.x - randX) < 90 && Math.abs(p.y - randY) < 90
            );
          } while(overlap);
          placed.push({x: randX, y: randY});
          stamp.style.left = randX + "px";
          stamp.style.top = randY + "px";

          // 加入拖曳
          dragElement(stamp, basePositions[i], i, scaleX, scaleY);
        });
      }

      window.addEventListener("resize", positionElements);
      positionElements();

      function dragElement(elmnt, correctPos, index, scaleX, scaleY) {
        let offsetX=0, offsetY=0, mouseX=0, mouseY=0;

        elmnt.onmousedown = dragMouseDown;

        function dragMouseDown(e) {
          e.preventDefault();
          mouseX = e.clientX;
          mouseY = e.clientY;
          document.onmouseup = closeDragElement;
          document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
          offsetX = e.clientX - mouseX;
          offsetY = e.clientY - mouseY;
          elmnt.style.left = (elmnt.offsetLeft + offsetX) + "px";
          elmnt.style.top = (elmnt.offsetTop + offsetY) + "px";
          mouseX = e.clientX;
          mouseY = e.clientY;
        }

        function closeDragElement() {
          document.onmouseup = null;
          document.onmousemove = null;

          const rect = map.getBoundingClientRect();
          const scaleX = rect.width / baseWidth;
          const scaleY = rect.height / baseHeight;

          const stampX = elmnt.offsetLeft + 40;
          const stampY = elmnt.offsetTop + 40;

          const correctX = correctPos.x * scaleX;
          const correctY = correctPos.y * scaleY;

          const dx = stampX - correctX;
          const dy = stampY - correctY;
          const dist = Math.sqrt(dx*dx + dy*dy);

          if(dist < 40){
            elmnt.style.left = (correctX-40)+"px";
            elmnt.style.top = (correctY-40)+"px";
            elmnt.onmousedown = null;
            playSound(`game4_assets/stamp${index+1}.mp3`);
            stampsPlaced++;
            if(stampsPlaced===12){
              showSuccess();
            }
          }else{
            playSound("game4_assets/wrong.mp3");
          }
        }
      }

      function playSound(src){
        const audio = new Audio(src);
        audio.play();
      }

      function showSuccess(){
        success.style.display = "block";
        let size = 20;
        const interval = setInterval(()=>{
          size += 5;
          success.style.fontSize = size+"px";
          if(size>=100){ clearInterval(interval); }
        }, 200);
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地圖&注音符號郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: "Microsoft JhengHei", sans-serif;
    }
    header {
      text-align: center;
      font-size: 20px;
      padding: 10px;
      background: #f0f0f0;
      flex: 0 0 auto;
    }
    #game-container {
      flex: 1 1 auto;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }
    #mapCanvas {
      border: 1px solid #ccc;
      background: #fff;
    }
    footer {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 8px;
      background: #f0f0f0;
      flex: 0 0 auto;
      gap: 20px;
    }
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <header>
    臺灣北部地圖&注音符號郵票配對遊戲
  </header>
  <div id="game-container">
    <canvas id="mapCanvas" width="1200" height="600"></canvas>
  </div>
  <footer id="control-bar">
    <div>
      <button onclick="moveStamps('left', -10)">左側 ←10</button>
      <button onclick="moveStamps('left', 10)">左側 →10</button>
    </div>
    <div>
      <button onclick="moveStamps('right', -10)">右側 ←10</button>
      <button onclick="moveStamps('right', 10)">右側 →10</button>
    </div>
    <div>
      <button onclick="location.reload()">回到遊戲首頁</button>
    </div>
  </footer>

  <script>
    const canvas = document.getElementById("mapCanvas");
    const ctx = canvas.getContext("2d");

    // 載入地圖
    const mapImage = new Image();
    mapImage.src = "game4_assets/north2_map.png";

    // 紅框座標（固定）
    const redFrames = [
      {x:1036, y:145}, {x:905, y:80}, {x:806, y:83}, {x:704, y:144},
      {x:593, y:116}, {x:593, y:180}, {x:544, y:243}, {x:567, y:396},
      {x:661, y:406}, {x:761, y:376}, {x:873, y:236}, {x:955, y:220}
    ];

    // 郵票資料
    let stamps = [];
    let placedCount = 0;

    for (let i = 1; i <= 12; i++) {
      let img = new Image();
      img.src = `game4_assets/stamp${i}.jpg`;
      stamps.push({
        id: i,
        img: img,
        x: i <= 6 ? 50 : 1050,  // 左右放置
        y: 100 + ((i-1)%6)*70, // 6張縱向排列
        width: 60,
        height: 60,
        isDragging: false,
        placed: false
      });
    }

    // 音效
    const sounds = {
      correct: new Audio("game4_assets/victory.mp3"),
      wrong: new Audio("game4_assets/wrong.mp3"),
    };
    const stampSounds = [];
    for (let i = 1; i <= 12; i++) {
      stampSounds[i] = new Audio(`game4_assets/stamp${i}.mp3`);
    }

    let draggingStamp = null;

    function drawGame() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.drawImage(mapImage, (canvas.width-mapImage.width*0.8)/2, 50, mapImage.width*0.8, mapImage.height*0.8);

      // 畫紅框
      redFrames.forEach(f => {
        ctx.strokeStyle = "red";
        ctx.lineWidth = 3;
        ctx.strokeRect(f.x-25, f.y-25, 50, 50);
      });

      // 畫郵票
      stamps.forEach(stamp => {
        if (!stamp.placed || stamp.isDragging) {
          ctx.shadowColor = "rgba(0,0,0,0.5)";
          ctx.shadowBlur = 6;
          ctx.drawImage(stamp.img, stamp.x, stamp.y, stamp.width, stamp.height);
          ctx.shadowBlur = 0;
        } else {
          ctx.drawImage(stamp.img, stamp.x, stamp.y, stamp.width, stamp.height);
        }
      });
    }

    // 拖曳
    canvas.addEventListener("mousedown", e => {
      const {offsetX, offsetY} = e;
      stamps.forEach(stamp => {
        if (!stamp.placed &&
          offsetX >= stamp.x && offsetX <= stamp.x+stamp.width &&
          offsetY >= stamp.y && offsetY <= stamp.y+stamp.height) {
          stamp.isDragging = true;
          draggingStamp = stamp;
        }
      });
    });

    canvas.addEventListener("mousemove", e => {
      if (draggingStamp) {
        draggingStamp.x = e.offsetX - draggingStamp.width/2;
        draggingStamp.y = e.offsetY - draggingStamp.height/2;
        drawGame();
      }
    });

    canvas.addEventListener("mouseup", e => {
      if (draggingStamp) {
        let placed = false;
        redFrames.forEach((f, i) => {
          if (Math.abs(draggingStamp.x - f.x) < 30 && Math.abs(draggingStamp.y - f.y) < 30) {
            if (draggingStamp.id === i+1) {
              draggingStamp.x = f.x-25;
              draggingStamp.y = f.y-25;
              draggingStamp.placed = true;
              stampSounds[draggingStamp.id].play();
              placedCount++;
              if (placedCount === 12) sounds.correct.play();
            } else {
              sounds.wrong.play();
            }
            placed = true;
          }
        });
        draggingStamp.isDragging = false;
        draggingStamp = null;
        drawGame();
      }
    });

    mapImage.onload = () => {
      drawGame();
    };

    // 控制列功能
    function moveStamps(side, delta) {
      stamps.forEach(stamp => {
        if (!stamp.placed) {
          if (side === "left" && stamp.x < canvas.width/2) {
            stamp.x += delta;
          } else if (side === "right" && stamp.x > canvas.width/2) {
            stamp.x += delta;
          }
        }
      });
      drawGame();
    }
  </script>
</body>
</html>

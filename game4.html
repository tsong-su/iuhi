<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è‡ºç£åŒ—éƒ¨åœ°åœ–&æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      text-align: center;
      font-family: Arial, sans-serif;
      background: #f9f9f9;
      overflow: hidden;
    }
    h1 {
      font-size: 28px;
      margin: 10px;
    }
    #map-container {
      position: relative;
      width: 100%;
      height: 70vh; /* ä¿è­‰æ•´å¼µåœ°åœ–ç¸®æ”¾é€²è¢å¹•é«˜åº¦ */
      margin: auto;
      overflow: hidden;
    }
    #map {
      width: 100%;
      height: 100%;
      object-fit: contain; /* ä¿è­‰å®Œæ•´å¡å…¥ */
      display: block;
    }
    .target {
      position: absolute;
      border: 3px dashed red;
      pointer-events: none;
      box-sizing: border-box;
    }
    #stamps {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .stamp {
      width: 8vw; /* éƒµç¥¨æ¯”ç´…æ¡†ç¨å¤§ */
      max-width: 100px;
      cursor: grab;
      position: absolute;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 8px;
    }
    #message {
      font-size: 26px;
      font-weight: bold;
      color: green;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h1>è‡ºç£åŒ—éƒ¨åœ°åœ–&æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</h1>
  <a href="index.html">å›åˆ°éŠæˆ²é¦–é </a>
  <div id="map-container">
    <img id="map" src="game4_assets/north2_map.png" alt="Map">
  </div>
  <button id="reshuffle">ğŸ”„ é‡æ’éƒµç¥¨</button>
  <div id="message"></div>

  <audio id="error-sound" src="game4_assets/error.mp3"></audio>
  <audio id="victory-sound" src="game4_assets/victory.mp3"></audio>

  <script>
    const basePositions = [
      {"x": 0.9953,"y": 0.1551},
      {"x": 0.7589,"y": 0.0012},
      {"x": 0.5749,"y": 0.0249},
      {"x": 0.3782,"y": 0.1872},
      {"x": 0.1291,"y": 0.1264},
      {"x": 0.115,"y": 0.3242},
      {"x": 0.0077,"y": 0.5255},
      {"x": 0.0435,"y": 0.9668},
      {"x": 0.2479,"y": 0.9922},
      {"x": 0.4791,"y": 0.9043},
      {"x": 0.7372,"y": 0.4916},
      {"x": 0.9173,"y": 0.4409}
    ];

    const map = document.getElementById("map");
    const container = document.getElementById("map-container");
    const errorSound = document.getElementById("error-sound");
    const victorySound = document.getElementById("victory-sound");
    const messageDiv = document.getElementById("message");
    const reshuffleBtn = document.getElementById("reshuffle");

    let placed = 0;
    let stamps = [];

    function initGame() {
      placed = 0;
      messageDiv.textContent = "";
      document.querySelectorAll(".target").forEach(e => e.remove());
      document.querySelectorAll(".stamp").forEach(e => e.remove());
      stamps = [];

      const mapWidth = container.clientWidth;
      const mapHeight = container.clientHeight;
      const stampSize = mapWidth * 0.06; // ç´…æ¡† & éƒµç¥¨å¤§å° = åœ°åœ–å¯¬åº¦6%

      basePositions.forEach((pos, i) => {
        // ç´…æ¡†
        const target = document.createElement("div");
        target.className = "target";
        target.style.width = stampSize + "px";
        target.style.height = stampSize + "px";
        target.style.left = (pos.x * mapWidth - stampSize/2) + "px";
        target.style.top = (pos.y * mapHeight - stampSize/2) + "px";
        target.dataset.index = i;
        container.appendChild(target);

        // éƒµç¥¨
        const stamp = document.createElement("img");
        stamp.src = `game4_assets/stamp${i+1}.jpg`;
        stamp.className = "stamp";
        stamp.style.width = stampSize + "px";
        stamp.style.height = stampSize + "px";
        stamp.draggable = true;
        stamp.dataset.index = i;
        container.appendChild(stamp);
        stamps.push(stamp);
      });

      scatterStamps();
      addDragDrop();
    }

    function scatterStamps() {
      const mapWidth = container.clientWidth;
      const mapHeight = container.clientHeight;
      const stampSize = mapWidth * 0.06;

      stamps.forEach(stamp => {
        // æŠŠéƒµç¥¨æ‰“æ•£åœ¨åœ°åœ–å››å‘¨ç©ºç™½è™•
        let x, y;
        const margin = 20;
        if (Math.random() > 0.5) { // ä¸Šä¸‹å€åŸŸ
          x = Math.random() * (mapWidth - stampSize - margin*2) + margin;
          y = (Math.random() > 0.5) ? margin : mapHeight - stampSize - margin;
        } else { // å·¦å³å€åŸŸ
          y = Math.random() * (mapHeight - stampSize - margin*2) + margin;
          x = (Math.random() > 0.5) ? margin : mapWidth - stampSize - margin;
        }
        stamp.style.left = x + "px";
        stamp.style.top = y + "px";
      });
    }

    function addDragDrop() {
      stamps.forEach(stamp => {
        stamp.addEventListener("dragstart", e => {
          e.dataTransfer.setData("index", stamp.dataset.index);
        });
      });

      container.addEventListener("dragover", e => {
        e.preventDefault();
      });

      container.addEventListener("drop", e => {
        e.preventDefault();
        const stampIndex = e.dataTransfer.getData("index");
        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        const mapWidth = container.clientWidth;
        const mapHeight = container.clientHeight;
        const stampSize = mapWidth * 0.06;

        // æ‰¾æœ€è¿‘ç´…æ¡†
        let nearest = null;
        let minDist = Infinity;
        document.querySelectorAll(".target").forEach(target => {
          const tx = parseFloat(target.style.left) + stampSize/2;
          const ty = parseFloat(target.style.top) + stampSize/2;
          const dist = Math.hypot(tx - x, ty - y);
          if (dist < minDist) {
            minDist = dist;
            nearest = target;
          }
        });

        if (nearest && nearest.dataset.index === stampIndex) {
          // é…å°æˆåŠŸ
          const stamp = stamps[stampIndex];
          stamp.style.left = nearest.style.left;
          stamp.style.top = nearest.style.top;
          stamp.draggable = false;
          placed++;
          if (placed === basePositions.length) {
            messageDiv.textContent = "æœ‰å¤ gÃ¢uï¼";
            victorySound.play();
          }
        } else {
          errorSound.play();
        }
      });
    }

    window.addEventListener("resize", initGame);
    reshuffleBtn.addEventListener("click", scatterStamps);
    window.onload = initGame;
  </script>
</body>
</html>

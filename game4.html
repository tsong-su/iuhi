<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>臺灣北部地區&注音符號郵票配對遊戲</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      font-family: Arial, sans-serif;
      height: 100vh;
      overflow: hidden;
    }

    h1 {
      font-size: 22px;
      margin: 10px 0 5px 0;
      text-align: center;
    }

    h2 {
      font-size: 16px;
      margin: 0 0 10px 0;
      font-weight: normal;
      text-align: center;
    }

    .game-container {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: center;
      flex: 1;
      width: 100%;
    }

    .stamps-container {
      display: grid;
      grid-template-columns: repeat(3, 100px);
      grid-template-rows: repeat(2, 140px);
      gap: 10px;
      justify-content: center;
      align-content: center;
      flex: 0 0 320px;
    }

    .stamps-container img {
      width: 100px;
      height: 140px;
      cursor: grab;
    }

    .map-container {
      position: relative;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      max-width: 650px;
      max-height: 80vh;
    }

    .map-container img {
      width: 100%;
      height: auto;
      object-fit: contain;
    }

    .dropzone {
      position: absolute;
      width: 90px;
      height: 120px;
      border: 2px dashed red;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: bold;
      color: red;
      cursor: default;
      user-select: none;
    }

    .dropzone.calibrating {
      cursor: move;
      pointer-events: auto;
    }

    .toolbar {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      padding: 10px;
    }

    button {
      padding: 8px 14px;
      border: none;
      background: #007bff;
      color: #fff;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <h1>臺灣北部地區&注音符號郵票配對遊戲</h1>
  <h2>共郵票 suá 到對應的縣市格仔內</h2>

  <div class="game-container">
    <!-- 左側郵票 -->
    <div class="stamps-container" id="stamps-left">
      <img src="game4_assets/stamp1.jpg" draggable="true" id="stamp1">
      <img src="game4_assets/stamp2.jpg" draggable="true" id="stamp2">
      <img src="game4_assets/stamp3.jpg" draggable="true" id="stamp3">
      <img src="game4_assets/stamp4.jpg" draggable="true" id="stamp4">
      <img src="game4_assets/stamp5.jpg" draggable="true" id="stamp5">
      <img src="game4_assets/stamp6.jpg" draggable="true" id="stamp6">
    </div>

    <!-- 地圖 -->
    <div class="map-container" id="map">
      <img src="game4_assets/north_map.png" alt="北部地圖">
      <!-- 紅框 (初始位置，會在 calibration 模式可調整) -->
      <div class="dropzone" style="top:15%; left:30%;">1</div>
      <div class="dropzone" style="top:12%; left:50%;">2</div>
      <div class="dropzone" style="top:20%; left:65%;">3</div>
      <div class="dropzone" style="top:28%; left:78%;">4</div>
      <div class="dropzone" style="top:30%; left:25%;">5</div>
      <div class="dropzone" style="top:22%; left:40%;">6</div>
      <div class="dropzone" style="top:45%; left:75%;">7</div>
      <div class="dropzone" style="top:40%; left:18%;">8</div>
      <div class="dropzone" style="top:65%; left:20%;">9</div>
      <div class="dropzone" style="top:70%; left:55%;">10</div>
      <div class="dropzone" style="top:55%; left:60%;">11</div>
      <div class="dropzone" style="top:75%; left:35%;">12</div>
    </div>

    <!-- 右側郵票 -->
    <div class="stamps-container" id="stamps-right">
      <img src="game4_assets/stamp7.jpg" draggable="true" id="stamp7">
      <img src="game4_assets/stamp8.jpg" draggable="true" id="stamp8">
      <img src="game4_assets/stamp9.jpg" draggable="true" id="stamp9">
      <img src="game4_assets/stamp10.jpg" draggable="true" id="stamp10">
      <img src="game4_assets/stamp11.jpg" draggable="true" id="stamp11">
      <img src="game4_assets/stamp12.jpg" draggable="true" id="stamp12">
    </div>
  </div>

  <!-- 工具列 -->
  <div class="toolbar">
    <button onclick="toggleCalibration()">切換對位校正模式</button>
    <button onclick="exportCoords()">匯出座標</button>
  </div>

  <script>
    let calibrating = false;
    let dragging = null;
    let offsetX = 0, offsetY = 0;

    function toggleCalibration() {
      calibrating = !calibrating;
      const zones = document.querySelectorAll('.dropzone');

      zones.forEach(z => {
        if (calibrating) {
          z.classList.add('calibrating');
        } else {
          z.classList.remove('calibrating');
        }
      });

      if (calibrating) {
        alert("進入對位校正模式，可拖曳紅框調整位置");
      } else {
        alert("已退出對位校正模式");
      }
    }

    document.addEventListener('mousedown', function(e) {
      if (!calibrating) return;
      if (e.target.classList.contains('dropzone')) {
        dragging = e.target;
        const rect = dragging.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
      }
    });

    document.addEventListener('mousemove', function(e) {
      if (dragging && calibrating) {
        const map = document.getElementById('map');
        const mapRect = map.getBoundingClientRect();

        let x = ((e.clientX - mapRect.left - offsetX) / mapRect.width) * 100;
        let y = ((e.clientY - mapRect.top - offsetY) / mapRect.height) * 100;

        // 限制在 0~100% 範圍
        x = Math.max(0, Math.min(100, x));
        y = Math.max(0, Math.min(100, y));

        dragging.style.left = x + "%";
        dragging.style.top = y + "%";
      }
    });

    document.addEventListener('mouseup', function() {
      dragging = null;
    });

    function exportCoords() {
      const zones = document.querySelectorAll('.dropzone');
      const coords = [];
      zones.forEach(z => {
        coords.push({
          id: z.textContent.trim(),
          left: z.style.left,
          top: z.style.top
        });
      });
      console.log(coords);
      alert("已匯出座標，請查看 console.log");
    }
  </script>
</body>
</html>

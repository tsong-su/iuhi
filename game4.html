<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è‡ºç£åŒ—éƒ¨åœ°åœ–&æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      text-align: center;
      background: #fff;
    }

    h1 {
      font-size: 28px;
      margin: 10px 0;
      color: #333;
    }

    #game-container {
      position: relative;
      width: 100vw;
      height: 85vh;
      overflow: hidden;
    }

    #map {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .frame {
      position: absolute;
      border: 3px dashed red; /* è™›ç·šç´…æ¡† */
      transform: translate(-50%, -50%);
      pointer-events: none;
    }

    .stamp {
      position: absolute;
      cursor: grab;
      user-select: none;
      z-index: 10;
    }

    #buttons {
      position: absolute;
      top: 10px;
      left: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 20;
    }

    #victory-message {
      display: none;
      font-size: 36px;
      color: red; /* æ”¹å›ç´…è‰² */
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 30;
    }
  </style>
</head>
<body>
  <h1>è‡ºç£åŒ—éƒ¨åœ°åœ–&æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</h1>
  <div id="game-container">
    <img id="map" src="game4_assets/north2_map.png" alt="åœ°åœ–">

    <div id="buttons">
      <button onclick="shuffleStamps()">ğŸ”„ é‡æ’éƒµç¥¨</button>
      <button onclick="location.reload()">ğŸ  å›åˆ°éŠæˆ²é¦–é </button>
    </div>

    <div id="victory-message">ğŸ‰ æœ‰å¤  gÃ¢u ğŸ‰</div>
  </div>

  <audio id="success-sound" src="game4_assets/victory.mp3"></audio>
  <audio id="error-sound" src="game4_assets/error.mp3"></audio>

  <script>
    const basePositions = [
      {x: 0.9953, y: 0.1551},
      {x: 0.7589, y: 0.0012},
      {x: 0.5749, y: 0.0249},
      {x: 0.3782, y: 0.1872},
      {x: 0.1291, y: 0.1264},
      {x: 0.115,  y: 0.3242},
      {x: 0.0077, y: 0.5255},
      {x: 0.0435, y: 0.9668},
      {x: 0.2479, y: 0.9922},
      {x: 0.4791, y: 0.9043},
      {x: 0.7372, y: 0.4916},
      {x: 0.9173, y: 0.4409}
    ];

    const container = document.getElementById("game-container");
    const successSound = document.getElementById("success-sound");
    const errorSound = document.getElementById("error-sound");
    const victoryMessage = document.getElementById("victory-message");

    let stamps = [];
    let frames = [];
    let placedCount = 0;

    function createFramesAndStamps() {
      const containerRect = container.getBoundingClientRect();
      const frameSize = containerRect.width * 0.07; // æ¡†å’Œéƒµç¥¨ä¸€èµ·å¾®èª¿å¤§ä¸€é»

      basePositions.forEach((pos, i) => {
        // ç´…æ¡†
        const frame = document.createElement("div");
        frame.className = "frame";
        frame.style.width = `${frameSize}px`;
        frame.style.height = `${frameSize}px`;
        frame.style.left = `${pos.x * containerRect.width}px`;
        frame.style.top = `${pos.y * containerRect.height}px`;
        container.appendChild(frame);
        frames.push(frame);

        // éƒµç¥¨
        const stamp = document.createElement("img");
        stamp.src = `game4_assets/stamp${i+1}.jpg`;
        stamp.className = "stamp";
        stamp.style.width = `${frameSize}px`;
        stamp.style.height = `${frameSize}px`;

        container.appendChild(stamp);
        stamps.push({el: stamp, correctFrame: frame, original: {x:0,y:0}});
      });

      shuffleStamps();
    }

    function shuffleStamps() {
      const containerRect = container.getBoundingClientRect();
      const frameSize = containerRect.width * 0.07;

      stamps.forEach(({el, original}) => {
        const x = Math.random() * (containerRect.width - frameSize);
        const y = Math.random() * (containerRect.height - frameSize);

        el.style.left = `${x}px`;
        el.style.top = `${y}px`;
        el.style.width = `${frameSize}px`;
        el.style.height = `${frameSize}px`;

        original.x = x;
        original.y = y;

        enableDrag(el, original);
      });
    }

    function enableDrag(stamp, original) {
      let offsetX, offsetY;

      stamp.onmousedown = function(e) {
        e.preventDefault();
        offsetX = e.clientX - stamp.offsetLeft;
        offsetY = e.clientY - stamp.offsetTop;

        document.onmousemove = function(e) {
          stamp.style.left = `${e.clientX - offsetX}px`;
          stamp.style.top = `${e.clientY - offsetY}px`;
        };

        document.onmouseup = function(e) {
          document.onmousemove = null;
          document.onmouseup = null;

          let matched = false;
          for (let {correctFrame} of stamps) {
            const rect = correctFrame.getBoundingClientRect();
            const stampRect = stamp.getBoundingClientRect();

            if (!(stampRect.right < rect.left || 
                  stampRect.left > rect.right || 
                  stampRect.bottom < rect.top || 
                  stampRect.top > rect.bottom)) {
              matched = true;
              break;
            }
          }

          if (matched) {
            successSound.play();
            placedCount++;
            stamp.style.pointerEvents = "none";
            if (placedCount === stamps.length) {
              victoryMessage.style.display = "block";
            }
          } else {
            errorSound.play();
            stamp.style.left = `${original.x}px`;
            stamp.style.top = `${original.y}px`;
          }
        };
      };
    }

    createFramesAndStamps();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>è‡ºç£åŒ—éƒ¨åœ°åœ–&æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      background: #fdfdfd;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }
    #map {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }
    .frame {
      position: absolute;
      border: 3px dashed red;
      box-sizing: border-box;
      pointer-events: none;
    }
    .stamp {
      position: absolute;
      width: 6vw;
      height: auto;
      cursor: grab;
      user-select: none;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      display: flex;
      gap: 10px;
      z-index: 1000;
    }
    #controls button {
      padding: 6px 12px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background: #1976d2;
      color: white;
      cursor: pointer;
    }
    #controls button:hover {
      background: #0d47a1;
    }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 48px;
      font-weight: bold;
      color: green;
      display: none;
      z-index: 2000;
    }
  </style>
</head>
<body>
  <div id="game-container">
    <img id="map" src="game4_assets/north2_map.png" alt="map">
    <div id="frames"></div>
    <div id="controls">
      <button onclick="location.href='index.html'">ğŸ  å›åˆ°éŠæˆ²é¦–é </button>
      <button onclick="scatterStamps()">ğŸ”„ é‡æ’éƒµç¥¨</button>
    </div>
    <div id="message">ğŸ‰ æœ‰å¤ gÃ¢uï¼</div>
  </div>

  <script>
    const basePositions = [
      {"x":0.9953,"y":0.1551},
      {"x":0.7589,"y":0.0012},
      {"x":0.5749,"y":0.0249},
      {"x":0.3782,"y":0.1872},
      {"x":0.1291,"y":0.1264},
      {"x":0.115,"y":0.3242},
      {"x":0.0077,"y":0.5255},
      {"x":0.0435,"y":0.9668},
      {"x":0.2479,"y":0.9922},
      {"x":0.4791,"y":0.9043},
      {"x":0.7372,"y":0.4916},
      {"x":0.9173,"y":0.4409}
    ];
    const stamps = [];
    const frames = [];
    let placedCount = 0;

    const correctAudio = new Audio("game4_assets/correct.mp3");
    const wrongAudio = new Audio("game4_assets/wrong.mp3");
    const victoryAudio = new Audio("game4_assets/victory.mp3");

    const map = document.getElementById("map");
    const framesContainer = document.getElementById("frames");
    const message = document.getElementById("message");

    // åˆå§‹åŒ–
    map.addEventListener("load", () => {
      drawFrames();
      createStamps();
      scatterStamps();
    });
    window.addEventListener("resize", drawFrames);

    // ç•«ç´…æ¡†
    function drawFrames() {
      framesContainer.innerHTML = "";
      const rect = map.getBoundingClientRect();
      const size = rect.width * 0.06; // ç´…æ¡†å¤§å° = 6% åœ°åœ–å¯¬åº¦
      basePositions.forEach((pos, i) => {
        const f = document.createElement("div");
        f.className = "frame";
        f.style.width = size + "px";
        f.style.height = size + "px";
        f.style.left = rect.left + pos.x * rect.width - size / 2 + "px";
        f.style.top  = rect.top  + pos.y * rect.height - size / 2 + "px";
        framesContainer.appendChild(f);
        frames[i] = f.getBoundingClientRect();
      });
    }

    // å»ºç«‹éƒµç¥¨
    function createStamps() {
      for (let i = 0; i < basePositions.length; i++) {
        const s = document.createElement("img");
        s.src = `game4_assets/stamp${i+1}.jpg`;
        s.className = "stamp";
        s.dataset.index = i;
        s.draggable = true;
        s.addEventListener("dragstart", dragStart);
        document.body.appendChild(s);
        stamps.push(s);
      }
    }

    // éš¨æ©Ÿæ•£è½éƒµç¥¨ï¼ˆé¿å…é‡ç–Šï¼‰
    function scatterStamps() {
      const rect = map.getBoundingClientRect();
      const size = rect.width * 0.06;
      const used = [];

      stamps.forEach(stamp => {
        let valid = false, x, y;
        while (!valid) {
          x = rect.left + Math.random() * (rect.width - size);
          y = rect.top + Math.random() * (rect.height - size);
          valid = !used.some(u => Math.abs(u.x - x) < size && Math.abs(u.y - y) < size);
        }
        used.push({x,y});
        stamp.style.left = x + "px";
        stamp.style.top = y + "px";
        stamp.style.width = size + "px";
      });
    }

    // æ‹–æ›³äº‹ä»¶
    function dragStart(e) {
      e.dataTransfer.setData("text", e.target.dataset.index);
    }
    document.body.addEventListener("dragover", e => e.preventDefault());
    document.body.addEventListener("drop", e => {
      e.preventDefault();
      const idx = e.dataTransfer.getData("text");
      const stamp = stamps[idx];
      const x = e.clientX;
      const y = e.clientY;
      const f = frames[idx];
      if (x >= f.left && x <= f.right && y >= f.top && y <= f.bottom) {
        stamp.style.left = f.left + "px";
        stamp.style.top = f.top + "px";
        stamp.style.pointerEvents = "none";
        placedCount++;
        correctAudio.currentTime = 0;
        correctAudio.play();
        if (placedCount === stamps.length) {
          message.style.display = "block";
          victoryAudio.currentTime = 0;
          victoryAudio.play();
        }
      } else {
        wrongAudio.currentTime = 0;
        wrongAudio.play();
      }
    });
  </script>
</body>
</html>

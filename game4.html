<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>è‡ºç£åŒ—éƒ¨åœ°åœ–æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h2 {
      margin: 10px 0;
    }
    #game-container {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 80vh;
      position: relative;
      overflow: hidden;
    }
    #map {
      max-height: 100%;
      max-width: 35%;
      object-fit: contain;
      z-index: 1;
    }
    .stamp {
      width: 80px;
      height: auto;
      cursor: grab;
      position: absolute;
      z-index: 2;
    }
    .red-box {
      width: 60px;
      height: 60px;
      border: 2px dashed red;
      position: absolute;
      pointer-events: none;
      z-index: 3;
    }
    #toolbar {
      width: 100%;
      padding: 10px;
      background: #f0f0f0;
      display: flex;
      justify-content: center;
      gap: 20px;
      border-top: 2px solid #ccc;
    }
    button {
      padding: 6px 12px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h2>è‡ºç£åŒ—éƒ¨åœ°åœ–æ³¨éŸ³ç¬¦è™Ÿéƒµç¥¨é…å°éŠæˆ²</h2>
  <div id="game-container">
    <img id="map" src="game4_assets/north_map.png" alt="åœ°åœ–">
  </div>

  <div id="toolbar">
    <button onclick="resetGame()">é‡æ–°é–‹å§‹</button>
    <button onclick="goHome()">å›åˆ°éŠæˆ²é¦–é </button>
    <button onclick="exportCoords()">åŒ¯å‡ºåº§æ¨™</button>
  </div>

  <audio id="error-sound" src="game4_assets/error.mp3"></audio>

  <script>
    const container = document.getElementById("game-container");
    const map = document.getElementById("map");
    const errorSound = document.getElementById("error-sound");

    // âœ… ç´…æ¡†æ­£ç¢ºä½ç½®ï¼ˆä½ ä¸Šæ¬¡çµ¦çš„ JSONï¼‰
    const correctCoords = [
      { "x": 86.4476, "y": 17.6471 },
      { "x": 68.9938, "y": -4.6036 },
      { "x": 47.2279, "y": -4.8593 },
      { "x": 5.3388, "y": 26.8542 },
      { "x": 28.3368, "y": 6.3939 },
      { "x": -3.6961, "y": 50.6394 },
      { "x": 8.6242, "y": 2.3018 },
      { "x": 2.8747, "y": 81.8414 },
      { "x": 46.6119, "y": 76.9821 },
      { "x": 23.8193, "y": 83.376 },
      { "x": 80.6982, "y": 40.665 },
      { "x": 63.039, "y": 48.3376 }
    ];

    // âœ… åŠ å…¥ç´…æ¡†
    const redBoxes = [];
    correctCoords.forEach((c, i) => {
      const box = document.createElement("div");
      box.className = "red-box";
      box.style.left = `calc(${c.x}% - 30px)`; // æ¸›å»ä¸€åŠï¼Œä¸­å¿ƒå°é½Š
      box.style.top = `calc(${c.y}% - 30px)`;
      container.appendChild(box);
      redBoxes.push(box);
    });

    // âœ… åŠ å…¥éƒµç¥¨ï¼ˆ12å¼µï¼‰
    const stamps = [];
    for (let i = 1; i <= 12; i++) {
      const stamp = document.createElement("img");
      stamp.src = `game4_assets/stamp${i}.jpg`;
      stamp.className = "stamp";
      stamp.style.left = (i <= 6 ? "70%" : "10%");
      stamp.style.top = (10 + (i % 6) * 12) + "%";
      stamp.draggable = false;
      container.appendChild(stamp);
      stamps.push(stamp);

      dragElement(stamp, i - 1);
    }

    // âœ… æ‹–æ›³åŠŸèƒ½
    function dragElement(el, index) {
      let offsetX = 0, offsetY = 0, isDragging = false;

      el.addEventListener("mousedown", (e) => {
        isDragging = true;
        offsetX = e.offsetX;
        offsetY = e.offsetY;
        el.style.zIndex = 10;
      });

      document.addEventListener("mousemove", (e) => {
        if (!isDragging) return;
        el.style.left = (e.pageX - container.offsetLeft - offsetX) + "px";
        el.style.top = (e.pageY - container.offsetTop - offsetY) + "px";
      });

      document.addEventListener("mouseup", () => {
        if (!isDragging) return;
        isDragging = false;
        el.style.zIndex = 2;

        // ğŸ“Œ æª¢æŸ¥å’Œç´…æ¡†æ˜¯å¦é‡ç–Š
        const rect1 = el.getBoundingClientRect();
        const rect2 = redBoxes[index].getBoundingClientRect();
        if (isOverlap(rect1, rect2)) {
          el.style.left = redBoxes[index].style.left;
          el.style.top = redBoxes[index].style.top;
        } else {
          errorSound.play();
        }
      });
    }

    // âœ… æª¢æŸ¥çŸ©å½¢é‡ç–Š
    function isOverlap(r1, r2) {
      return !(
        r1.right < r2.left ||
        r1.left > r2.right ||
        r1.bottom < r2.top ||
        r1.top > r2.bottom
      );
    }

    // å·¥å…·åˆ—åŠŸèƒ½
    function resetGame() {
      location.reload();
    }

    function goHome() {
      window.location.href = "index.html"; // å›é¦–é 
    }

    function exportCoords() {
      const coords = redBoxes.map(b => ({
        x: parseFloat(b.style.left),
        y: parseFloat(b.style.top)
      }));
      const json = JSON.stringify(coords, null, 2);
      navigator.clipboard.writeText(json).then(() => {
        alert("åº§æ¨™å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼š\n" + json);
      });
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<title>水果配對遊戲</title>
<style>
body { background-color: #FDF6E3; font-family: Arial, sans-serif; margin:0; padding:0; }
header { display:flex; justify-content: center; align-items: center; margin:10px 0; }
header img { width:50px; height:50px; margin:0 10px; }
h1 { text-align:center; color:#333; }
#gameBoard { display:flex; justify-content: space-around; flex-wrap: wrap; max-width: 1000px; margin:20px auto; }
.card { width:120px; height:60px; margin:5px; display:flex; justify-content:center; align-items:center; background-color:#1E90FF; color:white; cursor:pointer; border-radius:8px; user-select:none; font-size:16px; text-align:center; transition: background-color 0.3s, transform 0.3s; }
.card.matched { cursor: default; }
#message { text-align:center; font-size:24px; color:#E91E63; margin-top:20px; display:none; }
#controls { text-align:center; margin:20px; }
button { margin:0 10px; padding:8px 16px; font-size:16px; border:none; border-radius:6px; cursor:pointer; background-color:#FF9800; color:white; }
a { color:white; text-decoration: underline; }
</style>
</head>
<body>

<header>
<img src="game9_assets/fruit_left.png" alt="fruit left">
<h1>水果配對遊戲</h1>
<img src="game9_assets/fruit_right.png" alt="fruit right">
</header>

<div id="gameBoard"></div>
<div id="message">有夠 gâu</div>

<div id="controls">
<button id="restartBtn">重新開始</button>
<button id="nextPartBtn">後一部份</button>
<button id="homeBtn">轉去頭頁</button>
</div>

<script>
// 載入水果資料
const fruits = [];
const part1 = fetch('game9_assets/fruits_part1.json').then(r=>r.json());
const part2 = fetch('game9_assets/fruits_part2.json').then(r=>r.json());

Promise.all([part1, part2]).then(values=>{
  fruits.push(...values[0], ...values[1]);
  initGame();
});

let firstCard = null, secondCard = null;
let matchedCount = 0;

const colors = ['#FF5722','#4CAF50','#2196F3','#9C27B0','#FFC107','#E91E63','#00BCD4','#FF9800','#8BC34A','#CDDC39','#673AB7','#3F51B5','#009688','#F44336','#795548','#607D8B','#FFEB3B'];

function initGame() {
  const gameBoard = document.getElementById('gameBoard');
  gameBoard.innerHTML = '';

  // 每個水果生成中文卡 + 台語卡
  const cards = [];
  fruits.forEach((f,i)=>{
    cards.push({id:f.id, type:'chinese', text:f.chinese, audio:f.audio, link:f.link});
    cards.push({id:f.id, type:'taiwanese', text:f.taiwanese, audio:f.audio, link:f.link});
  });

  shuffle(cards);

  cards.forEach((card, index)=>{
    const div = document.createElement('div');
    div.classList.add('card');
    div.dataset.id = card.id;
    div.dataset.type = card.type;
    div.dataset.text = card.text;
    div.dataset.audio = card.audio;
    div.dataset.link = card.link;
    div.style.backgroundColor = '#1E90FF';
    div.textContent = card.text;
    div.addEventListener('click', ()=>selectCard(div));
    gameBoard.appendChild(div);
  });
}

function shuffle(array) {
  for(let i=array.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}

function selectCard(card) {
  if(card.classList.contains('matched') || card===firstCard) return;
  card.style.transform='scale(1.1)';
  setTimeout(()=>card.style.transform='scale(1)',150);

  if(!firstCard) {
    firstCard = card;
    return;
  }
  secondCard = card;

  if(firstCard.dataset.id === secondCard.dataset.id && firstCard.dataset.type !== secondCard.dataset.type){
    // 配對成功
    firstCard.classList.add('matched');
    secondCard.classList.add('matched');

    // 配對格子上色
    const colorIndex = matchedCount % colors.length;
    firstCard.style.backgroundColor = colors[colorIndex];
    secondCard.style.backgroundColor = colors[colorIndex];

    // 播放音檔
    const audio = new Audio(firstCard.dataset.audio);
    audio.play();

    matchedCount++;
    if(matchedCount === fruits.length){
      showVictory();
    }

    // 將台語詞變成連結
    if(firstCard.dataset.type==='taiwanese'){
      firstCard.innerHTML = `<a href="${firstCard.dataset.link}" target="_blank">${firstCard.dataset.text}</a>`;
    }
    if(secondCard.dataset.type==='taiwanese'){
      secondCard.innerHTML = `<a href="${secondCard.dataset.link}" target="_blank">${secondCard.dataset.text}</a>`;
    }

    firstCard = null;
    secondCard = null;
  } else {
    setTimeout(()=>{
      firstCard = null;
      secondCard = null;
    },500);
  }
}

function showVictory(){
  const message = document.getElementById('message');
  message.style.display='block';
  message.style.fontSize='10px';
  let size = 10;
  const interval = setInterval(()=>{
    size+=2;
    message.style.fontSize=size+'px';
    if(size>=60) clearInterval(interval);
  },100);
  // 勝利音效
  const victoryAudio = new Audio('game9_assets/victory.mp3');
  victoryAudio.play();
}

// 控制按鈕
document.getElementById('restartBtn').addEventListener('click', ()=>{ matchedCount=0; initGame(); document.getElementById('message').style.display='none'; });
document.getElementById('nextPartBtn').addEventListener('click', ()=>{ alert('切換下一部份'); });
document.getElementById('homeBtn').addEventListener('click', ()=>{ window.location.href='index.html'; });

</script>
</body>
</html>

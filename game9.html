<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<title>華台水果語詞配對</title>
<style>
* { box-sizing: border-box; }
body {
  margin:0; padding:0;
  font-family:"Microsoft JhengHei",sans-serif;
  background-color:#fff8e7;
  display:flex; flex-direction:column; align-items:center; min-height:100vh;
}
header { width:100%; display:flex; justify-content:center; align-items:center; margin:20px 0 10px; }
header img { height:60px; margin:0 20px; }
h1 { color:#d35400; font-size:2em; margin:0; }
h2 { color:#2c3e50; font-size:1em; margin:5px 0 15px; }
main { flex:1; display:flex; justify-content:center; align-items:flex-start; width:100%; max-width:1000px; padding:10px; }
.column { flex:1; display:flex; flex-wrap:wrap; justify-content:center; gap:10px; padding:10px; }
.word { border:2px solid #333; border-radius:8px; padding:8px 12px; font-size:1em; cursor:pointer; user-select:none; text-align:center; background-color:#fefefe; min-width:60px; }
.selected { border:3px solid #e74c3c; }
.matched { color:white; pointer-events:none; }
footer { margin:15px 0; }
button { padding:8px 16px; margin:0 5px; border:none; border-radius:6px; cursor:pointer; font-size:1em; color:white; }
#restart { background-color:#3498db; }
#next { background-color:#e67e22; }
#home { background-color:#2ecc71; }
#message { font-size:1.5em; color:#27ae60; margin:10px; font-weight:bold; transition: all 1s; display:inline-block; }
@media(max-width:768px){ main{flex-direction:column; align-items:center;} .column{flex-direction:row; flex-wrap:wrap;} }
</style>
</head>
<body>
<header>
<img id="left-fruit" src="game9_assets/fruit_left.png" alt="fruit left">
<h1>華台水果語詞配對</h1>
<img id="right-fruit" src="game9_assets/fruit_right.png" alt="fruit right">
</header>
<h2>tshi̍h 華文抑是台語攏會使，配對成功會有台語聲音檔喔！</h2>

<main>
<div class="column" id="hua-col"></div>
<div class="column" id="tai-col"></div>
</main>

<div id="message"></div>

<footer>
<button id="restart">重新開始</button>
<button id="next">後一部份</button>
<button id="home" onclick="location.href='index.html'">轉去頭頁</button>
</footer>

<audio id="audio-player"></audio>
<audio id="effect-correct" src="game9_assets/victory1.mp3"></audio>
<audio id="effect-wrong" src="game9_assets/wrong2.mp3"></audio>

<script>
let huaData=[], taiData=[];
let selectedHua=null, selectedTai=null;
let matchedCount=0, currentPart=1;
const colors=["#e74c3c","#3498db","#f1c40f","#9b59b6","#1abc9c","#e67e22","#2ecc71","#f39c12","#16a085","#8e44ad","#d35400","#27ae60","#c0392b","#2980b9","#f39c12","#7f8c8d","#e84393"];

async function loadPart(part){
  currentPart=part;
  const res=await fetch(`game9_assets/fruits_part${part}.json`);
  const data=await res.json();
  setupGame(data);
  // 重設左右水果圖片
  document.getElementById("left-fruit").src=Math.random()>0.5?"game9_assets/fruit_left.png":"game9_assets/fruit_left1.png";
  document.getElementById("right-fruit").src=Math.random()>0.5?"game9_assets/fruit_right.png":"game9_assets/fruit_right1.png";
}

function setupGame(data){
  huaData=data.map(item=>({id:item.chinese,text:item.chinese}));
  taiData=data.map(item=>({id:item.chinese,text:item.taiwanese,link:item.link,audio:item.audio}));
  shuffleArray(huaData); shuffleArray(taiData);
  const huaCol=document.getElementById("hua-col");
  const taiCol=document.getElementById("tai-col");
  huaCol.innerHTML=""; taiCol.innerHTML="";
  matchedCount=0;
  document.getElementById("message").textContent="";
  huaData.forEach((item,i)=>{
    const div=document.createElement("div");
    div.className="word hua";
    div.textContent=item.text;
    div.dataset.id=item.id;
    div.dataset.color=colors[i%colors.length];
    div.onclick=()=>selectHua(div);
    huaCol.appendChild(div);
  });
  taiData.forEach((item,i)=>{
    const div=document.createElement("div");
    div.className="word tai";
    div.textContent=item.text;
    div.dataset.id=item.id;
    div.dataset.color=colors[i%colors.length];
    div.onclick=()=>selectTai(div,item.link,item.audio);
    taiCol.appendChild(div);
  });
}

function selectHua(el){
  if(el.classList.contains("matched")) return;
  if(selectedHua) selectedHua.classList.remove("selected");
  selectedHua=el; el.classList.add("selected");
  checkMatch();
}

function selectTai(el, link, audioUrl){
  if(el.classList.contains("matched")) return;
  if(selectedTai) selectedTai.classList.remove("selected");
  selectedTai=el; el.classList.add("selected");
  checkMatch(link,audioUrl);
}

function checkMatch(link,audioUrl){
  if(!selectedHua || !selectedTai) return;
  if(selectedHua.dataset.id===selectedTai.dataset.id){
    selectedHua.classList.add("matched");
    selectedTai.classList.add("matched");
    selectedHua.style.backgroundColor=selectedHua.dataset.color;
    selectedTai.style.backgroundColor=selectedTai.dataset.color;

    // 播放台語音檔
    playAudio(audioUrl);

    // 右側台語詞加教典連結
    selectedTai.innerHTML=`<a href="${link||'#'}" target="_blank" style="color:white;text-decoration:underline;">${selectedTai.textContent}</a>`;

    matchedCount++;
    resetSelection();

    if(matchedCount===huaData.length){
      const msg=document.getElementById("message");
      msg.textContent="有夠 gâu！"; msg.style.fontSize="1em";
      document.getElementById("effect-correct").play();
      let size=16;
      const grow=setInterval(()=>{
        if(size>50){ clearInterval(grow); } else { msg.style.fontSize=size+"px"; size+=2; }
      },50);
    }

  }else{
    document.getElementById("effect-wrong").play();
    resetSelection();
  }
}

function playAudio(url){
  if(!url) return;
  const player=document.getElementById("audio-player");
  player.src=url; player.play();
}

function resetSelection(){
  if(selectedHua) selectedHua.classList.remove("selected");
  if(selectedTai) selectedTai.classList.remove("selected");
  selectedHua=null; selectedTai=null;
}

function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
}

document.getElementById("restart").onclick=()=>loadPart(currentPart);
document.getElementById("next").onclick=()=>loadPart(currentPart===1?2:1);

// 預設載入 Part1
loadPart(1);
</script>
</body>
</html>

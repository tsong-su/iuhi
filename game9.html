<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<title>華台水果語詞配對</title>
<style>
  body { font-family: Arial, sans-serif; background:#dff0d8; text-align:center; margin:0; padding:0; }
  h1 { margin-top:20px; display:flex; justify-content:center; align-items:center; }
  h1 img { width:50px; height:50px; margin:0 10px; }
  #hint { margin:10px; font-size:14px; color:#555; }
  #game-container { display:flex; justify-content:center; margin:20px; flex-wrap:wrap; }
  .column { display:flex; flex-direction:column; margin:0 20px; }
  .fruit-box { width:100px; height:40px; margin:5px; line-height:40px; color:white; font-weight:bold; cursor:pointer; border-radius:6px; user-select:none; }
  #message { font-size:24px; color:#e74c3c; margin:20px; transition: font-size 1s; }
  #buttons { margin:20px; }
  button { padding:10px 20px; font-size:16px; margin:5px; cursor:pointer; border-radius:6px; }
</style>
</head>
<body>

<h1>
  <img src="game9_assets/fruit_left.png" alt="">
  華台水果語詞配對
  <img src="game9_assets/fruit_right.png" alt="">
</h1>
<div id="hint">tshi̍h 華文抑是台語攏會使，配對成功會有台語聲音檔喔！</div>

<div id="game-container">
  <div class="column" id="chinese-column"></div>
  <div class="column" id="taiwanese-column"></div>
</div>

<div id="message"></div>

<div id="buttons">
  <button id="next-part">後一部份</button>
  <button onclick="window.location.href='index.html'">轉去頭頁</button>
</div>

<script>
let currentPart = 1;
let chineseColumn = document.getElementById('chinese-column');
let taiwaneseColumn = document.getElementById('taiwanese-column');
let messageEl = document.getElementById('message');
let nextPartBtn = document.getElementById('next-part');
let selectedChinese = null;
let selectedTaiwanese = null;
let matched = 0;
let partData = {};

async function loadPart(part) {
  const response = await fetch(`game9_assets/fruits_part${part}.json`);
  partData = await response.json();
  matched = 0;
  messageEl.textContent = '';
  chineseColumn.innerHTML = '';
  taiwaneseColumn.innerHTML = '';

  // 隨機顏色陣列
  const colors = ["#e74c3c","#e67e22","#f1c40f","#2ecc71","#3498db","#9b59b6","#1abc9c",
                  "#c0392b","#d35400","#f39c12","#27ae60","#2980b9","#8e44ad","#16a085","#c0392b","#d35400","#f39c12"];

  partData.forEach((item, index) => {
    let cBox = document.createElement('div');
    cBox.className = 'fruit-box';
    cBox.textContent = item.chinese;
    cBox.style.backgroundColor = '#34495e';
    cBox.dataset.index = index;
    cBox.addEventListener('click',()=>select('chinese',index));
    chineseColumn.appendChild(cBox);

    let tBox = document.createElement('div');
    tBox.className = 'fruit-box';
    tBox.innerHTML = `<a href="${item.link}" target="_blank" style="color:white;text-decoration:none;">${item.taiwanese}</a>`;
    tBox.style.backgroundColor = '#34495e';
    tBox.dataset.index = index;
    tBox.addEventListener('click',()=>select('taiwanese',index));
    taiwaneseColumn.appendChild(tBox);
  });
}

function select(type,index) {
  if(type==='chinese') selectedChinese = index;
  if(type==='taiwanese') selectedTaiwanese = index;

  if(selectedChinese!==null && selectedTaiwanese!==null) checkMatch();
}

function checkMatch() {
  let cBox = chineseColumn.children[selectedChinese];
  let tBox = taiwaneseColumn.children[selectedTaiwanese];
  if(selectedChinese===selectedTaiwanese) {
    let color = generateColor(selectedChinese);
    cBox.style.backgroundColor = color;
    tBox.style.backgroundColor = color;
    // 播放音檔
    let audio = new Audio(partData[selectedChinese].audio);
    audio.play();

    matched++;
    if(matched===partData.length){
      // 勝利動畫
      let victoryAudio = new Audio('game9_assets/victory.mp3');
      victoryAudio.play();
      messageEl.style.fontSize = '24px';
      messageEl.textContent = '有夠 gâu';
      let size=24;
      let interval = setInterval(()=>{
        if(size>=60) clearInterval(interval);
        messageEl.style.fontSize = size+'px';
        size+=2;
      },50);
    }
  } else {
    // 配對錯誤
    cBox.style.backgroundColor = '#7f8c8d';
    tBox.style.backgroundColor = '#7f8c8d';
  }
  selectedChinese = null;
  selectedTaiwanese = null;
}

function generateColor(index){
  const palette = ["#e74c3c","#e67e22","#f1c40f","#2ecc71","#3498db","#9b59b6","#1abc9c",
                  "#c0392b","#d35400","#f39c12","#27ae60","#2980b9","#8e44ad","#16a085","#9b59b6","#e67e22","#f1c40f","#2ecc71"];
  return palette[index % palette.length];
}

nextPartBtn.addEventListener('click',()=>{
  if(currentPart===1){
    currentPart=2;
    loadPart(2);
  } else {
    alert('已經是最後一部份了');
  }
});

// 初始載入第一部份
loadPart(1);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>華台水果語詞配對 - 第一回</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      margin: 0; padding: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: flex-start;
      height: 100vh;
      background: #fff7e6;
    }
    h1 {
      display: flex; align-items: center; justify-content: center;
      font-size: 2.2em; margin: 10px 0 0;
      color: #d35400;
    }
    h1 img {
      width: 40px; height: 40px; margin: 0 10px;
    }
    h2 {
      margin: 5px 0 15px;
      font-size: 1.4em; color: #27ae60;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
      gap: 8px;
      width: 95%;
      margin: 5px 0;
    }
    .cell {
      padding: 10px;
      text-align: center;
      border: 2px solid #ccc;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1.3em;
      font-weight: 500;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    /* 初始顏色區分 */
    #chineseGrid .cell {
      background: #fce4ec;
    }
    #taiwaneseGrid .cell {
      background: #e3f2fd;
    }
    .cell.selected {
      border: 3px solid #2980b9;
    }
    .cell.matched {
      color: #fff;
      font-weight: bold;
    }
    .buttons {
      margin: 15px 0;
    }
    .buttons button {
      margin: 0 5px;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      cursor: pointer;
      color: #fff;
    }
    #restart { background: #e67e22; }
    #home { background: #16a085; }
    #next { background: #c0392b; }
    #message {
      position: fixed; top: 40%; left: 50%;
      transform: translate(-50%, -50%);
      font-size: 3em; font-weight: bold;
      color: #e74c3c;
      display: none;
      animation: pop 1s ease-in-out;
    }
    @keyframes pop {
      0% { transform: scale(0.5) translate(-50%, -50%); opacity: 0; }
      50% { transform: scale(1.2) translate(-50%, -50%); opacity: 1; }
      100% { transform: scale(1) translate(-50%, -50%); opacity: 1; }
    }
  </style>
</head>
<body>
  <h1>
    <img src="game9_assets/fruit_icon.png" alt="水果">
    華台水果語詞配對
    <img src="game9_assets/fruit_icon.png" alt="水果">
  </h1>
  <h2>第一回：請配對正確的華語與台語水果名稱</h2>

  <div id="chineseGrid" class="grid"></div>
  <div id="taiwaneseGrid" class="grid"></div>

  <div class="buttons">
    <button id="restart">重新開始</button>
    <button id="home">回首頁</button>
    <button id="next">後一回</button>
  </div>

  <div id="message">有夠 gâu！</div>

  <audio id="correctSound" src="game9_assets/correct.mp3"></audio>
  <audio id="victorySound" src="game9_assets/victory.mp3"></audio>

  <script>
    const colors = [
      "#e74c3c","#9b59b6","#3498db","#1abc9c",
      "#f39c12","#d35400","#2ecc71","#e67e22",
      "#c0392b","#8e44ad","#2980b9","#16a085",
      "#27ae60","#f1c40f","#7f8c8d","#2c3e50"
    ];

    let chineseGrid = document.getElementById("chineseGrid");
    let taiwaneseGrid = document.getElementById("taiwaneseGrid");
    let correctSound = document.getElementById("correctSound");
    let victorySound = document.getElementById("victorySound");
    let message = document.getElementById("message");

    let chineseCells = [], taiwaneseCells = [];
    let selectedChinese = null, selectedTaiwanese = null;
    let matchedCount = 0;

    async function loadData() {
      let res = await fetch("game9_assets/fruits_part1.json");
      let data = await res.json();
      let fruits = data.fruits.slice(0, 16).filter(f => f.id !== 15);

      // 中文
      fruits.forEach(f => {
        let cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = f.chinese;
        cell.dataset.id = f.id;
        cell.addEventListener("click", () => selectCell(cell, "chinese"));
        chineseGrid.appendChild(cell);
        chineseCells.push(cell);
      });

      // 台語
      let shuffled = [...fruits].sort(() => Math.random() - 0.5);
      shuffled.forEach(f => {
        let cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = f.taiwanese;
        cell.dataset.id = f.id;
        cell.addEventListener("click", () => selectCell(cell, "taiwanese"));
        taiwaneseGrid.appendChild(cell);
        taiwaneseCells.push(cell);
      });
    }

    function selectCell(cell, type) {
      if (cell.classList.contains("matched")) return;

      if (type === "chinese") {
        if (selectedChinese) selectedChinese.classList.remove("selected");
        selectedChinese = cell;
        cell.classList.add("selected");
      } else {
        if (selectedTaiwanese) selectedTaiwanese.classList.remove("selected");
        selectedTaiwanese = cell;
        cell.classList.add("selected");
      }

      if (selectedChinese && selectedTaiwanese) {
        checkMatch();
      }
    }

    function checkMatch() {
      if (selectedChinese.dataset.id === selectedTaiwanese.dataset.id) {
        let color = colors[matchedCount % colors.length];
        selectedChinese.style.background = color;
        selectedTaiwanese.style.background = color;
        selectedChinese.classList.add("matched");
        selectedTaiwanese.classList.add("matched");

        matchedCount++;
        correctSound.play();

        if (matchedCount === 16) {
          setTimeout(() => {
            victorySound.play();
            message.style.display = "block";
          }, 1000);
        }
      }

      selectedChinese.classList.remove("selected");
      selectedTaiwanese.classList.remove("selected");
      selectedChinese = null;
      selectedTaiwanese = null;
    }

    document.getElementById("restart").onclick = () => location.reload();
    document.getElementById("home").onclick = () => location.href = "index.html";
    document.getElementById("next").onclick = () => location.href = "game9_round2.html";

    loadData();
  </script>
</body>
</html>

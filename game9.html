<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>華台水果語詞配對-第1回</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background: linear-gradient(to bottom, #fff7e6, #ffe0b2);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      min-height: 100vh;
    }
    header {
      text-align: center;
      padding: 10px;
    }
    header h1 {
      font-size: 2em;
      font-weight: bold;
      color: #ff6600; /* 亮麗色系 */
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    header img {
      width: 40px;
      height: 40px;
    }
    .subtitle {
      font-size: 1em;
      margin-top: 5px;
      color: #444;
    }
    .hint {
      font-size: 1.2em;
      margin-top: 5px;
      color: #0077cc;
      font-weight: bold;
    }
    main {
      flex-grow: 1;
      width: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 20px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      width: 90%;
      max-width: 600px;
    }
    .cell {
      border-radius: 12px;
      padding: 10px;
      background: #fff3cd;
      text-align: center;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      word-break: break-word;
    }
    .cell:hover { transform: scale(1.05); }
    .top-grid .cell { background: #e0f7fa; }   /* 初始上方顏色 */
    .bottom-grid .cell { background: #fce4ec; }/* 初始下方顏色 */

    footer {
      display: flex;
      justify-content: center;
      gap: 15px;
      padding: 15px;
    }
    button {
      border: none;
      padding: 10px 15px;
      font-size: 1em;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: transform 0.2s;
    }
    button:hover { transform: scale(1.1); }
    .btn-restart { background: #ffcc80; }
    .btn-next { background: #90caf9; }
    .btn-home { background: #a5d6a7; }

    #result {
      font-size: 2em;
      color: #d32f2f;
      font-weight: bold;
      opacity: 0;
      transition: all 0.5s ease;
    }
    #result.show {
      opacity: 1;
      transform: scale(1.5);
    }
  </style>
</head>
<body>
  <header>
    <h1>
      <img src="game9_assets/fruit_icon.png" alt="水果">
      華台水果語詞配對-第1回
      <img src="game9_assets/fruit_icon.png" alt="水果">
    </h1>
    <div class="subtitle">tshi̍h華文抑是台語攏會使，配對成功會有台語聲音檔喔！</div>
    <div class="hint">📱 建議直式觀看效果最佳</div>
  </header>

  <main>
    <div class="grid top-grid" id="chineseGrid"></div>
    <div class="grid bottom-grid" id="taiwaneseGrid"></div>
    <div id="result">有夠gâu！</div>
  </main>

  <footer>
    <button class="btn-restart" onclick="restartGame()">閣耍一擺</button>
    <button class="btn-next" onclick="nextRound()">後一回</button>
    <button class="btn-home" onclick="goHome()">轉去遊戲頭頁</button>
  </footer>

  <audio id="wrongSound" src="game9_assets/wrong.mp3"></audio>
  <audio id="correctSound" src="game9_assets/correct.mp3"></audio>
  <audio id="winSound" src="game9_assets/win.mp3"></audio>

  <script>
    const chineseGrid = document.getElementById("chineseGrid");
    const taiwaneseGrid = document.getElementById("taiwaneseGrid");
    const result = document.getElementById("result");
    const wrongSound = document.getElementById("wrongSound");
    const correctSound = document.getElementById("correctSound");
    const winSound = document.getElementById("winSound");

    let data = [];
    let selected = [];
    let matches = 0;

    async function loadData() {
      const [part1, part2] = await Promise.all([
        fetch("game9_assets/fruits_part1.json").then(res => res.json()),
        fetch("game9_assets/fruits_part2.json").then(res => res.json())
      ]);

      let combined = [...part1, ...part2];
      // 排除 李子/李仔 與 黑珍珠/烏真珠
      combined = combined.filter(item =>
        !item.zh.includes("李子") &&
        !item.tai.includes("李仔") &&
        !item.zh.includes("黑珍珠") &&
        !item.tai.includes("烏真珠")
      );

      data = combined.slice(0, 16); // 取16組
      setupGame();
    }

    function setupGame() {
      chineseGrid.innerHTML = "";
      taiwaneseGrid.innerHTML = "";
      result.classList.remove("show");
      matches = 0;

      const chinese = [...data].sort(() => Math.random() - 0.5);
      const taiwanese = [...data].sort(() => Math.random() - 0.5);

      chinese.forEach(item => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = item.zh;
        cell.dataset.match = item.id;
        cell.onclick = () => selectCell(cell, "zh");
        chineseGrid.appendChild(cell);
      });

      taiwanese.forEach(item => {
        const cell = document.createElement("div");
        cell.className = "cell";
        cell.textContent = item.tai;
        cell.dataset.match = item.id;
        cell.onclick = () => selectCell(cell, "tai");
        taiwaneseGrid.appendChild(cell);
      });
    }

    function selectCell(cell, type) {
      if (cell.classList.contains("matched")) return;
      cell.style.border = "3px solid #ff5722";
      selected.push(cell);

      if (selected.length === 2) {
        const [first, second] = selected;
        if (first.dataset.match === second.dataset.match && first !== second) {
          // 配對成功
          first.classList.add("matched");
          second.classList.add("matched");
          const color = getRandomColor();
          first.style.background = color;
          second.style.background = color;
          correctSound.play();
          matches++;
          if (matches === data.length) {
            setTimeout(() => {
              correctSound.pause();
              correctSound.currentTime = 0;
              winSound.play();
              result.classList.add("show");
            }, 1000);
          }
        } else {
          // 配對失敗
          wrongSound.play();
          setTimeout(() => {
            first.style.border = "none";
            second.style.border = "none";
          }, 500);
        }
        selected = [];
      }
    }

    function getRandomColor() {
      const colors = [
        "#ffb3ba","#ffdfba","#ffffba","#baffc9","#bae1ff",
        "#e1baff","#ffcba4","#c4fae8","#f1c0e8","#a3c4f3",
        "#ff9cee","#d0f4de","#fcf6bd","#a9def9","#e4c1f9","#ffd6a5"
      ];
      return colors[matches % colors.length];
    }

    function restartGame() { setupGame(); }
    function nextRound() { alert("後一回功能尚未串接，待補！"); }
    function goHome() { window.location.href = "index.html"; }

    loadData();
  </script>
</body>
</html>

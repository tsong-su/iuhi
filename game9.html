<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<title>華台水果語詞配對</title>
<style>
* { box-sizing: border-box; }
body {
  margin: 0; padding: 0;
  font-family: "Microsoft JhengHei", sans-serif;
  background-color: #fff8e7;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
}
header {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 20px 0 10px;
}
header img {
  height: 60px;
  margin: 0 20px;
}
h1 {
  color: #d35400;
  font-size: 2em;
  margin: 0;
}
h2 {
  color: #2c3e50;
  font-size: 1em;
  margin: 5px 0 15px;
}
main {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  width: 100%;
  max-width: 1000px;
  padding: 10px;
}
.column {
  flex: 1;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  padding: 10px;
}
.word {
  border: 2px solid #333;
  border-radius: 8px;
  padding: 8px 12px;
  font-size: 1em;
  cursor: pointer;
  user-select: none;
  text-align: center;
  background-color: #fefefe;
  min-width: 70px;
}
.hua { background-color: #ffeb99; }
.tai { background-color: #c5eff7; }
.selected { border: 3px solid #e74c3c; }
.matched { color:white; pointer-events: none; }
footer {
  margin: 15px 0;
}
button {
  padding: 8px 16px;
  margin: 0 5px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-size: 1em;
  color: white;
}
#restart { background-color: #3498db; }
#next { background-color: #e67e22; }
#home { background-color: #2ecc71; }
#message {
  font-size: 1.5em;
  color: #27ae60;
  margin: 10px;
  font-weight: bold;
  transition: font-size 1s;
}
@media (max-width: 768px) {
  main { flex-direction: column; align-items: center; }
  .column { flex-direction: row; flex-wrap: wrap; }
}
</style>
</head>
<body>
<header>
  <img id="left-fruit" src="game9_assets/fruit_left.png" alt="fruit left">
  <h1>華台水果語詞配對</h1>
  <img id="right-fruit" src="game9_assets/fruit_right.png" alt="fruit right">
</header>
<h2>tshi̍h 華文抑是台語攏會使，配對成功會有台語聲音檔喔！</h2>
<main>
  <div class="column" id="hua-col"></div>
  <div class="column" id="tai-col"></div>
</main>
<div id="message"></div>
<footer>
  <button id="restart">重新開始</button>
  <button id="next">後一部份</button>
  <button id="home" onclick="location.href='index.html'">轉去頭頁</button>
</footer>

<audio id="audio-player"></audio>
<audio id="effect-correct" src="game9_assets/victory1.mp3"></audio>
<audio id="effect-wrong" src="game9_assets/wrong2.mp3"></audio>

<script>
let huaData=[], taiData=[];
let selectedHua=null, selectedTai=null;
let matchedCount=0;
let currentPart=1;
let colors = ["#e74c3c","#8e44ad","#3498db","#16a085","#f39c12","#d35400","#2c3e50","#c0392b","#27ae60","#2980b9","#f1c40f","#d35400","#1abc9c","#9b59b6","#e67e22","#2ecc71","#34495e"];

function shuffleArray(array){
  for(let i=array.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [array[i],array[j]]=[array[j],array[i]];
  }
}

async function loadPart(part){
  currentPart=part;
  // 隨機左右水果圖
  document.getElementById("left-fruit").src = Math.random()>0.5 ? "game9_assets/fruit_left.png":"game9_assets/fruit_left1.png";
  document.getElementById("right-fruit").src = Math.random()>0.5 ? "game9_assets/fruit_right.png":"game9_assets/fruit_right1.png";
  const res = await fetch(`game9_assets/fruits_part${part}.json`);
  const data = await res.json();
  setupGame(data);
}

function setupGame(data){
  huaData = data.map(item=>({id:item.id,text:item.chinese,audio:item.audio,link:item.link}));
  taiData = data.map(item=>({id:item.id,text:item.taiwanese,audio:item.audio,link:item.link}));

  shuffleArray(huaData);
  shuffleArray(taiData);

  const huaCol=document.getElementById("hua-col");
  const taiCol=document.getElementById("tai-col");
  huaCol.innerHTML="";
  taiCol.innerHTML="";
  matchedCount=0;
  document.getElementById("message").textContent="";

  huaData.forEach((item,index)=>{
    const div=document.createElement("div");
    div.className="word hua";
    div.textContent=item.text;
    div.dataset.id=item.id;
    div.dataset.audio=item.audio;
    div.dataset.link=item.link;
    div.dataset.color=colors[index % colors.length];
    div.onclick=()=>selectHua(div);
    huaCol.appendChild(div);
  });

  taiData.forEach((item,index)=>{
    const div=document.createElement("div");
    div.className="word tai";
    div.textContent=item.text;
    div.dataset.id=item.id;
    div.dataset.audio=item.audio;
    div.dataset.link=item.link;
    div.dataset.color=colors[index % colors.length];
    div.onclick=()=>selectTai(div);
    taiCol.appendChild(div);
  });
}

function selectHua(el){
  if(el.classList.contains("matched")) return;
  if(selectedHua) selectedHua.classList.remove("selected");
  selectedHua=el;
  el.classList.add("selected");
  checkMatch();
}

function selectTai(el){
  if(el.classList.contains("matched")) return;
  if(selectedTai) selectedTai.classList.remove("selected");
  selectedTai=el;
  el.classList.add("selected");
  checkMatch();
}

function checkMatch(){
  if(!selectedHua || !selectedTai) return;
  if(selectedHua.dataset.id === selectedTai.dataset.id){
    const color=selectedHua.dataset.color;
    selectedHua.classList.add("matched");
    selectedTai.classList.add("matched");
    selectedHua.style.backgroundColor=color;
    selectedTai.style.backgroundColor=color;

    // 播放台語音檔
    playAudio(selectedTai.dataset.audio);

    // 台語詞加上教典連結
    selectedTai.innerHTML=`<a href="${selectedTai.dataset.link}" target="_blank" style="color:white;text-decoration:underline;">${selectedTai.textContent}</a>`;

    matchedCount++;
    animateMessage("有夠 gâu！");
    resetSelection();
  } else {
    document.getElementById("effect-wrong").play();
    resetSelection();
  }
}

function playAudio(url){
  const player=document.getElementById("audio-player");
  player.src=url;
  player.play();
}

function resetSelection(){
  if(selectedHua) selectedHua.classList.remove("selected");
  if(selectedTai) selectedTai.classList.remove("selected");
  selectedHua=null;
  selectedTai=null;
}

function animateMessage(text){
  const msg=document.getElementById("message");
  msg.textContent=text;
  msg.style.fontSize="1.5em";
  document.getElementById("effect-correct").play();
  let size=24;
  const interval=setInterval(()=>{
    if(size>=48){ clearInterval(interval); return;}
    size++;
    msg.style.fontSize=size+"px";
  },20);
}

document.getElementById("restart").onclick=()=>loadPart(currentPart);
document.getElementById("next").onclick=()=>loadPart(currentPart===1?2:1);

// 預設載入 Part1
loadPart(1);
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¯å°æ°´æœèªè©é…å°</title>
<style>
  :root{
    --header-h:14vh;
    --footer-h:11vh;
    --grid-h: calc((100vh - var(--header-h) - var(--footer-h) - 22px) / 2);
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:"Microsoft JhengHei", "Noto Sans TC", sans-serif;
    background: linear-gradient(180deg,#fffaf0 0%, #fff3df 100%);
    color:#222;
    min-height:100vh; display:flex; flex-direction:column; align-items:center;
  }

  header{
    height:var(--header-h);
    width:100%;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
    padding:8px 12px; text-align:center;
  }

  .title-row{
    display:flex; align-items:center; gap:10px;
    font-size:clamp(18px,4.2vw,28px);
    font-weight:800;
    color:#ff6f00; /* äº®éº—è‰²ç³» */
    flex-wrap: nowrap;
    justify-content: center;
  }
  .title-row img{ width:44px; height:44px; object-fit:contain; }

  .subtitle{
    margin-top:6px;
    font-size:clamp(12px,2.2vw,16px);
    color:#1565c0; 
  }
  .view-hint{
    margin-top:4px;
    font-size:clamp(14px,3vw,18px);
    color:#ff4081; /* æ›´äº®éº— */
    font-weight:800;
  }

  main{ width:100%; display:flex; flex-direction:column; align-items:center; gap:8px; padding:6px 0; }

  .grid-area{
    width:100%;
    max-width:720px;
    height:var(--grid-h);
    display:grid;
    grid-template-columns:repeat(4,1fr);
    grid-template-rows:repeat(4,1fr);
    gap:8px;
    padding: 0 4%;
  }

  .cell{
    border-radius:14px;
    border:2px solid rgba(0,0,0,0.12);
    display:flex; align-items:center; justify-content:center;
    padding:6px;
    text-align:center;
    cursor:pointer;
    transition: transform .12s ease, box-shadow .12s ease;
    user-select:none;
    overflow:hidden; white-space:nowrap; text-overflow:ellipsis;
    font-weight:700;
    font-size: clamp(14px, 2.6vw, 20px);
    min-height: 44px;
  }
  .cell:active{ transform: translateY(2px); }

  #grid-cn .cell{ background: #e3f2fd; color:#0b2340; }
  #grid-tw .cell{ background: #fff0f6; color:#2b1f2f; }

  .cell.selected{ outline:4px solid rgba(33,150,243,0.85); outline-offset:-6px; }
  .cell.matched{ pointer-events:none; color:#fff; }

  footer{
    height:var(--footer-h);
    width:100%;
    display:flex; align-items:center; justify-content:center; gap:12px; padding:8px;
  }

  button.btn {
    padding:10px 14px; border-radius:10px; border:none; font-weight:800; font-size:clamp(13px,2.2vw,16px);
    cursor:pointer; color:#fff;
  }
  #btn-restart{ background:#ffb74d } /* é–£è€ä¸€æ“º */
  #btn-next{ background:#4fc3f7 }    /* å¾Œä¸€å› */
  #btn-home{ background:#81c784 }    /* è½‰å»éŠæˆ²é ­é  */

  #victory {
    position: fixed; left:50%; top:44%; transform:translate(-50%,-50%) scale(.2);
    font-size: clamp(28px,6vw,48px); color:#e91e63; font-weight:900; opacity:0;
    transition: all .45s cubic-bezier(.2,.9,.2,1);
    pointer-events:none;
  }
  #victory.show { transform:translate(-50%,-50%) scale(1.2); opacity:1; }

  @media (max-width:600px){
    .title-row img{ width:36px; height:36px; }
  }
</style>
</head>
<body>
  <header>
    <div class="title-row">
      <img id="leftImg" src="game9_assets/fruit_left.png" alt="left fruit">
      <div id="titleText">è¯å°æ°´æœèªè©é…å° - ç¬¬1å›</div>
      <img id="rightImg" src="game9_assets/fruit_right.png" alt="right fruit">
    </div>
    <div class="subtitle" id="subtitle">tshiÌh è¯æ–‡æŠ‘æ˜¯å°èªæ”æœƒä½¿ï¼Œé…å°æˆåŠŸæœƒæœ‰å°èªè²éŸ³æª”å–”ï¼</div>
    <div class="view-hint">ğŸ“± å»ºè­°ç›´å¼è§€çœ‹æ•ˆæœæœ€ä½³</div>
  </header>

  <main>
    <div id="grid-cn" class="grid-area" aria-label="è¯èªæ ¼å­"></div>
    <div id="grid-tw" class="grid-area" aria-label="å°èªæ ¼å­"></div>
    <div id="victory">æœ‰å¤  gÃ¢uï¼</div>
  </main>

  <footer>
    <button id="btn-restart" class="btn">é–£è€ä¸€æ“º</button>
    <button id="btn-next" class="btn">å¾Œä¸€å›</button>
    <button id="btn-home" class="btn">è½‰å»éŠæˆ²é ­é </button>
  </footer>

  <audio id="wrongAudio" src="game9_assets/wrong.mp3" preload="auto"></audio>
  <audio id="victoryAudio" src="game9_assets/victory.mp3" preload="auto"></audio>

<script>
const ROUND_FILES = {1:'game9_assets/fruits_part1.json', 2:'game9_assets/fruits_part2.json'};
const EXCLUDE_ID = {1:15, 2:32};
const COLOR_PALETTE = [
  "#FF5733","#FF8D1A","#FFC300","#DAF7A6",
  "#33FF57","#1AFF8D","#33FFF6","#3380FF",
  "#8D33FF","#FF33F6","#FF3380","#FF6666",
  "#66FF66","#66FFFF","#6666FF","#FFCC00"
];

const gridCn = document.getElementById('grid-cn');
const gridTw = document.getElementById('grid-tw');
const leftImg = document.getElementById('leftImg');
const rightImg = document.getElementById('rightImg');
const titleText = document.getElementById('titleText');
const victoryEl = document.getElementById('victory');
const wrongAudio = document.getElementById('wrongAudio');
const victoryAudio = document.getElementById('victoryAudio');

let round = 1, pairs = [], selected = null, matchedCount = 0, playingFinalFlow=false;

// éš¨æ©Ÿåˆ‡æ›å·¦å³æ°´æœåœ–
const LEFT_OPTS = ['fruit_left.png','fruit_left1.png','fruit_left2.png','fruit_left3.png'];
const RIGHT_OPTS = ['fruit_right.png','fruit_right1.png','fruit_right2.png','fruit_right3.png'];
setInterval(()=> {
  leftImg.src = 'game9_assets/' + LEFT_OPTS[Math.floor(Math.random()*LEFT_OPTS.length)];
  rightImg.src = 'game9_assets/' + RIGHT_OPTS[Math.floor(Math.random()*RIGHT_OPTS.length)];
}, 2000);

// JSON è™•ç†èˆ‡æ¸²æŸ“ (åŒæ‚¨åŸæœ¬ç¨‹å¼ç¢¼)
function extractArray(json){ if(Array.isArray(json)) return json; if(json.fruits&&Array.isArray(json.fruits)) return json.fruits; return []; }
function pickFirst(obj,keys){for(const k of keys) if(obj[k]!==undefined && obj[k]!==null && String(obj[k]).trim()!=='') return String(obj[k]).trim(); return null;}
function parsePairEntry(entry, idx){
  const id = entry.id ?? entry.ID ?? entry.index ?? (idx+1);
  let chinese = pickFirst(entry, ['chinese','zh','name','title','text','Chinese','cn']);
  let taiwanese = pickFirst(entry, ['taiwanese','tai','tw','taiwaneseName','taiwanese_name','Taiwanese','tw_name']);
  if(!chinese && chinese!== "") chinese = null;
  if(!taiwan

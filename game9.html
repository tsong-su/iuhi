<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>華台水果語詞配對–第1回</title>
<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background: #FFF8DC;
  display:flex;
  flex-direction:column;
  align-items:center;
}
.header {
  text-align:center;
  padding:10px;
}
.header h1 {
  font-size:28px;
  color:#FF4500;
  margin:5px 0;
}
.header img {
  height:40px;
  vertical-align:middle;
  margin:0 5px;
}
.header p {
  margin:3px 0;
}
.header .note {
  font-size:20px;
  color:#32CD32;
}
.grid-container {
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap:8px;
  width:95%;
  max-width:500px;
  margin:10px 0;
}
.grid-item {
  background-color:#FFDAB9;
  border-radius:12px;
  display:flex;
  justify-content:center;
  align-items:center;
  height:70px;
  font-size:18px;
  font-weight:bold;
  cursor:pointer;
  text-align:center;
  white-space:nowrap;
}
.grid-item.selected {
  outline:3px solid #000;
}
.buttons {
  display:flex;
  gap:10px;
  margin:15px 0;
}
.buttons button {
  padding:10px 15px;
  border:none;
  border-radius:8px;
  font-size:16px;
  cursor:pointer;
  color:#fff;
}
.btn-retry { background-color:#FF6347; }
.btn-next { background-color:#1E90FF; }
.btn-home { background-color:#32CD32; }
#victory-text {
  font-size:30px;
  font-weight:bold;
  color:#FF4500;
  position:fixed;
  top:40%;
  display:none;
  text-align:center;
  animation:grow 0.8s forwards;
}
@keyframes grow {
  0% { transform: scale(0.1); opacity:0; }
  100% { transform: scale(1); opacity:1; }
}
</style>
</head>
<body>

<div class="header">
  <img id="left-img" src="game9_assets/fruit_left.png">
  <h1>華台水果語詞配對–第1回</h1>
  <img id="right-img" src="game9_assets/fruit_right.png">
  <p>tshi̍h 華文抑是台語攏會使，配對成功會有台語聲音檔喔！</p>
  <p class="note">📱 建議直式觀看效果最佳</p>
</div>

<div id="chinese-grid" class="grid-container"></div>
<div id="taiwanese-grid" class="grid-container"></div>

<div class="buttons">
  <button class="btn-retry" id="retry-btn">閣耍一擺</button>
  <button class="btn-next" id="next-btn">後一回</button>
  <button class="btn-home" id="home-btn">轉去遊戲頭頁</button>
</div>

<div id="victory-text">有夠gâu</div>

<script>
// 顏色設定
const successColors = [
  "#FF5733","#FF8C00","#FFD700","#ADFF2F","#32CD32","#00FA9A","#00CED1","#1E90FF",
  "#4169E1","#8A2BE2","#DA70D6","#FF1493","#FF4500","#DC143C","#8B0000","#2F4F4F"
];

let fruits = [];
let selected = [];
let pairsFound = 0;

// 載入 JSON
fetch('game9_assets/fruits_part1.json')
.then(res => res.json())
.then(data => {
  fruits = data.filter((item, idx) => idx !== 14); // 跳過 15.李子/李仔
  setupGrids();
});

function setupGrids() {
  const chineseGrid = document.getElementById('chinese-grid');
  const taiwaneseGrid = document.getElementById('taiwanese-grid');
  chineseGrid.innerHTML = '';
  taiwaneseGrid.innerHTML = '';

  // 上方華語
  fruits.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'grid-item';
    div.textContent = item.name.split('/')[0];
    div.dataset.idx = idx;
    div.dataset.lang = 'chinese';
    div.addEventListener('click', handleClick);
    chineseGrid.appendChild(div);
  });

  // 下方台語
  fruits.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'grid-item';
    div.textContent = item.name.split('/')[1];
    div.dataset.idx = idx;
    div.dataset.lang = 'taiwanese';
    div.addEventListener('click', handleClick);
    taiwaneseGrid.appendChild(div);
  });
}

function handleClick(e) {
  const el = e.currentTarget;
  if (el.classList.contains('selected')) return;

  el.classList.add('selected');
  selected.push(el);

  if (selected.length === 2) {
    const [a, b] = selected;
    if (a.dataset.idx === b.dataset.idx && a.dataset.lang !== b.dataset.lang) {
      // 配對成功
      const color = successColors[parseInt(a.dataset.idx)];
      a.style.backgroundColor = color;
      b.style.backgroundColor = color;

      const audio = new Audio(fruits[a.dataset.idx].audio);
      audio.play();

      pairsFound++;
      selected = [];

      if (pairsFound === fruits.length) {
        setTimeout(() => {
          new Audio('game9_assets/success.mp3').play();
          setTimeout(() => {
            new Audio('game9_assets/victory.mp3').play();
            document.getElementById('victory-text').style.display = 'block';
          },1000);
        },0);
      }
    } else {
      new Audio('game9_assets/wrong.mp3').play();
      setTimeout(() => {
        a.classList.remove('selected');
        b.classList.remove('selected');
        selected = [];
      },500);
    }
  }
}

// 按鈕事件
document.getElementById('retry-btn').addEventListener('click', () => {
  pairsFound = 0;
  selected = [];
  document.getElementById('victory-text').style.display = 'none';
  setupGrids();
});
document.getElementById('next-btn').addEventListener('click', () => {
  alert('後一回功能可連到下一回程式碼');
});
document.getElementById('home-btn').addEventListener('click', () => {
  window.location.href = 'index.html';
});

// 左右水果圖片切換
const leftImages = ['game9_assets/fruit_left.png','game9_assets/fruit_left1.png'];
const rightImages = ['game9_assets/fruit_right.png','game9_assets/fruit_right1.png'];
let leftIndex = 0;
let rightIndex = 0;

setInterval(()=>{
  leftIndex = (leftIndex + 1) % leftImages.length;
  rightIndex = (rightIndex + 1) % rightImages.length;
  document.getElementById('left-img').src = leftImages[leftIndex];
  document.getElementById('right-img').src = rightImages[rightIndex];
},2000);
</script>

</body>
</html>

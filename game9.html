<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8">
  <title>華台水果語詞配對</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background-color: #fef6e4;
      margin: 0;
      padding: 0;
      text-align: center;
    }
    header {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin-top: 20px;
    }
    header img {
      width: 100px;
      height: 100px;
      object-fit: contain;
    }
    h1 {
      color: #ff6b6b;
      font-size: 32px;
      margin: 0;
    }
    p {
      margin: 10px 0 20px;
      font-size: 18px;
      color: #333;
    }
    .container {
      display: flex;
      justify-content: space-around;
      align-items: flex-start;
      margin: 20px auto;
      max-width: 1000px;
    }
    .column {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      width: 45%;
    }
    .item {
      border-radius: 12px;
      padding: 15px 20px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      min-width: 100px;
      text-align: center;
      user-select: none;
    }
    .hua {
      background-color: #ffe066;
      color: #333;
    }
    .tai {
      background-color: #6bcbee;
      color: #fff;
    }
    .item.selected {
      border: 3px solid #ff6b6b;
    }
    .buttons {
      margin: 30px 0;
    }
    .buttons button {
      font-size: 18px;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      margin: 0 10px;
      cursor: pointer;
      font-weight: bold;
    }
    #restart { background-color: #ff922b; color: white; }
    #next { background-color: #51cf66; color: white; }
    #home { background-color: #339af0; color: white; }
  </style>
</head>
<body>
  <header>
    <img id="fruitLeft" alt="左側水果">
    <div>
      <h1>華台水果語詞配對</h1>
      <p>tshi̍h 華文抑是台語攏會使，配對成功會有台語聲音檔喔！</p>
    </div>
    <img id="fruitRight" alt="右側水果">
  </header>

  <div class="container">
    <div id="huaColumn" class="column"></div>
    <div id="taiColumn" class="column"></div>
  </div>

  <div class="buttons">
    <button id="restart">重新開始</button>
    <button id="next">下一部份</button>
    <button id="home">回首頁</button>
  </div>

  <audio id="audioPlayer"></audio>

  <script>
    let data = [];
    let selectedHua = null;
    let selectedTai = null;

    const fruitImagesLeft = ["game9_assets/fruit_left.png", "game9_assets/fruit_left1.png"];
    const fruitImagesRight = ["game9_assets/fruit_right.png", "game9_assets/fruit_right1.png"];

    // 隨機水果圖片
    document.getElementById("fruitLeft").src =
      fruitImagesLeft[Math.floor(Math.random() * fruitImagesLeft.length)];
    document.getElementById("fruitRight").src =
      fruitImagesRight[Math.floor(Math.random() * fruitImagesRight.length)];

    // 載入 JSON
    function loadPart(part) {
      fetch(`game9_assets/fruits_${part}.json`)
        .then(res => res.json())
        .then(json => {
          data = json;
          renderItems();
        })
        .catch(err => console.error("載入失敗:", err));
    }

    // 顯示語詞
    function renderItems() {
      const huaColumn = document.getElementById("huaColumn");
      const taiColumn = document.getElementById("taiColumn");
      huaColumn.innerHTML = "";
      taiColumn.innerHTML = "";

      // 打亂順序
      const huaItems = [...data].sort(() => Math.random() - 0.5);
      const taiItems = [...data].sort(() => Math.random() - 0.5);

      huaItems.forEach(item => {
        const div = document.createElement("div");
        div.className = "item hua";
        div.innerText = item.hua;
        div.onclick = () => selectHua(div, item);
        huaColumn.appendChild(div);
      });

      taiItems.forEach(item => {
        const div = document.createElement("div");
        div.className = "item tai";
        div.innerText = item.tai;
        div.onclick = () => selectTai(div, item);
        taiColumn.appendChild(div);
      });
    }

    function selectHua(div, item) {
      if (selectedHua) selectedHua.element.classList.remove("selected");
      selectedHua = { element: div, data: item };
      div.classList.add("selected");
      checkMatch();
    }

    function selectTai(div, item) {
      if (selectedTai) selectedTai.element.classList.remove("selected");
      selectedTai = { element: div, data: item };
      div.classList.add("selected");
      checkMatch();
    }

    function checkMatch() {
      if (selectedHua && selectedTai) {
        if (selectedHua.data.id === selectedTai.data.id) {
          // 正確配對
          selectedHua.element.style.backgroundColor = "#69db7c";
          selectedTai.element.style.backgroundColor = "#69db7c";
          playAudio(selectedTai.data.audio);
          window.open(selectedTai.data.link, "_blank");
        } else {
          // 錯誤配對
          selectedHua.element.style.backgroundColor = "#ff6b6b";
          selectedTai.element.style.backgroundColor = "#ff6b6b";
        }
        selectedHua = null;
        selectedTai = null;
      }
    }

    function playAudio(url) {
      const player = document.getElementById("audioPlayer");
      player.src = url;
      player.play();
    }

    document.getElementById("restart").onclick = () => renderItems();
    document.getElementById("next").onclick = () => {
      const current = data[0].id <= 6 ? "part2" : "part1";
      loadPart(current);
    };
    document.getElementById("home").onclick = () => {
      window.location.href = "index.html";
    };

    // 預設載入 Part1
    loadPart("part1");
  </script>
</body>
</html>

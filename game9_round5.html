<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>水果骰仔遊戲–第5回</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{
    --roll-btn: #ff6b35;
    --again-btn: #4caf50;
    --next-btn: #2196f3;
    --home-btn: #9c27b0;
    --bg1: #fffbea;
  }
  *{ box-sizing:border-box; }
  body{
    margin:0; min-height:100vh; font-family:"Noto Sans TC","Microsoft JhengHei",sans-serif;
    background:var(--bg1); display:flex; flex-direction:column; align-items:center;
    color:#222;
  }
  header{ text-align:center; padding:14px 10px 4px; width:100%; }
  h1{ margin:0; font-size:6.5vw; color:#d94f4f; line-height:1; }
  .hint{ margin-top:8px; font-size:4.8vw; color:#ff6600; font-weight:700; }

  main{ width:100%; max-width:520px; padding:8px 12px 18px; display:flex; flex-direction:column; align-items:center; gap:8px; flex:1 1 auto; }

  .cube-wrap{ width:100%; display:flex; justify-content:center; align-items:center; }
  .cube-stage{
    width: min(92vw, 420px);
    height: min(92vw, 420px);
    max-width:420px;
    max-height:420px;
    perspective:1200px;
    display:flex; align-items:center; justify-content:center;
  }
  .cube {
    width: var(--cube-size);
    height: var(--cube-size);
    position:relative;
    transform-style:preserve-3d;
    transition: transform 2000ms cubic-bezier(.19,.57,.3,.98);
  }
  .face{
    position:absolute; left:0; top:0;
    width:100%; height:100%;
    border-radius:16px;
    overflow:hidden;
    display:flex; align-items:center; justify-content:center;
    background:#fff; box-shadow: 0 14px 30px rgba(0,0,0,0.12);
    border:5px solid rgba(255,153,51,0.14);
    backface-visibility:hidden;
  }
  .face img{ width:92%; height:92%; object-fit:contain; display:block; border-radius:12px; }

  .face.front  { transform: rotateY(0deg)    translateZ(calc(var(--cube-size) / 2)); }
  .face.back   { transform: rotateY(180deg)  translateZ(calc(var(--cube-size) / 2)); }
  .face.right  { transform: rotateY(90deg)   translateZ(calc(var(--cube-size) / 2)); }
  .face.left   { transform: rotateY(-90deg)  translateZ(calc(var(--cube-size) / 2)); }
  .face.top    { transform: rotateX(90deg)   translateZ(calc(var(--cube-size) / 2)); }
  .face.bottom { transform: rotateX(-90deg)  translateZ(calc(var(--cube-size) / 2)); }

  #result {
    width:100%; min-height:120px; display:flex; flex-direction:column; align-items:center; justify-content:center;
    gap:8px;
  }
  .fruit-name{ font-size:6.5vw; color:#ff4081; font-weight:800; line-height:1; }
  .fruit-roman{ font-size:5vw; color:#009688; font-weight:700; margin-top:4px; }
  .play-audio{
    margin-top:8px; padding:8px 18px; border-radius:12px; border:none; background:#3f51b5; color:#fff; font-weight:700;
    font-size:4.6vw; cursor:pointer;
  }

  .controls{ display:flex; gap:8px; justify-content:center; align-items:center; width:100%; margin-top:6px; }
  #rollBtn{
    background:var(--roll-btn); color:#fff; border:none; border-radius:12px; padding:12px 20px; font-weight:800;
    font-size:5.2vw; cursor:pointer; box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }

  .bottom{ width:100%; padding:12px 10px 22px; display:flex; justify-content:center; gap:10px; }
  .bottom button{ border:none; padding:10px 12px; border-radius:12px; color:#fff; font-weight:800; cursor:pointer; font-size:4.6vw; }
  #againBtn{ background:var(--again-btn) }
  #nextBtn{ background:var(--next-btn) }
  #homeBtn{ background:var(--home-btn) }

  @media(min-width:720px){
    h1{ font-size:28px } .hint{ font-size:16px } .fruit-name{ font-size:28px } .fruit-roman{ font-size:18px }
    #rollBtn{ font-size:16px } .play-audio{ font-size:14px } .bottom button{ font-size:14px }
  }
</style>
</head>
<body>
  <header>
    <h1>水果骰仔遊戲–第5回</h1>
    <div class="hint">📱 建議直式觀看效果最佳</div>
  </header>

  <main>
    <div class="cube-wrap">
      <div class="cube-stage" id="stage">
        <div id="cube" class="cube" aria-hidden="false" role="img" aria-label="果子骰子">
          <div class="face front"><img src="game9_assets/fruit1.png" alt="檨仔"></div>
          <div class="face back"><img src="game9_assets/fruit2.png" alt="柑仔"></div>
          <div class="face right"><img src="game9_assets/fruit3.png" alt="弓蕉"></div>
          <div class="face left"><img src="game9_assets/fruit4.png" alt="林菝仔"></div>
          <div class="face top"><img src="game9_assets/fruit5.png" alt="王梨"></div>
          <div class="face bottom"><img src="game9_assets/fruit6.png" alt="時計果"></div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button id="rollBtn">撚骰仔 🎲</button>
    </div>

    <div id="result">
      <div class="fruit-name" id="fruitName">&nbsp;</div>
      <div class="fruit-roman" id="fruitRoman">&nbsp;</div>
      <button id="playPron" class="play-audio" style="display:none">🔊 聽台語發音</button>
    </div>
  </main>

  <div class="bottom">
    <button id="againBtn">閣耍一擺</button>
    <button id="nextBtn">後一回</button>
    <button id="homeBtn">轉去遊戲頭頁</button>
  </div>

  <audio id="rollSound" preload="auto"></audio>
  <audio id="dingSound" preload="auto"></audio>
  <audio id="fruitSound" preload="auto"></audio>

<script>
const fruits = [
  { name: "檨仔", roman: "suāinn-á", img: "game9_assets/fruit1.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/12/12189.mp3" },
  { name: "柑仔", roman: "kam-á", img: "game9_assets/fruit2.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/5/5084.mp3" },
  { name: "弓蕉", roman: "king-tsio", img: "game9_assets/fruit3.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/0/529.mp3" },
  { name: "林菝仔", roman: "ná-pua̍t-á", img: "game9_assets/fruit4.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/4/4237.mp3" },
  { name: "王梨", roman: "ông-lâi", img: "game9_assets/fruit5.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/1/1260.mp3" },
  { name: "時計果", roman: "sî-kè-kó", img: "game9_assets/fruit6.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/14/14205.mp3" }
];

const faceRotations = [
  { x: 0,   y: 0 },    // front -> fruit1
  { x: 0,   y: 180 },  // back -> fruit2
  { x: 0,   y: 90 },   // right -> fruit3
  { x: 0,   y: -90 },  // left -> fruit4
  { x: -90, y: 0 },    // top -> fruit5
  { x: 90,  y: 0 }     // bottom -> fruit6
];

const cube = document.getElementById('cube');
const rollBtn = document.getElementById('rollBtn');
const fruitNameEl = document.getElementById('fruitName');
const fruitRomanEl = document.getElementById('fruitRoman');
const playPronBtn = document.getElementById('playPron');
const againBtn = document.getElementById('againBtn');
const nextBtn = document.getElementById('nextBtn');
const homeBtn = document.getElementById('homeBtn');
const rollSound = document.getElementById('rollSound');
const dingSound = document.getElementById('dingSound');
const fruitSound = document.getElementById('fruitSound');

let animating = false;
let currentIndex = null;
let currentX = 0, currentY = 0;

function setAudioWithFallback(el, candidates){
  if(!Array.isArray(candidates)) candidates=[candidates];
  let i=0;
  function trySet(){ el.src=candidates[i]; el.load(); }
  el.onerror=function(){ i++; if(i<candidates.length) trySet(); else console.warn('audio failed', candidates); };
  trySet();
}

setAudioWithFallback(rollSound, ['game9_assets/Roll_the_dice.mp3']);
setAudioWithFallback(dingSound, ['game9_assets/ding.mp3']);

function updateCubeSize(){
  const maxW = Math.min(window.innerWidth*0.92, 320);
  const maxH = Math.min(window.innerHeight*0.48, 320);
  const size = Math.floor(Math.min(maxW, maxH));
  cube.style.setProperty('--cube-size', size+'px');
}
window.addEventListener('resize', updateCubeSize);
window.addEventListener('orientationchange', updateCubeSize);
updateCubeSize();

function rollDice(){
  if(animating) return;
  animating=true;
  fruitNameEl.textContent='';
  fruitRomanEl.textContent='';
  playPronBtn.style.display='none';
  currentIndex=null;

  const chosen = Math.floor(Math.random()*faceRotations.length);
  currentIndex=chosen;
  const base=faceRotations[chosen];
  const extrasX=360*(3+Math.floor(Math.random()*3));
  const extrasY=360*(3+Math.floor(Math.random()*3));
  currentX+=extrasX+base.x;
  currentY+=extrasY+base.y;

  try { rollSound.loop=true; rollSound.currentTime=0; rollSound.play().catch(()=>{}); } catch(e){}

  cube.style.transition='transform 2000ms cubic-bezier(.19,.57,.3,.98)';
  const preX=360*(1+Math.floor(Math.random()*1));
  const preY=360*(1+Math.floor(Math.random()*1));
  cube.style.transform=`rotateX(${preX}deg) rotateY(${preY}deg)`;
  setTimeout(()=>{ cube.style.transform=`rotateX(${currentX}deg) rotateY(${currentY}deg)`; }, 60);

  setTimeout(()=>{
    try { rollSound.loop=false; rollSound.pause(); rollSound.currentTime=0; } catch(e){}
    try { dingSound.currentTime=0; dingSound.play().catch(()=>{}); } catch(e){}
    const f=fruits[chosen];
    fruitNameEl.textContent=f.name;
    fruitRomanEl.textContent=f.roman;
    playPronBtn.style.display='inline-block';
    fruitSound.src=f.audio;
    animating=false;
  }, 2000+80);
}

playPronBtn.addEventListener('click', ()=>{
  if(currentIndex===null) return;
  try{ fruitSound.currentTime=0; fruitSound.play().catch(()=>{}); } catch(e){}
});

rollBtn.addEventListener('click', rollDice);
againBtn.addEventListener('click', ()=>{ rollDice(); });
nextBtn.addEventListener('click', ()=>{ window.location.href='game9_round2.html'; });
homeBtn.addEventListener('click', ()=>{ window.location.href='index.html'; });

document.querySelectorAll('.face img').forEach(img=>{ img.onerror=()=>{ console.warn('Missing image:', img.src); img.style.opacity=0.2; }; });
</script>
</body>
</html>

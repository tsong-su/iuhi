<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>果子骰仔遊戲-第1回</title>
<style>
  body {
    font-family: "Microsoft JhengHei", sans-serif;
    text-align: center;
    background: #fff8f0;
    margin: 0;
    padding: 0;
  }
  h1 {
    margin: 15px 0;
    color: #d35400;
  }
  .scene {
    width: 240px;
    height: 240px;
    margin: 20px auto;
    perspective: 1000px;
  }
  .cube {
    width: 100%;
    height: 100%;
    position: relative;
    transform-style: preserve-3d;
  }
  .face {
    position: absolute;
    width: 240px;
    height: 240px;
    border: 4px solid #d35400;
    border-radius: 20px;
    background: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .face img {
    width: 200px;
    height: 200px;
    border-radius: 15px;
  }
  .front  { transform: rotateY(   0deg) translateZ(120px); }
  .back   { transform: rotateY( 180deg) translateZ(120px); }
  .right  { transform: rotateY(  90deg) translateZ(120px); }
  .left   { transform: rotateY( -90deg) translateZ(120px); }
  .top    { transform: rotateX(  90deg) translateZ(120px); }
  .bottom { transform: rotateX( -90deg) translateZ(120px); }

  button {
    margin: 8px;
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    background: #e67e22;
    color: #fff;
    font-size: 16px;
    cursor: pointer;
  }
  button:hover {
    background: #d35400;
  }
  #result {
    margin-top: 15px;
    font-size: 20px;
    color: #2c3e50;
  }
</style>
</head>
<body>
<h1>果子骰仔遊戲-第1回</h1>

<div class="scene">
  <div class="cube" id="cube">
    <div class="face front"><img src="fruit1.png" alt="檨仔"></div>
    <div class="face back"><img src="fruit2.png" alt="柑仔"></div>
    <div class="face right"><img src="fruit3.png" alt="弓蕉"></div>
    <div class="face left"><img src="fruit4.png" alt="林菝仔"></div>
    <div class="face top"><img src="fruit5.png" alt="王梨"></div>
    <div class="face bottom"><img src="fruit6.png" alt="時計果"></div>
  </div>
</div>

<button id="rollBtn">🎲 擲骰子</button>
<button id="playPron" style="display:none;">🔊 播放發音</button>
<div id="result">
  <div id="fruitName"></div>
  <div id="fruitRoman"></div>
</div>
<br>
<button onclick="location.href='game9_round2.html'">後一回</button>
<button onclick="location.href='index.html'">回首頁</button>

<audio id="rollSound" src="Roll_the_dice.mp3" preload="auto"></audio>
<audio id="dingSound" src="ding.mp3" preload="auto"></audio>
<audio id="fruitSound" preload="auto"></audio>

<script>
const fruits = [
  { name:"檨仔", roman:"suāinn-á", audio:"https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/12/12189.mp3" },
  { name:"柑仔", roman:"kam-á", audio:"https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/5/5084.mp3" },
  { name:"弓蕉", roman:"king-tsio", audio:"https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/0/529.mp3" },
  { name:"林菝仔", roman:"ná-pua̍t-á", audio:"https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/4/4237.mp3" },
  { name:"王梨", roman:"ông-lâi", audio:"https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/1/1260.mp3" },
  { name:"時計果", roman:"sî-kè-kó", audio:"https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/14/14205.mp3" }
];

// 每個面固定角度 (對應上面 HTML cube 的 6 個 face)
const faceRotations = [
  {x:0,   y:0},    // front → 檨仔
  {x:0,   y:180},  // back  → 柑仔
  {x:0,   y:-90},  // right → 弓蕉
  {x:0,   y:90},   // left  → 林菝仔
  {x:-90, y:0},    // top   → 王梨
  {x:90,  y:0}     // bottom→ 時計果
];

const cube = document.getElementById('cube');
const rollBtn = document.getElementById('rollBtn');
const fruitNameEl = document.getElementById('fruitName');
const fruitRomanEl = document.getElementById('fruitRoman');
const playPronBtn = document.getElementById('playPron');
const rollSound = document.getElementById('rollSound');
const dingSound = document.getElementById('dingSound');
const fruitSound = document.getElementById('fruitSound');

let animating = false;
let currentIndex = null;
let currentX = 0, currentY = 0;

// 建立洗牌陣列，確保每6次出現一次完整
let sequence = [];
function refillSequence(){
  sequence = [0,1,2,3,4,5];
  for (let i=sequence.length-1; i>0; i--){
    const j = Math.floor(Math.random()*(i+1));
    [sequence[i], sequence[j]] = [sequence[j], sequence[i]];
  }
}
refillSequence();

function rollDice(){
  if(animating) return;
  animating = true;
  fruitNameEl.textContent = "";
  fruitRomanEl.textContent = "";
  playPronBtn.style.display = "none";
  currentIndex = null;

  rollSound.currentTime = 0;
  rollSound.loop = true;
  rollSound.play().catch(()=>{});

  // 從序列取下一個值
  if(sequence.length === 0) refillSequence();
  const chosen = sequence.pop();
  currentIndex = chosen;

  const base = faceRotations[chosen];
  const extraX = 360*(3+Math.floor(Math.random()*2));
  const extraY = 360*(3+Math.floor(Math.random()*2));
  currentX += extraX + base.x;
  currentY += extraY + base.y;

  cube.style.transition = "transform 2s cubic-bezier(.19,.57,.3,.98)";
  cube.style.transform = `rotateX(${currentX}deg) rotateY(${currentY}deg)`;

  setTimeout(()=>{
    rollSound.loop=false; rollSound.pause();
    dingSound.currentTime=0; dingSound.play().catch(()=>{});

    const f = fruits[chosen];
    fruitNameEl.textContent = f.name;
    fruitRomanEl.textContent = f.roman;
    playPronBtn.style.display = "inline-block";
    fruitSound.src = f.audio;

    animating = false;
  }, 2000);
}

rollBtn.addEventListener('click', rollDice);
playPronBtn.addEventListener('click', ()=>{
  if(currentIndex===null) return;
  fruitSound.currentTime=0; fruitSound.play().catch(()=>{});
});
</script>
</body>
</html>

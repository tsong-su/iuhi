<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>水果骰子遊戲 – 第1回</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --accent:#ff6b35;     /* 擲骰子按鈕 */
    --btn-again:#4caf50;  /* 閣耍一擺 */
    --btn-next:#2196f3;   /* 後一回 */
    --btn-home:#9c27b0;   /* 轉頭頁 */
    --bg1: #fff8f0;
    --bg2: #fff1f8;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    min-height:100vh;
    font-family:"Noto Sans TC","Microsoft JhengHei",sans-serif;
    background: linear-gradient(180deg,var(--bg1),var(--bg2));
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:flex-start;
    color:#222;
    -webkit-font-smoothing:antialiased;
  }

  header{
    width:100%;
    padding:14px 16px 6px;
    text-align:center;
  }
  h1{
    margin:0;
    font-size:5.8vw; /* responsive */
    color:#d94f4f;
    line-height:1;
    font-weight:700;
  }
  .hint{
    margin-top:8px;
    font-size:4.8vw; /* 放大、醒目 */
    color:#ff6600;
    font-weight:700;
  }

  /* 中央區塊：讓骰子更滿版 */
  main{
    width:100%;
    max-width:520px;
    padding:10px 18px 18px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:12px;
    flex:1 1 auto;
  }

  /* cube wrapper - size controlled by JS via --cube-size */
  .cube-wrap{
    width: min(92vw, 420px);
    height: min(92vw, 420px);
    max-width: 420px;
    max-height: 420px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .stage{
    width:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
  }

  /* cube (3D) */
  .cube-container{
    --cube-size: 320px; /* overwritten by JS */
    width: var(--cube-size);
    height: var(--cube-size);
    perspective: 1200px;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .cube{
    width:100%;
    height:100%;
    position:relative;
    transform-style:preserve-3d;
    transition: transform 2500ms cubic-bezier(.19,.57,.3,.98);
  }

  .face{
    position:absolute;
    width:100%;
    height:100%;
    left:0; top:0;
    border-radius:16px;
    overflow:hidden;
    display:flex;
    align-items:center;
    justify-content:center;
    background:#fff;
    box-shadow: 0 12px 30px rgba(0,0,0,0.12);
    border:6px solid rgba(255,153,51,0.18);
    backface-visibility:hidden;
  }

  .face img{
    width:92%;
    height:92%;
    object-fit:contain;
    border-radius:12px;
    display:block;
  }

  /* position faces at translateZ(half cube) */
  .face.front  { transform: rotateY(0deg)    translateZ(calc(var(--cube-size) / 2)); }
  .face.back   { transform: rotateY(180deg)  translateZ(calc(var(--cube-size) / 2)); }
  .face.right  { transform: rotateY(90deg)   translateZ(calc(var(--cube-size) / 2)); }
  .face.left   { transform: rotateY(-90deg)  translateZ(calc(var(--cube-size) / 2)); }
  .face.top    { transform: rotateX(90deg)   translateZ(calc(var(--cube-size) / 2)); }
  .face.bottom { transform: rotateX(-90deg)  translateZ(calc(var(--cube-size) / 2)); }

  /* result texts */
  .name {
    font-size:6.5vw;
    font-weight:800;
    color:#ff4081;
    line-height:1;
  }
  .pinyin {
    font-size:4.5vw;
    font-weight:700;
    color:#009688;
    margin-top:4px;
  }

  /* buttons */
  .controls { margin-top:10px; display:flex; gap:10px; justify-content:center; align-items:center; flex-wrap:wrap }
  .btn-roll{
    background:var(--accent);
    border:none; color:#fff; padding:12px 22px; border-radius:12px;
    font-size:4.8vw; font-weight:700; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,0.12);
  }
  .btn-roll:active{ transform:translateY(1px) }

  .footer{
    width:100%;
    padding:10px 16px 18px;
    display:flex;
    justify-content:center;
    gap:12px;
    align-items:center;
  }
  .footer button{
    border: none; color:#fff; padding:10px 14px; border-radius:12px; font-size:4.8vw; font-weight:700; cursor:pointer;
    box-shadow:0 6px 18px rgba(0,0,0,0.12);
  }
  #againBtn{ background:var(--btn-again) }
  #nextBtn { background:var(--btn-next) }
  #homeBtn { background:var(--btn-home) }

  /* Play audio button small */
  .play-audio{
    margin-top:8px;
    background:#0066cc; color:white; border:none; padding:8px 12px; border-radius:10px; font-size:4.2vw; font-weight:700;
  }

  /* Responsive tweaks for larger screens */
  @media(min-width:720px){
    h1{ font-size:28px }
    .hint{ font-size:18px }
    .name{ font-size:28px }
    .pinyin{ font-size:18px }
    .btn-roll{ font-size:16px; padding:12px 24px }
    .footer button{ font-size:14px }
  }
</style>
</head>
<body>
  <header>
    <h1>水果骰子遊戲 – 第1回</h1>
    <div class="hint">📱 建議直式觀看效果最佳</div>
  </header>

  <main>
    <div class="stage">
      <div class="cube-wrap">
        <div class="cube-container" id="cubeContainer" aria-hidden="false">
          <div id="cube" class="cube" role="img" aria-label="果子骰子">
            <div class="face front"><img src="game9_assets/fruit1.png" alt="檨仔"></div>
            <div class="face back"><img src="game9_assets/fruit2.png" alt="柑仔"></div>
            <div class="face right"><img src="game9_assets/fruit3.png" alt="弓蕉"></div>
            <div class="face left"><img src="game9_assets/fruit4.png" alt="林菝仔"></div>
            <div class="face top"><img src="game9_assets/fruit5.png" alt="王梨"></div>
            <div class="face bottom"><img src="game9_assets/fruit6.png" alt="時計果"></div>
          </div>
        </div>

        <div id="display">
          <div class="name" id="fruitName">按「擲骰子」開始</div>
          <div class="pinyin" id="fruitPinyin">&nbsp;</div>
          <button id="playPron" class="play-audio" style="display:none">🔊 播放台語發音</button>
        </div>

      </div>

      <div class="controls">
        <button id="rollBtn" class="btn-roll">🎲 擲骰子</button>
      </div>
    </div>
  </main>

  <div class="footer">
    <button id="againBtn">閣耍一擺</button>
    <button id="nextBtn">後一回</button>
    <button id="homeBtn">轉去遊戲頭頁</button>
  </div>

  <!-- 音: 我會嘗試兩個常見檔名備援 -->
  <audio id="rollSound"></audio>
  <audio id="dingSound"></audio>
  <audio id="fruitSound"></audio>

<script>
/* ---------- Data for round1 (6 faces) ---------- */
const fruits = [
  { name: "檨仔", roman: "suāinn-á", img: "game9_assets/fruit1.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/12/12189.mp3" },
  { name: "柑仔", roman: "kam-á",   img: "game9_assets/fruit2.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/5/5084.mp3" },
  { name: "弓蕉", roman: "king-tsio",img: "game9_assets/fruit3.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/0/529.mp3" },
  { name: "林菝仔",roman: "ná-pua̍t-á",img:"game9_assets/fruit4.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/4/4237.mp3" },
  { name: "王梨", roman: "ông-lâi", img: "game9_assets/fruit5.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/1/1260.mp3" },
  { name: "時計果",roman: "sî-kè-kó",img: "game9_assets/fruit6.png", audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/14/14205.mp3" }
];

/* ---------- DOM ---------- */
const cube = document.getElementById('cube');
const cubeContainer = document.getElementById('cubeContainer');
const rollBtn = document.getElementById('rollBtn');
const againBtn = document.getElementById('againBtn');
const nextBtn = document.getElementById('nextBtn');
const homeBtn = document.getElementById('homeBtn');
const fruitNameEl = document.getElementById('fruitName');
const fruitPinyinEl = document.getElementById('fruitPinyin');
const playPronBtn = document.getElementById('playPron');
const rollSound = document.getElementById('rollSound');
const dingSound = document.getElementById('dingSound');
const fruitSound = document.getElementById('fruitSound');

let animating = false;
let currentIndex = null;

/* ---------- audio src fallback helper ---------- */
function setAudioWithFallback(audioEl, candidates){
  if(!Array.isArray(candidates)) candidates = [candidates];
  // try first candidate
  audioEl.src = candidates[0];
  // attach error handler to try next if fails to load/play
  let tried = 0;
  audioEl.onerror = () => {
    tried++;
    if(tried < candidates.length){
      audioEl.src = candidates[tried];
      // try to load next
      audioEl.load();
    } else {
      console.warn('audio load failed for all candidates', candidates);
    }
  };
}

/* set roll and ding audio with likely filenames */
setAudioWithFallback(rollSound, [
  'game9_assets/Roll_the_dice.mp3',
  'game9_assets/Roll the dice.mp3',
  'game9_assets/RollTheDice.mp3',
  'game9_assets/Roll the Dice.mp3'
]);
setAudioWithFallback(dingSound, [
  'game9_assets/ding.mp3',
  'game9_assets/ding_sound.mp3'
]);

/* ---------- cube size responsive ---------- */
function updateCubeSize(){
  // prefer large on vertical phones: use 78vh capped by 420px, but also not overflow
  const vw = Math.min(window.innerWidth, window.innerHeight);
  const prefer = Math.min(window.innerWidth * 0.92, window.innerHeight * 0.62, 460);
  cubeContainer.style.setProperty('--cube-size', prefer + 'px');
}
window.addEventListener('resize', updateCubeSize);
updateCubeSize();

/* mapping face -> base rotation (so that face faces front) */
const faceRotations = [
  { x: 0,   y: 0   },  // front  (fruit1)
  { x: 0,   y: 180 },  // back   (fruit2)
  { x: 0,   y: 90  },  // right  (fruit3)
  { x: 0,   y: -90 },  // left   (fruit4)
  { x: -90, y: 0   },  // top    (fruit5)
  { x: 90,  y: 0   }   // bottom (fruit6)
];

/* roll logic: rotate many turns then land on chosen face */
function rollDice(){
  if(animating) return;
  animating = true;
  fruitNameEl.textContent = '...';
  fruitPinyinEl.textContent = '';
  playPronBtn.style.display = 'none';

  // choose result index first
  const chosen = Math.floor(Math.random() * fruits.length);
  currentIndex = chosen;
  const base = faceRotations[chosen];

  // random extra spins
  const extraX = 360 * (3 + Math.floor(Math.random()*3)); // 3-5 full X turns
  const extraY = 360 * (3 + Math.floor(Math.random()*3)); // 3-5 full Y turns

  // final rotation = extra + base rotation. Use sign to keep orientation natural.
  const finalX = extraX + base.x;
  const finalY = extraY + base.y;

  // start roll sound (loop the roll sound while animating if possible)
  try{
    rollSound.currentTime = 0;
    // attempt to loop while animating by setInterval fallback if file short
    rollSound.play().catch((e)=>{
      console.warn('rollSound play blocked', e);
    });
  }catch(e){ console.warn(e) }

  // apply transform (animation duration 2500ms via CSS)
  cube.style.transition = 'transform 2500ms cubic-bezier(.19,.57,.3,.98)';
  // slightly random initial push to feel more real
  const preX = 360 * (1 + Math.floor(Math.random()*2));
  const preY = 360 * (1 + Math.floor(Math.random()*2));
  cube.style.transform = `rotateX(${preX}deg) rotateY(${preY}deg)`;

  // after small delay, set final rotation so there is visible continuous motion
  setTimeout(()=> {
    cube.style.transform = `rotateX(${finalX}deg) rotateY(${finalY}deg)`;
  }, 60);

  // stop rollSound after animation ends and play ding, show result
  setTimeout(()=> {
    try { rollSound.pause(); rollSound.currentTime = 0; } catch(e){}
    // ding
    try { dingSound.currentTime = 0; dingSound.play().catch(()=>{}); } catch(e){}
    // update shown name/pinyin and enable play button
    const f = fruits[chosen];
    fruitNameEl.textContent = f.name;
    fruitPinyinEl.textContent = f.roman;
    playPronBtn.style.display = 'inline-block';
    // set fruitSound source (use given URL)
    fruitSound.src = f.audio;
    animating = false;
  }, 2500 + 80);
}

/* play pronunciation */
playPronBtn.addEventListener('click', ()=>{
  if(!currentIndex && currentIndex !== 0){
    // no fruit selected
    return;
  }
  try{
    fruitSound.currentTime = 0;
    fruitSound.play().catch((e)=>{
      console.warn('fruitSound play blocked', e);
    });
  }catch(e){ console.warn(e) }
});

/* wire up controls */
rollBtn.addEventListener('click', rollDice);
againBtn.addEventListener('click', rollDice);
nextBtn.addEventListener('click', ()=>{ window.location.href = 'game9_round2.html'; });
homeBtn.addEventListener('click', ()=>{ window.location.href = 'index.html'; });

/* init: show faces images (already in HTML), set placeholder size on load */
window.addEventListener('load', ()=>{
  updateCubeSize();
  // initial face forward
  cube.style.transform = 'rotateX(0deg) rotateY(0deg)';
  fruitNameEl.textContent = '按「擲骰子」開始';
  fruitPinyinEl.textContent = '';
});
</script>
</body>
</html>

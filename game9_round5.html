<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>æœå­éª°å­éŠæˆ² â€“ ç¬¬1å›</title>
<style>
  :root{
    --bg1:#fff8ec; --bg2:#ffecd2;
    --accent:#ff6b35; --muted:#6b6b6b;
    --card:#ffffff;
  }
  html,body{height:100%;margin:0;font-family:"Noto Sans TC","Microsoft JhengHei",sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));-webkit-font-smoothing:antialiased}
  .wrap{max-width:980px;margin:18px auto;padding:16px}
  header{display:flex;align-items:center;gap:12px}
  h1{margin:0;color:var(--accent);font-size:20px}
  #rules{margin-top:12px;background:rgba(255,255,255,0.85);padding:10px;border-radius:10px;color:var(--muted);font-size:14px}
  .stage{display:flex;gap:18px;align-items:flex-start;margin-top:18px;flex-wrap:wrap}
  /* dice area */
  #diceWrap{flex:1;min-width:260px;display:flex;flex-direction:column;align-items:center;gap:12px}
  /* 3D-like container */
  #diceContainer{width:260px;height:260px;perspective:1400px;display:flex;align-items:center;justify-content:center}
  .dice3d{
    width:100%;height:100%;border-radius:14px;background:linear-gradient(180deg,#fff,#fffef8);
    box-shadow:0 10px 30px rgba(0,0,0,0.12);display:flex;align-items:center;justify-content:center;
    transform-style:preserve-3d;transition:transform 900ms cubic-bezier(.2,.9,.3,1);
    position:relative;overflow:hidden;
  }
  /* during rolling we add a classname .rolling to animate jitter */
  .dice3d.rolling{animation:roll-jitter 1000ms linear}
  @keyframes roll-jitter{
    0%{transform:rotateX(0) rotateY(0) rotateZ(0)}
    25%{transform:rotateX(360deg) rotateY(180deg) rotateZ(20deg)}
    50%{transform:rotateX(720deg) rotateY(360deg) rotateZ(-18deg)}
    75%{transform:rotateX(1080deg) rotateY(540deg) rotateZ(12deg)}
    100%{transform:rotateX(1440deg) rotateY(720deg) rotateZ(0)}
  }

  /* visible face (we will inject SVG stamp into this) */
  .faceView{width:92%;height:92%;display:flex;align-items:center;justify-content:center}
  .stamp-svg{width:100%;height:100%;display:block}

  /* controls */
  .controls{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;font-weight:700;cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
  button.secondary{background:#fff;color:var(--accent);border:1px solid #ffd1b8}
  button:active{transform:translateY(1px)}
  .infoBox{flex:1;min-width:260px;background:var(--card);padding:12px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.04)}
  .fruitName{font-size:18px;margin:0;color:#333;font-weight:700}
  .fruitTai{margin:6px 0 0 0;color:#666}
  .playPron{margin-top:10px;display:flex;gap:8px;align-items:center}
  .smallNote{margin-top:10px;color:#666;font-size:13px}
  footer{margin-top:18px;color:#666;font-size:13px;text-align:center}

/* responsive */
@media (max-width:720px){
  #diceContainer{width:200px;height:200px}
  .dice3d{border-radius:10px}
  .infoBox{order:3}
  .stage{flex-direction:column;align-items:center}
}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>æœå­éª°å­éŠæˆ² â€“ ç¬¬1å›</h1>
    </header>

    <div id="rules">
      <strong>ç©æ³•ç°¡è¿°ï¼š</strong> æŒ‰ã€Œæ’šéª°å­ã€â†’ æœƒå‡ºç¾ä¸€å€‹éš¨æ©Ÿæœå­ï¼ˆ1â€“34ï¼‰ä¸¦é¡¯ç¤ºåœ–ç‰‡ã€ä¸­æ–‡åèˆ‡å°èªåã€‚æŒ‰ã€ŒğŸ”Š æ’­æ”¾å°èªã€å¯è½è©²æœå­çš„å°èªç™¼éŸ³ã€‚æ“²éª°åŒæ™‚æœƒæ’­æ”¾æ»¾å‹•éŸ³æ•ˆï¼Œåœæ­¢æ™‚æ’­æ”¾æç¤ºéŸ³ã€‚
    </div>

    <div class="stage">
      <div id="diceWrap">
        <div id="diceContainer" aria-hidden="false">
          <div id="dice" class="dice3d" role="img" aria-label="æœå­éª°å­">
            <div class="faceView" id="faceView">
              <!-- SVG stamp injected here -->
            </div>
          </div>
        </div>

        <div class="controls" style="margin-top:4px">
          <button id="rollBtn">æ’šéª°å­ ğŸ²</button>
          <button id="pronBtn" class="secondary" style="display:none">ğŸ”Š æ’­æ”¾å°èª</button>
        </div>
      </div>

      <div class="infoBox" id="infoBox" aria-live="polite">
        <p class="fruitName" id="fruitCn">â€”</p>
        <p class="fruitTai" id="fruitTw">â€”</p>
        <div class="playPron" id="playPron" style="display:none">
          <button id="playAudio" class="secondary">ğŸ”Š æ’­æ”¾å°èªç™¼éŸ³</button>
          <div style="font-size:13px;color:#777">ï¼ˆæŒ‰éˆ•æ’­æ”¾æ‚¨æ”¾åœ¨ game9_assets çš„å°æ‡‰æª”æ¡ˆï¼‰</div>
        </div>
        <p class="smallNote">èªªå‡ºå°èªåç¨±ï¼Œè®“å­¸ç¿’è®Šæœ‰è¶£ ğŸ˜Š</p>
      </div>
    </div>

    <footer>åœ–ç‰‡èˆ‡éŸ³æª”ä¾†æºï¼šgame9_assetsï¼ˆfruit1â€“fruit34.png / fruit1â€“fruit34.mp3ï¼‰ã€‚</footer>
  </div>

<script>
/* ---------------------------
  è³‡æ–™ï¼š1..34 å°æ‡‰ ä¸­æ–‡ + å°èª
  ä½¿ç”¨è€…æä¾›å°ç…§è¡¨ï¼Œé¡¯ç¤ºæ™‚ä¸é¡¯ç¤ºç·¨è™Ÿ
----------------------------*/
const FRUITS = [
  {id:1, cn:"èŠ’æœ", tw:"æª¨ä»”", img:"game9_assets/fruit1.png", audio:"game9_assets/fruit1.mp3"},
  {id:2, cn:"æ©˜å­", tw:"æŸ‘ä»”", img:"game9_assets/fruit2.png", audio:"game9_assets/fruit2.mp3"},
  {id:3, cn:"é¦™è•‰", tw:"å¼“è•‰", img:"game9_assets/fruit3.png", audio:"game9_assets/fruit3.mp3"},
  {id:4, cn:"ç•ªçŸ³æ¦´", tw:"æ—èä»”", img:"game9_assets/fruit4.png", audio:"game9_assets/fruit4.mp3"},
  {id:5, cn:"é³³æ¢¨", tw:"ç‹æ¢¨", img:"game9_assets/fruit5.png", audio:"game9_assets/fruit5.mp3"},
  {id:6, cn:"ç™¾é¦™æœ", tw:"æ™‚è¨ˆæœ", img:"game9_assets/fruit6.png", audio:"game9_assets/fruit6.mp3"},
  {id:7, cn:"é¦™ç“œ", tw:"èŠ³ç“œ", img:"game9_assets/fruit7.png", audio:"game9_assets/fruit7.mp3"},
  {id:8, cn:"è‘¡è„", tw:"è‘¡è„", img:"game9_assets/fruit8.png", audio:"game9_assets/fruit8.mp3"},
  {id:9, cn:"è“®éœ§", tw:"è“®éœ§", img:"game9_assets/fruit9.png", audio:"game9_assets/fruit9.mp3"},
  {id:10, cn:"æŸ³ä¸", tw:"æŸ³ä¸", img:"game9_assets/fruit10.png", audio:"game9_assets/fruit10.mp3"},
  {id:11, cn:"æœ¨ç“œ", tw:"æœ¨ç“œ", img:"game9_assets/fruit11.png", audio:"game9_assets/fruit11.mp3"},
  {id:12, cn:"æ¢¨å­", tw:"æ¢¨ä»”", img:"game9_assets/fruit12.png", audio:"game9_assets/fruit12.mp3"},
  {id:13, cn:"æ£—å­", tw:"æ£—ä»”", img:"game9_assets/fruit13.png", audio:"game9_assets/fruit13.mp3"},
  {id:14, cn:"æŸšå­", tw:"æŸšä»”", img:"game9_assets/fruit14.png", audio:"game9_assets/fruit14.mp3"},
  {id:15, cn:"æå­", tw:"æä»”", img:"game9_assets/fruit15.png", audio:"game9_assets/fruit15.mp3"},
  {id:16, cn:"æŸ¿å­", tw:"æŸ¿ä»”", img:"game9_assets/fruit16.png", audio:"game9_assets/fruit16.mp3"},
  {id:17, cn:"è”æ", tw:"è”æ", img:"game9_assets/fruit17.png", audio:"game9_assets/fruit17.mp3"},
  {id:18, cn:"é¾çœ¼", tw:"é¾çœ¼", img:"game9_assets/fruit18.png", audio:"game9_assets/fruit18.mp3"},
  {id:19, cn:"é‡‹è¿¦", tw:"é‡‹è¿¦", img:"game9_assets/fruit19.png", audio:"game9_assets/fruit19.mp3"},
  {id:20, cn:"è‰è“", tw:"è‰è“", img:"game9_assets/fruit20.png", audio:"game9_assets/fruit20.mp3"},
  {id:21, cn:"æ«»æ¡ƒ", tw:"æ«»æ¡ƒ", img:"game9_assets/fruit21.png", audio:"game9_assets/fruit21.mp3"},
  {id:22, cn:"æ°´èœœæ¡ƒ", tw:"æ°´èœœæ¡ƒ", img:"game9_assets/fruit22.png", audio:"game9_assets/fruit22.mp3"},
  {id:23, cn:"è¥¿ç“œ", tw:"è¥¿ç“œ", img:"game9_assets/fruit23.png", audio:"game9_assets/fruit23.mp3"},
  {id:24, cn:"æ‡æ·", tw:"æ‡æ·", img:"game9_assets/fruit24.png", audio:"game9_assets/fruit24.mp3"},
  {id:25, cn:"æª¸æª¬", tw:"æª¸æª¬", img:"game9_assets/fruit25.png", audio:"game9_assets/fruit25.mp3"},
  {id:26, cn:"è˜‹æœ", tw:"è˜‹æœ", img:"game9_assets/fruit26.png", audio:"game9_assets/fruit26.mp3"},
  {id:27, cn:"æ¥Šæ¡ƒ", tw:"æ¥Šæ¡ƒ", img:"game9_assets/fruit27.png", audio:"game9_assets/fruit27.mp3"},
  {id:28, cn:"çŸ³æ¦´", tw:"çŸ³æ¦´", img:"game9_assets/fruit28.png", audio:"game9_assets/fruit28.mp3"},
  {id:29, cn:"æ¦´æ§¤", tw:"æ¦´æ§¤", img:"game9_assets/fruit29.png", audio:"game9_assets/fruit29.mp3"},
  {id:30, cn:"é³¥æ¢¨", tw:"é³¥æ¢¨ä»”", img:"game9_assets/fruit30.png", audio:"game9_assets/fruit30.mp3"},
  {id:31, cn:"é‡‘æ¡”", tw:"é‡‘æ¡”ä»”", img:"game9_assets/fruit31.png", audio:"game9_assets/fruit31.mp3"},
  {id:32, cn:"é»‘çç ", tw:"çƒçœŸç ", img:"game9_assets/fruit32.png", audio:"game9_assets/fruit32.mp3"},
  {id:33, cn:"ä»™æ¡ƒ", tw:"ä»™æ¡ƒ", img:"game9_assets/fruit33.png", audio:"game9_assets/fruit33.mp3"},
  {id:34, cn:"ç•ªèŒ„", tw:"è‡­æŸ¿ä»”", img:"game9_assets/fruit34.png", audio:"game9_assets/fruit34.mp3"},
];

/* DOM refs */
const rollBtn = document.getElementById('rollBtn');
const pronBtn = document.getElementById('pronBtn');
const faceView = document.getElementById('faceView');
const fruitCn = document.getElementById('fruitCn');
const fruitTw = document.getElementById('fruitTw');
const playAudioBtn = document.getElementById('playAudio');
const playPronBox = document.getElementById('playPron');

const rollSound = new Audio('game9_assets/Roll the dice.mp3');
const dingSound = new Audio('game9_assets/ding.mp3');

let rolling = false;
let currentIndex = null;

/* Helper: create SVG stamp markup for a given image URL */
function createStampSVG(imgUrl){
  // We'll embed a mask with perforation holes around edge
  const holes = [];
  const holeCount = 36;
  for(let i=0;i<holeCount;i++){
    const angle = i * (360 / holeCount) * Math.PI/180;
    const r = 86;
    const cx = 100 + Math.round(r * Math.cos(angle));
    const cy = 100 + Math.round(r * Math.sin(angle));
    holes.push(`<circle cx="${cx}" cy="${cy}" r="3.6" fill="black" />`);
  }
  return `
    <svg class="stamp-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" role="img" aria-label="æœå­åœ–ç‰‡">
      <defs>
        <mask id="perfMask">
          <rect width="200" height="200" fill="white" />
          ${holes.join('')}
        </mask>
      </defs>
      <rect x="0" y="0" width="200" height="200" fill="#fff" rx="8" ry="8"/>
      <image href="${imgUrl}" x="10" y="10" width="180" height="180" preserveAspectRatio="xMidYMid slice" mask="url(#perfMask)"></image>
      <rect x="10" y="10" width="180" height="180" fill="none" stroke="rgba(0,0,0,0.06)" rx="6" ry="6"/>
    </svg>
  `;
}

/* roll animation: we will simulate continuous rolling by rapidly changing random images,
   and simultaneously apply the CSS .rolling jitter. After duration, stop and pick final index. */
function rollAnimation(duration = 1200){
  if(rolling) return;
  rolling = true;
  rollBtn.disabled = true;
  pronBtn.style.display = 'none';
  playPronBox.style.display = 'none';
  fruitCn.textContent = '...';
  fruitTw.textContent = '';

  const diceEl = document.getElementById('dice');
  diceEl.classList.add('rolling');

  rollSound.currentTime = 0;
  rollSound.play().catch(()=>{ /* ignore autoplay blocks */ });

  const intervalMs = 70;
  let elapsed = 0;
  let lastIdx = null;
  const iv = setInterval(()=>{
    // show quick random thumb (no mask heavy work)
    const idx = Math.floor(Math.random() * FRUITS.length);
    lastIdx = idx;
    faceView.innerHTML = createStampSVG(FRUITS[idx].img);
    elapsed += intervalMs;
    if(elapsed >= duration){
      clearInterval(iv);
      // small delay to let rolling CSS finish
      setTimeout(()=> finishRoll(lastIdx), 160);
    }
  }, intervalMs);
}

/* finalize roll: show final and play ding */
function finishRoll(randIdx){
  const diceEl = document.getElementById('dice');
  diceEl.classList.remove('rolling');

  // pick final index (randIdx already chosen), but to ensure uniform final pick do:
  const finalIdx = Math.floor(Math.random() * FRUITS.length);
  currentIndex = finalIdx;
  // render final stamp (SVG)
  faceView.innerHTML = createStampSVG(FRUITS[finalIdx].img);

  // populate names (no numbering)
  fruitCn.textContent = FRUITS[finalIdx].cn;
  fruitTw.textContent = FRUITS[finalIdx].tw;

  // show pronunciation controls
  pronBtn.style.display = 'inline-block';
  playPronBox.style.display = 'flex';

  // stop roll sound & play ding
  try{ rollSound.pause(); rollSound.currentTime = 0; }catch(e){}
  dingSound.currentTime = 0;
  dingSound.play().catch(()=>{});

  // enable roll after a short cooldown
  setTimeout(()=>{ rolling = false; rollBtn.disabled = false; }, 300);
}

/* pronounce fruit */
function playPronunciation(){
  if(currentIndex === null) return;
  const aud = new Audio(FRUITS[currentIndex].audio);
  aud.currentTime = 0;
  aud.play().catch(()=>{ /* browsers may require user gesture; ignore */ });
}

/* init handlers */
rollBtn.addEventListener('click', ()=>{ rollAnimation(1200); });
pronBtn.addEventListener('click', playPronunciation);
playAudioBtn && playAudioBtn.addEventListener('click', playPronunciation);

/* Accessibility: allow keyboard Enter on roll button */
rollBtn.addEventListener('keyup', (e)=>{ if(e.key === 'Enter') rollBtn.click(); });

/* On load, show a neutral placeholder */
(function setPlaceholder(){
  faceView.innerHTML = createStampSVG('game9_assets/fruit1.png');
  fruitCn.textContent = 'æŒ‰ã€Œæ’šéª°å­ã€é–‹å§‹';
  fruitTw.textContent = '';
})();
</script>
</body>
</html>

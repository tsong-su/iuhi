<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<title>å’±ä¾†æ’šéª°ä»”</title>
<style>
*{box-sizing:border-box;}
html,body{
  margin:0;
  padding:0;
  height:100%;
  font-family:"Microsoft JhengHei","PingFang TC",sans-serif;
  background:#f5e6fa;
  color:#444;
  overflow:hidden; /* ğŸš« ç¦æ­¢æ²è»¸ */
  display:flex;
  flex-direction:column;
}
.top-section{text-align:center;padding:8px 0 0 0;}
h1{margin:0;font-size:2em;color:#553c7b;font-weight:600;}
.top-section p{margin:4px 0 8px 0;font-size:17px;color:#666;}
.btn-container{display:flex;flex-wrap:wrap;justify-content:center;gap:6px;margin-bottom:4px;}
button{font-size:15px;padding:8px 14px;border:none;border-radius:8px;cursor:pointer;font-weight:bold;color:#fff;transition: transform 0.15s ease, opacity 0.2s;}
button:hover{transform:scale(1.08);opacity:0.9;}
.btn1{background:#d17b88;} .btn2{background:#d49b6a;} .btn3{background:#e6c16a;color:#333;}
.btn4{background:#7cb67c;} .btn5{background:#6a9ed4;} .btn6{background:#8a6ad4;} .btn7{background:#d46aba;}
.home-btn{background:#553c7b;margin:10px auto 12px auto;padding:14px 28px;font-size:20px;border-radius:10px;display:block;}

.middle-section{
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  max-height:100%;
}
#three-container{
  width:80vmin;
  max-width:520px;
  aspect-ratio:1/1;
  background:#f3dfff;
  border-radius:24px;
  box-shadow:0 8px 24px rgba(0,0,0,0.2);
  display:flex;
  justify-content:center;
  align-items:center;
  position: relative;
  overflow:hidden; /* ç¢ºä¿éª°å­ä¸è¶…å‡º */
}
.bottom-section{padding:6px 0 10px 0;text-align:center;}
.hint{font-size:18px;font-weight:500;color:#333;margin:4px 0 6px 0;}
.label{
  position:absolute;
  color:#222;
  font-weight:bold;
  font-size:18px;
  text-shadow:1px 1px 2px #fff;
}
</style>
</head>
<body>
<div class="top-section">
<h1>å’±ä¾†æ’šéª°ä»”</h1>
<p>æ¬²æ’šå¹¾ç²’éª°ä»”ï¼Œåœ¨ä½ æ€ã€‚</p>
<div class="btn-container">
  <button class="btn1" onclick="rollDice(1)">1ç²’</button>
  <button class="btn2" onclick="rollDice(2)">2ç²’</button>
  <button class="btn3" onclick="rollDice(3)">3ç²’</button>
  <button class="btn4" onclick="rollDice(4)">4ç²’</button>
  <button class="btn5" onclick="rollDice(5)">5ç²’</button>
  <button class="btn6" onclick="rollDice(6)">6ç²’</button>
  <button class="btn7" onclick="rollDice(7)">7ç²’</button>
</div>
</div>

<div class="middle-section">
  <div id="three-container"></div>
</div>

<div class="bottom-section">
  <button class="home-btn" onclick="location.href='index.html'">è½‰å»éŠæˆ²é ­é </button>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
<script>
let scene,camera,renderer,dice=[],rolling=false;
let rollAudio=new Audio("game8_assets/Roll the dice.mp3");
let dingAudio=new Audio("game8_assets/ding1.mp3");
let textures=[];

const loader=new THREE.TextureLoader();
for(let i=1;i<=40;i++){
  textures[i]=loader.load(`game8_assets/stamp${i}.jpg`);
}

init();

function init(){
  scene=new THREE.Scene();
  const box=document.getElementById("three-container");
  const width=box.clientWidth;
  const height=box.clientHeight;
  camera=new THREE.PerspectiveCamera(45,width/height,0.1,1000);
  camera.position.set(0,5,15);
  renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
  renderer.setSize(width,height);
  box.appendChild(renderer.domElement);

  const light=new THREE.DirectionalLight(0xffffff,1);
  light.position.set(10,14,10).normalize();
  scene.add(light);
  scene.add(new THREE.AmbientLight(0x999999));

  animate();
  window.addEventListener("resize",onWindowResize,false);
}

function onWindowResize(){
  const box=document.getElementById("three-container");
  camera.aspect=box.clientWidth/box.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(box.clientWidth,box.clientHeight);
}

function createDice(num){
  dice.forEach(d=>scene.remove(d.mesh));
  dice=[];
  const container=document.getElementById("three-container");
  [...container.querySelectorAll(".label")].forEach(l=>l.remove());

  // å‹•æ…‹ç¸®æ”¾å¤§å°
  const baseSize=3;
  const size=baseSize*(1.2-Math.min(num,7)/10); 

  // æ’åˆ—æ–¹å¼ (åƒç©å®¶æ¡Œé¢)
  let rows,cols;
  if(num===1){rows=1;cols=1;}
  else if(num===2){rows=2;cols=1;}
  else if(num===3){rows=2;cols=2;}
  else if(num===4){rows=2;cols=2;}
  else if(num===5){rows=2;cols=3;}
  else if(num===6){rows=2;cols=3;}
  else if(num===7){rows=2;cols=4;}

  const gap=0.5*size;
  const offsetX=(cols-1)*(size+gap)/2;
  const offsetY=(rows-1)*(size+gap)/2;

  for(let i=0;i<num;i++){
    const mats=[];
    for(let f=0;f<6;f++){
      let id=Math.floor(Math.random()*40)+1;
      mats.push(new THREE.MeshLambertMaterial({map:textures[id]}));
    }
    const cube=new THREE.Mesh(new THREE.BoxGeometry(size,size,size),mats);
    let row=Math.floor(i/cols);
    let col=i%cols;
    cube.position.set(col*(size+gap)-offsetX, -row*(size+gap)+offsetY, 0);
    cube.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI);
    scene.add(cube);

    // æ¨™ç±¤
    const label=document.createElement("div");
    label.className="label";
    label.innerText=(i+1);
    container.appendChild(label);
    dice.push({mesh:cube,label:label});
  }
  updateLabels();
}

function updateLabels(){
  const box=document.getElementById("three-container");
  dice.forEach(d=>{
    const vector=d.mesh.position.clone().project(camera);
    const x=(vector.x*0.5+0.5)*box.clientWidth;
    const y=(-vector.y*0.5+0.5)*box.clientHeight;
    d.label.style.left=`${x}px`;
    d.label.style.top=`${y+40}px`;
  });
}

function rollDice(num){
  if(rolling) return;
  rolling=true;
  rollAudio.currentTime=0; rollAudio.play();
  createDice(num);

  const speeds=dice.map

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>éƒµç¥¨é…å°éŠæˆ² - æ ¡æ­£å·¥å…·</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f9f9f9;
    }
    #map-container {
      position: relative;
      width: 80%;
      margin: 0 auto;
      border: 2px solid #333;
      background: #fff;
    }
    #map {
      width: 100%;
      display: block;
    }
    .calibration-box {
      position: absolute;
      width: 50px;
      height: 50px;
      border: 2px dashed red;
      cursor: move;
    }
    #controls {
      margin: 20px 0;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      margin: 5px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      background: #4CAF50;
      color: #fff;
    }
    button:hover {
      background: #45a049;
    }
    #coords-output {
      margin-top: 20px;
      padding: 10px;
      background: #eee;
      white-space: pre-wrap;
      border-radius: 8px;
      font-family: monospace;
      display: none;
    }
  </style>
</head>
<body>

  <h2 style="text-align:center;">éƒµç¥¨é…å°éŠæˆ² - æ ¡æ­£å·¥å…·</h2>
  
  <div id="map-container">
    <img id="map" src="north_map.png" alt="åœ°åœ–">
  </div>

  <div id="controls">
    <button onclick="toggleCalibration()">ğŸ”§ é–‹å•Ÿ / é—œé–‰ æ ¡æ­£æ¨¡å¼</button>
    <button onclick="exportCoords()">ğŸ“¤ åŒ¯å‡ºåº§æ¨™</button>
    <button onclick="copyCoords()">ğŸ“‹ è¤‡è£½åº§æ¨™</button>
  </div>

  <div id="coords-output"></div>

  <script>
    const mapContainer = document.getElementById('map-container');
    const coordsOutput = document.getElementById('coords-output');
    let isCalibrating = false;

    // é–‹é—œæ ¡æ­£æ¨¡å¼
    function toggleCalibration() {
      isCalibrating = !isCalibrating;
      if (isCalibrating) {
        alert('æ ¡æ­£æ¨¡å¼å·²é–‹å•Ÿï¼Œé»æ“Šåœ°åœ–å¯æ–°å¢æ‹–æ›³æ–¹æ¡†');
        mapContainer.addEventListener('click', addCalibrationBox);
      } else {
        alert('æ ¡æ­£æ¨¡å¼å·²é—œé–‰');
        mapContainer.removeEventListener('click', addCalibrationBox);
      }
    }

    // æ–°å¢ç´…è‰²æ–¹æ¡†
    function addCalibrationBox(e) {
      if (e.target.id === 'map') {
        const box = document.createElement('div');
        box.className = 'calibration-box';
        box.style.left = `${(e.offsetX / mapContainer.clientWidth) * 100}%`;
        box.style.top = `${(e.offsetY / mapContainer.clientHeight) * 100}%`;

        // æ‹–æ›³åŠŸèƒ½
        box.onmousedown = function(event) {
          event.preventDefault();
          const shiftX = event.clientX - box.getBoundingClientRect().left;
          const shiftY = event.clientY - box.getBoundingClientRect().top;

          function moveAt(pageX, pageY) {
            const relX = (pageX - mapContainer.getBoundingClientRect().left - shiftX) / mapContainer.clientWidth * 100;
            const relY = (pageY - mapContainer.getBoundingClientRect().top - shiftY) / mapContainer.clientHeight * 100;
            box.style.left = `${Math.max(0, Math.min(100, relX))}%`;
            box.style.top = `${Math.max(0, Math.min(100, relY))}%`;
          }

          function onMouseMove(e) {
            moveAt(e.pageX, e.pageY);
          }

          document.addEventListener('mousemove', onMouseMove);
          document.onmouseup = () => {
            document.removeEventListener('mousemove', onMouseMove);
            document.onmouseup = null;
          };
        };
        box.ondragstart = () => false;
        mapContainer.appendChild(box);
      }
    }

    // åŒ¯å‡ºåº§æ¨™ï¼ˆè‡ªå‹•è¤‡è£½ï¼‰
    function exportCoords() {
      if (!isCalibrating) {
        alert('è«‹å…ˆé–‹å•Ÿæ ¡æ­£æ¨¡å¼ï¼Œæ‰èƒ½åŒ¯å‡ºåº§æ¨™ï¼');
        return;
      }
      const calibrationBoxes = document.querySelectorAll('.calibration-box');
      if (calibrationBoxes.length === 0) {
        alert('è«‹å…ˆæ–°å¢è‡³å°‘ä¸€å€‹æ–¹æ¡†ï¼');
        return;
      }
      const newCoords = Array.from(calibrationBoxes).map(box => {
        const x = parseFloat(box.style.left) || 0;
        const y = parseFloat(box.style.top) || 0;
        return { x, y };
      });
      const coordsStr = `const coords = ${JSON.stringify(newCoords, null, 2)};`;
      coordsOutput.innerText = coordsStr;
      coordsOutput.style.display = 'block';
      // è‡ªå‹•è¤‡è£½
      navigator.clipboard.writeText(coordsStr).then(() => {
        alert('åº§æ¨™å·²åŒ¯å‡ºä¸¦è‡ªå‹•è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
      }).catch(err => {
        console.error(err);
        alert('è‡ªå‹•è¤‡è£½å¤±æ•—ï¼Œè«‹ç”¨ä¸‹æ–¹çš„ã€Œè¤‡è£½åº§æ¨™ã€æŒ‰éˆ•æ‰‹å‹•è¤‡è£½');
      });
      window.scrollTo(0, document.body.scrollHeight);
    }

    // æ‰‹å‹•è¤‡è£½
    function copyCoords() {
      if (coordsOutput.innerText.trim() === '') {
        alert('ç›®å‰æ²’æœ‰åº§æ¨™å¯ä»¥è¤‡è£½ï¼');
        return;
      }
      navigator.clipboard.writeText(coordsOutput.innerText).then(() => {
        alert('åº§æ¨™å·²è¤‡è£½ï¼');
      }).catch(err => {
        console.error(err);
        alert('æ‰‹å‹•è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•é¸å–æ–‡å­—è¤‡è£½');
      });
    }
  </script>
</body>
</html>

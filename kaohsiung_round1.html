<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>é«˜é›„å¸‚ï¼å¸‚ä¸­å¿ƒå€æ–°èˆŠåœ°åé…å°</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;800;900&display=swap">
<style>
:root{
  --bg:#FFF7F2;            /* æŸ”ç±³è‰²èƒŒæ™¯ */
  --ink:#6B3B00;           /* ä¸»è¦å­—è‰² */
  --ink2:#542f00;
  --card:#ffffff;
  --border:#e8e6e3;
  --chip:#FFE7C7;
  --chipBorder:#ffb873;
  --good:#22c55e;
  --bad:#ef4444;
}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:"Noto Sans TC","Microsoft JhengHei",system-ui,-apple-system,Arial}
h1{margin:.7rem 0 .25rem;text-align:center;font-weight:900;letter-spacing:1px;color:#7b341e;font-size:clamp(20px,3.8vw,30px)}
.p{margin:.1rem 0;text-align:center;color:#8a4b00;font-size:14px}
.wrapper{max-width:1100px;margin:0 auto;padding:0 12px 16px}
.board{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 24px rgba(0,0,0,.08);overflow:hidden}
.mapbox{position:relative;width:100%;height:72vh;min-height:520px;background:#fff}
.mapbox svg{width:100%;height:100%;display:block;opacity:0;transform:translateY(8px);transition:opacity .6s ease, transform .6s ease}
.mapbox svg.fadein{opacity:1;transform:translateY(0)}

.mapbox svg path,.mapbox svg polygon,.mapbox svg polyline{
  vector-effect:non-scaling-stroke;stroke-linejoin:round;stroke-linecap:round
}
.core{fill:url(#coreGrad);stroke:#ffffff;stroke-width:1.2}
.dim{opacity:.08}

.flash{animation:ccFlash .9s ease-in-out 1}
@keyframes ccFlash{
  0%{stroke:#ffb703;stroke-width:3;filter:drop-shadow(0 0 0 rgba(255,183,3,0))}
  50%{stroke:#ff7a00;stroke-width:4.5;filter:drop-shadow(0 0 12px rgba(255,122,0,.55))}
  100%{stroke:#000;stroke-width:.2;filter:drop-shadow(0 0 0 rgba(0,0,0,0))}
}

svg text.label{
  font-weight:900;fill:var(--ink2);paint-order:stroke;stroke:#fff;stroke-width:2.2px;stroke-linejoin:round;
  letter-spacing:.2px;font-size:12px
}
svg text.label tspan{fill:#8a4b00;font-weight:800;font-size:10px}

.tray{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;padding:12px;background:#fff;border-top:1px dashed var(--border)}
.chip{
  user-select:none;touch-action:none;padding:10px 12px;border-radius:14px;border:2px solid var(--chipBorder);background:var(--chip);
  box-shadow:0 3px 8px rgba(0,0,0,.12);font-weight:900;color:var(--ink2);
  display:inline-flex;flex-direction:column;align-items:center;gap:2px
}
.chip .poj{font-size:12px;color:#8a4b00}
.chip.dragging{opacity:.95;box-shadow:0 10px 24px rgba(0,0,0,.24)}
.chip.correct{border-color:var(--good)}
.chip.wrong{border-color:var(--bad);animation:shake .28s linear 1}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-3px)}100%{transform:translateX(0)}}

.footer{text-align:center;padding:12px}
.btn{
  display:inline-block;margin:0 6px;background:linear-gradient(145deg,#ffa96e,#ffcf9b);color:#fff;padding:9px 14px;border-radius:12px;
  box-shadow:0 4px 12px rgba(0,0,0,.18);border:0;font-weight:900;text-decoration:none
}

.toast{
  position:fixed;left:50%;top:12px;transform:translateX(-50%);background:#111827;color:#fff;padding:8px 12px;border-radius:10px;
  box-shadow:0 8px 20px rgba(0,0,0,.25);font-weight:700;z-index:999;display:none
}
.win-banner{
  position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;
  font-weight:900;font-size:clamp(28px,7vw,56px);color:#ff9e42;text-shadow:0 10px 24px rgba(0,0,0,.18);
  transform:scale(.6);opacity:0;transition:transform .5s ease, opacity .5s ease;z-index:9999
}
.win-banner.show{transform:scale(1);opacity:1}
</style>
</head>
<body>
  <h1>é«˜é›„å¸‚ï¼å¸‚ä¸­å¿ƒå€æ–°èˆŠåœ°åé…å°</h1>
  <p class="p">ğŸ“± å»ºè­°ç›´å¼è§€çœ‹æ•ˆæœæœ€ä½³</p>
  <p class="p">ğŸ‘‡ æŠŠã€ŒèˆŠåœ°åï¼‹æ‹¼éŸ³ã€æ‹–åˆ°åœ–ä¸Šçš„æ­£ç¢ºä½ç½®</p>

  <div class="wrapper">
    <div class="board">
      <div class="mapbox" id="mapbox"><!-- é€™è£¡æœƒç”¨ JS è‡ªå‹•å¡å…¥ svg.txt çš„å…§å®¹ --></div>
      <div class="tray" id="tray"></div>
    </div>
    <div class="footer">
      <button class="btn" id="btn-restart">ğŸ” é–£è€ä¸€æ“º</button>
      <a class="btn" href="https://tsong-su.github.io/iuhi/index.html">ğŸ  è½‰å»éŠæˆ²é¦–é </a>
    </div>
  </div>

  <div class="toast" id="toast">âœ”ï¸ é…å°æˆåŠŸï¼</div>
  <div class="win-banner" id="winBanner">æœ‰å¤  gÃ¢u çš„ï¼è®šå•¦ï¼</div>

<script>
const CITY_TITLES = ['æ¥ æ¢“å€','å·¦ç‡Ÿå€','é¼“å±±å€','ä¸‰æ°‘å€','é¹½åŸ•å€','å‰é‡‘å€','æ–°èˆˆå€','è‹“é›…å€','æ——æ´¥å€','å‰é®å€','å°æ¸¯å€'];
const PAIRS = [
  { id:'01', newName:'æ¥ æ¢“', oldName:'æ¥ ä»”å‘', roman:'LÃ¢m-Ã¡-khenn' },
  { id:'02', newName:'å·¦ç‡Ÿ', oldName:'åŸ¤ä»”é ­', roman:'Pi-Ã¡-thÃ¢u' },
  { id:'03', newName:'é¼“å±±', oldName:'æ‰“é¼“å±±', roman:'TÃ¡nn-kÃ³o-san' },
  { id:'04', newName:'ä¸‰æ°‘', oldName:'ä¸‰å¡Šå', roman:'Sann-tÃ¨-tshÃ¹' },
  { id:'05', newName:'é¹½åŸ•', oldName:'é¹½åŸ•åŸ”', roman:'IÃ¢m-tiÃ¢nn-poo' },
  { id:'06', newName:'å‰é‡‘', oldName:'å‰è¡¿',   roman:'TsiÃ¢n-khim' },
  { id:'07', newName:'æ–°èˆˆ', oldName:'é€®æ¸¯åŸ”', roman:'TÄi-kÃ¡ng-poo' },
  { id:'08', newName:'è‹“é›…', oldName:'ç¬­ä»”å¯®', roman:'LÃ®ng-Ã¡-liÃ¢u' },
  { id:'09', newName:'æ——æ´¥', oldName:'æ——å¾Œ',   roman:'KÃ®-Äu' },
  { id:'10', newName:'å‰é®', oldName:'å‰é®',   roman:'TsiÃ¢n-tÃ¬n' },
  { id:'11', newName:'å°æ¸¯', oldName:'æ¸¯ä»”å¢˜', roman:'KÃ¡ng-Ã¡-kÃ®nn' }
];

const mapbox=document.getElementById('mapbox');
const tray=document.getElementById('tray');
const toast=document.getElementById('toast');
const winBanner=document.getElementById('winBanner');
const audioNew=new Audio(), audioOld=new Audio();
const vVictory=new Audio('map_assets/victory.mp3'), vFinish1=new Audio('map_assets/finish1.mp3');
let solved=0;

function audioUrl(id2,label,kind){return`map_assets/${encodeURIComponent(id2+label+'_'+kind+'.mp3')}`;}

function titleCN(el){const t=el.querySelector('title');return t?t.textContent.trim().split(/\s+/)[0]:'';}

async function loadSVG(){
  const res=await fetch('svg.txt',{cache:'no-store'});
  const txt=await res.text();
  mapbox.innerHTML=txt;
  const svg=mapbox.querySelector('svg');
  if(!svg)return;

  // ä¿ç•™åŸ viewBoxï¼ˆä¸è£åˆ‡ï¼‰ï¼Œè®“æ•´å¼µåœ°åœ–å‡ºç¾
  svg.removeAttribute('width');
  svg.removeAttribute('height');
  svg.classList.add('fadein');

  // å¸‚ä¸­å¿ƒ 11 å€ä¸Šäº®è‰²ï¼Œå…¶é¤˜åŠé€æ˜
  const paths=svg.querySelectorAll('path');
  paths.forEach(p=>{
    const name=titleCN(p);
    if(CITY_TITLES.includes(name)){
      p.style.fill='url(#coreGrad)';
      p.style.opacity='1';
      p.setAttribute('data-core','1');
    }else{
      p.style.fill='#d9d9d9';
      p.style.opacity='0.25';
    }
  });

  // åŠ ä¸Šæ¼¸å±¤
  const defs=document.createElementNS('http://www.w3.org/2000/svg','defs');
  const grad=document.createElementNS('http://www.w3.org/2000/svg','linearGradient');
  grad.id='coreGrad';grad.setAttribute('x1','0');grad.setAttribute('y1','0');grad.setAttribute('x2','0');grad.setAttribute('y2','1');
  const s1=document.createElementNS('http://www.w3.org/2000/svg','stop');
  s1.setAttribute('offset','0%');s1.setAttribute('stop-color','#ffce9b');
  const s2=document.createElementNS('http://www.w3.org/2000/svg','stop');
  s2.setAttribute('offset','100%');s2.setAttribute('stop-color','#ffb774');
  grad.appendChild(s1);grad.appendChild(s2);defs.appendChild(grad);
  svg.prepend(defs);

  // åœ¨åœ–ä¸Šæ¨™æ–°åœ°åï¼‹æ‹¼éŸ³
  PAIRS.forEach(meta=>{
    const target=[...paths].find(p=>titleCN(p)===meta.newName+'å€');
    if(!target)return;
    const b=target.getBBox(), cx=b.x+b.width/2, cy=b.y+b.height/2;
    const t=document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('class','label');t.setAttribute('x',cx);t.setAttribute('y',cy);
    t.setAttribute('text-anchor','middle');
    t.textContent=meta.newName;
    const ts=document.createElementNS('http://www.w3.org/2000/svg','tspan');
    ts.setAttribute('x',cx);ts.setAttribute('dy','1.2em');ts.textContent=meta.roman;
    t.appendChild(ts);svg.appendChild(t);
  });
}

function buildChips(){
  tray.innerHTML='';solved=0;
  const arr=[...PAIRS].sort(()=>Math.random()-0.5);
  arr.forEach(it=>{
    const chip=document.createElement('div');
    chip.className='chip';chip.dataset.name=it.newName;
    chip.innerHTML=`<div>${it.oldName}</div><div class="poj">${it.roman}</div>`;
    tray.appendChild(chip);
  });
  enableDrag();
}

function enableDrag(){
  let dragEl=null, offsetX=0, offsetY=0, orig=null;
  function down(e){
    const t=e.target.closest('.chip');if(!t)return;e.preventDefault();
    dragEl=t;dragEl.classList.add('dragging');
    const r=t.getBoundingClientRect();offsetX=e.clientX-r.left;offsetY=e.clientY-r.top;
    orig=t.parentElement;mapbox.appendChild(t);
    t.style.position='absolute';t.style.zIndex=9;move(e);
    window.addEventListener('pointermove',move);
    window.addEventListener('pointerup',up,{once:true});
  }
  function move(e){
    if(!dragEl)return;
    const b=mapbox.getBoundingClientRect();
    dragEl.style.left=e.clientX-b.left-offsetX+'px';
    dragEl.style.top=e.clientY-b.top-offsetY+'px';
  }
  function up(e){
    if(!dragEl)return;
    const exp=dragEl.dataset.name;
    const r=dragEl.getBoundingClientRect(), center={x:r.left+r.width/2,y:r.top+r.height/2};
    const svg=mapbox.querySelector('svg');
    let best=null,dist=1e9;
    svg.querySelectorAll('[data-core="1"]').forEach(p=>{
      const bb=p.getBBox(),pt=svg.createSVGPoint();
      pt.x=bb.x+bb.width/2;pt.y=bb.y+bb.height/2;
      const scr=pt.matrixTransform(p.getScreenCTM());
      const d=Math.hypot(center.x-scr.x,center.y-scr.y);
      if(d<dist){dist=d;best={el:p,name:titleCN(p).replace(/å€$/,'')}}
    });
    if(best && best.name===exp && dist<90){
      dragEl.classList.add('correct');
      const bb=best.el.getBBox(),pt=svg.createSVGPoint();
      pt.x=bb.x+bb.width/2;pt.y=bb.y+bb.height/2;
      const scr=pt.matrixTransform(best.el.getScreenCTM());
      dragEl.style.left=scr.x-mapbox.getBoundingClientRect().left+'px';
      dragEl.style.top=scr.y-mapbox.getBoundingClientRect().top+'px';
      dragEl.style.transform='translate(-50%,-50%)';dragEl.onpointerdown=null;
      const meta=PAIRS.find(p=>p.newName===exp);
      audioNew.src=audioUrl(meta.id,meta.newName,'new');
      audioOld.src=audioUrl(meta.id,meta.oldName,'old');
      audioNew.onended=()=>setTimeout(()=>audioOld.play().catch(()=>{}),600);
      audioNew.play().catch(()=>{});
      solved++;showToast('âœ”ï¸ é…å°æˆåŠŸï¼');
      if(solved>=PAIRS.length)setTimeout(winSequence,600);
    }else{
      dragEl.classList.add('wrong');
      orig.appendChild(dragEl);dragEl.style.position='';dragEl.style.left='';dragEl.style.top='';
    }
    dragEl.classList.remove('dragging');dragEl=null;window.removeEventListener('pointermove',move);
  }
  tray.addEventListener('pointerdown',down);
  mapbox.addEventListener('pointerdown',down);
}

function showToast(m){toast.textContent=m;toast.style.display='block';setTimeout(()=>toast.style.display='none',900);}
function winSequence(){winBanner.classList.add('show');vVictory.play();setTimeout(()=>vFinish1.play(),600);}
document.getElementById('btn-restart').addEventListener('click',()=>location.reload());
window.addEventListener('load',async()=>{await loadSVG();buildChips();});
</script>
</body>
</html>

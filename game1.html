<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>字詞重組遊戲</title>
  <style>
    body {
      background-color: #f3e6ff;
      font-family: sans-serif;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #6a1b9a;
    }
    #question {
      font-size: 20px;
      margin-bottom: 15px;
    }
    .words, .answer-box {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 10px;
      min-height: 60px;
      border: 2px dashed #999;
      padding: 10px;
      border-radius: 8px;
    }
    .word {
      background: #fff;
      padding: 8px 12px;
      margin: 5px;
      border: 1px solid #aaa;
      border-radius: 6px;
      cursor: grab;
      user-select: none;
      transition: box-shadow 0.2s ease;
    }
    .word.dragging {
      box-shadow: 0 0 10px #00bcd4;
    }
    .answer-box.correct {
      animation: flash-green 0.5s;
    }
    @keyframes flash-green {
      0% { background-color: #c8e6c9; }
      100% { background-color: transparent; }
    }
    .controls {
      margin-top: 15px;
    }
    .cat {
      position: absolute;
      width: 80px;
      bottom: 30px;
      display: none;
    }
    #cat-left { left: -100px; }
    #cat-right { right: -100px; }
    .show-cat {
      animation: slide-in 1s forwards;
    }
    @keyframes slide-in {
      to { transform: translateX(120px); }
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      background-color: #9575cd;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h1>字詞重組遊戲</h1>
<div id="question">請拖曳正確的順序：</div>

<div class="words" id="word-bank"></div>
<div class="answer-box" id="answer-box" ondragover="event.preventDefault()"></div>

<div class="controls">
  <button onclick="nextQuestion()">下一題</button>
  <button onclick="restartGame()">重新開始</button>
</div>

<img src="https://i.imgur.com/OB0y6MR.png" class="cat" id="cat-left">
<img src="https://i.imgur.com/OB0y6MR.png" class="cat" id="cat-right" style="transform: scaleX(-1);">

<audio id="correct-sound" src="https://www.soundjay.com/button/sounds/button-3.mp3"></audio>
<audio id="wrong-sound" src="https://www.soundjay.com/button/sounds/button-10.mp3"></audio>

<script>
const questions = [
  ["下課", "干焦", "十", "分", "鐘"],
  ["華語", "的", "『蒟蒻』", "台語", "講做", "粉鳥舅"], 
  ["人", "講", "中指", "毋通", "烏白", "比"],
  ["伊", "毋是", "彼款", "會", "食錢", "的", "人"],
  ["今仔日", "的", "日頭", "真", "猛"],
  ["這陣", "當咧", "出", "大日虎", "咱", "上好", "莫", "出門", "較袂", "著痧"],
  ["大水雨", "閣", "拄著", "滇流"],
  ["你", "敢", "有", "需要", "人", "共", "你", "鬥相共"]
];

let current = 0;
let wrongCount = 0;

function shuffle(arr) {
  return arr.slice().sort(() => Math.random() - 0.5);
}

function loadQuestion() {
  const bank = document.getElementById("word-bank");
  const box = document.getElementById("answer-box");
  bank.innerHTML = '';
  box.innerHTML = '';
  wrongCount = 0;
  
  const q = questions[current];
  shuffle(q).forEach(word => {
    const el = document.createElement("div");
    el.className = "word";
    el.textContent = word;
    el.draggable = true;
    el.ondragstart = () => el.classList.add("dragging");
    el.ondragend = () => el.classList.remove("dragging");
    el.ondragover = e => e.preventDefault();
    el.ondrop = () => {};
    bank.appendChild(el);
  });
}

document.getElementById("answer-box").addEventListener("drop", e => {
  e.preventDefault();
  const dragging = document.querySelector(".dragging");
  if (dragging && !Array.from(answerBox.children).includes(dragging)) {
    answerBox.appendChild(dragging);
  }
  checkAnswer();
});

function checkAnswer() {
  const box = document.getElementById("answer-box");
  const answer = questions[current];
  const user = Array.from(box.children).map(el => el.textContent);
  if (user.length !== answer.length) return;

  if (user.every((w, i) => w === answer[i])) {
    document.getElementById("correct-sound").play();
    box.classList.add("correct");
    setTimeout(() => box.classList.remove("correct"), 500);
    animateCats();
  } else {
    document.getElementById("wrong-sound").play();
    wrongCount++;
    if (wrongCount >= 2) {
      alert("提示：正確答案是：\n" + answer.join(" "));
    } else {
      alert("不正確，請再試一次！");
      // 回到字詞區讓玩家重新拖曳
      loadQuestion();
    }
  }
}

function nextQuestion() {
  current = (current + 1) % questions.length;
  loadQuestion();
}

function restartGame() {
  current = 0;
  loadQuestion();
}

function animateCats() {
  const left = document.getElementById("cat-left");
  const right = document.getElementById("cat-right");
  left.style.display = right.style.display = "block";
  left.classList.add("show-cat");
  right.classList.add("show-cat");
  setTimeout(() => {
    left.style.display = right.style.display = "none";
    left.classList.remove("show-cat");
    right.classList.remove("show-cat");
  }, 1200);
}

loadQuestion();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8" />
  <title>台語字詞排序遊戲</title>
  <style>
    * {
      box-sizing: border-box;
    }
    body, html {
      margin: 0; padding: 0;
      height: 100%; width: 100%;
      font-family: "Microsoft JhengHei", sans-serif;
      background: #fdf6e3;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      background: #ffcc66;
      padding: 10px 20px;
      border-radius: 10px;
    }
    #sentence {
      margin: 20px;
      font-size: 24px;
      font-weight: bold;
      color: #333;
    }
    #words {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin: 20px;
    }
    .word {
      background: #fff;
      border: 2px solid #666;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: grab;
      font-size: 20px;
      user-select: none;
    }
    #controls {
      margin: 20px;
    }
    button {
      padding: 10px 15px;
      margin: 5px;
      font-size: 18px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #87cefa;
    }
    button:hover {
      background: #00bfff;
      color: white;
    }
    #dictLink {
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h1>台語字詞排序遊戲</h1>
  <div id="sentence">請將下方字詞拖曳排序，組成正確句子</div>
  <div id="words"></div>
  <div id="controls">
    <button onclick="checkAnswer()">確認答案</button>
    <button onclick="nextQuestion()">後一條</button>
    <button onclick="restart()">重新開始</button>
    <button onclick="showAnswer()">提示正確答案</button>
    <button onclick="goHome()">回到遊戲首頁</button>
  </div>
  <audio id="audioPlayer" controls style="margin-top:10px;"></audio>
  <div id="dictLink"></div>

  <script>
    const questions = [
      {
        words: ["流行性", "感冒", "病毒", "的", "暗作期", "大約", "是", "一工", "到", "三工"],
        answer: "流行性感冒病毒的暗作期大約是一工到三工",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/8U/SA/29455-1-1.mp3",
        dict: {
          word: "暗作期",
          url: "https://sutian.moe.edu.tw/und-hani/su/29455/"
        }
      },
      {
        words: ["半老老", "才", "開始", "學", "電腦", "食甲"],
        answer: "食甲半老老才開始學電腦",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/3/1006.mp3",
        dict: {
          word: "半老老",
          url: "https://sutian.moe.edu.tw/und-hani/su/1006/"
        }
      },
      {
        words: ["你", "是", "阮", "的", "好朋友"],
        answer: "你是阮的好朋友",
        audio: "https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/1/101.mp3",
        dict: {
          word: "朋友",
          url: "https://sutian.moe.edu.tw/und-hani/su/101/"
        }
      }
    ];

    let current = 0;

    function shuffle(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function loadQuestion(index) {
      const q = questions[index];
      const wordsDiv = document.getElementById("words");
      wordsDiv.innerHTML = "";
      shuffle(q.words).forEach(word => {
        const span = document.createElement("span");
        span.className = "word";
        span.draggable = true;
        span.textContent = word;
        span.addEventListener("dragstart", dragStart);
        span.addEventListener("dragover", dragOver);
        span.addEventListener("drop", drop);
        wordsDiv.appendChild(span);
      });
      document.getElementById("audioPlayer").src = q.audio;
      document.getElementById("audioPlayer").play();
      document.getElementById("dictLink").innerHTML =
        `<a href="${q.dict.url}" target="_blank">查「${q.dict.word}」教典</a>`;
    }

    let dragSrcEl = null;

    function dragStart(e) {
      dragSrcEl = this;
      e.dataTransfer.effectAllowed = "move";
    }

    function dragOver(e) {
      e.preventDefault();
    }

    function drop(e) {
      e.preventDefault();
      if (dragSrcEl !== this) {
        const temp = this.textContent;
        this.textContent = dragSrcEl.textContent;
        dragSrcEl.textContent = temp;
      }
    }

    function checkAnswer() {
      const arranged = Array.from(document.querySelectorAll(".word"))
        .map(w => w.textContent).join("");
      if (arranged === questions[current].answer) {
        alert("答對了！");
      } else {
        alert("答錯了，再試一次！");
      }
    }

    function nextQuestion() {
      current = (current + 1) % questions.length;
      loadQuestion(current);
    }

    function restart() {
      loadQuestion(current);
    }

    function showAnswer() {
      alert("正確答案是： " + questions[current].answer);
    }

    function goHome() {
      window.location.href = "index.html";
    }

    // 頁面載入自動出題
    window.onload = () => loadQuestion(current);
  </script>
</body>
</html>

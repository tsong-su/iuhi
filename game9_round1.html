<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æœå­åœ–ç‰‡ & å°èªæœå­åé…å° - ç¬¬1å›</title>
  <style>
    * { box-sizing: border-box; }
    html,body { height:100%; margin:0; padding:0; background:#fffbe6; font-family: "Noto Sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    header { text-align:center; padding:10px 12px 6px; color:#cc5500; font-size:1.25rem; font-weight:600; }
    /* å…§å®¹å€ï¼šç•™å‡ºåº•éƒ¨æŒ‰éˆ•é«˜åº¦ï¼ˆé¿å…è¢«é®ä½ï¼‰ */
    main { padding:8px; padding-bottom:86px; max-width:1100px; margin:0 auto; }

    /* gridï¼šæ‰‹æ©Ÿ 3 æ¬„ã€â‰¥600px ç‚º 4 æ¬„ */
    #game {
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap:8px;
      width:100%;
    }
    @media (min-width:600px) {
      #game { grid-template-columns: repeat(4, 1fr); }
    }

    /* å¡ç‰‡ */
    .card {
      background:#fff;
      border:1.6px solid #d6d6d6;
      border-radius:10px;
      height:110px;               /* å›ºå®šé«˜åº¦ï¼Œè®“æ–‡å­—èƒ½å‚ç›´ç½®ä¸­ */
      display:flex;
      align-items:center;         /* å‚ç›´ç½®ä¸­ */
      justify-content:center;     /* è®“æ–‡å­—æ°´å¹³ç½®ä¸­ */
      padding:8px;
      text-align:center;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, border-color .12s ease, opacity .12s ease;
    }
    .card:active { transform: scale(0.98); }

    /* åœ–ç‰‡å¡å…§æ¨£å¼ */
    .card.img-card img {
      max-width:72px;
      max-height:72px;
      width:auto;
      height:auto;
      display:block;
      border-radius:6px;
    }

    /* æ–‡å­—å¡å…§æ¨£å¼ */
    .card.text-card {
      font-size:1.08rem;         /* æ–‡å­—ç¨å¤§ï¼Œç½®ä¸­å‘ˆç¾ */
      line-height:1.1;
      padding-left:10px;
      padding-right:10px;
      word-break:break-word;
    }

    /* é¸å–æ¨£å¼ */
    .card.selected { border-color:#007bff; box-shadow:0 2px 6px rgba(0,123,255,0.12); }

    /* æˆåŠŸé…å° */
    .card.matched {
      opacity:0.45;
      pointer-events:none;
      border-color:#28a745;
      transform: none;
    }

    /* éŒ¯èª¤çŸ­æš«æç¤ºï¼ˆå¥—ç”¨å¾Œæœƒåœ¨ JS ç”¨ setTimeout ç§»é™¤ï¼‰*/
    .card.wrong {
      border-color:#e63946 !important;
      box-shadow:0 0 0 3px rgba(230,57,70,0.08);
    }

    /* å‹åˆ©æ–‡å­— */
    #message {
      display:none;
      text-align:center;
      margin-top:12px;
      font-size:1.9rem;
      color:#1b8a3e;
      font-weight:700;
      animation: pop 700ms ease forwards;
    }
    @keyframes pop { from { transform: scale(.6); opacity:0 } to { transform:scale(1); opacity:1 } }

    /* å›ºå®šåº•éƒ¨æŒ‰éˆ•åˆ— */
    #bottomBar {
      position:fixed;
      left:0; right:0; bottom:0;
      background:#fff8dc;
      border-top:1px solid #e0d7c0;
      padding:10px 8px;
      display:flex;
      justify-content:space-around;
      gap:10px;
      z-index:1200;
    }
    #bottomBar button {
      flex:1;
      min-width:80px;
      max-width:220px;
      background:#ffb347;
      color:#fff;
      border:none;
      padding:10px 12px;
      border-radius:8px;
      font-size:1rem;
      cursor:pointer;
    }
    #bottomBar button.secondary { background:#7a7a7a; }
  </style>
</head>
<body>
  <header>æœå­åœ–ç‰‡ & å°èªæœå­åé…å° â€” ç¬¬1å›ï¼ˆ8é¡Œï¼‰</header>

  <main>
    <div id="game" aria-live="polite"></div>
    <div id="message">æœ‰å¤  gÃ¢uï¼ğŸ‰</div>
  </main>

  <div id="bottomBar">
    <button id="restartBtn">ğŸ”„ å†ç©ä¸€æ¬¡</button>
    <button id="nextBtn">â­ ä¸‹ä¸€å›</button>
    <button id="homeBtn" class="secondary">â¬… å›é¦–é </button>
  </div>

  <audio id="wrongSound" src="game9_assets/wrong1.mp3" preload="auto"></audio>
  <audio id="victorySound" src="game9_assets/victory2.mp3" preload="auto"></audio>

  <script>
    // --- è¨­å®š ---
    const JSON_PATH = 'game9_assets/fruits_part1.json'; // ç”±æ­¤è®€å–
    const ROUND_COUNT = 8; // ç¬¬1å›å–å‰8ç­†

    const gameDiv = document.getElementById('game');
    const messageDiv = document.getElementById('message');
    const wrongSound = document.getElementById('wrongSound');
    const victorySound = document.getElementById('victorySound');

    const restartBtn = document.getElementById('restartBtn');
    const nextBtn = document.getElementById('nextBtn');
    const homeBtn = document.getElementById('homeBtn');

    let fruits = [];      // æœƒæ”¾å‰ 8 ç­†ç‰©ä»¶
    let cards = [];       // å°‡åŒ…å« 16 å¼µå¡ï¼ˆ8 åœ– + 8 æ–‡ï¼‰
    let selected = [];    // æš«å­˜è¢«é¸çš„å…©å¼µ
    let matchedPairs = 0;

    // é‡æ–°é–‹å§‹
    restartBtn.addEventListener('click', () => {
      init(); // é‡æ–°è¼‰å…¥å¡ç‰Œï¼ˆæœƒæ‰“äº‚é¡¯ç¤ºï¼‰
    });
    nextBtn.addEventListener('click', () => {
      // å¦‚æœå°šæœªè£½ä½œç¬¬äºŒå›ï¼Œå…ˆè·³è½‰ä½”ä½é ï¼ˆä½ å¯æ”¹ç‚º game9_round2.htmlï¼‰
      location.href = 'game9_round2.html';
    });
    homeBtn.addEventListener('click', () => location.href = 'index.html');

    // è¼‰å…¥ JSONï¼ˆå¾ repo çš„ game9_assetsï¼‰
    fetch(JSON_PATH)
      .then(r => r.ok ? r.json() : Promise.reject('JSON è®€å–å¤±æ•—'))
      .then(all => {
        // ç¢ºä¿æ˜¯é™£åˆ—
        if (!Array.isArray(all)) {
          console.error('fruits_part1.json ä¸æ˜¯é™£åˆ—ï¼', all);
          return;
        }
        // å–å‰ ROUND_COUNT ç­†ï¼ˆå¦‚æœä¸è¶³æœƒå–åˆ°æœ«å°¾ï¼‰
        fruits = all.slice(0, ROUND_COUNT);
        init();
      })
      .catch(err => {
        console.error('è®€å– fruits_part1.json éŒ¯èª¤ï¼š', err);
        // fallback: å¯ä»¥åœ¨é€™è£¡æç¤ºä½¿ç”¨è€…ï¼Œæˆ–å…§å»ºç°¡å–®å‡è³‡æ–™
        alert('ç„¡æ³•è®€å–æ°´æœè³‡æ–™ (fruits_part1.json)ã€‚è«‹ç¢ºèªæª”æ¡ˆåœ¨ game9_assets/ è£¡ã€‚');
      });

    function init() {
      // é‡è¨­
      gameDiv.innerHTML = '';
      messageDiv.style.display = 'none';
      selected = [];
      matchedPairs = 0;
      cards = [];

      // å»ºç«‹å¡ç‰Œè³‡æ–™ï¼ˆæ¯å€‹ fruit ç”¢ç”Ÿä¸€å¼µåœ–å¡èˆ‡ä¸€å¼µæ–‡å­—å¡ï¼‰
      fruits.forEach(f => {
        // åœ–ç‰‡å¡ï¼ˆæœƒç”¨ id å°æ‡‰ game9_assets/{id}.pngï¼‰
        cards.push({
          id: f.id,
          type: 'img',
          data: f
        });
        // æ–‡å­—å¡ï¼ˆé¡¯ç¤º taiwaneseï¼‰
        cards.push({
          id: f.id,
          type: 'text',
          data: f
        });
      });

      // æ‰“äº‚é¡¯ç¤ºé †åº
      shuffle(cards);

      // ç”¢ç”Ÿ DOM å¡ç‰‡
      cards.forEach((cardObj, idx) => {
        const el = document.createElement('div');
        el.className = 'card ' + (cardObj.type === 'img' ? 'img-card' : 'text-card');
        el.dataset.id = cardObj.id;
        el.dataset.type = cardObj.type;
        el.setAttribute('role','button');
        el.setAttribute('tabindex','0');

        if (cardObj.type === 'img') {
          const img = document.createElement('img');
          // åœ–ç‰‡æª”åä»¥ json çš„ id æ¬„ä½ç‚ºæº–ï¼Œä¾‹å¦‚ id = "fruit1" -> game9_assets/fruit1.png
          img.src = `game9_assets/${cardObj.id}.png`;
          img.alt = cardObj.data.chinese || cardObj.data.taiwanese || cardObj.id;
          // è‹¥åœ–ç‰‡è¼‰å…¥å¤±æ•—ï¼Œä¸æœƒä¸­æ–·éŠæˆ²
          img.onerror = () => { img.style.opacity = 0.5; img.alt = 'åœ–ç‰‡ç„¡æ³•è¼‰å…¥'; };
          el.appendChild(img);
        } else {
          const span = document.createElement('span');
          span.textContent = cardObj.data.taiwanese || cardObj.data.chinese || cardObj.id;
          el.appendChild(span);
        }

        // é»æ“Š / éµç›¤æ“ä½œéƒ½å¯
        el.addEventListener('click', () => onSelect(el, cardObj));
        el.addEventListener('keydown', ev => {
          if (ev.key === 'Enter' || ev.key === ' ') { ev.preventDefault(); onSelect(el, cardObj); }
        });

        gameDiv.appendChild(el);
      });
    }

    function onSelect(el, cardObj) {
      // å·²é…å°æˆ–å·²é¸å…©å¼µæ™‚å¿½ç•¥
      if (el.classList.contains('matched') || selected.length === 2) return;

      // è‹¥å·²é¸å–åŒä¸€å¼µå°±å–æ¶ˆé¸
      if (el.classList.contains('selected')) {
        el.classList.remove('selected');
        selected = selected.filter(s => s.el !== el);
        return;
      }

      // é¸å–
      el.classList.add('selected');
      selected.push({ el, card: cardObj });

      // è‹¥é¸åˆ°å…©å¼µå°±åˆ¤æ–·
      if (selected.length === 2) {
        const [a,b] = selected;
        // ä¸å…è¨±åŒé¡å‹é…å°ï¼ˆå…©å¼µéƒ½æ˜¯åœ–æˆ–å…©å¼µéƒ½æ˜¯å­—è¦–ç‚ºéŒ¯èª¤ï¼‰
        if (a.card.id === b.card.id && a.card.type !== b.card.type) {
          // æˆåŠŸ
          a.el.classList.add('matched');
          b.el.classList.add('matched');
          // ç§»é™¤ selected æ¨£å¼
          a.el.classList.remove('selected');
          b.el.classList.remove('selected');
          // æ’­æ”¾è©²æ°´æœçš„å°èªç™¼éŸ³ï¼ˆä½¿ç”¨ json ä¸­çš„ audioï¼‰
          const audioSrc = a.card.data.audio || b.card.data.audio;
          if (audioSrc) {
            try { new Audio(audioSrc).play(); } catch(e){ console.warn('æ’­æ”¾èªéŸ³éŒ¯èª¤', e); }
          }
          matchedPairs += 1;
          // è‹¥å…¨éƒ¨é…å®Œ
          if (matchedPairs === fruits.length) {
            // é¡¯ç¤ºå‹åˆ©ã€æ’­éŸ³æ¨‚
            messageDiv.style.display = 'block';
            try { victorySound.currentTime = 0; victorySound.play(); } catch(e){ }
          }
        } else {
          // å¤±æ•—ï¼šæ’­éŒ¯èª¤éŸ³ + ç´…æ¡†æç¤º
          try { wrongSound.currentTime = 0; wrongSound.play(); } catch(e){ }
          a.el.classList.add('wrong');
          b.el.classList.add('wrong');
          // 0.7s å¾Œå›å¾©æ¨£å¼
          setTimeout(() => {
            a.el.classList.remove('wrong');
            b.el.classList.remove('wrong');
            a.el.classList.remove('selected');
            b.el.classList.remove('selected');
          }, 700);
        }
        // æ¸…ç©ºé¸æ“‡æš«å­˜
        selected = [];
      }
    }

    function shuffle(arr) {
      // Fisher-Yates
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }
  </script>
</body>
</html>

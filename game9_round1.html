<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8" />
  <title>æœå­åœ–ç‰‡&å°èªæœå­åé…å° - ç¬¬1å›</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      text-align: center;
      background: #f8f8f8;
    }
    h2 {
      margin: 10px 0 5px;
      font-size: 1.6em;
    }
    .note {
      font-size: 1.2em;
      color: #e65c00;
      font-weight: bold;
      margin-bottom: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
      padding: 6px;
      max-width: 95vw;
      margin: 0 auto;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      display: flex;
      justify-content: center;
      align-items: center;
      aspect-ratio: 1 / 1;
      font-size: 2em;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      overflow: hidden;
    }
    .card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .matched {
      color: white !important;
    }
    .buttons {
      margin-top: 10px;
    }
    .buttons button {
      border: none;
      padding: 10px 18px;
      margin: 5px;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
      color: white;
    }
    .btn-green { background: #28c76f; }
    .btn-orange { background: #ff9f43; }
    .btn-blue { background: #00cfe8; }
    .btn-green:hover { background: #20a65d; }
    .btn-orange:hover { background: #e68a2d; }
    .btn-blue:hover { background: #00a8c6; }
    #victory {
      position: fixed;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.2);
      font-size: 3em;
      font-weight: bold;
      color: #e60000;
      opacity: 0;
      transition: all 1s ease;
      z-index: 1000;
    }
    #victory.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.5);
    }
  </style>
</head>
<body>
  <h2>æœå­åœ–ç‰‡&å°èªæœå­åé…å° - ç¬¬1å›</h2>
  <div class="note">ğŸ“± å»ºè­°ç›´å¼è§€çœ‹æ•ˆæœæœ€ä½³</div>
  <div class="grid" id="gameGrid"></div>

  <div id="victory">æœ‰å¤  gÃ¢uï¼</div>

  <div class="buttons">
    <button class="btn-green" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
    <button class="btn-orange" onclick="nextRound()">ä¸‹ä¸€å›</button>
    <button class="btn-blue" onclick="goHome()">å›é¦–é </button>
  </div>

  <audio id="wrongSound" src="game9_assets/wrong1.mp3"></audio>
  <audio id="victorySound" src="game9_assets/victory2.mp3"></audio>

  <script>
    const groupColors = ["#28a745","#ff5733","#007bff","#8e44ad",
                         "#d35400","#2c3e50","#16a085","#b03a2e"];
    const textColors = ["#e60000","#007bff","#28a745","#ff33cc",
                        "#ff6600","#009999","#663399","#cc9900"];

    let data = [];
    let firstPick = null;
    let matchedCount = 0;
    let colorMap = {};

    async function loadData() {
      const res = await fetch("game9_assets/fruits_part1.json");
      const json = await res.json();
      data = json.slice(0, 8); // ç¬¬1å›å–å‰8ç­†
      initGame();
    }

    function initGame() {
      matchedCount = 0;
      firstPick = null;
      colorMap = {};
      const grid = document.getElementById("gameGrid");
      grid.innerHTML = "";

      let cards = [];
      data.forEach((item, idx) => {
        cards.push({
          id: item.id,
          type: "img",
          content: `<img src="game9_assets/${item.id}.png">`
        });
        cards.push({
          id: item.id,
          type: "text",
          content: `<span style="color:${textColors[idx % textColors.length]}">${item.taiwanese}</span>`
        });
      });

      cards.sort(() => Math.random() - 0.5);

      cards.forEach(card => {
        const div = document.createElement("div");
        div.className = "card";
        div.dataset.id = card.id;
        div.dataset.type = card.type;
        div.innerHTML = card.content;
        div.onclick = () => handleClick(div);
        grid.appendChild(div);
      });
    }

    function handleClick(card) {
      if (card.classList.contains("matched")) return;

      if (!firstPick) {
        firstPick = card;
        card.style.outline = "3px solid #ff9800";
      } else {
        if (firstPick === card) return;

        if (firstPick.dataset.id === card.dataset.id &&
            firstPick.dataset.type !== card.dataset.type) {
          // âœ… æˆåŠŸé…å°
          let color = groupColors[matchedCount % groupColors.length];
          [firstPick, card].forEach(c => {
            c.classList.add("matched");
            c.style.background = color;
            c.style.color = "white";
            c.style.outline = "none";
          });

          matchedCount++;
          // æ’­æ”¾æ­£ç¢ºéŸ³æª”
          const item = data.find(d => d.id === card.dataset.id);
          if (item && item.audio) {
            new Audio(item.audio).play();
          }

          if (matchedCount === data.length) {
            document.getElementById("victorySound").play();
            const v = document.getElementById("victory");
            v.classList.add("show");
            setTimeout(() => v.classList.remove("show"), 2000);
          }
        } else {
          // âŒ éŒ¯èª¤é…å°
          document.getElementById("wrongSound").play();
          firstPick.style.outline = "none";
        }
        firstPick = null;
      }
    }

    function restartGame() {
      initGame();
    }
    function nextRound() {
      window.location.href = "game9_round2.html";
    }
    function goHome() {
      window.location.href = "index.html";
    }

    loadData();
  </script>
</body>
</html>

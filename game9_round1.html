<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æœå­åœ–ç‰‡ & å°èªæœå­åé…å° - ç¬¬1å›</title>
  <style>
    :root{
      --grid-gap:8px;
      --card-height-vw:22vw; /* å›ºå®šæ ¼å­é«˜åº¦ï¼ˆéŸ¿æ‡‰å¼ï¼‰ */
      --card-max-height:140px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:0;
      font-family: "Microsoft JhengHei", "Noto Sans", Arial, sans-serif;
      background:#ffffff;
      color:#222;
      text-align:center;
    }
    header{
      padding:10px 12px 4px;
    }
    h1{margin:0;font-size:1.25rem;color:#cc5500;}
    .hint{
      margin-top:6px;
      margin-bottom:8px;
      font-size:1.5rem;           /* åŠ å¤§æç¤ºå­—æ¨£ */
      color:#d35400;
      font-weight:700;
    }

    /* grid: å›ºå®š 4x4 */
    .grid{
      display:grid;
      grid-template-columns:repeat(4,1fr);
      gap:var(--grid-gap);
      max-width:96vw;
      margin:0 auto 14px;
      padding:6px;
    }

    .card{
      background:#fafafa;
      border:1.4px solid #dcdcdc;
      border-radius:10px;
      height:var(--card-height-vw);
      max-height:var(--card-max-height);
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      user-select:none;
      overflow:hidden;
      padding:6px;
      transition:transform .12s ease, border-color .12s ease;
    }
    .card:active{ transform:scale(.99); }

    /* åœ–ç‰‡åœ¨å¡ç‰‡å…§ */
    .card img{
      max-width:78%;
      max-height:68%;
      object-fit:contain;
      display:block;
      border-radius:6px;
    }

    /* æ–‡å­—å¡ç‰‡ï¼šæ–‡å­—ä½”æ ¼å­å¤§å° 60â€“70% (éŸ¿æ‡‰å¼) */
    .card .fruit-text{
      display:block;
      width:100%;
      text-align:center;
      font-weight:700;
      /* clamp(min, preferred, max) for responsive large text */
      font-size: clamp(18px, 6.5vw, 34px); 
      line-height:1;
      color:#111; /* çµ±ä¸€æ·±è‰²å­— */
      padding:2px 6px;
      word-break:break-word;
    }

    /* é¸å–æ¨£å¼ */
    .selected{
      outline: 3px solid #ffb84d;
      outline-offset: -6px;
    }

    /* matched: ä½¿ç”¨æ·ºè‰²åº•ã€æ–‡å­—ä»ç‚ºæ·±è‰²ä»¥ç¶­æŒå¯è®€æ€§ */
    .matched{
      pointer-events:none;
    }

    /* victory */
    #victory{
      position:fixed;
      top:45%;
      left:50%;
      transform:translate(-50%,-50%) scale(.4);
      font-size:2.6rem;
      font-weight:800;
      color:#e74c3c;
      background:transparent;
      z-index:1200;
      opacity:0;
      transition: transform .5s ease, opacity .4s ease;
      pointer-events:none;
    }
    #victory.show{
      transform:translate(-50%,-50%) scale(1.4);
      opacity:1;
    }

    /* åº•éƒ¨æŒ‰éˆ•ï¼ˆç¶­æŒæ‚¨æœ€å¾Œå¸Œæœ›ä¸è®Šçš„æ¨£å¼ï¼‰ */
    .bottom{
      position:fixed;
      left:0; right:0; bottom:0;
      background:#fff8dc;
      border-top:1px solid #e6ddd0;
      padding:10px 8px;
      display:flex;
      justify-content:space-around;
      gap:8px;
      z-index:1100;
    }
    .bottom button{
      background:#ff9800;
      color:#fff;
      border:none;
      padding:10px 14px;
      border-radius:8px;
      font-size:1rem;
      cursor:pointer;
      min-width:88px;
    }

    /* å°è¢å¹•å¾®èª¿ */
    @media(max-width:480px){
      :root{ --card-height-vw:26vw; }
      .hint{ font-size:1.35rem; }
    }
    @media(min-width:900px){
      :root{ --card-height-vw:16vw; --card-max-height:150px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>æœå­åœ–ç‰‡ & å°èªæœå­åé…å° â€” ç¬¬1å›</h1>
    <div class="hint">ğŸ“± å»ºè­°ç›´å¼è§€çœ‹æ•ˆæœæœ€ä½³</div>
  </header>

  <main>
    <div class="grid" id="grid"></div>
  </main>

  <div id="victory">æœ‰å¤  gÃ¢uï¼</div>

  <div class="bottom">
    <button onclick="location.reload()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
    <button onclick="location.href='game9_round2.html'">â­ ä¸‹ä¸€å›</button>
    <button onclick="location.href='index.html'">â¬… å›é¦–é </button>
  </div>

  <audio id="wrongAudio" src="game9_assets/wrong1.mp3" preload="auto"></audio>
  <audio id="victoryAudio" src="game9_assets/victory2.mp3" preload="auto"></audio>

  <script>
    // å–è‡ª fruits_part1.jsonï¼ˆæ”¾åœ¨ game9_assets è³‡æ–™å¤¾ï¼‰
    const JSON_PATH = 'game9_assets/fruits_part1.json';
    const ROUND_COUNT = 8; // æœ¬å›å–å‰ 8 ç­†
    const grid = document.getElementById('grid');
    const wrongAudio = document.getElementById('wrongAudio');
    const victoryAudio = document.getElementById('victoryAudio');
    const victoryEl = document.getElementById('victory');

    // æ·ºè‰²ç³»é¡è‰²ï¼ˆæ•¸é‡ >= ROUND_COUNTï¼Œä¸”éƒ½åæ·ºï¼Œæ–‡å­—ä½¿ç”¨æ·±è‰²ï¼‰
    const palette = [
      '#fff2e8', '#fffbe6', '#e8fff3', '#e8f5ff',
      '#fff0f6', '#f7fff2', '#fff7e6', '#f0f7ff',
      '#fbf0ff', '#f0fff6'
    ];

    let fruits = [];      // æœƒæ”¾ 8 ç­†ç‰©ä»¶ï¼ˆä¾†è‡ª JSONï¼‰
    let cards = [];       // 16 å¼µå¡
    let first = null;
    let lock = false;
    let matchedPairs = 0;
    let colorMap = {};    // id -> bg colorï¼ˆå”¯ä¸€ï¼‰

    // å¹«åŠ©å‡½å¼ï¼šFisher-Yates shuffle
    function shuffle(arr){
      for(let i = arr.length -1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // è¼‰å…¥ JSON ä¸¦åˆå§‹åŒ–
    fetch(JSON_PATH)
      .then(r => {
        if (!r.ok) throw new Error('ç„¡æ³•è®€å– JSON');
        return r.json();
      })
      .then(all => {
        if (!Array.isArray(all)) throw new Error('JSON çµæ§‹ä¸æ˜¯é™£åˆ—');
        fruits = all.slice(0, ROUND_COUNT); // å–å‰ 8 ç­†
        setup();
      })
      .catch(err => {
        console.error('è®€ JSON éŒ¯èª¤:', err);
        alert('ç„¡æ³•è¼‰å…¥æœå­è³‡æ–™ï¼ˆfruits_part1.jsonï¼‰ã€‚è«‹ç¢ºèªæª”æ¡ˆä½æ–¼ game9_assets/ è£¡ã€‚');
      });

    function setup(){
      matchedPairs = 0;
      first = null;
      lock = false;
      grid.innerHTML = '';
      cards = [];

      // ç”¢ç”Ÿæ¯çµ„å”¯ä¸€æ·ºè‰²ï¼šå…ˆæ‰“äº‚ paletteï¼Œç„¶å¾Œåˆ†é…çµ¦ fruits çš„ idï¼ˆç¢ºä¿å”¯ä¸€ä¸”ä¸é‡è¤‡ï¼‰
      const colors = shuffle(palette.slice());
      fruits.forEach((f, idx) => {
        colorMap[f.id] = colors[idx % colors.length];
        // åœ–ç‰‡å¡
        cards.push({ id: f.id, type: 'img', data: f });
        // æ–‡å­—å¡
        cards.push({ id: f.id, type: 'text', data: f });
      });

      shuffle(cards);

      // å»º DOM å¡ç‰‡
      cards.forEach(card => {
        const el = document.createElement('div');
        el.className = 'card';
        el.dataset.id = card.id;
        el.dataset.type = card.type;
        el.setAttribute('role','button');
        el.setAttribute('tabindex','0');

        if (card.type === 'img'){
          const img = document.createElement('img');
          img.src = `game9_assets/${card.id}.png`;
          img.alt = card.data.chinese || card.data.taiwanese || card.id;
          img.onerror = () => { img.style.opacity = 0.6; img.alt='åœ–ç‰‡è¼‰å…¥å¤±æ•—'; };
          el.appendChild(img);
        } else {
          const span = document.createElement('span');
          span.className = 'fruit-text';
          // æ–‡å­—ç›´æ¥ä¾†è‡ª JSON çš„ taiwanese æ¬„ä½
          span.textContent = card.data.taiwanese || card.data.chinese || card.id;
          el.appendChild(span);
        }

        // é»æ“Šèˆ‡éµç›¤ Enter/Space æ”¯æ´
        el.addEventListener('click', () => onPick(el));
        el.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); onPick(el); }
        });

        grid.appendChild(el);
      });
    }

    function onPick(el){
      if (lock) return;
      if (el.classList.contains('matched')) return;

      // é¸å–/å–æ¶ˆé¸å–
      if (!first){
        first = el;
        el.classList.add('selected');
        return;
      }

      // å¦‚æœé»åˆ°åŒä¸€å¼µå°±å–æ¶ˆ
      if (first === el){
        first.classList.remove('selected');
        first = null;
        return;
      }

      // ç¬¬äºŒå¼µè¢«é¸
      el.classList.add('selected');

      // æª¢æŸ¥æ˜¯å¦ç‚ºåŒä¸€ idï¼Œä¸” type ä¸åŒï¼ˆåœ–å°å­—ï¼‰
      const idA = first.dataset.id;
      const idB = el.dataset.id;
      const typeA = first.dataset.type;
      const typeB = el.dataset.type;

      if (idA === idB && typeA !== typeB){
        // æˆåŠŸé…å°ï¼šå¥—ç”¨è©² id çš„æ·ºè‰²åº•ï¼Œæ–‡å­—ç¶­æŒæ·±è‰²
        const bg = colorMap[idA] || '#e9f5e9';
        [first, el].forEach(node => {
          node.classList.remove('selected');
          node.classList.add('matched');
          node.style.backgroundColor = bg;
          node.style.borderColor = '#cccccc';
          // æ–‡å­—ä¿æŒæ·±è‰²ä¾¿æ–¼é–±è®€ï¼š
          node.style.color = '#111';
        });

        // æ’­æ”¾è©²æ°´æœçš„å°èªéŸ³æª”ï¼ˆä½¿ç”¨ JSON çš„ audio æ¬„ä½ï¼‰
        const fruitObj = fruits.find(f => f.id === idA);
        if (fruitObj && fruitObj.audio){
          try { new Audio(fruitObj.audio).play(); } catch(e){ console.warn('æ’­æ”¾èªéŸ³éŒ¯èª¤', e); }
        }

        matchedPairs += 1;
        first = null;

        if (matchedPairs === fruits.length){
          // å…¨éƒ¨å®Œæˆï¼šæ’­å‹åˆ©éŸ³ã€é¡¯ç¤ºå‹•ç•«æ–‡å­—
          try { victoryAudio.currentTime = 0; victoryAudio.play(); } catch(e){}
          victoryEl.classList.add('show');
          setTimeout(()=> victoryEl.classList.remove('show'), 2200);
        }
      } else {
        // éŒ¯èª¤é…å°ï¼šæ’­æ”¾éŒ¯èª¤éŸ³ï¼Œä¸¦çŸ­æš«å±•ç¤ºéŒ¯èª¤æ¨£å¼
        try { wrongAudio.currentTime = 0; wrongAudio.play(); } catch(e){}
        // æš«æ™‚å¢å¼·é‚Šæ¡†æç¤º
        first.classList.add('wrong');
        el.classList.add('wrong');
        lock = true;
        setTimeout(()=>{
          first.classList.remove('wrong','selected');
          el.classList.remove('wrong','selected');
          lock = false;
          first = null;
        },700);
      }
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æœå­åœ–ç‰‡ & å°èªæœå­åé…å° - ç¬¬1å›</title>
  <style>
    :root{
      --card-h: 140px; /* å›ºå®šæ ¼å­é«˜åº¦ï¼ˆå¯è¦–éœ€æ±‚å¾®èª¿ï¼‰ */
      --grid-gap: 8px;
      --max-grid-width: 980px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:0;
      font-family: "Noto Sans TC", "Microsoft JhengHei", Arial, sans-serif;
      background:#ffffff; color:#222; text-align:center;
    }
    header{ padding:10px 12px 0; }
    h1{ margin:0; font-size:1.2rem; color:#cc5500; }
    .hint{
      margin:10px 0 8px;
      font-size:1.45rem; /* æ›´é†’ç›® */
      color:#d35400; font-weight:700;
    }

    /* Grid å›ºå®š 4x4ï¼ˆ16 æ ¼ï¼‰ */
    .grid {
      display:grid;
      grid-template-columns: repeat(4, 1fr);
      gap: var(--grid-gap);
      max-width: var(--max-grid-width);
      margin: 0 auto 16px;
      padding: 6px;
    }

    .card {
      background:#fafafa;
      border:1.4px solid #ddd;
      border-radius:10px;
      height: var(--card-h);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      cursor:pointer;
      transition: transform .08s ease, border-color .12s ease;
      padding:6px;
    }
    .card:active{ transform: scale(.995); }

    /* åœ–ç‰‡ */
    .card img {
      max-width:78%;
      max-height:68%;
      object-fit:contain;
      display:block;
      border-radius:6px;
    }

    /* æ–‡å­—ï¼ˆä½”æ ¼å­ 60â€“70%ï¼‰    */
    .fruit-text {
      font-weight:800;
      color:#111; /* çµ±ä¸€æ·±è‰²æ–‡å­—ï¼Œé…æ·ºåº•æ›´æ¸…æ¥š */
      line-height:1;
      /* ä½¿ç”¨ clamp èˆ‡å¡ç‰‡é«˜åº¦è¨ˆç®—ï¼Œé¿å…æ–‡å­—è¶…å‡º */
      font-size: clamp(18px, calc(var(--card-h) * 0.55), 72px);
      text-align:center;
      padding:0 6px;
      word-break:break-word;
    }

    /* é¸å– / éŒ¯èª¤æç¤º */
    .selected { outline: 3px solid #ffd28a; outline-offset:-6px; }
    .wrong { outline: 3px solid #e66; outline-offset:-6px; }

    /* å·²é…å°ï¼šæ·ºè‰²åº•ï¼ˆæ–‡å­—ä»æ·±è‰²ï¼‰ï¼Œä½†èƒŒæ™¯é¡è‰²ç”± JS æŒ‡æ´¾ */
    .matched { pointer-events: none; }

    /* å‹åˆ©æ–‡å­— */
    #victory {
      position: fixed;
      top: 42%;
      left: 50%;
      transform: translate(-50%, -50%) scale(.4);
      font-size: 2.6rem;
      font-weight: 900;
      color: #e74c3c;
      opacity: 0;
      z-index: 2000;
      transition: transform .45s ease, opacity .35s ease;
      pointer-events:none;
    }
    #victory.show { transform: translate(-50%, -50%) scale(1.4); opacity:1; }

    /* åº•éƒ¨æŒ‰éˆ•ï¼ˆæ‚¨è¦æ±‚ä¿ç•™åŸæ¨£ï¼‰ */
    .bottom {
      position: fixed;
      left:0; right:0; bottom:0;
      background:#fff8dc;
      border-top:1px solid #e6ddd0;
      padding: 10px 8px;
      display:flex;
      justify-content:space-around;
      gap:8px;
      z-index:1200;
    }
    .bottom button {
      background:#ff9800;
      color:#fff;
      border:none;
      padding:10px 14px;
      border-radius:8px;
      font-size:1rem;
      cursor:pointer;
      min-width:88px;
    }

    /* å°è¢å¹•å¾®èª¿ */
    @media(max-width:480px){
      :root{ --card-h: 120px; }
      .hint { font-size: 1.25rem; }
    }
    @media(min-width:900px){
      :root{ --card-h:160px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>æœå­åœ–ç‰‡ & å°èªæœå­åé…å° â€” ç¬¬1å›</h1>
    <div class="hint">ğŸ“± å»ºè­°ç›´å¼è§€çœ‹æ•ˆæœæœ€ä½³</div>
  </header>

  <main>
    <div class="grid" id="grid"></div>
  </main>

  <div id="victory">æœ‰å¤  gÃ¢uï¼</div>

  <div class="bottom">
    <button onclick="location.reload()">ğŸ”„ å†ç©ä¸€æ¬¡</button>
    <button onclick="location.href='game9_round2.html'">â­ ä¸‹ä¸€å›</button>
    <button onclick="location.href='index.html'">â¬… å›é¦–é </button>
  </div>

  <audio id="wrongAudio" src="game9_assets/wrong1.mp3" preload="auto"></audio>
  <audio id="victoryAudio" src="game9_assets/victory2.mp3" preload="auto"></audio>

  <script>
    // é¡è‰²èª¿è‰²ç›¤ï¼šæ·ºè‰²ä¸”å·®ç•°æ˜é¡¯ï¼ˆä¿è­‰æ–‡å­—æ·±è‰²å¯è®€ï¼‰
    const palette = [
      "#FFF1B8", // æ·¡é»ƒ
      "#DFF8E2", // æ·¡ç¶ 
      "#E8E8FF", // æ·¡ç´«
      "#FFEFD6", // æ·¡èœœæ©˜
      "#DFF4F4", // æ·¡é’
      "#FFD6E0", // æ·¡ç²‰
      "#CDE7FF", // æ·¡è—
      "#F0F7E6"  // æ·¡ç°ç¶ 
    ];

    const GRID_JSON = 'game9_assets/fruits_part1.json';
    const ROUND_COUNT = 8; // ç¬¬1å›å–å‰ 8 ç­†
    const grid = document.getElementById('grid');
    const wrongAudio = document.getElementById('wrongAudio');
    const victoryAudio = document.getElementById('victoryAudio');
    const victoryEl = document.getElementById('victory');

    let fruits = [];    // ä¾†æº JSONï¼ˆå‰8ç­†ï¼‰
    let cards = [];     // å°‡åŒ…å« 16 å¼µå¡ï¼š8 åœ– + 8 æ–‡
    let selected = null;
    let lock = false;
    let matched = 0;
    let colorMap = {};  // id -> bgColor (å”¯ä¸€)

    // å°å·¥å…·ï¼šFisher-Yates shuffleï¼ˆå°±åœ°ï¼‰
    function shuffle(arr){
      for(let i = arr.length -1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // è¼‰å…¥ JSON ä¸¦åˆå§‹åŒ–
    fetch(GRID_JSON)
      .then(r => {
        if(!r.ok) throw new Error('ç„¡æ³•è®€å– fruits_part1.json');
        return r.json();
      })
      .then(all => {
        if(!Array.isArray(all)) throw new Error('fruits_part1.json æ ¼å¼éé™£åˆ—');
        fruits = all.slice(0, ROUND_COUNT);
        init();
      })
      .catch(err => {
        console.error('è®€ JSON éŒ¯èª¤ï¼š', err);
        alert('ç„¡æ³•è®€å–æ°´æœè³‡æ–™ (fruits_part1.json)ã€‚è«‹ç¢ºèªæª”æ¡ˆåœ¨ game9_assets/ã€‚');
      });

    function init(){
      grid.innerHTML = '';
      cards = [];
      selected = null;
      lock = false;
      matched = 0;
      colorMap = {};

      // ç‚ºæ¯å€‹ id æŒ‡æ´¾å”¯ä¸€æ·ºè‰²ï¼ˆå…ˆæ‰“äº‚ paletteï¼Œå†ä¾åºçµ¦ fruitsï¼‰
      const colors = shuffle(palette.slice());
      fruits.forEach((f,i) => { colorMap[f.id] = colors[i % colors.length]; });

      // å»ºç«‹ cards
      fruits.forEach(f => {
        cards.push({ id: f.id, type:'img', data: f });
        cards.push({ id: f.id, type:'text', data: f });
      });

      shuffle(cards);

      // å»º DOM
      cards.forEach(c => {
        const el = document.createElement('div');
        el.className = 'card';
        el.dataset.id = c.id;
        el.dataset.type = c.type;
        el.setAttribute('role','button');
        el.setAttribute('tabindex','0');

        if(c.type === 'img'){
          const img = document.createElement('img');
          img.src = `game9_assets/${c.id}.png`;
          img.alt = c.data.chinese || c.data.taiwanese || c.id;
          img.onerror = () => { img.style.opacity = 0.6; img.alt = 'åœ–ç‰‡è¼‰å…¥å¤±æ•—'; };
          el.appendChild(img);
        } else {
          const span = document.createElement('span');
          span.className = 'fruit-text';
          span.textContent = c.data.taiwanese || c.data.chinese || c.id;
          el.appendChild(span);
        }

        // äº’å‹•ï¼šclick / keyboard
        el.addEventListener('click', () => pick(el));
        el.addEventListener('keydown', e => {
          if(e.key === 'Enter' || e.key === ' ') { e.preventDefault(); pick(el); }
        });

        grid.appendChild(el);
      });
    }

    function pick(el){
      if(lock) return;
      if(el.classList.contains('matched')) return;

      // ç¬¬ä¸€å¼µ
      if(!selected){
        selected = el;
        el.classList.add('selected');
        return;
      }

      // å¦‚æœé¸åˆ°åŒä¸€å¼µ -> å–æ¶ˆ
      if(selected === el){
        selected.classList.remove('selected');
        selected = null;
        return;
      }

      // é¸åˆ°ç¬¬äºŒå¼µ
      el.classList.add('selected');

      const idA = selected.dataset.id;
      const idB = el.dataset.id;
      const typeA = selected.dataset.type;
      const typeB = el.dataset.type;

      // æˆåŠŸæ¢ä»¶ï¼šid ç›¸åŒä¸” type ä¸åŒï¼ˆåœ–å°å­—ï¼‰
      if(idA === idB && typeA !== typeB){
        const bg = colorMap[idA] || '#eaf7e8';
        [selected, el].forEach(node => {
          node.classList.remove('selected');
          node.classList.add('matched');
          node.style.backgroundColor = bg;
          node.style.borderColor = '#ddd';
          // æ–‡å­—ï¼ˆè‹¥æœ‰ï¼‰ä¿æŒæ·±è‰²ï¼Œåœ–ç‰‡ä»æ¸…æ™°
          node.style.color = '#111';
        });

        // æ’­æ”¾æ­£ç¢ºéŸ³æª”ï¼ˆJSON çš„ audio æ¬„ä½ï¼‰
        const fruitObj = fruits.find(f => f.id === idA);
        if(fruitObj && fruitObj.audio){
          try { new Audio(fruitObj.audio).play(); } catch(e){ console.warn('æ’­æ”¾ audio éŒ¯èª¤', e); }
        }

        matched++;
        selected = null;

        if(matched === fruits.length){
          // å…¨éƒ¨å®Œæˆ
          try { victoryAudio.currentTime = 0; victoryAudio.play(); } catch(e){}
          victoryEl.classList.add('show');
          setTimeout(()=> victoryEl.classList.remove('show'), 2200);
        }
      } else {
        // éŒ¯èª¤ï¼šæç¤ºä¸¦å›å¾©
        try { wrongAudio.currentTime = 0; wrongAudio.play(); } catch(e){}
        selected.classList.add('wrong');
        el.classList.add('wrong');
        lock = true;
        setTimeout(()=> {
          selected.classList.remove('selected','wrong');
          el.classList.remove('selected','wrong');
          selected = null;
          lock = false;
        }, 650);
      }
    }
  </script>
</body>
</html>

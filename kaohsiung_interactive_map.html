<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>高雄市38區新舊地名互動地圖 v6.13b</title>
<style>
html,body{margin:0;height:100%;font-family:"Noto Sans TC","Microsoft JhengHei",sans-serif;background:#f7f8fb;color:#0f172a;text-align:center}
h1{margin:10px 0 4px;font-size:1.5rem;font-weight:800}
.notice{margin:2px 0;color:#555;font-size:.95rem}
.groupbar{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;max-width:980px;margin:10px auto;padding:0 12px}
.groupbar button{border:0;border-radius:14px;padding:10px 6px;font-size:1rem;color:#fff;cursor:pointer;
box-shadow:0 4px 10px rgba(0,0,0,.18);transition:all .2s;position:relative;line-height:1.1}
@media(max-width:420px){.groupbar button{font-size:.95rem;padding:10px 4px}}
.groupbar button.is-on{outline:2px solid #fff;transform:translateY(-1px)}
.btn-core{background:linear-gradient(145deg,#6FA8DC,#9EC6F2)} .btn-east{background:linear-gradient(145deg,#93C47D,#B5D99F)}
.btn-north{background:linear-gradient(145deg,#F6B26B,#FFD79C)} .btn-mount{background:linear-gradient(145deg,#B4A7D6,#D2C4F2)}
.badge{position:absolute;top:-6px;right:-8px;border-radius:50%;min-width:22px;height:22px;padding:0 6px;
display:flex;align-items:center;justify-content:center;font-size:.78rem;font-weight:700;color:#333;box-shadow:0 2px 6px rgba(0,0,0,.25)}
main{max-width:980px;margin:0 auto;padding:0 12px 10px}
#mapbox{width:100%;height:calc(100vh - 230px);min-height:420px;position:relative;background:#fff;border-radius:14px;
border:1px solid #e5e7eb;box-shadow:0 8px 18px rgba(0,0,0,.08);overflow:hidden}
#mapContainer svg{width:100%;height:100%}
.dimmed{opacity:.15}
.strong-stroke{stroke:#1f2937;stroke-width:.9}
.light-stroke{stroke:#a0aec0;stroke-width:.6}
@keyframes glow{0%{filter:none}50%{filter:drop-shadow(0 0 12px #fff)}100%{filter:none}}
.glow{animation:glow 1.4s ease}
.popup{position:absolute;display:none;background:#fff;border-radius:12px;padding:10px;z-index:60;
border:1px solid rgba(0,0,0,.08);box-shadow:0 10px 24px rgba(0,0,0,.18);min-width:190px;max-width:min(300px,85%)}
.popup h3{margin:0 0 4px;font-size:1.05rem;font-weight:800}
.newP{color:#00796b;font-weight:800}.old{margin-top:2px}.oldP{color:#6a1b9a;font-weight:700}
.row{display:flex;gap:8px;margin-top:8px;justify-content:center;flex-wrap:wrap}
.btn{padding:6px 10px;border-radius:10px;border:0;color:#fff;cursor:pointer;box-shadow:0 3px 8px rgba(0,0,0,.22)}
.btn.play{background:linear-gradient(145deg,#64b5f6,#1565c0)}.btn.old{background:linear-gradient(145deg,#ffa27a,#e66a3a)}
footer{padding:12px 0}
footer a{display:inline-block;background:linear-gradient(145deg,#4CAF50,#2e7d32);color:#fff;
padding:8px 16px;border-radius:12px;text-decoration:none;box-shadow:0 3px 8px rgba(0,0,0,.22)}
</style>
</head>
<body>
<h1>高雄市38區新舊地名互動地圖</h1>
<p class="notice">📱 建議直式觀看效果最佳</p>
<p class="notice">👆 點行政區看新舊地名並播放音檔</p>

<div class="groupbar" id="groupbar">
<button class="btn-core is-on" data-group="core">市中心<span class="badge">11</span></button>
<button class="btn-east" data-group="east">市郊-東區<span class="badge">7</span></button>
<button class="btn-north" data-group="north">市郊-北區<span class="badge">11</span></button>
<button class="btn-mount" data-group="mountain">山區<span class="badge">9</span></button>
</div>

<main>
<div id="mapbox">
  <div id="mapContainer">載入地圖中...</div>
  <div class="popup" id="popup">
    <h3 id="pop-new">—</h3>
    <div class="newP" id="pop-new-poj">—</div>
    <div class="old" id="pop-old">—</div>
    <div class="oldP" id="pop-old-poj">—</div>
    <div class="row">
      <button class="btn play" id="btn-new">播放新地名</button>
      <button class="btn old" id="btn-old">播放舊地名</button>
    </div>
  </div>
</div>
</main>
<footer><a href="https://tsong-su.github.io/iuhi/index.html">🏠 回遊戲首頁</a></footer>

<script>
const COLORS={core:"#6FA8DC",east:"#93C47D",north:"#F6B26B",mountain:"#B4A7D6"};
const GROUPS={core:["楠梓","左營","鼓山","三民","鹽埕","前金","新興","苓雅","旗津","前鎮","小港"],
east:["大樹","大寮","林園","大社","仁武","鳥松","鳳山"],
north:["茄萣","永安","彌陀","梓官","湖內","路竹","岡山","橋頭","阿蓮","田寮","燕巢"],
mountain:["內門","旗山","杉林","美濃","甲仙","六龜","那瑪夏","桃源","茂林"]};
const DATA={"鳳山":{old:"下埤頭",newPoj:"Hōng-suann",oldPoj:"Ē-pi-thâu"}};
let svg, items=[], currentGroup="core";

fetch("map_assets/Blank_Kaohsiung_map.svg").then(r=>r.text()).then(txt=>{
  document.getElementById("mapContainer").innerHTML=txt;
  svg=document.querySelector("#mapContainer svg");
  svg.querySelectorAll("path,polygon,polyline").forEach(el=>{
    el.style.cursor="pointer";
    el.addEventListener("click",()=>el.classList.add("glow"));
  });
}).catch(e=>{
  document.getElementById("mapContainer").innerText="地圖載入失敗："+e;
});

document.querySelectorAll("#groupbar button").forEach(btn=>{
  btn.onclick=()=>{
    currentGroup=btn.dataset.group;
    document.querySelectorAll("#groupbar button").forEach(b=>b.classList.toggle("is-on",b===btn));
  };
});
</script>
</body>
</html>
!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>高雄市38區新舊地名互動地圖 v6.13a</title>
<style>
  html,body{margin:0;height:100%;font-family:"Noto Sans TC",system-ui,"Microsoft JhengHei",sans-serif;background:#f7f8fb;color:#0f172a;text-align:center}
  h1{margin:10px 0 4px;font-size:1.5rem;font-weight:800}
  .notice{margin:2px 0;color:#555;font-size:.95rem}

  .groupbar{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;max-width:980px;margin:10px auto;padding:0 12px}
  .groupbar button{
    border:0;border-radius:14px;padding:10px 6px;font-size:1rem;color:#fff;cursor:pointer;
    box-shadow:0 4px 10px rgba(0,0,0,.18);transition:all .2s;position:relative;line-height:1.1
  }
  @media (max-width:420px){.groupbar button{font-size:.95rem;padding:10px 4px}}
  .groupbar button.is-on{outline:2px solid #fff;transform:translateY(-1px)}
  .btn-core {background:linear-gradient(145deg,#6FA8DC,#9EC6F2)}  .btn-core  .badge{background:#e7f2ff}
  .btn-east {background:linear-gradient(145deg,#93C47D,#B5D99F)}  .btn-east  .badge{background:#e9f7ec}
  .btn-north{background:linear-gradient(145deg,#F6B26B,#FFD79C)}  .btn-north .badge{background:#fff1e3}
  .btn-mount{background:linear-gradient(145deg,#B4A7D6,#D2C4F2)}  .btn-mount .badge{background:#f2edff}
  .badge{
    position:absolute;top:-6px;right:-8px;border-radius:50%;min-width:22px;height:22px;padding:0 6px;
    display:flex;align-items:center;justify-content:center;font-size:.78rem;font-weight:700;color:#333;box-shadow:0 2px 6px rgba(0,0,0,.25)
  }

  main{max-width:980px;margin:0 auto;padding:0 12px 10px}
  #mapbox{
    width:100%;height:calc(100vh - 230px);min-height:420px;position:relative;background:#fff;border-radius:14px;
    border:1px solid #e5e7eb;box-shadow:0 8px 18px rgba(0,0,0,.08);overflow:hidden
  }
  object{width:100%;height:100%}

  /* 群組淡化/描邊 */
  .strong-stroke{stroke:#1f2937;stroke-width:.9}
  .light-stroke{stroke:#a0aec0;stroke-width:.6}

  /* 群組閃爍（Web Animations 有備援 class） */
  @keyframes groupFlash{0%{filter:brightness(1)}50%{filter:brightness(1.65)}100%{filter:brightness(1)}}
  .flash-group{animation:groupFlash 1.4s ease}

  /* 浮框 */
  .popup{position:absolute;display:none;background:#fff;border-radius:12px;padding:10px;z-index:60;
         border:1px solid rgba(0,0,0,.08);box-shadow:0 10px 24px rgba(0,0,0,.18);min-width:190px;max-width:min(300px,85%)}
  .popup h3{margin:0 0 4px;font-size:1.05rem;font-weight:800}
  .newP{color:#00796b;font-weight:800} .old{margin-top:2px} .oldP{color:#6a1b9a;font-weight:700}
  .row{display:flex;gap:8px;margin-top:8px;justify-content:center;flex-wrap:wrap}
  .btn{padding:6px 10px;border-radius:10px;border:0;color:#fff;cursor:pointer;box-shadow:0 3px 8px rgba(0,0,0,.22)}
  .btn.play{background:linear-gradient(145deg,#64b5f6,#1565c0)}
  .btn.old {background:linear-gradient(145deg,#ffa27a,#e66a3a)}

  footer{padding:12px 0}
  footer a{display:inline-block;background:linear-gradient(145deg,#4CAF50,#2e7d32);color:#fff;
           padding:8px 16px;border-radius:12px;text-decoration:none;box-shadow:0 3px 8px rgba(0,0,0,.22)}
</style>
</head>
<body>
  <h1>高雄市38區新舊地名互動地圖</h1>
  <p class="notice">📱 建議直式觀看效果最佳</p>
  <p class="notice">👆 點行政區看新舊地名並播放音檔</p>

  <div class="groupbar" id="groupbar">
    <button class="btn-core is-on"  data-group="core">市中心<span class="badge">11</span></button>
    <button class="btn-east"         data-group="east">市郊-東區<span class="badge">7</span></button>
    <button class="btn-north"        data-group="north">市郊-北區<span class="badge">11</span></button>
    <button class="btn-mount"        data-group="mountain">山區<span class="badge">9</span></button>
  </div>

  <main>
    <div id="mapbox">
      <object id="svgMap" data="map_assets/Blank_Kaohsiung_map.svg" type="image/svg+xml" aria-label="Kaohsiung Map"></object>

      <div class="popup" id="popup">
        <h3 id="pop-new">—</h3>
        <div class="newP" id="pop-new-poj">—</div>
        <div class="old"  id="pop-old">—</div>
        <div class="oldP" id="pop-old-poj">—</div>
        <div class="row">
          <button class="btn play" id="btn-new">播放新地名</button>
          <button class="btn old"  id="btn-old">播放舊地名</button>
        </div>
      </div>
    </div>
  </main>

  <footer><a href="https://tsong-su.github.io/iuhi/index.html">🏠 回遊戲首頁</a></footer>

<script>
/* ===== 顏色 ===== */
const COLORS={ core:"#6FA8DC", east:"#93C47D", north:"#F6B26B", mountain:"#B4A7D6" };

/* ===== 群組與資料 ===== */
const GROUPS={
  core:["楠梓","左營","鼓山","三民","鹽埕","前金","新興","苓雅","旗津","前鎮","小港"],
  east:["大樹","大寮","林園","大社","仁武","鳥松","鳳山"],
  north:["茄萣","永安","彌陀","梓官","湖內","路竹","岡山","橋頭","阿蓮","田寮","燕巢"],
  mountain:["內門","旗山","杉林","美濃","甲仙","六龜","那瑪夏","桃源","茂林"]
};
const DATA={
  "楠梓":{old:"楠仔坑", newPoj:"Lâm-tsú", oldPoj:"Lâm-á-khenn"},
  "左營":{old:"埤仔頭", newPoj:"Tsó-iânn", oldPoj:"Pi-á-thâu"},
  "鼓山":{old:"打鼓山", newPoj:"Kóo-san", oldPoj:"Tánn-kóo-san"},
  "三民":{old:"三塊厝", newPoj:"Sam-bîn", oldPoj:"Sann-tè-tshù"},
  "鹽埕":{old:"鹽埕埔", newPoj:"Iâm-tiânn", oldPoj:"Iâm-tiânn-poo"},
  "前金":{old:"前衿", newPoj:"Tsiân-kim", oldPoj:"Tsiân-khim"},
  "新興":{old:"逮港埔", newPoj:"Sin-hing", oldPoj:"Tāi-káng-poo"},
  "苓雅":{old:"笭仔寮", newPoj:"Lîng-ngá", oldPoj:"Lîng-á-liâu"},
  "旗津":{old:"旗後", newPoj:"Kî-tin", oldPoj:"Kî-āu"},
  "前鎮":{old:"前鎮", newPoj:"Tsiân-tìn", oldPoj:"Tsiân-tìn"},
  "小港":{old:"港仔墘", newPoj:"Sió-káng", oldPoj:"Káng-á kînn"},
  "大樹":{old:"大樹跤", newPoj:"Tuā-tshiū", oldPoj:"Tuā-tshiū-kha"},
  "大寮":{old:"大藔", newPoj:"Tuā-liâu", oldPoj:"Tuā-liâu"},
  "林園":{old:"頂林仔邊", newPoj:"Lîm-hn̂g", oldPoj:"Tíng-nâ-á-pinn"},
  "大社":{old:"三奶壇", newPoj:"Tuā-siā", oldPoj:"Sam-nái-tuânn"},
  "仁武":{old:"仁武庄", newPoj:"Jîn-bú", oldPoj:"Jîn-bú-tsng"},
  "鳥松":{old:"鳥松跤", newPoj:"Tsiáu-tshîng", oldPoj:"Tsiáu-tshîng-kha"},
  "鳳山":{old:"下埤頭", newPoj:"Hōng-suann", oldPoj:"Ē-pi-thâu"},
  "茄萣":{old:"茄苳萣仔", newPoj:"Ka-tiānn", oldPoj:"Ka-tang-tiānn-á"},
  "永安":{old:"烏樹林", newPoj:"Íng-an", oldPoj:"Oo-tshiū-nâ"},
  "彌陀":{old:"彌陀港", newPoj:"Mî-tô", oldPoj:"Bî-lô-káng"},
  "梓官":{old:"梓官", newPoj:"Tsú-kuann", oldPoj:"Tsú-kuann"},
  "湖內":{old:"大湖", newPoj:"Ôo-lāi", oldPoj:"Tuā-ôo"},
  "路竹":{old:"半路竹", newPoj:"Lōo-tik", oldPoj:"Puànn-lōo-tik"},
  "岡山":{old:"阿公店", newPoj:"Kong-san", oldPoj:"A-kong-tiàm"},
  "橋頭":{old:"橋仔頭", newPoj:"Kiô-thâu", oldPoj:"Kiô-á-thâu"},
  "阿蓮":{old:"阿嗹社", newPoj:"A-lian", oldPoj:"A-lian-siā"},
  "田寮":{old:"田藔", newPoj:"Tshân-liâu", oldPoj:"Tshân-liâu"},
  "燕巢":{old:"援剿右", newPoj:"Iàn-tsâu", oldPoj:"Uān-tsâu-iū"},
  "內門":{old:"羅漢內門", newPoj:"Lāi-bûn", oldPoj:"Lô-hàn-lāi-bûn"},
  "旗山":{old:"蕃薯藔", newPoj:"Kî-san", oldPoj:"Han-tsî-liâu"},
  "杉林":{old:"楠梓仙", newPoj:"Sam-nâ", oldPoj:"Lâm-tsú-sian"},
  "美濃":{old:"瀰濃", newPoj:"Bi-long", oldPoj:"Bî-long"},
  "甲仙":{old:"阿里關", newPoj:"Kah-sian", oldPoj:"A-lí-kuan"},
  "六龜":{old:"六龜里社", newPoj:"La̍k-ku", oldPoj:"La̍k-ku-lí-siā"},
  "那瑪夏":{old:"蚊子只", newPoj:"Na-má-siah", oldPoj:"Mangacun"},
  "桃源":{old:"雅爾", newPoj:"Thô-guân", oldPoj:"Ngani"},
  "茂林":{old:"多納", newPoj:"Bōo-lîm", oldPoj:"Tō-na"}
};

/* ===== 工具 ===== */
const $=(s,e=document)=>e.querySelector(s), $$=(s,e=document)=>Array.from(e.querySelectorAll(s));
function stripQu(s){return (s||"").replace(/區$/,'');}
function onlyHan(t){const m=(t||'').match(/[\u4E00-\u9FFF]+/g);return m?m.join(''):'';}
function getNameFromShape(el){
  const selfT = el.querySelector && el.querySelector('title');
  if(selfT && selfT.textContent) return onlyHan(selfT.textContent.trim());
  const p = el.parentNode;
  if(p && p.querySelector){
    const pT = p.querySelector('title');
    if(pT && pT.textContent) return onlyHan(pT.textContent.trim());
  }
  const idName = el.getAttribute('data-name') || el.getAttribute('inkscape:label') || el.getAttribute('id') || '';
  return onlyHan(idName);
}

/* ===== 狀態 ===== */
let svgDoc=null, items=[], itemsByGroup={core:[],east:[],north:[],mountain:[]}, currentGroup="core";
const popup=$("#popup"), popNew=$("#pop-new"), popNewPoj=$("#pop-new-poj"), popOld=$("#pop-old"), popOldPoj=$("#pop-old-poj");
const audioNew=new Audio(), audioOld=new Audio();

/* ===== 幫手：邊框強閃（更明顯） ===== */
function pulseStroke(el, ms=1600){
  // 設定非縮放描邊避免縮放變細
  el.style.setProperty('vector-effect','non-scaling-stroke');
  const prevStroke = el.style.stroke || '';
  const prevWidth  = el.style.strokeWidth || '';
  // 白邊 4px
  el.style.stroke = '#ffffff';
  el.style.strokeWidth = '4px';
  // 外光暈（WAAPI 優先）
  if(el.animate){
    el.animate([
      { filter:'drop-shadow(0 0 0 rgba(255,255,255,0))' },
      { filter:'drop-shadow(0 0 14px rgba(255,255,255,1))', offset:.45 },
      { filter:'drop-shadow(0 0 0 rgba(255,255,255,0))' }
    ], { duration: ms, easing:'ease' });
  }
  setTimeout(()=>{ el.style.stroke = prevStroke; el.style.strokeWidth = prevWidth; }, ms);
}

/* ===== 載入 SVG ===== */
$("#svgMap").addEventListener("load",()=>{
  svgDoc=$("#svgMap").contentDocument;
  if(!svgDoc) return;

  const svgEl=svgDoc.querySelector("svg");
  try{ if(svgEl && !svgEl.getAttribute("viewBox")){ const b=svgEl.getBBox(); svgEl.setAttribute("viewBox",`${b.x} ${b.y} ${b.width} ${b.height}`); } }catch(e){}
  if(svgEl){ svgEl.setAttribute("preserveAspectRatio","xMidYMid meet"); svgEl.setAttribute("width","100%"); svgEl.setAttribute("height","100%"); }

  items=[]; itemsByGroup={core:[],east:[],north:[],mountain:[]};

  svgDoc.querySelectorAll("path, polygon, polyline").forEach(el=>{
    const nm = stripQu(getNameFromShape(el));
    if(!nm || !DATA[nm]) return;
    const grp = (Object.entries(GROUPS).find(([k,v])=>v.includes(nm))||[])[0];
    if(!grp) return;

    const color = COLORS[grp];
    el.style.fill = color; el.setAttribute("fill", color);
    el.classList.add("strong-stroke");
    el.style.cursor="pointer";

    el.addEventListener("click",(evt)=>onDistrictClick(evt,{el,newName:nm,group:grp}));
    items.push({el,newName:nm,group:grp});
    itemsByGroup[grp].push(el);
  });

  setAllNormal(); // 一進頁四區全亮
});

/* ===== 群組切換 ===== */
function setAllNormal(){
  items.forEach(d=>{
    d.el.style.opacity = '1';
    d.el.classList.remove('light-stroke');
    d.el.classList.add('strong-stroke');
  });
  $$("#groupbar button").forEach(b=> b.classList.toggle("is-on", b.dataset.group===currentGroup));
}
function updateGroupDim(){
  // 先全部淡化
  items.forEach(d=>{
    d.el.style.opacity = (d.group===currentGroup) ? '1' : '0.15';
    d.el.classList.toggle('light-stroke', d.group!==currentGroup);
    d.el.classList.toggle('strong-stroke', d.group===currentGroup);
  });
  $$("#groupbar button").forEach(b=> b.classList.toggle("is-on", b.dataset.group===currentGroup));
}
function flashGroupNow(groupKey){
  const arr = itemsByGroup[groupKey] || [];
  if(arr.length===0) return;
  // 以 WAAPI 做亮度動畫；若不支援則使用備援 class
  arr.forEach(el=>{
    if(el.animate){
      el.animate([{filter:'brightness(1)'},{filter:'brightness(1.65)'},{filter:'brightness(1)'}],{duration:1200,easing:'ease'});
    }else{
      el.classList.add('flash-group'); setTimeout(()=>el.classList.remove('flash-group'),1200);
    }
  });
}

$$("#groupbar button").forEach(btn=>{
  btn.addEventListener("click",()=>{
    currentGroup = btn.dataset.group;      // core / east / north / mountain
    updateGroupDim();                       // 其他三群淡化
    flashGroupNow(currentGroup);            // 目標群組必閃
    popup.style.display="none";
  });
});

/* ===== 點單一行政區 ===== */
function onDistrictClick(evt,d){
  pulseStroke(d.el, 1600);  // 更強邊框閃

  const info=DATA[d.newName]||{};
  $("#pop-new").textContent = d.newName;
  $("#pop-new-poj").textContent = info.newPoj || "";
  $("#pop-old").textContent = info.old || "";
  $("#pop-old-poj").textContent = info.oldPoj || "";

  const box=$("#mapbox").getBoundingClientRect();
  popup.style.display="block";
  const w=popup.offsetWidth, h=popup.offsetHeight;
  let left=evt.clientX - box.left + 10, top=evt.clientY - box.top + 10;
  if(left + w > box.width) left = box.width - w - 8;
  if(top + h > box.height) top = box.height - h - 8;
  if(left < 8) left = 8; if(top < 8) top = 8;
  popup.style.left=left+"px"; popup.style.top=top+"px";

  $("#btn-new").onclick=()=>playNewOnly(d);
  $("#btn-old").onclick=()=>playOldOnly(d);
  autoPlaySequence(d); // 新→0.6秒→舊
}

/* ===== 音檔播放 ===== */
const audioNew=new Audio(), audioOld=new Audio(), audioGapMs=600;
function stopAll(){ [audioNew,audioOld].forEach(a=>{try{a.pause();}catch{} a.currentTime=0;}); }
function idxInGroup(group, name){ return GROUPS[group].indexOf(name)+1; }
function newSrc(group,name){ return "map_assets/"+String(idxInGroup(group,name)).padStart(2,"0")+name+"_new.mp3"; }
function oldSrc(group,name){ const oldName=(DATA[name]&&DATA[name].old)||name; return "map_assets/"+String(idxInGroup(group,name)).padStart(2,"0")+oldName+"_old.mp3"; }
function autoPlaySequence(d){ stopAll(); audioNew.src=encodeURI(newSrc(d.group,d.newName)); audioOld.src=encodeURI(oldSrc(d.group,d.newName)); audioNew.onended=()=>setTimeout(()=>audioOld.play().catch(()=>{}),audioGapMs); audioOld.onended=null; audioNew.play().catch(()=>{}); }
function playNewOnly(d){ stopAll(); audioNew.src=encodeURI(newSrc(d.group,d.newName)); audioNew.play().catch(()=>{}); }
function playOldOnly(d){ stopAll(); audioOld.src=encodeURI(oldSrc(d.group,d.newName)); audioOld.play().catch(()=>{}); }

/* ===== 點地圖外關閉浮框 ===== */
document.addEventListener("click",(e)=>{
  if(!e.target.closest("#mapbox") || e.target.closest("#groupbar")) popup.style.display="none";
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<title>果子骰仔遊戲 – 第2回</title>
<style>
  body { font-family: Arial, sans-serif; text-align:center; background:#f5f5f5; margin:0; padding:0; }
  h1 { margin-top:20px; }
  .cube-container { perspective: 800px; width: 200px; height: 200px; margin: 40px auto; }
  .cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1s; }
  .face { position:absolute; width:200px; height:200px; backface-visibility: hidden; display:flex; align-items:center; justify-content:center; font-size:16px; }
  .front  { transform: rotateY(0deg) translateZ(100px); }
  .back   { transform: rotateY(180deg) translateZ(100px); }
  .right  { transform: rotateY(90deg) translateZ(100px); }
  .left   { transform: rotateY(-90deg) translateZ(100px); }
  .top    { transform: rotateX(90deg) translateZ(100px); }
  .bottom { transform: rotateX(-90deg) translateZ(100px); }
  .fruit-name { margin-top: 20px; font-size: 24px; font-weight:bold; }
  .buttons { margin-top: 30px; }
  button { padding:10px 20px; margin:5px; font-size:16px; }
</style>
</head>
<body>

<h1>果子骰仔遊戲 – 第2回</h1>

<div class="cube-container">
  <div class="cube" id="cube">
    <div class="face front"><img src="game9_assets/fruit7.png" width="180" height="180"></div>
    <div class="face back"><img src="game9_assets/fruit8.png" width="180" height="180"></div>
    <div class="face right"><img src="game9_assets/fruit9.png" width="180" height="180"></div>
    <div class="face left"><img src="game9_assets/fruit10.png" width="180" height="180"></div>
    <div class="face top"><img src="game9_assets/fruit11.png" width="180" height="180"></div>
    <div class="face bottom"><img src="game9_assets/fruit12.png" width="180" height="180"></div>
  </div>
</div>

<div class="fruit-name" id="fruitName">請按「擲骰子」開始</div>

<div class="buttons">
  <button id="rollBtn">擲骰子</button>
  <button onclick="window.location.href='https://tsong-su.github.io/iuhi/index.html'">轉去遊戲頭頁</button>
</div>

<audio id="rollSound" src="game9_assets/Roll the dice.mp3"></audio>
<audio id="dingSound" src="game9_assets/ding.mp3"></audio>

<script>
const fruits = [
  {img:'game9_assets/fruit7.png', name:'芳瓜', pinyin:'phang-kue', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/4/4434.mp3'},
  {img:'game9_assets/fruit8.png', name:'葡萄', pinyin:'phû-tô', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/9/9985.mp3'},
  {img:'game9_assets/fruit9.png', name:'蓮霧', pinyin:'lián-bū', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/11/11322.mp3'},
  {img:'game9_assets/fruit10.png', name:'柳丁', pinyin:'liú-ting', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/5/5078.mp3'},
  {img:'game9_assets/fruit11.png', name:'木瓜', pinyin:'bo̍k-kue', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/0/877.mp3'},
  {img:'game9_assets/fruit12.png', name:'梨仔', pinyin:'lâi-á', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/7/7478.mp3'}
];

// 順序打亂，保證每6次不重複
let fruitOrder = [];
function shuffleArray(array){
  let a = array.slice();
  for(let i=a.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}
function resetOrder(){ fruitOrder = shuffleArray(fruits); }
resetOrder();

const cube = document.getElementById('cube');
const fruitNameDiv = document.getElementById('fruitName');
const rollSound = document.getElementById('rollSound');
const dingSound = document.getElementById('dingSound');
const rollBtn = document.getElementById('rollBtn');

let rolling=false;
let rollIndex=0;

const faceTransforms = [
  'rotateY(0deg)',      // front fruit7
  'rotateY(180deg)',    // back fruit8
  'rotateY(90deg)',     // right fruit9
  'rotateY(-90deg)',    // left fruit10
  'rotateX(90deg)',     // top fruit11
  'rotateX(-90deg)'     // bottom fruit12
];

rollBtn.addEventListener('click',()=>{
  if(rolling) return;
  if(fruitOrder.length===0) resetOrder();
  rolling = true;

  let fruit = fruitOrder.shift();

  rollSound.currentTime=0;
  rollSound.play();

  // 隨機旋轉幾圈
  let rotations = 20 + Math.floor(Math.random()*10);
  let current = 0;
  let animInterval = setInterval(()=>{
    let idx = Math.floor(Math.random()*6);
    cube.style.transform = faceTransforms[idx] + ' rotateX('+current*20+'deg)';
    current++;
    if(current>=rotations){
      clearInterval(animInterval);
      cube.style.transform = faceTransforms[fruits.indexOf(fruit)];
      rollSound.pause();
      rollSound.currentTime=0;
      dingSound.currentTime=0;
      dingSound.play();
      fruitNameDiv.textContent = fruit.name + ' ' + fruit.pinyin;
      // 播放水果音檔
      let audio = new Audio(fruit.audio);
      audio.play();
      rolling=false;
    }
  },50);
});
</script>

</body>
</html>

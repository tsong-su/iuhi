<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<title>果子骰仔遊戲-第2回</title>
<style>
  body { font-family: Arial, sans-serif; background: #fff8dc; text-align: center; margin: 0; padding: 0; }
  h1 { margin-top: 20px; font-size: 2em; color: #d2691e; }
  .cube-container { perspective: 800px; width: 200px; height: 200px; margin: 40px auto; }
  .cube { width: 200px; height: 200px; position: relative; transform-style: preserve-3d; transition: transform 1s; }
  .face {
    position: absolute; width: 200px; height: 200px; border: 3px solid #d2691e;
    background-size: cover; background-position: center; line-height: 200px; font-size: 1.5em; color: #fff; font-weight: bold;
  }
  .face1 { transform: rotateY(0deg) translateZ(100px); }
  .face2 { transform: rotateY(90deg) translateZ(100px); }
  .face3 { transform: rotateY(180deg) translateZ(100px); }
  .face4 { transform: rotateY(-90deg) translateZ(100px); }
  .face5 { transform: rotateX(90deg) translateZ(100px); }
  .face6 { transform: rotateX(-90deg) translateZ(100px); }
  #fruit-name { margin-top: 20px; font-size: 1.5em; color: #8b0000; }
  button { margin: 10px; padding: 10px 20px; font-size: 1em; border-radius: 8px; border: none; background: #d2691e; color: white; cursor: pointer; }
  button:hover { background: #b25500; }
</style>
</head>
<body>

<h1>果子骰仔遊戲-第2回</h1>

<div class="cube-container">
  <div class="cube" id="cube">
    <div class="face face1" id="face1"></div>
    <div class="face face2" id="face2"></div>
    <div class="face face3" id="face3"></div>
    <div class="face face4" id="face4"></div>
    <div class="face face5" id="face5"></div>
    <div class="face face6" id="face6"></div>
  </div>
</div>

<div id="fruit-name">準備好了，按「搖骰子」開始！</div>

<button id="rollBtn">搖骰子</button>
<button onclick="location.href='game9_round7.html'">後一回</button>
<button onclick="location.href='https://tsong-su.github.io/iuhi/index.html'">轉去遊戲頭頁</button>

<audio id="rollSound" src="game9_assets/Roll the dice.mp3"></audio>
<audio id="stopSound" src="game9_assets/ding.mp3"></audio>

<script>
const cube = document.getElementById('cube');
const fruitName = document.getElementById('fruit-name');
const rollBtn = document.getElementById('rollBtn');
const rollSound = document.getElementById('rollSound');
const stopSound = document.getElementById('stopSound');

const fruits = [
  {img:'game9_assets/fruit7.png', name:'芳瓜', pinyin:'phang-kue', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/4/4434.mp3'},
  {img:'game9_assets/fruit8.png', name:'葡萄', pinyin:'phû-tô', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/9/9985.mp3'},
  {img:'game9_assets/fruit9.png', name:'蓮霧', pinyin:'lián-bū', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/11/11322.mp3'},
  {img:'game9_assets/fruit10.png', name:'柳丁', pinyin:'liú-ting', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/5/5078.mp3'},
  {img:'game9_assets/fruit11.png', name:'木瓜', pinyin:'bo̍k-kue', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/0/877.mp3'},
  {img:'game9_assets/fruit12.png', name:'梨仔', pinyin:'lâi-á', audio:'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/7/7478.mp3'}
];

// 將水果分配到 cube 六面
function assignFaces() {
  for(let i=0;i<6;i++){
    document.getElementById('face'+(i+1)).style.backgroundImage = `url(${fruits[i].img})`;
  }
}
assignFaces();

// 打亂水果順序，確保每輪 6 次不重複
let fruitOrder = [...fruits];
function shuffle(array){
  for(let i=array.length-1;i>0;i--){
    let j=Math.floor(Math.random()*(i+1));
    [array[i], array[j]] = [array[j], array[i]];
  }
}
shuffle(fruitOrder);

let isRolling = false;

rollBtn.addEventListener('click',()=>{
  if(isRolling) return;
  isRolling = true;

  rollSound.currentTime = 0;
  rollSound.play();

  let angleX = 0;
  let angleY = 0;
  let rotations = 20 + Math.floor(Math.random()*20);

  let rollInterval = setInterval(()=>{
    angleX += 90*Math.floor(Math.random()*2+1);
    angleY += 90*Math.floor(Math.random()*2+1);
    cube.style.transform = `rotateX(${angleX}deg) rotateY(${angleY}deg)`;
    rotations--;
    if(rotations<=0){
      clearInterval(rollInterval);
      isRolling=false;
      showFruit();
      stopSound.currentTime = 0;
      stopSound.play();
    }
  }, 100);
});

function showFruit(){
  if(fruitOrder.length===0){
    fruitOrder = [...fruits];
    shuffle(fruitOrder);
  }
  const fruit = fruitOrder.shift();
  fruitName.innerHTML = `${fruit.name} ${fruit.pinyin}`;
  const audio = new Audio(fruit.audio);
  audio.play();
  // 將 cube 六面對應成當前水果
  cube.style.transform = 'rotateX(0deg) rotateY(0deg)'; 
  document.getElementById('face1').style.backgroundImage = `url(${fruit.img})`;
  document.getElementById('face2').style.backgroundImage = `url(${fruit.img})`;
  document.getElementById('face3').style.backgroundImage = `url(${fruit.img})`;
  document.getElementById('face4').style.backgroundImage = `url(${fruit.img})`;
  document.getElementById('face5').style.backgroundImage = `url(${fruit.img})`;
  document.getElementById('face6').style.backgroundImage = `url(${fruit.img})`;
}
</script>

</body>
</html>

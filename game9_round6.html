<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
<meta charset="UTF-8">
<title>果子骰仔遊戲－第2回</title>
<style>
body { font-family: Arial, sans-serif; background-color: #fff; color: #333; text-align: center; }
.cube-wrap { width:100%; display:flex; justify-content:center; align-items:center; margin: 20px 0; }
.cube-stage { width: min(90vw, 200px); height: min(90vw, 200px); max-width:200px; max-height:200px; perspective:1200px; }
.cube { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1s ease; }
.cube-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border: 3px solid #6B1E6A; border-radius: 10px; display: flex; justify-content: center; align-items: center; font-weight: bold; font-size: 1.2rem; background-color: #fff; }
.cube-face img { max-width: 90%; max-height: 90%; }
button { padding: 10px 20px; margin: 5px; font-size: 1rem; cursor: pointer; border: none; border-radius: 8px; background-color: #6B1E6A; color: #fff; }
button:hover { background-color: #8A3390; }
#fruit-name { margin-top: 15px; font-size: 1.2rem; font-weight: bold; }
</style>
</head>
<body>
<h1>果子骰仔遊戲－第2回</h1>
<p>📱 建議直式觀看效果最佳</p>
<div class="cube-wrap">
  <div class="cube-stage">
    <div class="cube" id="cube">
      <div class="cube-face" id="face1"></div>
      <div class="cube-face" id="face2"></div>
      <div class="cube-face" id="face3"></div>
      <div class="cube-face" id="face4"></div>
      <div class="cube-face" id="face5"></div>
      <div class="cube-face" id="face6"></div>
    </div>
  </div>
</div>
<div id="fruit-name"></div>
<button id="roll-btn">撚骰仔 🎲</button>
<button id="again-btn">閣耍一擺</button>
<button onclick="location.href='index.html'">轉去遊戲頭頁</button>
<button id="next-btn">後一回</button>
<audio id="roll-sound" src="game9_assets/Roll the dice.mp3"></audio>
<audio id="ding-sound" src="game9_assets/ding.mp3"></audio>
<script>
const fruits = [
  {name: '芳瓜', pinyin: 'phang-kue', img: 'game9_assets/fruit7.png', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/4/4434.mp3'},
  {name: '葡萄', pinyin: 'phû-tô', img: 'game9_assets/fruit8.png', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/9/9985.mp3'},
  {name: '蓮霧', pinyin: 'lián-bū', img: 'game9_assets/fruit9.png', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/11/11322.mp3'},
  {name: '柳丁', pinyin: 'liú-ting', img: 'game9_assets/fruit10.png', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/5/5078.mp3'},
  {name: '木瓜', pinyin: 'bo̍k-kue', img: 'game9_assets/fruit11.png', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/0/877.mp3'},
  {name: '梨仔', pinyin: 'lâi-á', img: 'game9_assets/fruit12.png', audio: 'https://sutian.moe.edu.tw/media/senn/mp3/imtong/subak/7/7478.mp3'}
];

let usedIndexes = [];
const cube = document.getElementById('cube');
const faces = [...document.querySelectorAll('.cube-face')];
const rollBtn = document.getElementById('roll-btn');
const againBtn = document.getElementById('again-btn');
const fruitNameDiv = document.getElementById('fruit-name');
const rollSound = document.getElementById('roll-sound');
const dingSound = document.getElementById('ding-sound');

function getRandomIndex() {
  if (usedIndexes.length === fruits.length) usedIndexes = [];
  let index;
  do { index = Math.floor(Math.random() * fruits.length); } while(usedIndexes.includes(index));
  usedIndexes.push(index);
  return index;
}

function showFruit(index) {
  const fruit = fruits[index];
  faces.forEach((face, i) => { face.innerHTML = `<img src='${fruit.img}' alt='${fruit.name}'>`; });
  fruitNameDiv.textContent = `${fruit.name} ${fruit.pinyin}`;
  const audio = new Audio(fruit.audio);
  audio.play();
}

function rollCube() {
  rollBtn.disabled = true;
  const index = getRandomIndex();
  rollSound.currentTime = 0;
  rollSound.play();

  const xRand = 720 + Math.floor(Math.random() * 360);
  const yRand = 720 + Math.floor(Math.random() * 360);
  cube.style.transform = `rotateX(${xRand}deg) rotateY(${yRand}deg)`;

  setTimeout(() => {
    rollSound.pause();
    rollSound.currentTime = 0;
    dingSound.currentTime = 0;
    dingSound.play();
    showFruit(index);
    rollBtn.disabled = false;
  }, 1200);
}

rollBtn.addEventListener('click', rollCube);
againBtn.addEventListener('click', rollCube);
</script>
</body>
</html>
